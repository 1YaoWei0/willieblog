{"meta":{"version":1,"warehouse":"5.0.1"},"models":{"Asset":[{"_id":"node_modules/hexo-theme-next/source/css/main.styl","path":"css/main.styl","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-next/source/css/noscript.styl","path":"css/noscript.styl","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-next/source/js/bookmark.js","path":"js/bookmark.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-next/source/js/comments-buttons.js","path":"js/comments-buttons.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-next/source/js/comments.js","path":"js/comments.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-next/source/js/config.js","path":"js/config.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-next/source/js/motion.js","path":"js/motion.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-next/source/js/next-boot.js","path":"js/next-boot.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-next/source/js/pjax.js","path":"js/pjax.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-next/source/js/schedule.js","path":"js/schedule.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-next/source/js/sidebar.js","path":"js/sidebar.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-next/source/js/utils.js","path":"js/utils.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-next/source/images/apple-touch-icon-next.png","path":"images/apple-touch-icon-next.png","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-next/source/images/avatar.gif","path":"images/avatar.gif","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-next/source/images/favicon-16x16-next.png","path":"images/favicon-16x16-next.png","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-next/source/images/favicon-32x32-next.png","path":"images/favicon-32x32-next.png","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-next/source/images/logo-algolia-nebula-blue-full.svg","path":"images/logo-algolia-nebula-blue-full.svg","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-next/source/images/logo.svg","path":"images/logo.svg","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-next/source/js/third-party/addtoany.js","path":"js/third-party/addtoany.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-next/source/js/third-party/fancybox.js","path":"js/third-party/fancybox.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-next/source/js/third-party/pace.js","path":"js/third-party/pace.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-next/source/js/third-party/quicklink.js","path":"js/third-party/quicklink.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-next/source/js/third-party/chat/chatra.js","path":"js/third-party/chat/chatra.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-next/source/js/third-party/chat/tidio.js","path":"js/third-party/chat/tidio.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-next/source/js/third-party/math/katex.js","path":"js/third-party/math/katex.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-next/source/js/third-party/math/mathjax.js","path":"js/third-party/math/mathjax.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-next/source/js/third-party/search/algolia-search.js","path":"js/third-party/search/algolia-search.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-next/source/js/third-party/search/local-search.js","path":"js/third-party/search/local-search.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-next/source/js/third-party/analytics/google-analytics.js","path":"js/third-party/analytics/google-analytics.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-next/source/js/third-party/analytics/growingio.js","path":"js/third-party/analytics/growingio.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-next/source/js/third-party/analytics/baidu-analytics.js","path":"js/third-party/analytics/baidu-analytics.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-next/source/js/third-party/analytics/matomo.js","path":"js/third-party/analytics/matomo.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-next/source/js/third-party/comments/changyan.js","path":"js/third-party/comments/changyan.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-next/source/js/third-party/comments/disqus.js","path":"js/third-party/comments/disqus.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-next/source/js/third-party/comments/disqusjs.js","path":"js/third-party/comments/disqusjs.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-next/source/js/third-party/comments/gitalk.js","path":"js/third-party/comments/gitalk.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-next/source/js/third-party/comments/isso.js","path":"js/third-party/comments/isso.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-next/source/js/third-party/comments/livere.js","path":"js/third-party/comments/livere.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-next/source/js/third-party/comments/utterances.js","path":"js/third-party/comments/utterances.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-next/source/js/third-party/statistics/firestore.js","path":"js/third-party/statistics/firestore.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-next/source/js/third-party/tags/mermaid.js","path":"js/third-party/tags/mermaid.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-next/source/js/third-party/statistics/lean-analytics.js","path":"js/third-party/statistics/lean-analytics.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-next/source/js/third-party/tags/pdf.js","path":"js/third-party/tags/pdf.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-next/source/js/third-party/tags/wavedrom.js","path":"js/third-party/tags/wavedrom.js","modified":0,"renderable":1}],"Cache":[{"_id":"source/_drafts/xpp-open-onhandlist.md","hash":"0df24524b396efb3606b37bdea3f37d775864864","modified":1751976300509},{"_id":"source/_drafts/xpp-export-to-excel.md","hash":"de2d5f384888068258c97ed6f6eeb9bf5488acdc","modified":1751976300509},{"_id":"source/_posts/ai-plateform-flask.md","hash":"ca8c24be5884ea09e1ea0f03799d657ffba03e48","modified":1751976300537},{"_id":"source/_posts/commerce-cache.md","hash":"9f08ba9e11db8dce61a0115f15f66d4846d6673f","modified":1751976300538},{"_id":"source/_posts/d365-documentroutingconfiguration.md","hash":"4baf7293222b7a130693597ba232f84d7ecbe34c","modified":1751979269985},{"_id":"source/_posts/ai-900-exam-preparation-1.md","hash":"3bc00bd359038f3bc08ae263b81959b555f6aa06","modified":1751976300522},{"_id":"source/_posts/API.md","hash":"a8012925db6ac6bef1ed7364033eb08af5749b3b","modified":1751976300509},{"_id":"source/_posts/ai-900-exam-preparation-2.md","hash":"733faf509731ceb20d730f6f6b3cf0acbaa0ac08","modified":1751976300534},{"_id":"source/_posts/commerce-use-languageId.md","hash":"375d0a6bb6e281c6e31e977e69584f1e22fe9795","modified":1751976300538},{"_id":"source/_posts/d365-transferjournalandtransferorder.md","hash":"85afd33bbb6c2fcd43053c43dcfb708108cd098c","modified":1751979043340},{"_id":"source/_posts/flask-tutorial-2.md","hash":"bab7a0ee5a3de3ecc62339db9f116e2401d4d045","modified":1751976300538},{"_id":"source/_posts/xpp-api-list.md","hash":"d0ad7ce34736e06ca0b0ebe158e66187beb741b4","modified":1751976300539},{"_id":"source/_posts/flask-tutorial.md","hash":"0b3bffee0c761675840dfd85a790680e17c3f02f","modified":1751976300538},{"_id":"source/_posts/xpp-createledgerjournals.md","hash":"c0fb1bb78a1c81afece16c2afc8fc5661c19a3ae","modified":1752062921439},{"_id":"source/_posts/mssql-clear-log.md","hash":"0b60ac3d6790d9eeb7dc5820fb9cd364897c2f68","modified":1751976300539},{"_id":"source/_posts/hello-world.md","hash":"d408aa5827b0d5a646e70cae45f348d17cae0228","modified":1751976300538},{"_id":"source/_posts/xpp-extendsalesinvoicereport.md","hash":"1b386e8920e00966658775955e72ff1f9bdbb39f","modified":1752064073608},{"_id":"source/_posts/xpp-debug-configuration.md","hash":"ec7050a5362d6fe39a2a0519984818a7bd5680d4","modified":1751976300540},{"_id":"source/_posts/xpp-extendedvendtransandcusttrans.md","hash":"09a0d3ab0ebb0735758684724d41b5e5638112cf","modified":1752062759968},{"_id":"source/_posts/xpp-getselectedrecords.md","hash":"0d01ba6b2b5499619e0d86829053f90636bf7c05","modified":1751977867995},{"_id":"source/_posts/xpp-merge-ledger-account.md","hash":"790ae29df90b927508ccd31cc5717c8c82586ca9","modified":1751976300541},{"_id":"source/_posts/xpp-onhandinvent.md","hash":"bf49d661c9b24949bc3aba7bf5674e66168c86b8","modified":1751976958457},{"_id":"source/categories/index.md","hash":"8d6e587c05165ff3c748cc18957f49e3865ac289","modified":1751976300543},{"_id":"source/_posts/xpp-open-in-office.md","hash":"43c7b204a06902e11e28749780f31ca1b1c67554","modified":1751976300541},{"_id":"source/_posts/xpp-invoice-purchase-order.md","hash":"042092071be166f14630b20214341c7278b8fe1c","modified":1751976300541},{"_id":"source/tags/index.md","hash":"b2b20e18bcf7c1a61c73838fec84c97518c51954","modified":1751976300543},{"_id":"source/about/index.md","hash":"66b5532340da6443e77647c1814c1ad09c4c9be2","modified":1751976300543},{"_id":"source/_posts/加密存储敏感信息.md","hash":"c7e67eb8c33b02b2333cbcbd8ff8b1eba5cfdd78","modified":1751976300542},{"_id":"source/_posts/API/image2.png","hash":"bdebceaea113a7b3b6c4cb432dad0afad28f7eda","modified":1751976300509},{"_id":"source/_posts/API/image1.png","hash":"450f62ff8aa3a6c3fe3e6c83dacd17060ffa8e3b","modified":1751976300509},{"_id":"source/_posts/API/image4.png","hash":"25570a22f193e67fd0e5335baaa2f9c5a8310d57","modified":1751976300509},{"_id":"source/_posts/API/image3.png","hash":"a54808a625c66a56bbaab66f1b54061badb2a218","modified":1751976300509},{"_id":"source/_posts/API/image5.png","hash":"62b69f54b1c07c3301519b9780f63c4aadb12fbe","modified":1751976300509},{"_id":"source/_posts/ai-900-exam-preparation-2/binary-confusion-matrix.png","hash":"589c4694c10130738cec03f7e0d52f6a3f6a3843","modified":1751976300534},{"_id":"source/_posts/API/image6.png","hash":"a1bdc3710c332cde21cf2fadabeaa1f5f330f6af","modified":1751976300509},{"_id":"source/_posts/ai-900-exam-preparation-2/machine-learning-types.png","hash":"e1ae15afcbb5096da4a0e635f5c8041cde444beb","modified":1751976300535},{"_id":"source/_posts/ai-900-exam-preparation-2/classification-predictions.png","hash":"74b6ebf83fed85f6c4fc9fae2149c82c12e2be6c","modified":1751976300534},{"_id":"source/_posts/ai-900-exam-preparation-2/machine-learning.png","hash":"7ebfe4b2428e211f9e0df224c1ae15434ebbc71f","modified":1751976300536},{"_id":"source/_posts/ai-900-exam-preparation-2/scatter-plot.png","hash":"cc11d3931d675e6f63a5e23757fb9757eb3a8004","modified":1751976300536},{"_id":"source/_posts/ai-900-exam-preparation-2/roc-chart.png","hash":"08b03c4a29945c1183678b063b98f744010fe274","modified":1751976300536},{"_id":"source/_posts/ai-900-exam-preparation-2/sigmoid-plot.png","hash":"0cf61f570573ba43d70def0dd7757bd222a2c79a","modified":1751976300537},{"_id":"source/_posts/ai-900-exam-preparation-2/regression-line.png","hash":"3d29fb5fd1d171f674e11ebcac9c3271829a1c46","modified":1751976300536},{"_id":"source/_posts/ai-900-exam-preparation-2/supervised-training.png","hash":"4f2793c5482e92495467236941758e3aa79d3fad","modified":1751976300537},{"_id":"source/_posts/mssql-clear-log/mssql-clear-log.png","hash":"6d6f92e238a5d60b3aa370640dede1dc58eed509","modified":1751976300539},{"_id":"source/_posts/xpp-extendsalesinvoicereport/CreateNewReport.png","hash":"b5f00e4ecfbc1bc1d0a800c707b594525e9f4fbc","modified":1752063430904},{"_id":"source/_posts/ai-plateform-flask/image.png","hash":"715ef9e63db901a9157d5be93ba6bb9a18810805","modified":1751976300537},{"_id":"source/_posts/xpp-createledgerjournals/CopyJournalDialog.png","hash":"25303d1dd4597662e713aea913d973c651e212d6","modified":1752061257707},{"_id":"source/_posts/commerce-cache/commerce-cache-example.png","hash":"373b25eb3f107582c3eecdea1209473ebae568ee","modified":1751976300538},{"_id":"source/_posts/xpp-extendsalesinvoicereport/ReportDatasets.png","hash":"2b4bf1e0b1dcda4eb3ac57775b533da6ff55f851","modified":1752063540563},{"_id":"source/_posts/xpp-extendsalesinvoicereport/LineTablix.png","hash":"0d5a34ba225a6fd813af06f0a5d61bc0f2190b87","modified":1752063671569},{"_id":"source/_posts/xpp-extendsalesinvoicereport/PrintedReport.png","hash":"ee10b1df43cc58741e77e0192d14728fde77482a","modified":1752063886168},{"_id":"source/_posts/xpp-extendsalesinvoicereport/ReportProperties.png","hash":"78702a1c847e3d681ad301364e6bf3be0919e6c0","modified":1752063586545},{"_id":"source/_posts/xpp-extendsalesinvoicereport/RowVisibility.png","hash":"5811a60c2bedb1e5991595793fb10c4769ea2c90","modified":1752063708447},{"_id":"source/_posts/xpp-api-list/xpp-api-list-recordinsertlist.png","hash":"6b0ec9fa8ce8c1b94ea0d400e25d964a86a2f048","modified":1751976300539},{"_id":"source/_posts/xpp-extendsalesinvoicereport/ReportResulting.png","hash":"542a0313ed57d414c387e10689e27a4268e4a340","modified":1752063743260},{"_id":"source/_posts/d365-documentroutingconfiguration/image-27.png","hash":"de48bdae84d2a1a77c633a2c30e53a21e18eb968","modified":1751978408193},{"_id":"source/_posts/d365-documentroutingconfiguration/image-34.png","hash":"2593bfaf1630ded5a9ff93a16523baa76cd6fd68","modified":1751978619042},{"_id":"source/_posts/d365-documentroutingconfiguration/image-33.png","hash":"ec604517556bf16ab9448283c0873bf90f34e1d1","modified":1751978580621},{"_id":"source/_posts/d365-documentroutingconfiguration/image-35.png","hash":"7fb5f7b8976a0c97d8fc4a6745fb1e02fb4d18fb","modified":1751978648369},{"_id":"source/_posts/d365-documentroutingconfiguration/image-40.png","hash":"b68afe36ee486b98ee47478e75233e12b48cb25f","modified":1751978755388},{"_id":"source/_posts/d365-documentroutingconfiguration/image-46.png","hash":"27de22407cd73be14bbb8b8d1eb2cdc39e98207f","modified":1751978865393},{"_id":"source/_posts/加密存储敏感信息/75c34455b6d94fd5a859979b5462f90d.png","hash":"6b3500b7cf605f3de4b7a8cf7d14b6449e1ebc2d","modified":1751976300542},{"_id":"source/_posts/d365-documentroutingconfiguration/image-47.png","hash":"eda554c0565f8c1882cd9090c94b7bb7de0e3560","modified":1751978939069},{"_id":"source/_posts/加密存储敏感信息/c3f95d2ff64b427591d18ce311bcefea.png","hash":"9ea435979f114eb0f7ad41c48dbe63bcf3febda2","modified":1751976300542},{"_id":"source/_posts/xpp-open-in-office/xpp-open-in-office.png","hash":"e5597ae72ec0f393eefdba5b392300a018ad3a67","modified":1751976300541},{"_id":"source/_posts/xpp-open-in-office/xpp-open-in-office3.png","hash":"35a5d7ece7eef51acd7d862a869a63a47492fb64","modified":1751976300542},{"_id":"source/_posts/xpp-open-in-office/xpp-open-in-office2.png","hash":"d34920c5e53717299fbae46a4382ed2373ea5c07","modified":1751976300542},{"_id":"source/_posts/API/image7.png","hash":"307a64abcf7f56bd8bfb838a738f78d1fa2a38c7","modified":1751976300522},{"_id":"source/_posts/xpp-debug-configuration/xpp-debug-configuration.png","hash":"f613c9fc9f3dd1eb3a5b54aa158cde9224f0cc9e","modified":1751976300540},{"_id":"source/_posts/d365-documentroutingconfiguration/image-26.png","hash":"016684a9a67b88995178c6ac622ff55ab93d6da4","modified":1751978381442},{"_id":"source/_posts/d365-documentroutingconfiguration/image-30.png","hash":"de42324e871c07bdb8c4adea25f68f13888e4519","modified":1751978472949},{"_id":"source/_posts/d365-documentroutingconfiguration/image-28.png","hash":"13abe5ec8b08ff38590067cca417e827a5e266af","modified":1751978429403},{"_id":"source/_posts/d365-documentroutingconfiguration/image-32.png","hash":"b0ef1f1f666228328d934a3724cb20125ecabb3d","modified":1751978556249},{"_id":"source/_posts/d365-documentroutingconfiguration/image-36.png","hash":"320f9ca1c9e69181dbbc5be81ea5e8caae2ac542","modified":1751978677485},{"_id":"source/_posts/d365-documentroutingconfiguration/image-37.png","hash":"037b833b85e1e42ad5ac7244d2a8eb9e30a7675c","modified":1751978690673},{"_id":"source/_posts/d365-documentroutingconfiguration/image-41.png","hash":"ac96eeb43d3359e034c621fc60be82a6a4888a6a","modified":1751978769369},{"_id":"source/_posts/d365-documentroutingconfiguration/image-42.png","hash":"eaf909332d594faffa98bca18ea992adc09e14b0","modified":1751978795208},{"_id":"source/_posts/d365-documentroutingconfiguration/image-39.png","hash":"32f1bad5545503d89baa2248a94d5538c5753cdc","modified":1751978731921},{"_id":"source/_posts/d365-documentroutingconfiguration/image-45.png","hash":"08c4558e4823d176aa54df442cf59dd8782bcd67","modified":1751978841570},{"_id":"source/_posts/d365-documentroutingconfiguration/image-48.png","hash":"da3598ac9bd996c78751f89c9f8007c581ea3b67","modified":1751978954934},{"_id":"source/_posts/d365-documentroutingconfiguration/image-49.png","hash":"81f1efe62befe58767343604fb4754c0fbe850e6","modified":1751978987963},{"_id":"source/_posts/d365-documentroutingconfiguration/image-25.png","hash":"e5d04a6b69c0703a0e907a920bcdfedf46414c4b","modified":1751978291503},{"_id":"source/_posts/d365-documentroutingconfiguration/image-31.png","hash":"dc60ecd9e823683c09c36f7eda1c52d15f612358","modified":1751978526017},{"_id":"source/_posts/d365-documentroutingconfiguration/image-38.png","hash":"ee6aa6b26b27219937f83f52bb5e1b102e9af66d","modified":1751978709423},{"_id":"source/_posts/d365-documentroutingconfiguration/image-43.png","hash":"a132ae3278112f876f61f6d1f886df17cf63556d","modified":1751978818818},{"_id":"source/_posts/d365-documentroutingconfiguration/image-29.png","hash":"b2c239135d5a4787fd8f933a6d22fb6694d9e0da","modified":1751978456363},{"_id":"source/_posts/ai-900-exam-preparation-1/document-intelligence-studio.png","hash":"d4ab717f5d0775d2f0ca479669632925e9276fe8","modified":1751976300524},{"_id":"node_modules/hexo-theme-next/package.json","hash":"26e77380c9dd66388b9fd34eb9aac3e0ad510731","modified":1751976612345},{"_id":"node_modules/hexo-theme-next/_vendors.yml","hash":"312fa7c1ae472e18d88f6d01c54dc6f32f66255c","modified":1751976612520},{"_id":"node_modules/hexo-theme-next/LICENSE.md","hash":"68fc9a03d50fd4b5ea97092b05967d1819dea2c4","modified":1751976612345},{"_id":"node_modules/hexo-theme-next/README.md","hash":"5dd295594b92dbe07b0376b505f29fb3884e77f9","modified":1751976612361},{"_id":"node_modules/hexo-theme-next/docs/AUTHORS.md","hash":"a648823121563c34a177ae91f5a774b5e29f01a0","modified":1751976612345},{"_id":"node_modules/hexo-theme-next/docs/LICENSE.txt","hash":"f5b14f791b7cfa1d16da981d929152e088a5d1b8","modified":1751976612504},{"_id":"node_modules/hexo-theme-next/docs/AGPL3.md","hash":"0d2b8c5fa8a614723be0767cc3bca39c49578036","modified":1751976612345},{"_id":"node_modules/hexo-theme-next/_config.yml","hash":"dbbd054721541f4d1f4fed4bc983bc19ff1f259a","modified":1751976612520},{"_id":"node_modules/hexo-theme-next/layout/page.njk","hash":"af6d7570621be760536c216a56d74e40a1cceae2","modified":1751976612418},{"_id":"node_modules/hexo-theme-next/layout/post.njk","hash":"0bfce9f133f501a9a4837257e3b862b3bbca15be","modified":1751976612427},{"_id":"node_modules/hexo-theme-next/layout/_layout.njk","hash":"fc0a45112f2dcfc2642404e8934ea32a793c3bd7","modified":1751976612361},{"_id":"node_modules/hexo-theme-next/layout/category.njk","hash":"c68b7343d0f8145010f93351908cc36ef6212ec1","modified":1751976612379},{"_id":"node_modules/hexo-theme-next/layout/index.njk","hash":"dd63e488ae8cc144335a5958acedf6a16edd7a92","modified":1751976612405},{"_id":"node_modules/hexo-theme-next/layout/tag.njk","hash":"9e16ba20c28a7f2c6bc75aa427f48122301a30aa","modified":1751976612427},{"_id":"node_modules/hexo-theme-next/languages/ar.yml","hash":"7d0f39e8684284a04bb9808521c87fecda8bd131","modified":1751976612520},{"_id":"node_modules/hexo-theme-next/layout/archive.njk","hash":"d759f4d2cf5ddc6875ea250113a00662c1caf6d1","modified":1751976612361},{"_id":"node_modules/hexo-theme-next/languages/README.md","hash":"b2567e32805dda79601157351a07e5ca9fe01315","modified":1751976612361},{"_id":"node_modules/hexo-theme-next/languages/bn.yml","hash":"564bed75da6e05b11dce6164508f97a15e2fb6c2","modified":1751976612520},{"_id":"node_modules/hexo-theme-next/languages/eo.yml","hash":"e34bb33ae827bf2f0727088599a73bc64bdad1b0","modified":1751976612520},{"_id":"node_modules/hexo-theme-next/languages/de.yml","hash":"79b37df731c29665dee6cd7c90d278e1edfb6e24","modified":1751976612520},{"_id":"node_modules/hexo-theme-next/languages/es.yml","hash":"dffc63ef42e1266b88e0acf08994fd17a9908d53","modified":1751976612520},{"_id":"node_modules/hexo-theme-next/languages/en.yml","hash":"ba0fd79a2b1d8db01a034180556061745965ff05","modified":1751976612520},{"_id":"node_modules/hexo-theme-next/languages/fa.yml","hash":"f3ffc444599f4ac92d62e9ed00a1490ebc277d70","modified":1751976612520},{"_id":"node_modules/hexo-theme-next/languages/id.yml","hash":"929df147f4f17d638b07de5fe52ca13e2549ab1c","modified":1751976612520},{"_id":"node_modules/hexo-theme-next/languages/fr.yml","hash":"8ac44e58f71a38b7697a2f7f98a6971ed818cb5b","modified":1751976612520},{"_id":"node_modules/hexo-theme-next/languages/it.yml","hash":"16d716ecfd748def2f6486ef5a82d0ab7ceb4890","modified":1751976612520},{"_id":"node_modules/hexo-theme-next/languages/pt.yml","hash":"b62faaa767a45a613dd042b5f1903675eb5a8cf9","modified":1751976612538},{"_id":"node_modules/hexo-theme-next/languages/pt-BR.yml","hash":"76b8576ce228d540a16b1f0af5af2cce20923194","modified":1751976612538},{"_id":"node_modules/hexo-theme-next/languages/ko.yml","hash":"d345a303310c8a5f4836c3683f3580f861ebd1b4","modified":1751976612536},{"_id":"node_modules/hexo-theme-next/languages/ja.yml","hash":"543222bfc516aab6c33e8534f807972ecb8943a9","modified":1751976612520},{"_id":"node_modules/hexo-theme-next/languages/nl.yml","hash":"3cb3687696635ec71b4ca40c5fc43b56acc8843e","modified":1751976612537},{"_id":"node_modules/hexo-theme-next/languages/si.yml","hash":"2d712eedf3f60d04d36c3108cf5a12e2a52e875c","modified":1751976612538},{"_id":"node_modules/hexo-theme-next/languages/ru.yml","hash":"c6d8de0ff7d8148d09993257cfd3b7aca755696c","modified":1751976612538},{"_id":"node_modules/hexo-theme-next/languages/tk.yml","hash":"511726054873f6f8d7ce0d2e803f6731de0ddbe7","modified":1751976612544},{"_id":"node_modules/hexo-theme-next/languages/th.yml","hash":"6829e998b39f8f143e20b276bb1f62d95a29de58","modified":1751976612538},{"_id":"node_modules/hexo-theme-next/languages/vi.yml","hash":"7ebcba5e1128784195e4681dffc9d34c4e873fec","modified":1751976612545},{"_id":"node_modules/hexo-theme-next/languages/uk.yml","hash":"ff537047b4b4c3ca9a7b64fa7f428a9942751eeb","modified":1751976612545},{"_id":"node_modules/hexo-theme-next/languages/tr.yml","hash":"a57e4ed089b893a95f5e1ecff17ce625165f4d46","modified":1751976612545},{"_id":"node_modules/hexo-theme-next/languages/zh-CN.yml","hash":"741d7efe0262c9cdc2c648014b55599665d90f6b","modified":1751976612545},{"_id":"node_modules/hexo-theme-next/languages/zh-HK.yml","hash":"8eb6a9f231ce1bfa54cc54418ccf14f01dcc9a31","modified":1751976612545},{"_id":"node_modules/hexo-theme-next/languages/zh-TW.yml","hash":"5c0f00cdac3f4727b880dd223f622a535736fa8e","modified":1751976612545},{"_id":"node_modules/hexo-theme-next/docs/zh-CN/CODE_OF_CONDUCT.md","hash":"12a6631617695504d5cf2a94b57d87bd331bef6f","modified":1751976612345},{"_id":"node_modules/hexo-theme-next/scripts/filters/default-injects.js","hash":"872f01cb10e422a648ea505436532e776e92926b","modified":1751976612198},{"_id":"node_modules/hexo-theme-next/docs/ru/README.md","hash":"285d5c4dffb97da659851fb6e53379a614619fd9","modified":1751976612361},{"_id":"node_modules/hexo-theme-next/scripts/filters/locals.js","hash":"9eb5310664759931287dd28ea39165dfb67f12ed","modified":1751976612295},{"_id":"node_modules/hexo-theme-next/scripts/filters/post.js","hash":"fdc8a0af90035e89c3fcb754a0eb189b8951a2bc","modified":1751976612331},{"_id":"node_modules/hexo-theme-next/scripts/filters/minify.js","hash":"2063aaa1db448ebcf7b0fdbbc54d3991a368bbd3","modified":1751976612305},{"_id":"node_modules/hexo-theme-next/docs/zh-CN/CONTRIBUTING.md","hash":"a089f7a8368ab0b7d7b9b7ec0ac3767a453435df","modified":1751976612345},{"_id":"node_modules/hexo-theme-next/scripts/helpers/engine.js","hash":"049b1a0b66563e39f68710bb576a8c7342ae749c","modified":1751976612214},{"_id":"node_modules/hexo-theme-next/scripts/helpers/font.js","hash":"f2d45eb3f03662033608075e3fa895498d08712d","modified":1751976612238},{"_id":"node_modules/hexo-theme-next/scripts/helpers/navigation.js","hash":"78107021101553c3d23e89290f7530b60cf4aa86","modified":1751976612305},{"_id":"node_modules/hexo-theme-next/scripts/helpers/next-config.js","hash":"25bb3ec3c7c456aa1d1650eb139605b7df7394eb","modified":1751976612317},{"_id":"node_modules/hexo-theme-next/scripts/helpers/next-paginator.js","hash":"e86c764b546e4fbb87970cabc4135a56f9ef9fe1","modified":1751976612319},{"_id":"node_modules/hexo-theme-next/scripts/helpers/next-url.js","hash":"6281d47c1de98eb38f3aa0f6df29bbb19d412173","modified":1751976612320},{"_id":"node_modules/hexo-theme-next/docs/zh-CN/README.md","hash":"21567f1810f861b0a33db6514a4fcf18fb98467d","modified":1751976612361},{"_id":"node_modules/hexo-theme-next/scripts/helpers/next-vendors.js","hash":"af3946a595f997eb43d9af87428e4898c9acbc82","modified":1751976612322},{"_id":"node_modules/hexo-theme-next/scripts/events/index.js","hash":"bd9ea82376cd87df611ea3ae077875c7c595a3df","modified":1751976612265},{"_id":"node_modules/hexo-theme-next/scripts/tags/button.js","hash":"c6ad2ed544fbb25ecb5d820c36e76302504271b7","modified":1751976612137},{"_id":"node_modules/hexo-theme-next/scripts/tags/center-quote.js","hash":"92c19d796bdb3320df9caea59bf52df7a95d9da9","modified":1751976612147},{"_id":"node_modules/hexo-theme-next/scripts/tags/caniuse.js","hash":"935a311142a409c1896b3ae3f01fe7a9e2db1134","modified":1751976612145},{"_id":"node_modules/hexo-theme-next/scripts/tags/index.js","hash":"1f6aba7820f1fb58b61969485148db21846e1aa9","modified":1751976612268},{"_id":"node_modules/hexo-theme-next/scripts/tags/label.js","hash":"8a73348186113bae0a51ea2f891c1bb882fab05a","modified":1751976612281},{"_id":"node_modules/hexo-theme-next/scripts/tags/group-pictures.js","hash":"f57f7e09eb6220f681fa8385082b0960502ce5c4","modified":1751976612251},{"_id":"node_modules/hexo-theme-next/scripts/tags/mermaid.js","hash":"7d7bbc4a9970bd4c5449bc71b94364a8ec61e5d2","modified":1751976612304},{"_id":"node_modules/hexo-theme-next/scripts/tags/note.js","hash":"7b94ddb46b7d4b0fe815f2fbe4bd375f07f55363","modified":1751976612323},{"_id":"node_modules/hexo-theme-next/scripts/tags/link-grid.js","hash":"18a483c2d5afd701f6080ffdddf2d1321370336c","modified":1751976612288},{"_id":"node_modules/hexo-theme-next/scripts/tags/pdf.js","hash":"344636b6fd7e27e8831c1e194039afc0d61931cd","modified":1751976612326},{"_id":"node_modules/hexo-theme-next/scripts/tags/tabs.js","hash":"0eabe51da40b4b13e16419c8fe02452d9a4fef73","modified":1751976612337},{"_id":"node_modules/hexo-theme-next/scripts/tags/video.js","hash":"2ee926448583be8f95af1f2884ae2c9c4830151d","modified":1751976612345},{"_id":"node_modules/hexo-theme-next/scripts/tags/wavedrom.js","hash":"b44dfeeb58b41945d469141787f3dbce4b117d08","modified":1751976612345},{"_id":"node_modules/hexo-theme-next/source/css/_mixins.styl","hash":"e21309d4165ebb6645084eed8dd749846ae981f1","modified":1751976612443},{"_id":"node_modules/hexo-theme-next/source/css/_colors.styl","hash":"ebfe0954e3931431f46f913abe08d0212e06e7c2","modified":1751976612427},{"_id":"node_modules/hexo-theme-next/source/css/main.styl","hash":"921a58577f411cf4eb5cfd66db0a241f8f88578c","modified":1751976612484},{"_id":"node_modules/hexo-theme-next/source/css/noscript.styl","hash":"dadc81256afb127b77eac6763d5ee0ec9c77f0a3","modified":1751976612490},{"_id":"node_modules/hexo-theme-next/source/js/comments.js","hash":"66ae2e26ea36a41b72c638ea8b220296638ae952","modified":1751976612181},{"_id":"node_modules/hexo-theme-next/source/js/comments-buttons.js","hash":"1a7344440321713426a0b2ab17e276b5bdf85ade","modified":1751976612177},{"_id":"node_modules/hexo-theme-next/source/js/bookmark.js","hash":"9ba4cceafd12c6d5ba8a6b986a046ef8319a7811","modified":1751976612132},{"_id":"node_modules/hexo-theme-next/source/js/config.js","hash":"4c4ebbe3b3f3841a26f9d5af6d0ba8bc6da01c54","modified":1751976612194},{"_id":"node_modules/hexo-theme-next/source/js/motion.js","hash":"6f751f5c9499a39d7c5e1d323db3260342dd9431","modified":1751976612305},{"_id":"node_modules/hexo-theme-next/source/js/next-boot.js","hash":"8e2d589585f5270ee90285d3e65b69923c7629d8","modified":1751976612305},{"_id":"node_modules/hexo-theme-next/source/js/pjax.js","hash":"0996078604f356a4f6692b9b0838038b3b10aa8a","modified":1751976612329},{"_id":"node_modules/hexo-theme-next/source/js/schedule.js","hash":"a1333258726caf84f368a8f8454639c7dc1626bb","modified":1751976612334},{"_id":"node_modules/hexo-theme-next/source/js/sidebar.js","hash":"2ee359ae48273b01ba1e0768704524e08702c7eb","modified":1751976612335},{"_id":"node_modules/hexo-theme-next/source/js/utils.js","hash":"d7954a623be2ee9fe3eadc785b17c17afac6c34d","modified":1751976612341},{"_id":"node_modules/hexo-theme-next/source/images/favicon-16x16-next.png","hash":"943a0d67a9cdf8c198109b28f9dbd42f761d11c3","modified":1751976612427},{"_id":"node_modules/hexo-theme-next/source/images/apple-touch-icon-next.png","hash":"2959dbc97f31c80283e67104fe0854e2369e40aa","modified":1751976612427},{"_id":"node_modules/hexo-theme-next/source/images/avatar.gif","hash":"2dbc3e2f2d624b2ca1afe6edc2ca17307f1950c8","modified":1751976612055},{"_id":"node_modules/hexo-theme-next/source/images/logo.svg","hash":"099e11ab995a2c8981427a85476d082609848c77","modified":1751976612504},{"_id":"node_modules/hexo-theme-next/source/images/logo-algolia-nebula-blue-full.svg","hash":"a38c6d92b368bfc42c72ad799ad03f3274957065","modified":1751976612504},{"_id":"node_modules/hexo-theme-next/layout/_scripts/index.njk","hash":"51704a2eadb0d363762ebf2e44994696e0843e40","modified":1751976612400},{"_id":"node_modules/hexo-theme-next/source/images/favicon-32x32-next.png","hash":"0749d7b24b0d2fae1c8eb7f671ad4646ee1894b1","modified":1751976612427},{"_id":"node_modules/hexo-theme-next/layout/_scripts/vendors.njk","hash":"be80b9fe415a9a09d74c28e230995fd292dfc123","modified":1751976612427},{"_id":"node_modules/hexo-theme-next/layout/_macro/post-collapse.njk","hash":"313637fe3569f98fd926e8cd0fcc75d098eb6e6e","modified":1751976612420},{"_id":"node_modules/hexo-theme-next/layout/_macro/sidebar.njk","hash":"547c62ab14d9e05d2d9116db9048a677fbe1fb6d","modified":1751976612427},{"_id":"node_modules/hexo-theme-next/layout/_partials/comments.njk","hash":"d0c470b0f6690aa217e9ada848c5e2e73fb27c6f","modified":1751976612385},{"_id":"node_modules/hexo-theme-next/layout/_macro/post.njk","hash":"952449064fcb6a5cefc281b585f9149809f857f1","modified":1751976612426},{"_id":"node_modules/hexo-theme-next/layout/_partials/pagination.njk","hash":"bc719473ed5948ab6859449d60b8d36cfc1542b4","modified":1751976612418},{"_id":"node_modules/hexo-theme-next/layout/_partials/footer.njk","hash":"fbf8232cacf0df87e88e74860be66c9f86018302","modified":1751976612385},{"_id":"node_modules/hexo-theme-next/layout/_third-party/addtoany.njk","hash":"ef64c6bfb8540cd874701236b9be47db2496e98e","modified":1751976612361},{"_id":"node_modules/hexo-theme-next/layout/_third-party/fancybox.njk","hash":"844559f46e2ff1c8be234d5763703106e2072a7b","modified":1751976612385},{"_id":"node_modules/hexo-theme-next/layout/_third-party/index.njk","hash":"dfd7cdd6ba89f8c3deabc27726c7a350cadafd11","modified":1751976612402},{"_id":"node_modules/hexo-theme-next/layout/_third-party/pace.njk","hash":"d7ad5714079f7f65446f880baf14722435ca9061","modified":1751976612416},{"_id":"node_modules/hexo-theme-next/layout/_partials/widgets.njk","hash":"d83fb59f02c5e6630a7770401a05c02f6f07358b","modified":1751976612427},{"_id":"node_modules/hexo-theme-next/layout/_third-party/quicklink.njk","hash":"0efed71ed530447718c4ea5bbd5fc8695b0b0d5f","modified":1751976612427},{"_id":"node_modules/hexo-theme-next/scripts/filters/comment/changyan.js","hash":"5798cfc8f63665031dd3e01debed051628cec319","modified":1751976612158},{"_id":"node_modules/hexo-theme-next/layout/_partials/languages.njk","hash":"e43f22198cccb5f6e306b1ce0d28d12a4fb891f8","modified":1751976612407},{"_id":"node_modules/hexo-theme-next/scripts/filters/comment/common.js","hash":"19a402a225c31edffc50f202a14e0d582d3db23e","modified":1751976612184},{"_id":"node_modules/hexo-theme-next/scripts/filters/comment/disqusjs.js","hash":"a600a98e7436edeb31e291abca359885567df3c9","modified":1751976612198},{"_id":"node_modules/hexo-theme-next/scripts/filters/comment/disqus.js","hash":"7f71d6b271ba65ff333d5682e7575711d368c0d2","modified":1751976612198},{"_id":"node_modules/hexo-theme-next/scripts/filters/comment/gitalk.js","hash":"7bb7dafdd7f6bca8464b54e17e552ce7f1714195","modified":1751976612238},{"_id":"node_modules/hexo-theme-next/scripts/filters/comment/default-config.js","hash":"93ee5f9109dad885dc38c49bcee630c10f9dce6e","modified":1751976612197},{"_id":"node_modules/hexo-theme-next/scripts/filters/comment/isso.js","hash":"ff8b5b5145220a17d0ecd9508ba9bd2d3b2da47d","modified":1751976612272},{"_id":"node_modules/hexo-theme-next/scripts/filters/comment/livere.js","hash":"5a07d8bb52bc1d51a624ca8db54be144566c306b","modified":1751976612291},{"_id":"node_modules/hexo-theme-next/scripts/filters/comment/utterances.js","hash":"d3bded697bc32dace689d2a6dfb6eb7514169d15","modified":1751976612342},{"_id":"node_modules/hexo-theme-next/scripts/events/lib/highlight.js","hash":"8a8f752260be5b8098393f9879b61ffe904465e8","modified":1751976612251},{"_id":"node_modules/hexo-theme-next/scripts/events/lib/injects.js","hash":"d987709267a1bc6e5014411e9983d7c49c102c16","modified":1751976612271},{"_id":"node_modules/hexo-theme-next/scripts/events/lib/config.js","hash":"9ec51eb61f7fee612ffc5252f489003a0fa301fc","modified":1751976612189},{"_id":"node_modules/hexo-theme-next/scripts/events/lib/navigation.js","hash":"dd3562686d95a50375e6fd32e717ccb0d99c1e3d","modified":1751976612305},{"_id":"node_modules/hexo-theme-next/scripts/events/lib/utils.js","hash":"5942feb3f31ed3480bf50b0f5a4a305b5bdca3d6","modified":1751976612339},{"_id":"node_modules/hexo-theme-next/scripts/events/lib/vendors.js","hash":"e2b4a9d6b08155735ec336eedc506763d5671821","modified":1751976612345},{"_id":"node_modules/hexo-theme-next/source/css/_variables/Muse.styl","hash":"879b49f693af0c04c285b2dd0c9cccaf77347b7c","modified":1751976612488},{"_id":"node_modules/hexo-theme-next/source/js/third-party/addtoany.js","hash":"5276c8f78ee562a8965216dc67d762e59cb4a9f2","modified":1751976612078},{"_id":"node_modules/hexo-theme-next/source/css/_variables/base.styl","hash":"e814de4dab6aee6153d0a46438c231f94ed05e73","modified":1751976612443},{"_id":"node_modules/hexo-theme-next/source/css/_variables/Mist.styl","hash":"2c800eaab6c613e5d091be2111aaa786641aa0c2","modified":1751976612487},{"_id":"node_modules/hexo-theme-next/source/css/_variables/Pisces.styl","hash":"20d5c6aa136bbb55e03906d98ee90ad3fbaa80a7","modified":1751976612493},{"_id":"node_modules/hexo-theme-next/source/js/third-party/pace.js","hash":"0ef04218b93561ba4d0ff420d556c3d90a756d32","modified":1751976612324},{"_id":"node_modules/hexo-theme-next/source/js/third-party/quicklink.js","hash":"eed02e6fced8e5a653077205d4d4d7834ca71472","modified":1751976612332},{"_id":"node_modules/hexo-theme-next/source/js/third-party/fancybox.js","hash":"819f382c561fe5ec23c67cc5fabd63dd1cc22dc1","modified":1751976612214},{"_id":"node_modules/hexo-theme-next/layout/_partials/header/index.njk","hash":"650de421a8ce4cf685428ffbe0087ff84cbd1356","modified":1751976612397},{"_id":"node_modules/hexo-theme-next/layout/_partials/head/head.njk","hash":"5388b157bba4a40b9312f4a45c6678974ccf0837","modified":1751976612397},{"_id":"node_modules/hexo-theme-next/layout/_partials/head/head-unique.njk","hash":"93c1d103d9d16581c944c51f3d0638f57c80ee41","modified":1751976612385},{"_id":"node_modules/hexo-theme-next/source/css/_variables/Gemini.styl","hash":"96e0a7c2a65ce68215e17e369085b2ea2f1334f2","modified":1751976612465},{"_id":"node_modules/hexo-theme-next/layout/_partials/header/menu.njk","hash":"ee6fc2f111572d3eeab0a2fecbb2d6b3e37ab26b","modified":1751976612414},{"_id":"node_modules/hexo-theme-next/layout/_partials/header/sub-menu.njk","hash":"06480d8ec5f0b87eafd47f082f07968d7282dd5c","modified":1751976612427},{"_id":"node_modules/hexo-theme-next/layout/_partials/page/categories.njk","hash":"17156d99941f28a225951ffdcfa9a115e20dc2d2","modified":1751976612379},{"_id":"node_modules/hexo-theme-next/layout/_partials/page/page-header.njk","hash":"7ed4f102a1825195cff8d7995bf9219f323a9034","modified":1751976612417},{"_id":"node_modules/hexo-theme-next/layout/_partials/header/menu-item.njk","hash":"41a8b0cc16f60fa085cb719d07216d86b6bc4bf8","modified":1751976612413},{"_id":"node_modules/hexo-theme-next/layout/_partials/page/schedule.njk","hash":"0f4bc8e257da60f77c0c1738607b2bde55810684","modified":1751976612427},{"_id":"node_modules/hexo-theme-next/layout/_partials/header/brand.njk","hash":"dd9c4c03e99dfde0dfb8edefcb2c933f2f560efc","modified":1751976612361},{"_id":"node_modules/hexo-theme-next/layout/_partials/page/tags.njk","hash":"a18d1598e36cc72f2b0b24c3cc3c5990dfaa3254","modified":1751976612427},{"_id":"node_modules/hexo-theme-next/layout/_partials/page/breadcrumb.njk","hash":"89825e75cc45e9709fa6ba89883669eedaff6f46","modified":1751976612376},{"_id":"node_modules/hexo-theme-next/layout/_partials/post/post-copyright.njk","hash":"bfff923526d6800218f08dba6ce0bbf5c17755fd","modified":1751976612421},{"_id":"node_modules/hexo-theme-next/layout/_partials/search/index.njk","hash":"6ad43135bd3aecf933ffdd750763e27ade36f97c","modified":1751976612400},{"_id":"node_modules/hexo-theme-next/layout/_partials/post/post-followme.njk","hash":"c1e33b4889f75acc490af3c8bde0ec56c518ff41","modified":1751976612422},{"_id":"node_modules/hexo-theme-next/layout/_partials/sidebar/site-overview.njk","hash":"bc5708e38b6070dff0cab6bf9480971017ce4dda","modified":1751976612427},{"_id":"node_modules/hexo-theme-next/layout/_partials/post/post-reward.njk","hash":"e8b8a7c41e9ec612d0c0c73419529d55d1c16256","modified":1751976612424},{"_id":"node_modules/hexo-theme-next/layout/_partials/post/post-related.njk","hash":"e0986db00a0201dd3c60570f964829c84ba5bc68","modified":1751976612424},{"_id":"node_modules/hexo-theme-next/layout/_third-party/chat/chatra.njk","hash":"d7263fca16d0278ccf1f6aa1c6df6902a6344a09","modified":1751976612385},{"_id":"node_modules/hexo-theme-next/layout/_partials/post/post-share.njk","hash":"16696990e4ce65fc8db18c4635082a5d5d06ff07","modified":1751976612425},{"_id":"node_modules/hexo-theme-next/layout/_third-party/chat/tidio.njk","hash":"02aab857c27fc103216029be991688b12a73a525","modified":1751976612427},{"_id":"node_modules/hexo-theme-next/layout/_partials/post/post-meta.njk","hash":"9fa47e4fb342811da590ee4adc91cf81118c0a39","modified":1751976612423},{"_id":"node_modules/hexo-theme-next/layout/_third-party/analytics/baidu-analytics.njk","hash":"6215309aee028dcb734452beec448c5afb6c63fc","modified":1751976612361},{"_id":"node_modules/hexo-theme-next/layout/_third-party/analytics/google-analytics.njk","hash":"d89066ff53879693f023e540d59c86137172c529","modified":1751976612385},{"_id":"node_modules/hexo-theme-next/layout/_third-party/analytics/cloudflare.njk","hash":"a5b8297c2c383124dd6a56e256ecc0c0dcf489be","modified":1751976612385},{"_id":"node_modules/hexo-theme-next/layout/_third-party/analytics/index.njk","hash":"f900306497b133e8b098bd9f4b96b93d1d96c185","modified":1751976612401},{"_id":"node_modules/hexo-theme-next/layout/_third-party/analytics/matomo.njk","hash":"4e89648a8ec8194c5823064cbca39c938a799006","modified":1751976612412},{"_id":"node_modules/hexo-theme-next/layout/_third-party/analytics/microsoft-clarity.njk","hash":"1efeeda00db08a3c033798228dd0092ee532cc36","modified":1751976612415},{"_id":"node_modules/hexo-theme-next/layout/_third-party/analytics/growingio.njk","hash":"8afaa772c390bd9d53a5cff9645ac3168334eb98","modified":1751976612385},{"_id":"node_modules/hexo-theme-next/layout/_third-party/analytics/plausible.njk","hash":"ef9f2bb7110507f1c4336800af9157d5fa9765bd","modified":1751976612419},{"_id":"node_modules/hexo-theme-next/layout/_third-party/analytics/umami.njk","hash":"3343750682fbd8535e50f8129be3003ad26015b4","modified":1751976612427},{"_id":"node_modules/hexo-theme-next/layout/_third-party/math/katex.njk","hash":"1ebf658690468ea197bdd0416eb7cfa4bd0b083a","modified":1751976612406},{"_id":"node_modules/hexo-theme-next/layout/_third-party/math/mathjax.njk","hash":"3677017fd4572b158311f5f5d870590ab25184e0","modified":1751976612411},{"_id":"node_modules/hexo-theme-next/layout/_third-party/comments/changyan.njk","hash":"d1c950f8fbdf85e7a3eae5463767a89e858e8220","modified":1751976612379},{"_id":"node_modules/hexo-theme-next/layout/_third-party/comments/disqus.njk","hash":"9375b19a89b7fa9474e558d085af5448d4c5c50c","modified":1751976612385},{"_id":"node_modules/hexo-theme-next/layout/_third-party/comments/disqusjs.njk","hash":"0749cb6902baecdfd01f779a2a2513f6d2f6a823","modified":1751976612385},{"_id":"node_modules/hexo-theme-next/layout/_third-party/comments/gitalk.njk","hash":"b63b7e2ede0d3e66e732fa1a06bda9b19e1e85d4","modified":1751976612385},{"_id":"node_modules/hexo-theme-next/layout/_third-party/comments/isso.njk","hash":"64cc3bdaf644fd32c0d0a247f29f5b6904da9af3","modified":1751976612405},{"_id":"node_modules/hexo-theme-next/layout/_third-party/comments/livere.njk","hash":"3b13b09fba84ec6000886890a6710736a2b8fafe","modified":1751976612409},{"_id":"node_modules/hexo-theme-next/layout/_third-party/comments/utterances.njk","hash":"5a94032bc3512a10ad4328fc19ec07b819a1d687","modified":1751976612427},{"_id":"node_modules/hexo-theme-next/layout/_third-party/math/index.njk","hash":"abf37fc55aa86702118e8fdf5bf2d389dd589aa0","modified":1751976612403},{"_id":"node_modules/hexo-theme-next/layout/_third-party/tags/mermaid.njk","hash":"099e031f52fb8e47b3af5b2684737efc9e643ee7","modified":1751976612415},{"_id":"node_modules/hexo-theme-next/layout/_third-party/search/algolia-search.njk","hash":"41b28f05e6233fb37700f7151f55868be10a0965","modified":1751976612361},{"_id":"node_modules/hexo-theme-next/layout/_third-party/tags/wavedrom.njk","hash":"02202bf563fb5eedde2ccad4d6c5b9109d30a703","modified":1751976612427},{"_id":"node_modules/hexo-theme-next/layout/_third-party/tags/pdf.njk","hash":"2c81984cc4f5123103460442f6e046f5b6c97127","modified":1751976612419},{"_id":"node_modules/hexo-theme-next/layout/_third-party/search/localsearch.njk","hash":"e45ea3542cdc9ed7ec8447b5e6f35df4c5e82758","modified":1751976612411},{"_id":"node_modules/hexo-theme-next/layout/_third-party/statistics/busuanzi-counter.njk","hash":"55c2468b2b7f035881d494085527d6554f37b556","modified":1751976612379},{"_id":"node_modules/hexo-theme-next/layout/_third-party/statistics/firestore.njk","hash":"d32ebe94560fa95824478ebbff531bffc47b194d","modified":1751976612385},{"_id":"node_modules/hexo-theme-next/layout/_third-party/statistics/lean-analytics.njk","hash":"2446e748cdc102c78492216319ac02148db7daf6","modified":1751976612408},{"_id":"node_modules/hexo-theme-next/layout/_third-party/statistics/index.njk","hash":"568ddf7955d11d93fb5e842b403a7ac8b1b7fdb1","modified":1751976612404},{"_id":"node_modules/hexo-theme-next/source/css/_common/outline/index.styl","hash":"8e34df131830d4fa3725e4590a672ba1cf1903e5","modified":1751976612465},{"_id":"node_modules/hexo-theme-next/source/css/_schemes/Mist/_menu.styl","hash":"f23c53e32d140091b819be2603d1afbbb5d66933","modified":1751976612443},{"_id":"node_modules/hexo-theme-next/source/css/_schemes/Gemini/index.styl","hash":"bcbf498d8d3ecea84324f0a59b7f95f389a52b8d","modified":1751976612480},{"_id":"node_modules/hexo-theme-next/source/css/_common/outline/mobile.styl","hash":"48b2dfc04df6409c6e0736ccc11462ad97d349b1","modified":1751976612487},{"_id":"node_modules/hexo-theme-next/source/css/_schemes/Mist/_header.styl","hash":"dafc6d23c80d6fe3e55a7711e94210d2479b629a","modified":1751976612427},{"_id":"node_modules/hexo-theme-next/source/css/_schemes/Mist/index.styl","hash":"ab16a3dcdc0393b9b582ef59dcc13db9320e917c","modified":1751976612481},{"_id":"node_modules/hexo-theme-next/source/css/_schemes/Mist/_layout.styl","hash":"fa4fd8f76464e214fb7318f325b13c2b62f4b478","modified":1751976612443},{"_id":"node_modules/hexo-theme-next/source/css/_schemes/Mist/_posts-expand.styl","hash":"485d23ccb42c0d0c8ead7ea8930dd3e06d79a285","modified":1751976612443},{"_id":"node_modules/hexo-theme-next/source/css/_schemes/Pisces/_layout.styl","hash":"a92c4eb16bdb7806079467eb022ccf193bb0f794","modified":1751976612443},{"_id":"node_modules/hexo-theme-next/source/css/_schemes/Pisces/index.styl","hash":"8000075b227749a7495eaf417cac6ccfbe441580","modified":1751976612482},{"_id":"node_modules/hexo-theme-next/source/css/_schemes/Pisces/_header.styl","hash":"dc03835e42d82eaf2633cf3b627990ad3e1f5967","modified":1751976612443},{"_id":"node_modules/hexo-theme-next/source/css/_schemes/Pisces/_menu.styl","hash":"a03f16ffc7dfdbdc6053f9fd68d77257ba0c559e","modified":1751976612443},{"_id":"node_modules/hexo-theme-next/source/css/_schemes/Pisces/_sub-menu.styl","hash":"778ed2ad5643b93970c95626b325defeb586733f","modified":1751976612443},{"_id":"node_modules/hexo-theme-next/source/css/_schemes/Muse/_header.styl","hash":"3fbfab591f280e2e7f3b0265901c93bc4bd137ed","modified":1751976612443},{"_id":"node_modules/hexo-theme-next/source/css/_schemes/Muse/_sidebar.styl","hash":"c29a827e82d2820ed8977c92994da73721200fac","modified":1751976612443},{"_id":"node_modules/hexo-theme-next/source/css/_schemes/Muse/_layout.styl","hash":"6569a6640f79d247a8235b3914772c0e2f99ead2","modified":1751976612443},{"_id":"node_modules/hexo-theme-next/source/css/_schemes/Pisces/_sidebar.styl","hash":"e792a6233e1d4dbc5fd2f10ae97b7a790b82568b","modified":1751976612443},{"_id":"node_modules/hexo-theme-next/source/css/_schemes/Muse/_sub-menu.styl","hash":"c48ccd8d6651fe1a01faff8f01179456d39ba9b1","modified":1751976612443},{"_id":"node_modules/hexo-theme-next/source/js/third-party/chat/chatra.js","hash":"c32180522788c10e51df1803aa6842ef0432ddc9","modified":1751976612173},{"_id":"node_modules/hexo-theme-next/source/css/_schemes/Muse/index.styl","hash":"6ad168288b213cec357e9b5a97674ff2ef3a910c","modified":1751976612482},{"_id":"node_modules/hexo-theme-next/source/js/third-party/chat/tidio.js","hash":"b0079f6a4601e06ca6fe46e83a2f5af553e9bc3c","modified":1751976612338},{"_id":"node_modules/hexo-theme-next/source/css/_common/scaffolding/buttons.styl","hash":"a042571d85ff7265f799004239a45f36b716b8a6","modified":1751976612460},{"_id":"node_modules/hexo-theme-next/source/css/_schemes/Muse/_menu.styl","hash":"e31f6adbb22a451f07e4661cff9a2f12e4e99a36","modified":1751976612443},{"_id":"node_modules/hexo-theme-next/source/css/_common/scaffolding/index.styl","hash":"523fb7b653b87ae37fc91fc8813e4ffad87b0d7e","modified":1751976612478},{"_id":"node_modules/hexo-theme-next/source/css/_common/scaffolding/comments.styl","hash":"e4fecc889ba3317a64e9abba5842c79dff9b7827","modified":1751976612460},{"_id":"node_modules/hexo-theme-next/source/css/_common/scaffolding/tables.styl","hash":"e840b23d33023e6d45e018f6e84b683dd56efd8d","modified":1751976612504},{"_id":"node_modules/hexo-theme-next/source/css/_common/scaffolding/toggles.styl","hash":"69c66aab4651e2e7ae9e65f08600144970648c60","modified":1751976612504},{"_id":"node_modules/hexo-theme-next/source/css/_common/scaffolding/base.styl","hash":"d898944f9a68da04c9c9bc4afeec4b5595b76783","modified":1751976612443},{"_id":"node_modules/hexo-theme-next/source/js/third-party/math/katex.js","hash":"83c54ee536e487a1031783443fe0cb63b1b4767e","modified":1751976612278},{"_id":"node_modules/hexo-theme-next/source/css/_common/scaffolding/pagination.styl","hash":"f4228c759db4a650c8d38745c2edd1dc83c45687","modified":1751976612492},{"_id":"node_modules/hexo-theme-next/source/css/_common/scaffolding/normalize.styl","hash":"b56367ea676ea8e8783ea89cd4ab150c7da7a060","modified":1751976612489},{"_id":"node_modules/hexo-theme-next/source/css/_common/components/index.styl","hash":"2298e521253b3bf376a2412271bc2a7d305051f3","modified":1751976612465},{"_id":"node_modules/hexo-theme-next/source/css/_common/components/back-to-top.styl","hash":"b8445c828d78a38e2de50bdc86b3bff66285ea0f","modified":1751976612443},{"_id":"node_modules/hexo-theme-next/source/js/third-party/math/mathjax.js","hash":"5c749b9c1c3bb738122d0516211ecff6496d4907","modified":1751976612295},{"_id":"node_modules/hexo-theme-next/source/css/_common/components/reading-progress.styl","hash":"90a86045a33c1bae49fc2f6fa1e1b53170c7f77b","modified":1751976612502},{"_id":"node_modules/hexo-theme-next/source/js/third-party/analytics/growingio.js","hash":"78dd3cf04082b7dbe6246e404b2aa8e726922402","modified":1751976612251},{"_id":"node_modules/hexo-theme-next/source/js/third-party/analytics/baidu-analytics.js","hash":"f629acc46ff40c071ffd31b77d5c7616f0fdd778","modified":1751976612118},{"_id":"node_modules/hexo-theme-next/source/js/third-party/analytics/google-analytics.js","hash":"def07bcc7c17d8a0caad177fb1dd2f3a5e5b3536","modified":1751976612251},{"_id":"node_modules/hexo-theme-next/source/js/third-party/search/algolia-search.js","hash":"111f60e26b82b4d5be4357737e9273617778c9a9","modified":1751976612103},{"_id":"node_modules/hexo-theme-next/source/js/third-party/analytics/matomo.js","hash":"c6a25b26a1443caa70b47fd3dfa282271574deb5","modified":1751976612295},{"_id":"node_modules/hexo-theme-next/source/js/third-party/search/local-search.js","hash":"4262628e173b16c4c6c18f817173dd103fb9e9a8","modified":1751976612295},{"_id":"node_modules/hexo-theme-next/source/js/third-party/comments/changyan.js","hash":"260d1a77d6a3bb33a579d3e4cca1997003e799b5","modified":1751976612158},{"_id":"node_modules/hexo-theme-next/source/js/third-party/comments/isso.js","hash":"753a873b6f566aff5ba77ca23f91b78eb880ca64","modified":1751976612274},{"_id":"node_modules/hexo-theme-next/source/js/third-party/comments/gitalk.js","hash":"0ec038cf83e8ec067534f16a54041e47a3c1e59a","modified":1751976612251},{"_id":"node_modules/hexo-theme-next/source/js/third-party/comments/livere.js","hash":"2247d88c934c765c43013337860774aaa99f0b31","modified":1751976612293},{"_id":"node_modules/hexo-theme-next/source/js/third-party/comments/utterances.js","hash":"f67f90eb03e284c82da2b8cf2f1e31801813c16d","modified":1751976612343},{"_id":"node_modules/hexo-theme-next/source/js/third-party/comments/disqusjs.js","hash":"1e826dea3f684c0515f362dc1352447a1f0eae71","modified":1751976612214},{"_id":"node_modules/hexo-theme-next/source/js/third-party/tags/pdf.js","hash":"af78c22f0e61c8c8aa8794e585e0d632c6d4fcb8","modified":1751976612327},{"_id":"node_modules/hexo-theme-next/source/js/third-party/comments/disqus.js","hash":"da361917d65e5dca8362f8cdeb6c8cc0e8316cec","modified":1751976612198},{"_id":"node_modules/hexo-theme-next/source/js/third-party/statistics/firestore.js","hash":"6e0682bb42170d61b13b786295f45f9c785f8b73","modified":1751976612238},{"_id":"node_modules/hexo-theme-next/source/js/third-party/tags/mermaid.js","hash":"1d1b6d847215b16f26b230859d7e16501190ecc0","modified":1751976612305},{"_id":"node_modules/hexo-theme-next/source/js/third-party/statistics/lean-analytics.js","hash":"835cbf54c49ef1327f47df70ff2636ad36b6f57d","modified":1751976612285},{"_id":"node_modules/hexo-theme-next/source/js/third-party/tags/wavedrom.js","hash":"40dcd10df6edf124088c329346e0cc0bdac74ef1","modified":1751976612345},{"_id":"node_modules/hexo-theme-next/source/css/_common/outline/header/bookmark.styl","hash":"e74f4bb47a101b014ee2a1783c87f3b87323f9a0","modified":1751976612459},{"_id":"node_modules/hexo-theme-next/source/css/_common/outline/header/index.styl","hash":"6e0d0796ef7fbbb62ffdfb448753a850de82c74f","modified":1751976612465},{"_id":"node_modules/hexo-theme-next/source/css/_common/outline/header/github-banner.styl","hash":"38c64c2d04e46848382bfa246a0e9c508294767b","modified":1751976612465},{"_id":"node_modules/hexo-theme-next/source/css/_common/outline/header/menu.styl","hash":"a3dd3edea9c01b66b28a8367185269b9dcc3bdee","modified":1751976612486},{"_id":"node_modules/hexo-theme-next/source/css/_common/outline/footer/index.styl","hash":"4e967702cf4c637132346bc74ec8854426f1a68c","modified":1751976612465},{"_id":"node_modules/hexo-theme-next/source/css/_common/outline/header/site-nav.styl","hash":"bf3ad8b4268f763a1e26377681644887694bc009","modified":1751976612504},{"_id":"node_modules/hexo-theme-next/source/css/_common/outline/header/site-meta.styl","hash":"a851e9d5aefcd027c95eeb323860b6da70f202d1","modified":1751976612504},{"_id":"node_modules/hexo-theme-next/source/css/_common/outline/sidebar/sidebar-blogroll.styl","hash":"86b110899eaae51b85c4c95eadfe7a912e58a813","modified":1751976612504},{"_id":"node_modules/hexo-theme-next/source/css/_common/outline/sidebar/related-posts.styl","hash":"b05908f04ef95f2d91e6eba89b12411c378d050f","modified":1751976612503},{"_id":"node_modules/hexo-theme-next/source/css/_common/outline/sidebar/sidebar-author-links.styl","hash":"0847400d8579b0a2dd1bf662c78954c10adf2680","modified":1751976612504},{"_id":"node_modules/hexo-theme-next/source/css/_common/outline/sidebar/sidebar-button.styl","hash":"46eece42510c2c89bb9209afb0262ad76a4b0b36","modified":1751976612504},{"_id":"node_modules/hexo-theme-next/source/css/_common/outline/sidebar/sidebar-copyright.styl","hash":"56805b77fe236fac19e19c716a49363bcf986311","modified":1751976612504},{"_id":"node_modules/hexo-theme-next/source/css/_common/outline/sidebar/index.styl","hash":"21acb11e397526132605eef23bde7b307aa1eab5","modified":1751976612477},{"_id":"node_modules/hexo-theme-next/source/css/_common/outline/sidebar/sidebar-author.styl","hash":"5b38ac4a0f1ade0e681aff0e3366c481d9cf3dcd","modified":1751976612504},{"_id":"node_modules/hexo-theme-next/source/css/_common/outline/sidebar/sidebar-nav.styl","hash":"24752d145c6fb8f5344dca9c7b9640839c02e009","modified":1751976612504},{"_id":"node_modules/hexo-theme-next/source/css/_common/outline/sidebar/sidebar-toggle.styl","hash":"741566d6ac5f852b5c8dee6a8996b65e48e7c97f","modified":1751976612504},{"_id":"node_modules/hexo-theme-next/source/css/_common/outline/sidebar/site-state.styl","hash":"26dd0adfcb1db6df29c6090c8d7e9b5a43583fb0","modified":1751976612504},{"_id":"node_modules/hexo-theme-next/source/css/_common/scaffolding/highlight/fold.styl","hash":"42a0b65491ad85438596b3fe0b7f23973e4cef34","modified":1751976612465},{"_id":"node_modules/hexo-theme-next/source/css/_common/scaffolding/tags/group-pictures.styl","hash":"393ff96234e4196b569d4b11496774eb78e147de","modified":1751976612465},{"_id":"node_modules/hexo-theme-next/source/css/_common/outline/sidebar/sidebar-toc.styl","hash":"c2e354a565c8c1b32bd0ceacc972b17982758b67","modified":1751976612504},{"_id":"node_modules/hexo-theme-next/source/css/_common/scaffolding/tags/index.styl","hash":"22cd37bd5df9972d5074710896aba4424ad5161c","modified":1751976612479},{"_id":"node_modules/hexo-theme-next/source/css/_common/scaffolding/highlight/copy-code.styl","hash":"f634f94828620e88c3f5a8db56f7944f6ba232b0","modified":1751976612465},{"_id":"node_modules/hexo-theme-next/source/css/_common/scaffolding/tags/label.styl","hash":"debee14539272fbe3835a7d3853af2230baa3501","modified":1751976612483},{"_id":"node_modules/hexo-theme-next/source/css/_common/scaffolding/tags/blockquote-center.styl","hash":"d6418fd2bbfba7b73ddf11ec62db9637fdf5d8af","modified":1751976612443},{"_id":"node_modules/hexo-theme-next/source/css/_common/scaffolding/highlight/index.styl","hash":"9b0217e1caecd91e05572c7e8e52d32016ca312f","modified":1751976612478},{"_id":"node_modules/hexo-theme-next/source/css/_common/scaffolding/tags/mermaid.styl","hash":"48d35dba575a7c9e8845b16652e76b7d4a4646de","modified":1751976612486},{"_id":"node_modules/hexo-theme-next/source/css/_common/scaffolding/tags/wavedrom.styl","hash":"af113411ad9cca7674177be36af8dd399680834d","modified":1751976612504},{"_id":"node_modules/hexo-theme-next/source/css/_common/scaffolding/tags/pdf.styl","hash":"b6654a1d7cf82577d8263faffee8af3ad4a5c0e8","modified":1751976612492},{"_id":"node_modules/hexo-theme-next/source/css/_common/components/pages/breadcrumb.styl","hash":"8afdc311c6b8db121758371f95cf1c5e77354f42","modified":1751976612460},{"_id":"node_modules/hexo-theme-next/source/css/_common/scaffolding/tags/link-grid.styl","hash":"49329a7144f3413d1c832e52a1f4954171ef11e1","modified":1751976612484},{"_id":"node_modules/hexo-theme-next/source/css/_common/components/pages/categories.styl","hash":"51a97a33879289904cb523ddc2d88b5b0c60fa72","modified":1751976612460},{"_id":"node_modules/hexo-theme-next/source/css/_common/scaffolding/tags/note.styl","hash":"8213015d9cae45d2c9945f8aba9d8db39c734efc","modified":1751976612491},{"_id":"node_modules/hexo-theme-next/source/css/_common/scaffolding/tags/tabs.styl","hash":"c3be8b0738f693e750486bb71769c3dbbec174cc","modified":1751976612504},{"_id":"node_modules/hexo-theme-next/source/css/_common/components/pages/index.styl","hash":"7504dbc5c70262b048143b2c37d2b5aa2809afa2","modified":1751976612465},{"_id":"node_modules/hexo-theme-next/source/css/_common/components/third-party/gitalk.styl","hash":"8f094c4ac17e2ab45569b12d157747f9c7333c12","modified":1751976612465},{"_id":"node_modules/hexo-theme-next/source/css/_common/components/third-party/index.styl","hash":"54d12e2c5d9982f7b9e5b23be5133954a8514e9d","modified":1751976612465},{"_id":"node_modules/hexo-theme-next/source/css/_common/components/third-party/math.styl","hash":"9d995eb4871a6c273d9d51558676a1fdabf69e72","modified":1751976612485},{"_id":"node_modules/hexo-theme-next/source/css/_common/components/pages/tag-cloud.styl","hash":"1a81d1a71fcf0699629ce6e72dfd0a15f3a2dd0a","modified":1751976612504},{"_id":"node_modules/hexo-theme-next/source/css/_common/components/third-party/utterances.styl","hash":"56d90ae0559caa55b75f3c300ff2711f9ed65fc4","modified":1751976612504},{"_id":"node_modules/hexo-theme-next/source/css/_common/components/pages/schedule.styl","hash":"6b816c2511242ee503fb5f34cd3e4dcdafc06b85","modified":1751976612503},{"_id":"node_modules/hexo-theme-next/source/css/_common/components/third-party/disqusjs.styl","hash":"877a537d5b95beb048142e4fdee6f17e6ef9c7bb","modified":1751976612465},{"_id":"node_modules/hexo-theme-next/source/css/_common/components/post/post-body.styl","hash":"93f014809d6442da23f8b7d729f7375e2badba7d","modified":1751976612494},{"_id":"node_modules/hexo-theme-next/source/css/_common/components/post/post-collapse.styl","hash":"809bab3414b1eb1ae44444eb821126868f764414","modified":1751976612494},{"_id":"node_modules/hexo-theme-next/source/css/_common/components/third-party/search.styl","hash":"be60b8dacd4dc9d2b1b68982dc4f0c5325b9a315","modified":1751976612504},{"_id":"node_modules/hexo-theme-next/source/css/_common/components/post/post-followme.styl","hash":"1ecfd64507954810b07a9d21fb5305b5378feda0","modified":1751976612496},{"_id":"node_modules/hexo-theme-next/source/css/_common/components/post/post-footer.styl","hash":"11497388f124bfbb4001495a67d3629a9f618405","modified":1751976612496},{"_id":"node_modules/hexo-theme-next/source/css/_common/components/post/post-gallery.styl","hash":"aa366d37389760c8595529b850f461569577a1c5","modified":1751976612497},{"_id":"node_modules/hexo-theme-next/source/css/_common/components/post/post-widgets.styl","hash":"ebfba158a0a4af3d1dabcacbc58986664de52140","modified":1751976612501},{"_id":"node_modules/hexo-theme-next/source/css/_common/components/post/post-nav.styl","hash":"9ac6f477177264c26a46e8333b8456720a0444dc","modified":1751976612500},{"_id":"node_modules/hexo-theme-next/source/css/_common/components/post/index.styl","hash":"098d4bd034e986fcf7e443eac4fc2193935461b7","modified":1751976612465},{"_id":"node_modules/hexo-theme-next/source/css/_common/components/post/post-header.styl","hash":"1191f1bfa5c43e54be8e5b3cc0d802984e161747","modified":1751976612499},{"_id":"node_modules/hexo-theme-next/source/css/_common/components/post/post-reward.styl","hash":"b47fb36915962309553ff7fb1782341585ed2b76","modified":1751976612501},{"_id":"source/_posts/ai-900-exam-preparation-1/machine-learn.gif","hash":"58e84dca6cdef36f26ff9bbe220d77d0288a423a","modified":1751976300532},{"_id":"public/search.json","hash":"aa993145d0fe40c58d7efcf46bd0bb76a27b0387","modified":1752064219764},{"_id":"public/categories/index.html","hash":"a667e84cc766c454e3b5c552261a17fed0ec67cd","modified":1752064219764},{"_id":"public/tags/index.html","hash":"b24c9f3e1ce1b0efbd6e796baa66bc5639c5a4df","modified":1752064219764},{"_id":"public/about/index.html","hash":"ede83a1a3557ae7b273081de3bed6adbfc3c1ebd","modified":1752064219764},{"_id":"public/2025/07/09/xpp-extendsalesinvoicereport/index.html","hash":"8eb197a6ec62d2ecd6141bb2483f4afec94ad652","modified":1752064219764},{"_id":"public/2025/07/09/xpp-extendedvendtransandcusttrans/index.html","hash":"4a07eff1f3a7ad7c3965c06d322cc5c7d2dbd0ff","modified":1752064219764},{"_id":"public/2025/07/09/xpp-createledgerjournals/index.html","hash":"949b473c0265a3829d3f8cf9aa3233eeebb3cef2","modified":1752064219764},{"_id":"public/2025/07/08/d365-documentroutingconfiguration/index.html","hash":"709fd0f0f6972076b626eeb738bd3da904337555","modified":1752064219764},{"_id":"public/2025/07/08/xpp-getselectedrecords/index.html","hash":"2f554cceb9b16535b87d22b6ae9bb60db205f5d1","modified":1752064219764},{"_id":"public/2025/07/08/d365-transferjournalandtransferorder/index.html","hash":"3b5acd9f7d5084054ca9012128f21a8be5aea43f","modified":1752064219764},{"_id":"public/2025/07/08/xpp-onhandinvent/index.html","hash":"df081759c4a90220e55ac0c1280fc3a40fd31952","modified":1752064219764},{"_id":"public/2025/07/08/hello-world/index.html","hash":"169b25a5c67a98bf8396c60b1b2e66204681f8f3","modified":1752064219764},{"_id":"public/2025/03/29/API/index.html","hash":"39ef53582165158c9e61ab343d56e2bb019c8941","modified":1752064219764},{"_id":"public/2025/03/29/加密存储敏感信息/index.html","hash":"f485f32b64bf6035a4af3629689c8d342325b8cb","modified":1752064219764},{"_id":"public/2025/02/25/ai-900-exam-preparation-2/index.html","hash":"aef84bcd0a996f1a2c6bdc31fa8bb04377e25e36","modified":1752064219764},{"_id":"public/2025/02/24/ai-900-exam-preparation-1/index.html","hash":"90492eb798db474e2181f2b5d41afabc2ba41295","modified":1752064219764},{"_id":"public/2025/02/23/xpp-invoice-purchase-order/index.html","hash":"a1c4d9004e809fad04369e10c02a65cccbddcade","modified":1752064219764},{"_id":"public/2025/02/23/xpp-debug-configuration/index.html","hash":"6ab4e5a786bfd64be8842aae34754a80d69a498f","modified":1752064219764},{"_id":"public/2025/01/18/xpp-open-in-office/index.html","hash":"8fabc14b3264a71fcf6804eeb9b219d2cc931aae","modified":1752064219764},{"_id":"public/2025/01/09/flask-tutorial-2/index.html","hash":"00426019243118ab694e03ddd561f991b123b141","modified":1752064219764},{"_id":"public/2025/01/08/flask-tutorial/index.html","hash":"e996d132e0a5d646a1853aa7a79b44ab4d36da4e","modified":1752064219764},{"_id":"public/2025/01/07/ai-plateform-flask/index.html","hash":"f80df6fa19b9f4d35ef4fbd95f8a97711f45aab1","modified":1752064219764},{"_id":"public/2024/12/23/mssql-clear-log/index.html","hash":"4511b5580eaafd6a8adaea2ea99c5e06820853c4","modified":1752064219764},{"_id":"public/2024/12/23/xpp-merge-ledger-account/index.html","hash":"ee2f50877378df4f48c463584a67b0fdfa1ecca0","modified":1752064219764},{"_id":"public/2024/12/23/xpp-api-list/index.html","hash":"6ca0b6738fc254bab54f51689fba8b2afbcd99d7","modified":1752064219764},{"_id":"public/2024/12/23/commerce-use-languageId/index.html","hash":"4dd38b55b7cbb132b863acd6bc303bd9dd426cde","modified":1752064219764},{"_id":"public/2024/12/22/commerce-cache/index.html","hash":"d91d2b28cc203dc97e6719fe659b9f85814f1b7b","modified":1752064219764},{"_id":"public/archives/index.html","hash":"3fa627c1ce1054e6bd1f3c9c72a665a2dcd9a291","modified":1752064219764},{"_id":"public/archives/page/2/index.html","hash":"71f680f49d2cbca78b2207fdc0f74e74384b54e4","modified":1752064219764},{"_id":"public/archives/page/3/index.html","hash":"2df89dc8deaab610b4d33c30ae87bd8661303a4d","modified":1752064219764},{"_id":"public/archives/2024/index.html","hash":"d3581b7f789456498e76566fb56963f3b1d4844a","modified":1752064219764},{"_id":"public/archives/2024/12/index.html","hash":"44c39b6877432ce1950bf6213e83b5237e325b08","modified":1752064219764},{"_id":"public/archives/2025/index.html","hash":"b627c7400c5a0e2302035c6aba1c9dbd45c5e92c","modified":1752064219764},{"_id":"public/archives/2025/page/2/index.html","hash":"7ae33ffd7a01e96835a18d034ee920daf93039c3","modified":1752064219764},{"_id":"public/archives/2025/01/index.html","hash":"2c7897fd2ebc24fb4f322382f085049a87e66be5","modified":1752064219764},{"_id":"public/archives/2025/02/index.html","hash":"dee653df57696bcaf2a6326d4d102e4db0303890","modified":1752064219764},{"_id":"public/archives/2025/03/index.html","hash":"e45c4745d6678cc84483ede415934d8e5fecd48c","modified":1752064219764},{"_id":"public/archives/2025/07/index.html","hash":"dccb929467135e7682e9f0e1d90a7571efdfdd90","modified":1752064219764},{"_id":"public/categories/ai/index.html","hash":"6abdcaf823abcc9f4712b601134e453ce255785c","modified":1752064219764},{"_id":"public/categories/asp-net/index.html","hash":"3514cb9d0d7a3ecf52066be01712a41b740fbc47","modified":1752064219764},{"_id":"public/categories/flask/index.html","hash":"4083c9915fb36254ff58a17ae66f514e1ede43bd","modified":1752064219764},{"_id":"public/categories/commerce/index.html","hash":"048f92030231eeb5365d8876e8adc5cd2eb91c3d","modified":1752064219764},{"_id":"public/categories/d365/index.html","hash":"ab27176b6d0b687976900c6cb954c20f2ed54bc9","modified":1752064219764},{"_id":"public/categories/t-sql/index.html","hash":"e2a63ba034b3da199d835a094c1d3bfb482cace4","modified":1752064219764},{"_id":"public/categories/x/index.html","hash":"b72180cb68e9eb90672c2ff4370636f6798baaa0","modified":1752064219764},{"_id":"public/categories/c/index.html","hash":"d41ad68f9e06ddfb5fe06ef6dc07acd43f328d85","modified":1752064219764},{"_id":"public/index.html","hash":"dbb57d5d025e51b33bdf059138ed5bde85ec31b7","modified":1752064219764},{"_id":"public/page/2/index.html","hash":"c184fdd8f3cb5d67df8934df601f9871f0b74e26","modified":1752064219764},{"_id":"public/page/3/index.html","hash":"48b7f621decc59724698932221e08663d4bfddc8","modified":1752064219764},{"_id":"public/tags/LedgerJournalTrans/index.html","hash":"3081d750476137e29b8cbab3c506bbd1d3bd2c6e","modified":1752064219764},{"_id":"public/tags/CustTrans/index.html","hash":"23f4d4b28fc2fef801d9fbc0e6905f33feb9dc7e","modified":1752064219764},{"_id":"public/tags/VendTrans/index.html","hash":"36e8bb9f8667b016e0bb2229d7d434ae355b5300","modified":1752064219764},{"_id":"public/tags/Reversal/index.html","hash":"a2b6766b076625b01bae8a3b73a4264e68f7f82f","modified":1752064219764},{"_id":"public/tags/ssrs/index.html","hash":"30ca1974594b71d0d66e86eeb2dbb87afa89dd43","modified":1752064219764},{"_id":"public/tags/sales-invoice-report/index.html","hash":"6f876c245582aaf49d3848aa688f12f250f92272","modified":1752064219764},{"_id":"public/images/apple-touch-icon-next.png","hash":"2959dbc97f31c80283e67104fe0854e2369e40aa","modified":1752064219764},{"_id":"public/images/favicon-32x32-next.png","hash":"0749d7b24b0d2fae1c8eb7f671ad4646ee1894b1","modified":1752064219764},{"_id":"public/images/avatar.gif","hash":"2dbc3e2f2d624b2ca1afe6edc2ca17307f1950c8","modified":1752064219764},{"_id":"public/images/favicon-16x16-next.png","hash":"943a0d67a9cdf8c198109b28f9dbd42f761d11c3","modified":1752064219764},{"_id":"public/images/logo.svg","hash":"099e11ab995a2c8981427a85476d082609848c77","modified":1752064219764},{"_id":"public/2025/03/29/API/image1.png","hash":"450f62ff8aa3a6c3fe3e6c83dacd17060ffa8e3b","modified":1752064219764},{"_id":"public/2025/03/29/API/image3.png","hash":"a54808a625c66a56bbaab66f1b54061badb2a218","modified":1752064219764},{"_id":"public/2025/03/29/API/image2.png","hash":"bdebceaea113a7b3b6c4cb432dad0afad28f7eda","modified":1752064219764},{"_id":"public/2025/03/29/API/image4.png","hash":"25570a22f193e67fd0e5335baaa2f9c5a8310d57","modified":1752064219764},{"_id":"public/2025/03/29/API/image5.png","hash":"62b69f54b1c07c3301519b9780f63c4aadb12fbe","modified":1752064219764},{"_id":"public/2025/03/29/API/image6.png","hash":"a1bdc3710c332cde21cf2fadabeaa1f5f330f6af","modified":1752064219764},{"_id":"public/2024/12/22/commerce-cache/commerce-cache-example.png","hash":"373b25eb3f107582c3eecdea1209473ebae568ee","modified":1752064219764},{"_id":"public/2025/02/25/ai-900-exam-preparation-2/binary-confusion-matrix.png","hash":"589c4694c10130738cec03f7e0d52f6a3f6a3843","modified":1752064219764},{"_id":"public/2025/02/25/ai-900-exam-preparation-2/classification-predictions.png","hash":"74b6ebf83fed85f6c4fc9fae2149c82c12e2be6c","modified":1752064219764},{"_id":"public/2025/02/25/ai-900-exam-preparation-2/machine-learning-types.png","hash":"e1ae15afcbb5096da4a0e635f5c8041cde444beb","modified":1752064219764},{"_id":"public/2025/02/25/ai-900-exam-preparation-2/regression-line.png","hash":"3d29fb5fd1d171f674e11ebcac9c3271829a1c46","modified":1752064219764},{"_id":"public/2025/02/25/ai-900-exam-preparation-2/machine-learning.png","hash":"7ebfe4b2428e211f9e0df224c1ae15434ebbc71f","modified":1752064219764},{"_id":"public/2025/02/25/ai-900-exam-preparation-2/roc-chart.png","hash":"08b03c4a29945c1183678b063b98f744010fe274","modified":1752064219764},{"_id":"public/2025/02/25/ai-900-exam-preparation-2/scatter-plot.png","hash":"cc11d3931d675e6f63a5e23757fb9757eb3a8004","modified":1752064219764},{"_id":"public/2025/02/25/ai-900-exam-preparation-2/sigmoid-plot.png","hash":"0cf61f570573ba43d70def0dd7757bd222a2c79a","modified":1752064219764},{"_id":"public/2025/02/25/ai-900-exam-preparation-2/supervised-training.png","hash":"4f2793c5482e92495467236941758e3aa79d3fad","modified":1752064219764},{"_id":"public/2025/01/07/ai-plateform-flask/image.png","hash":"715ef9e63db901a9157d5be93ba6bb9a18810805","modified":1752064219764},{"_id":"public/2025/07/08/d365-documentroutingconfiguration/image-27.png","hash":"de48bdae84d2a1a77c633a2c30e53a21e18eb968","modified":1752064219764},{"_id":"public/2025/07/08/d365-documentroutingconfiguration/image-33.png","hash":"ec604517556bf16ab9448283c0873bf90f34e1d1","modified":1752064219764},{"_id":"public/2025/07/08/d365-documentroutingconfiguration/image-34.png","hash":"2593bfaf1630ded5a9ff93a16523baa76cd6fd68","modified":1752064219764},{"_id":"public/2025/07/08/d365-documentroutingconfiguration/image-35.png","hash":"7fb5f7b8976a0c97d8fc4a6745fb1e02fb4d18fb","modified":1752064219764},{"_id":"public/2025/07/08/d365-documentroutingconfiguration/image-40.png","hash":"b68afe36ee486b98ee47478e75233e12b48cb25f","modified":1752064219764},{"_id":"public/2025/07/08/d365-documentroutingconfiguration/image-46.png","hash":"27de22407cd73be14bbb8b8d1eb2cdc39e98207f","modified":1752064219764},{"_id":"public/2025/07/09/xpp-createledgerjournals/CopyJournalDialog.png","hash":"25303d1dd4597662e713aea913d973c651e212d6","modified":1752064219764},{"_id":"public/2025/07/08/d365-documentroutingconfiguration/image-47.png","hash":"eda554c0565f8c1882cd9090c94b7bb7de0e3560","modified":1752064219764},{"_id":"public/2024/12/23/mssql-clear-log/mssql-clear-log.png","hash":"6d6f92e238a5d60b3aa370640dede1dc58eed509","modified":1752064219764},{"_id":"public/2024/12/23/xpp-api-list/xpp-api-list-recordinsertlist.png","hash":"6b0ec9fa8ce8c1b94ea0d400e25d964a86a2f048","modified":1752064219764},{"_id":"public/2025/07/09/xpp-extendsalesinvoicereport/CreateNewReport.png","hash":"b5f00e4ecfbc1bc1d0a800c707b594525e9f4fbc","modified":1752064219764},{"_id":"public/2025/07/09/xpp-extendsalesinvoicereport/LineTablix.png","hash":"0d5a34ba225a6fd813af06f0a5d61bc0f2190b87","modified":1752064219764},{"_id":"public/2025/07/09/xpp-extendsalesinvoicereport/PrintedReport.png","hash":"ee10b1df43cc58741e77e0192d14728fde77482a","modified":1752064219764},{"_id":"public/2025/07/09/xpp-extendsalesinvoicereport/ReportDatasets.png","hash":"2b4bf1e0b1dcda4eb3ac57775b533da6ff55f851","modified":1752064219764},{"_id":"public/2025/07/09/xpp-extendsalesinvoicereport/ReportResulting.png","hash":"542a0313ed57d414c387e10689e27a4268e4a340","modified":1752064219764},{"_id":"public/2025/07/09/xpp-extendsalesinvoicereport/RowVisibility.png","hash":"5811a60c2bedb1e5991595793fb10c4769ea2c90","modified":1752064219764},{"_id":"public/2025/01/18/xpp-open-in-office/xpp-open-in-office.png","hash":"e5597ae72ec0f393eefdba5b392300a018ad3a67","modified":1752064219764},{"_id":"public/2025/01/18/xpp-open-in-office/xpp-open-in-office2.png","hash":"d34920c5e53717299fbae46a4382ed2373ea5c07","modified":1752064219764},{"_id":"public/2025/01/18/xpp-open-in-office/xpp-open-in-office3.png","hash":"35a5d7ece7eef51acd7d862a869a63a47492fb64","modified":1752064219764},{"_id":"public/2025/03/29/加密存储敏感信息/75c34455b6d94fd5a859979b5462f90d.png","hash":"6b3500b7cf605f3de4b7a8cf7d14b6449e1ebc2d","modified":1752064219764},{"_id":"public/2025/07/09/xpp-extendsalesinvoicereport/ReportProperties.png","hash":"78702a1c847e3d681ad301364e6bf3be0919e6c0","modified":1752064219764},{"_id":"public/2025/03/29/加密存储敏感信息/c3f95d2ff64b427591d18ce311bcefea.png","hash":"9ea435979f114eb0f7ad41c48dbe63bcf3febda2","modified":1752064219764},{"_id":"public/2025/03/29/API/image7.png","hash":"307a64abcf7f56bd8bfb838a738f78d1fa2a38c7","modified":1752064219764},{"_id":"public/2025/07/08/d365-documentroutingconfiguration/image-26.png","hash":"016684a9a67b88995178c6ac622ff55ab93d6da4","modified":1752064219764},{"_id":"public/2025/07/08/d365-documentroutingconfiguration/image-28.png","hash":"13abe5ec8b08ff38590067cca417e827a5e266af","modified":1752064219764},{"_id":"public/2025/07/08/d365-documentroutingconfiguration/image-30.png","hash":"de42324e871c07bdb8c4adea25f68f13888e4519","modified":1752064219764},{"_id":"public/2025/07/08/d365-documentroutingconfiguration/image-32.png","hash":"b0ef1f1f666228328d934a3724cb20125ecabb3d","modified":1752064219764},{"_id":"public/2025/07/08/d365-documentroutingconfiguration/image-36.png","hash":"320f9ca1c9e69181dbbc5be81ea5e8caae2ac542","modified":1752064219764},{"_id":"public/2025/07/08/d365-documentroutingconfiguration/image-39.png","hash":"32f1bad5545503d89baa2248a94d5538c5753cdc","modified":1752064219764},{"_id":"public/2025/07/08/d365-documentroutingconfiguration/image-37.png","hash":"037b833b85e1e42ad5ac7244d2a8eb9e30a7675c","modified":1752064219764},{"_id":"public/2025/07/08/d365-documentroutingconfiguration/image-41.png","hash":"ac96eeb43d3359e034c621fc60be82a6a4888a6a","modified":1752064219764},{"_id":"public/2025/07/08/d365-documentroutingconfiguration/image-45.png","hash":"08c4558e4823d176aa54df442cf59dd8782bcd67","modified":1752064219764},{"_id":"public/2025/07/08/d365-documentroutingconfiguration/image-42.png","hash":"eaf909332d594faffa98bca18ea992adc09e14b0","modified":1752064219764},{"_id":"public/2025/07/08/d365-documentroutingconfiguration/image-49.png","hash":"81f1efe62befe58767343604fb4754c0fbe850e6","modified":1752064219764},{"_id":"public/2025/07/08/d365-documentroutingconfiguration/image-48.png","hash":"da3598ac9bd996c78751f89c9f8007c581ea3b67","modified":1752064219764},{"_id":"public/2025/02/23/xpp-debug-configuration/xpp-debug-configuration.png","hash":"f613c9fc9f3dd1eb3a5b54aa158cde9224f0cc9e","modified":1752064219764},{"_id":"public/css/main.css","hash":"45a2203fd6079784fabe153f8cc1636173aee6fc","modified":1752064219764},{"_id":"public/js/config.js","hash":"4c4ebbe3b3f3841a26f9d5af6d0ba8bc6da01c54","modified":1752064219764},{"_id":"public/js/bookmark.js","hash":"9ba4cceafd12c6d5ba8a6b986a046ef8319a7811","modified":1752064219764},{"_id":"public/js/comments.js","hash":"66ae2e26ea36a41b72c638ea8b220296638ae952","modified":1752064219764},{"_id":"public/js/motion.js","hash":"6f751f5c9499a39d7c5e1d323db3260342dd9431","modified":1752064219764},{"_id":"public/js/next-boot.js","hash":"8e2d589585f5270ee90285d3e65b69923c7629d8","modified":1752064219764},{"_id":"public/css/noscript.css","hash":"4cd5301e478e0e0d4b176740ec314087ec5cb707","modified":1752064219764},{"_id":"public/js/sidebar.js","hash":"2ee359ae48273b01ba1e0768704524e08702c7eb","modified":1752064219764},{"_id":"public/js/third-party/addtoany.js","hash":"5276c8f78ee562a8965216dc67d762e59cb4a9f2","modified":1752064219764},{"_id":"public/js/utils.js","hash":"d7954a623be2ee9fe3eadc785b17c17afac6c34d","modified":1752064219764},{"_id":"public/js/third-party/pace.js","hash":"0ef04218b93561ba4d0ff420d556c3d90a756d32","modified":1752064219764},{"_id":"public/js/third-party/analytics/matomo.js","hash":"c6a25b26a1443caa70b47fd3dfa282271574deb5","modified":1752064219764},{"_id":"public/js/third-party/search/local-search.js","hash":"4262628e173b16c4c6c18f817173dd103fb9e9a8","modified":1752064219764},{"_id":"public/js/third-party/tags/pdf.js","hash":"af78c22f0e61c8c8aa8794e585e0d632c6d4fcb8","modified":1752064219764},{"_id":"public/2025/07/08/d365-documentroutingconfiguration/image-25.png","hash":"e5d04a6b69c0703a0e907a920bcdfedf46414c4b","modified":1752064219764},{"_id":"public/2025/07/08/d365-documentroutingconfiguration/image-31.png","hash":"dc60ecd9e823683c09c36f7eda1c52d15f612358","modified":1752064219764},{"_id":"public/2025/07/08/d365-documentroutingconfiguration/image-38.png","hash":"ee6aa6b26b27219937f83f52bb5e1b102e9af66d","modified":1752064219764},{"_id":"public/2025/07/08/d365-documentroutingconfiguration/image-43.png","hash":"a132ae3278112f876f61f6d1f886df17cf63556d","modified":1752064219764},{"_id":"public/2025/07/08/d365-documentroutingconfiguration/image-29.png","hash":"b2c239135d5a4787fd8f933a6d22fb6694d9e0da","modified":1752064219764},{"_id":"public/2025/02/24/ai-900-exam-preparation-1/document-intelligence-studio.png","hash":"d4ab717f5d0775d2f0ca479669632925e9276fe8","modified":1752064219764},{"_id":"public/2025/02/24/ai-900-exam-preparation-1/machine-learn.gif","hash":"58e84dca6cdef36f26ff9bbe220d77d0288a423a","modified":1752064219764}],"Category":[{"name":"ai","_id":"cmcvxsshk00073cug50bv3v2i"},{"name":"asp.net","_id":"cmcvxsshm000b3cug1q9x32n1"},{"name":"flask","_id":"cmcvxsshp000i3cuggwaj60wo"},{"name":"commerce","_id":"cmcvxsshq000n3cug9688dx5p"},{"name":"d365","_id":"cmcvxsshs000w3cug6f5id4z7"},{"name":"t-sql","_id":"cmcvxsshu001a3cugam65gnse"},{"name":"x++","_id":"cmcvxsshu001e3cugd4j69n9v"},{"name":"c#","_id":"cmcvxsshy00273cug7e7xg4sm"}],"Data":[],"Page":[{"title":"categories","date":"2024-12-22T09:12:29.000Z","type":"categories","_content":"","source":"categories/index.md","raw":"---\ntitle: categories\ndate: 2024-12-22 17:12:29\ntype: \"categories\"\n---\n","updated":"2025-07-08T12:05:00.543Z","path":"categories/index.html","comments":1,"layout":"page","_id":"cmcvxsshf00003cuggfqpeyai","content":"","excerpt":"","more":""},{"title":"tags","date":"2024-12-22T09:12:48.000Z","type":"tags","_content":"","source":"tags/index.md","raw":"---\ntitle: tags\ndate: 2024-12-22 17:12:48\ntype: \"tags\"\n---\n","updated":"2025-07-08T12:05:00.543Z","path":"tags/index.html","comments":1,"layout":"page","_id":"cmcvxsshi00023cug9mh4g1qa","content":"","excerpt":"","more":""},{"title":"about","date":"2024-12-22T14:10:18.000Z","type":"about","comments":0,"_content":"\nI am a Dynamics 365 F&O developer. I want to be an AI + ERP integrated solution architect.","source":"about/index.md","raw":"---\ntitle: about\ndate: 2024-12-22 22:10:18\ntype: \"about\"\ncomments: false\n---\n\nI am a Dynamics 365 F&O developer. I want to be an AI + ERP integrated solution architect.","updated":"2025-07-08T12:05:00.543Z","path":"about/index.html","layout":"page","_id":"cmcvxsshj00043cug3ki1addo","content":"<p>I am a Dynamics 365 F&amp;O developer. I want to be an AI + ERP integrated solution architect.</p>\n","excerpt":"","more":"<p>I am a Dynamics 365 F&amp;O developer. I want to be an AI + ERP integrated solution architect.</p>\n"}],"Post":[{"title":"Export to excel","comments":1,"date":"2024-12-23T14:20:30.000Z","description":"This article describes the way to export to excel","_content":"\n### Example Code\n\n```c#\nusing System.IO;\nusing OfficeOpenXml;\nusing OfficeOpenXml.Style;\nusing OfficeOpenXml.Table;\nusing OfficeOpenXml.Style.ExcelFillStyle;\nusing System.Drawing;\nclass LMSMidStatesPullService extends SysOperationServiceBase\n{\n    public date                     gFromDate;\n    public date                     gToDate;\n    public boolean                  hasheader = false;\n    public EcoResCategoryId         gCategory;\n    public LMSCateGoryTable         gCategoryTable;\n    public EcoResCategory           gEcoCategoryTable;\n    RetailReportSessionIdentifier   gsessionId = guid2Str(newGuid());\n\n    /// <summary>\n    /// LMS_SUN-029403_EXT-00015 Load to Truck Validation\n    /// Lance Shi - 7/17/2024\n    /// Process\n    /// </summary>\n    /// <param name = \"_contract\">LMSCleanUpLoadedLPTableContract</param>\n    public void process(LMSMidStatesPullContract _contract)\n    {\n        gFromDate           = _contract.parmFromDate();\n        gToDate             = _contract.parmToDate();\n        // LMS_SUN-030708_Mid-StatesPullReport add by Ina Wang on 11/21/2024 begin\n\n        gCategory           = _contract.parmCategory();\n        gEcoCategoryTable   = EcoResCategory::find(gCategory);\n\n        select firstonly RecId from gCategoryTable\n            where gCategoryTable.EcoResCategory     == gEcoCategoryTable.RecId\n              && gCategoryTable.SessionId           == gsessionId;\n\n        if(!gCategoryTable.RecId)\n        {\n            gCategoryTable.EcoResCategory   = gEcoCategoryTable.RecId;\n            gCategoryTable.SessionId        = gsessionId;\n            gCategoryTable.insert();\n        }\n\n        ttsbegin;\n        this.getAllCategory(gEcoCategoryTable.RecId);\n        this.createtab(_contract);\n\n        delete_from gCategoryTable\n            where gCategoryTable.SessionId == gsessionId;\n        ttscommit;\n        // LMS_SUN-030708_Mid-StatesPullReport add by Ina Wang on 11/21/2024 end\n    }\n\n    /// <summary>\n    /// LMS_SUN-030708_Mid-StatesPullReport\n    /// Bruce Niu -10/11/2024\n    /// Create tab.\n    /// </summary>\n    /// <param name = \"_contract\">LMSMidStatesPullContract</param>\n    public void createtab(LMSMidStatesPullContract _contract)\n    {\n        QueryRun                        queryRun    = new QueryRun(_contract.getQuery());\n        LMSSalesHistoryView             historyView;\n        container                       itemIdCon   = conNull();\n        System.IO.Stream                stream;\n        ExcelSpreadsheetName            sheet;\n        MemoryStream                    memoryStream = new MemoryStream();\n\n        using (var package = new ExcelPackage(memoryStream))\n        {\n            var currentRow = 1;\n\n            var                             worksheets          = package.get_Workbook().get_Worksheets();\n            OfficeOpenXml.ExcelWorksheet    SupplierWorksheet   = worksheets.Add(\"@LMS:LMSSupplierInformation\");\n            OfficeOpenXml.ExcelWorksheet    SalesDataWorksheet  = worksheets.Add(\"@LMS:LMSSalesData\");\n\n            itemIdCon = this.generateSalesData(SalesDataWorksheet, _contract);\n\n            if(itemIdCon)\n            {\n                this.generateSupplier(itemIdCon, SupplierWorksheet);\n        \n            }\n\n            package.Save();\n            file::SendFileToUser(memoryStream, \"@LMS:LMSMidStatsPullExcel\");\n        }\n    }\n\n    /// <summary>\n    /// LMS_SUN-030708_Mid-StatesPullReport\n    /// Bruce Niu -10/11/2024\n    /// Get query for range.\n    /// </summary>\n    /// <param name = \"_query\">Query</param>\n    /// <returns>Query</returns>\n    public Query  getQueryForRange(Query _query)\n    {\n        Query                   query = _query;\n        QueryBuildDataSource    qbds = _query.dataSourceTable(tableNum(LMSSalesHistorySummaryView)).addDataSource(tableNum(LMSSalesHistoryView));\n\n        qbds.joinMode(JoinMode::ExistsJoin);\n        qbds.addLink(fieldNum(LMSSalesHistorySummaryView, ProductNumber), fieldNum(LMSSalesHistoryView, ProductNumber));\n\n        // LMS_SUN-030708_Mid-StatesPullReport add by Ina Wang on 11/11/2024 begin\n        qbds.addLink(fieldNum(LMSSalesHistorySummaryView, Color), fieldNum(LMSSalesHistoryView, Color));\n        qbds.addLink(fieldNum(LMSSalesHistorySummaryView, Size), fieldNum(LMSSalesHistoryView, Size));\n        // LMS_SUN-030708_Mid-StatesPullReport add by Ina Wang on 11/11/2024 end\n\n        qbds.addRange(fieldNum(LMSSalesHistoryView, SalesHistoryDate)).value(SysQueryRangeUtil::dateRange(gFromDate, gToDate));\n\n        // LMS_SUN-030708_Mid-StatesPullReport add by Ina Wang on 11/21/2024 begin\n        if(gCategory)\n        {\n            EcoResCategoryNamedHierarchyRole    hierarchyId             = EcoResCategoryHierarchyRole::getHierarchiesByRole(EcoResCategoryNamedHierarchyRole::Retail).NamedCategoryHierarchyRole;\n            QueryBuildDataSource                qbdsCategoryExpanded    = _query.dataSourceTable(tableNum(LMSSalesHistoryView)).addDataSource(tableNum(EcoResProductCategoryExpanded));\n\n            qbdsCategoryExpanded.joinMode(JoinMode::ExistsJoin);\n            qbdsCategoryExpanded.addLink(fieldNum(LMSSalesHistoryView, ProductNumber), fieldNum(EcoResProductCategoryExpanded, ItemId));\n            qbdsCategoryExpanded.addRange(fieldNum(EcoResProductCategoryExpanded, NamedCategoryHierarchyRole)).value(queryValue(hierarchyId));\n\n            QueryBuildDataSource    qbdsCategoryTable     = _query.dataSourceTable(tableNum(EcoResProductCategoryExpanded)).addDataSource(tableNum(LMSCateGoryTable));\n            qbdsCategoryTable.joinMode(JoinMode::ExistsJoin);\n            qbdsCategoryTable.addLink(fieldNum(EcoResProductCategoryExpanded, RecIdCategory), fieldNum(LMSCateGoryTable, EcoResCategory));\n            qbdsCategoryTable.addRange(fieldNum(LMSCateGoryTable, SessionId)).value(queryValue(gsessionId));\n        }\n        // LMS_SUN-030708_Mid-StatesPullReport add by Ina Wang on 11/21/2024 end\n        return query;\n\n    }\n\n    /// <summary>\n    /// LMS_SUN-030708_Mid-StatesPullReport\n    /// Bruce Niu -10/11/2024\n    /// Generate sales data.\n    /// </summary>\n    /// <param name = \"_SalesDataWorksheet\">ExcelWorksheet</param>\n    /// <param name = \"_contract\">Contract</param>\n    /// <returns>container</returns>\n    public container generateSalesData(OfficeOpenXml.ExcelWorksheet _SalesDataWorksheet, LMSMidStatesPullContract _contract)\n    {\n        var                             SalesDatacells      = _SalesDataWorksheet.get_Cells();\n        Map                             map                 = new Map(Types::String, Types::Container);\n        int                             row                 = 1;\n        QueryRun                        queryRun            = new QueryRun(this.getQueryForRange(_contract.getQuery()));\n        LMSSalesHistorySummaryView      historyView;\n        LMSSalesHistoryView             historyViewRecord;\n        container                       supplerRow          = conNull();\n        container                       itemIdCon           = conNull();\n\n        OfficeOpenXml.ExcelRange cell = SalesDatacells.get_Item(1, 1);\n        cell.set_Value(\"@LMS:LMSMemberName\");\n\n        cell = SalesDatacells.get_Item(1, 2);\n        cell.set_Value(\"@LMS:LMSReportingVendor\");\n\n        cell = SalesDatacells.get_Item(1, 3);\n        cell.set_Value(\"@LMS:LMSItemNumber\");\n\n        cell = SalesDatacells.get_Item(1, 4);\n        cell.set_Value(\"@LMS:LMSMFGPart\");\n\n        cell = SalesDatacells.get_Item(1, 5);\n        cell.set_Value(\"@LMS:LMSItemDesc\");\n\n        cell = SalesDatacells.get_Item(1, 6);\n        cell.set_Value(\"@LMS:LMSUPC\");\n\n        cell = SalesDatacells.get_Item(1, 7);\n        cell.set_Value(\"@SYS850\");\n\n        cell = SalesDatacells.get_Item(1, 8);\n        cell.set_Value(\"@LMS:LMSClassLine\");\n\n        cell = SalesDatacells.get_Item(1, 9);\n        cell.set_Value(\"@LMS:LMSSubClassFineLine\");\n\n        int currentRow = 9;\n\n        container con = this.generateMonthColumn();\n\n        if(con)\n        {\n            for(int i = 1; i <= conlen(con); i ++)\n            {\n                currentRow ++;\n                cell = SalesDatacells.get_Item(1, currentRow);\n                cell.set_Value(conpeek(con, i));\n            }\n        }\n\n        currentRow ++;\n        cell = SalesDatacells.get_Item(1, currentRow);\n        cell.set_Value(\"@LMS:LMSTotalMonthSales\");\n\n        currentRow ++;\n        cell = SalesDatacells.get_Item(1, currentRow);\n        cell.set_Value(\"@LMS:LMSRepalcementCost\");\n\n        currentRow ++;\n        cell = SalesDatacells.get_Item(1, currentRow);\n        cell.set_Value(\"@LMS:LMSCompanyOnHand\");\n\n        currentRow ++;\n        cell = SalesDatacells.get_Item(1, currentRow);\n        cell.set_Value(\"@LMS:LMSSystemRetail\");\n\n        currentRow ++;\n        cell = SalesDatacells.get_Item(1, currentRow);\n        cell.set_Value(\"@LMS:LMSAverageUnitRetail\");\n\n        currentRow = 2;\n        container alldateCollection = this.getAlldateCollection();\n\n        while(queryRun.next())\n        {\n            historyView                 = queryRun.get(tableNum(LMSSalesHistorySummaryView));\n\n            container   itemIdDim       = this.getItemId(historyView);\n            ItemId      itemId          = conPeek(itemIdDim, 1);\n            InventDimId inventdIm       = conPeek(itemIdDim, 2);\n            str         description     = conPeek(itemIdDim, 3);\n            int         currentColumn   ;\n\n            InventTable inventTable;\n\n            select firstonly PrimaryVendorId from inventTable\n                where inventTable.ItemId == itemId;\n\n            VendTable   vendTable;\n\n            select firstonly Party from vendTable\n                where vendTable.AccountNum == inventTable.PrimaryVendorId;\n\n            if(itemIdCon == conNull())\n            {\n                itemIdCon += itemId;\n            }\n            else\n            {\n                if(!conFind(itemIdCon, itemId))\n                {\n                    itemIdCon += itemId;\n                }\n            }\n\n            cell = SalesDatacells.get_Item(currentRow, 1);\n            cell.set_Value(\"@LMS:LMSLMSupply\");\n\n            cell = SalesDatacells.get_Item(currentRow, 2);\n            cell.set_Value(vendTable.vendorName());\n\n            cell = SalesDatacells.get_Item(currentRow, 3);\n            cell.set_Value(historyView.ProductNumber);\n\n            cell = SalesDatacells.get_Item(currentRow, 4);\n            cell.set_Value(CustVendExternalItem::find(ModuleInventPurchSalesVendCustGroup::Vend, itemId, inventdIm, inventTable.PrimaryVendorId).ExternalItemId);\n\n            cell = SalesDatacells.get_Item(currentRow, 5);\n            cell.set_Value(description);\n\n            cell = SalesDatacells.get_Item(currentRow, 6);\n            cell.set_Value(this.getItemBarcode(itemId, inventdIm));\n\n            container conCate = this.getCategory(itemId);\n\n            cell = SalesDatacells.get_Item(currentRow, 7);\n            cell.set_Value(conPeek(conCate, 1));\n\n            cell = SalesDatacells.get_Item(currentRow, 8);\n            cell.set_Value(conPeek(conCate, 2));\n\n            cell = SalesDatacells.get_Item(currentRow, 9);\n            cell.set_Value(conPeek(conCate, 3));\n\n            for(currentColumn  = 10; currentColumn <= conLen(alldateCollection) + 9; currentColumn++)\n            {\n                container   conLine = conPeek(alldateCollection, currentColumn - 9);\n\n                select sum(Quantity) from historyViewRecord\n                    where historyViewRecord.ProductNumber       == historyView.ProductNumber\n                       && historyViewRecord.SalesHistoryDate    >= conPeek(conLine, 1)\n                       && historyViewRecord.SalesHistoryDate    <= conPeek(conLine, 2);\n\n                cell = SalesDatacells.get_Item(currentRow, currentColumn);\n                cell.set_Value(strFmt(\"%1\", historyViewRecord.Quantity));\n            \n            }\n\n            select sum(Quantity),sum(Amount) from historyViewRecord\n                    where historyViewRecord.ProductNumber       == historyView.ProductNumber\n                       && historyViewRecord.SalesHistoryDate    >= gFromDate\n                       && historyViewRecord.SalesHistoryDate    <= gToDate;\n\n            cell = SalesDatacells.get_Item(currentRow, currentColumn);\n            cell.set_Value(strFmt(\"%1\", historyViewRecord.Quantity));\n\n            currentColumn ++;\n\n            cell = SalesDatacells.get_Item(currentRow, currentColumn);\n            cell.set_Value(strFmt(\"%1\", InventTableModule::find(itemId, ModuleInventPurchSales::Purch).price));\n\n            currentColumn ++;\n\n            cell = SalesDatacells.get_Item(currentRow, currentColumn);\n            cell.set_Value(this.getinventOnhand(itemId, inventdIm));\n\n            currentColumn ++;\n\n            cell = SalesDatacells.get_Item(currentRow, currentColumn);\n            cell.set_Value(strFmt(\"%1\", InventTableModule::find(itemId, ModuleInventPurchSales::Sales).price));\n\n            currentColumn ++;\n\n            cell = SalesDatacells.get_Item(currentRow, currentColumn);\n            cell.set_Value(strFmt(\"%1\", historyViewRecord.Amount));\n\n            currentRow ++;\n        }\n\n        return itemIdCon;\n    }\n\n    /// <summary>\n    /// BAB_EXT-0002 – Dynamic Seasonality Coefficients\n    /// Bruce Niu 11/14/2024\n    /// getAllCategory\n    /// </summary>\n    public void getAllCategory(RecId _parentRecId)\n    {\n        EcoResCategory  cate;\n\n        while select RecId from cate\n            where cate.ParentCategory == _parentRecId\n        {\n            select firstonly RecId from gCategoryTable\n                where gCategoryTable.EcoResCategory     == cate.RecId\n                  && gCategoryTable.SessionId           == gsessionId;\n\n            if(!gCategoryTable)\n            {\n                gCategoryTable.EcoResCategory   = cate.RecId;\n                gCategoryTable.SessionId        = gsessionId;\n                gCategoryTable.insert();\n\n                this.getAllCategory(cate.recid);\n            }\n        }\n    }\n\n    /// <summary>\n    /// LMS_SUN-030708_Mid-StatesPullReport\n    /// Bruce Niu -10/11/2024\n    /// Get invent on hand.\n    /// </summary>\n    /// <param name = \"_itemId\">Item Id</param>\n    /// <param name = \"_inventdIm\">Invent Dim</param>\n    /// <returns>the string of inventOnhand</returns>\n    public str getinventOnhand(str _itemId, str _inventdIm)\n    {\n        InventDimParm         dimParm;\n        InventOnhand          onhand;\n        InventDim             inventDimNew;\n\n        inventDimNew = InventDim::find(_inventdIm);\n\n        dimParm.initFromInventDim(inventDimNew);\n\n        onhand      = InventOnhand::newItemDim(_itemId, inventDimNew, dimParm);\n\n        return strFmt(\"%1\", onhand.physicalInvent());\n    }\n\n    /// <summary>\n    /// LMS_SUN-030708_Mid-StatesPullReport\n    /// Bruce Niu -10/11/2024\n    /// Get category.\n    /// </summary>\n    /// <param name = \"_itemId\">Item Id</param>\n    /// <returns>container</returns>\n    public container  getCategory(str _itemId)\n    {\n        EcoResCategory          c1,c2,c3;\n        EcoResProductCategory   ecoResProductCate   = EcoResProductCategory::findByItemIdCategoryHierarchyRole(_itemId, EcoResCategoryNamedHierarchyRole::Retail);\n\n        c1 = EcoResCategory::find(ecoResProductCate.Category);\n        c2 = EcoResCategory::find(c1.ParentCategory);\n        c3 = EcoResCategory::find(c2.ParentCategory);\n        \n        return [c3.Name, c2.Name, c1.Name];\n    }\n\n    /// <summary>\n    /// LMS_SUN-030708_Mid-StatesPullReport\n    /// Bruce Niu -10/11/2024\n    /// Get Item Barcode\n    /// </summary>\n    /// <param name = \"_itemid\">Item Id</param>\n    /// <param name = \"_inventDimId\">Invent dim id</param>\n    /// <returns>ItemBarcode</returns>\n    public str getItemBarcode(str _itemid, str _inventDimId)\n    {\n        InventItemBarcode barcode;\n\n        select firstonly itemBarCode from barcode\n            where barcode.barcodeSetupId    == '@LMS:LMSUPC'\n               && barcode.inventDimId       == _inventDimId\n               && barcode.itemId            == _itemid;\n\n        return barcode.itemBarCode;\n    }\n\n    /// <summary>\n    /// LMS_SUN-030708_Mid-StatesPullReport\n    /// Bruce Niu -10/11/2024\n    /// Get all date collection.\n    /// </summary>\n    /// <returns>container</returns>\n    public container getAlldateCollection()\n    {\n        container con = conNull();\n        date        fD, tD;\n        \n        fD = gFromDate;\n        tD = endMth(fd);\n        \n        while(tD <= gToDate)\n        {\n            con += [[fD, td]];\n\n            fD = nextMth(fD);\n            fD = fD - (dayOfMth(fd) - 1);\n            tD = endMth(fd);\n        }\n\n        if(tD > gToDate && fD <= gToDate)\n        {\n            con += [[fD, gToDate]];\n        }\n\n        return con;\n    }\n\n    /// <summary>\n    /// LMS_SUN-030708_Mid-StatesPullReport\n    /// Bruce Niu -10/11/2024\n    /// Generate month column.\n    /// </summary>\n    /// <returns>container</returns>\n    public container generateMonthColumn()\n    {\n        container   con = conNull();\n        date        fd  = gFromDate;\n        date        Td  = endMth(gToDate);\n\n        if(gFromDate && gToDate)\n        {\n            while(fd <= Td)\n            {\n                con += strFmt(\"@LMS:LMSSalesUnits\", this.getMthName(mthOfYr(fd)), year(fd) mod 1000);\n\n                fd      = nextMth(fd);\n            }\n        }\n\n        return con;\n    }\n\n    /// <summary>\n    /// LMS_SUN-030708_Mid-StatesPullReport\n    /// Bruce Niu -10/11/2024\n    /// Get month name.\n    /// </summary>\n    /// <param name = \"_number\">number</param>\n    /// <returns>month name string</returns>\n    public str getMthName(int _number)\n    {\n        str mth = '';\n\n        switch(_number)\n        {\n            case 1:\n                mth = '@LMS:LMSJan';\n                break;\n            case 2:\n                mth = '@LMS:LMSFeb';\n                break;\n            case 3:\n                mth = '@LMS:LMSMar';\n                break;\n            case 4:\n                mth = '@LMS:LMSApr';\n                break;\n            case 5:\n                mth = '@LMS:LMSMay';\n                break;\n            case 6:\n                mth = '@LMS:LMSJun';\n                break;\n            case 7:\n                mth = '@LMS:LMSJul';\n                break;\n            case 8:\n                mth = '@LMS:LMSAug';\n                break;\n            case 9:\n                mth = '@LMS:LMSSep';\n                break;\n            case 10:\n                mth = '@LMS:LMSOct';\n                break;\n            case 11:\n                mth = '@LMS:LMSNov';\n                break;\n            case 12:\n                mth = '@LMS:LMSDec';\n                break;\n        \n        }\n\n        return mth;\n    \n    }\n\n    /// <summary>\n    /// LMS_SUN-030708_Mid-StatesPullReport\n    /// Bruce Niu -10/11/2024\n    /// Generate Supplier\n    /// </summary>\n    /// <param name = \"_con\">container</param>\n    /// <param name = \"_SupplierWorksheet\">ExcelWorksheet</param>\n    public void generateSupplier(container _con,  OfficeOpenXml.ExcelWorksheet    _SupplierWorksheet)\n    {\n        var         Suppliercells       = _SupplierWorksheet.get_Cells();\n        Map         map                 = new Map(Types::String, Types::Container);\n        int         currentColumn       = 1;\n        container   vendorCon           = conNull();\n        InventTable inventtable;\n\n        OfficeOpenXml.ExcelRange cell = Suppliercells.get_Item(1, 1);\n        cell.set_Value(\"@LMS:LMSItemCategory\");\n\n        cell = Suppliercells.get_Item(2, 1);\n        cell.set_Value(\"@LMS:LMSSupplierVendorName\");\n\n        cell = Suppliercells.get_Item(3, 1);\n        cell.set_Value(\"@LMS:LMSPaymentTermsDays\");\n\n        cell = Suppliercells.get_Item(4, 1);\n        cell.set_Value(\"@LMS:LMSFreightTerms\");\n\n        cell = Suppliercells.get_Item(5, 1);\n        cell.set_Value(\"@LMS:LMSFOBOriginPoint\");\n\n        cell = Suppliercells.get_Item(6, 1);\n        cell.set_Value(\"@LMS:LMSDelveryMethod\");\n\n        cell = Suppliercells.get_Item(7, 1);\n        cell.set_Value(\"@LMS:LMSMinimumOrder\");\n\n        cell = Suppliercells.get_Item(8, 1);\n        cell.set_Value(\"@LMS:LMSMinimumOrderAmount\");\n\n        cell = Suppliercells.get_Item(9, 1);\n        cell.set_Value(\"@LMS:LMSMidStates\");\n\n        cell = Suppliercells.get_Item(10, 1);\n        cell.set_Value(\"@LMS:LMSInitialStoreAllowance\");\n\n\n        cell = Suppliercells.get_Item(11, 1);\n        cell.set_Value(\"@LMS:LMSDefetiveAllowance\");\n\n\n        cell = Suppliercells.get_Item(12, 1);\n        cell.set_Value(\"@LMS:LMSCoopMarketingAllowance\");\n\n        cell = Suppliercells.get_Item(13, 1);\n        cell.set_Value(\"@LMS:LMSVolumeRebateAllowance\");\n\n        cell = Suppliercells.get_Item(14, 1);\n        cell.set_Value(\"@LMS:LMSOtherDiscounts\");\n\n        cell = Suppliercells.get_Item(15, 1);\n        cell.set_Value(\"@LMS:LMSReplacementCost\");\n\n        cell = Suppliercells.get_Item(16, 1);\n        cell.set_Value('@LMS:LMSReplacementCostInclude');\n\n        cell = Suppliercells.get_Item(17, 1);\n        cell.set_Value(\"@LMS:LMSComments\");\n\n        for(int i = 1; i<= conLen(_con); i++)\n        {\n            select firstonly PrimaryVendorId from inventtable\n                where inventtable.ItemId    == conPeek(_con, i);\n\n            if(inventtable.PrimaryVendorId && !conFind(vendorCon, inventtable.PrimaryVendorId))\n            {\n                vendorCon += inventtable.PrimaryVendorId;\n            }\n        }\n\n        for(int j = 1; j <= conLen(vendorCon); j++)\n        {\n            currentColumn ++;\n\n            if(currentColumn == 2)\n            {\n                cell = Suppliercells.get_Item(1, currentColumn);\n                cell.set_Value(\"@LMS:LMSCurrentSupplier\");\n            }\n            else\n            {\n                cell = Suppliercells.get_Item(1, currentColumn);\n                cell.set_Value(strFmt(\"@LMS:LMSSupplier\", currentColumn - 1));\n            }\n\n            VendTable   vendTable = VendTable::find(conPeek(vendorCon, j));\n\n            if(vendTable)\n            {\n                cell = Suppliercells.get_Item(2, currentColumn);\n                cell.set_Value(vendTable.name());\n\n                cell = Suppliercells.get_Item(3, currentColumn);\n                cell.set_Value(this.getPaymentTerms(vendTable.CashDisc, vendTable.PaymTermId));\n\n                cell = Suppliercells.get_Item(4, currentColumn);\n                cell.set_Value(this.getFreightTerms(vendTable.DlvTerm));\n\n                cell = Suppliercells.get_Item(5, currentColumn);\n                cell.set_Value(this.getFOBOriginPoint(vendTable.Party));\n                //6\n                cell = Suppliercells.get_Item(7, currentColumn);\n                cell.set_Value(int2Str(VendTable.LMSMinDollarOrder));\n\n                cell = Suppliercells.get_Item(8, currentColumn);\n                cell.set_Value(int2Str(VendTable.LMSMinUnitFreight) + \" \" + \"@SYS314952\");\n\n                cell = Suppliercells.get_Item(9, currentColumn);\n                cell.set_Value(this.getautoChargeLine(vendTable.accountnum, \"@LMS:LMSCBA\"));\n\n                //10\n\n                cell = Suppliercells.get_Item(11, currentColumn);\n                cell.set_Value(this.getautoChargeLine(vendTable.accountnum, \"@LMS:LMSDefective\"));\n\n                cell = Suppliercells.get_Item(12, currentColumn);\n                cell.set_Value(this.getautoChargeLine(vendTable.accountnum, \"@LMS:LMSCoop\"));\n\n                // 13 14 15 16 17 \n            }\n        }\n    }\n\n    /// <summary>\n    /// LMS_SUN-030708_Mid-StatesPullReport\n    /// Bruce Niu -10/11/2024\n    /// Get auto Charge Line\n    /// </summary>\n    /// <param name = \"_account\">Account</param>\n    /// <param name = \"_markupcode\">markup code</param>\n    /// <returns>str</returns>\n    public str getautoChargeLine(str _account, str _markupcode)\n    {\n        MarkupAutoTable autoTable;\n        MarkupAutoLine  autoLine;\n\n        select firstonly Value from autoLine\n            where autoLine.MarkupCode           == _markupcode\n            exists join autoTable\n                where autoTable.ModuleType      == MarkupModuleType::Vend\n                   && autoTable.AccountCode     == TableGroupAll::Table\n                   && autoTable.AccountRelation == _account\n                   && autoTable.ModuleCategory  == HeadingLine::Heading\n                    && autoTable.ItemCode       == TableGroupAll::All\n                   && autoTable.RecId           == autoLine.TableRecId\n                   && autoTable.TableId         == autoLine.TableTableId;\n\n        if(autoLine)\n        {\n            return strFmt(\"%1 %\", autoLine.Value);\n        }\n        else\n        {\n            return \"\";\n        }\n    }\n\n    /// <summary>\n    /// LMS_SUN-030708_Mid-StatesPullReport\n    /// Bruce Niu -10/11/2024\n    /// Get fob origin point.\n    /// </summary>\n    /// <param name = \"_party\">Int64</param>\n    /// <returns>str</returns>\n    public str getFOBOriginPoint(Int64 _party)\n    {\n        LogisticsPostalAddress  address     = DirParty::primaryPostalAddress(_party);\n        str                     originPoint = \"\";\n        container               con         = conNull();\n\n        con += address.City;\n        con += address.State;\n\n        return con2Str(con);\n    }\n\n    /// <summary>\n    /// LMS_SUN-030708_Mid-StatesPullReport\n    /// Bruce Niu -10/11/2024\n    /// Get freight terms.\n    /// </summary>\n    /// <param name = \"_dlvTerm\">dlvTerm</param>\n    /// <returns>FreightTerms str</returns>\n    public str getFreightTerms(str _dlvTerm)\n    {\n        container con = ['@LMS:LMSFFAFOBD', '@LMS:LMSFFAFOBO', '@LMS:LMSPPAFOBD', '@LMS:LMSPPAFOBO', '@LMS:LMSPPDFOBD', '@LMS:LMSPPDFOBO'];\n\n        if(conFind(con, _dlvTerm))\n        {\n            return 'Yes';\n        }\n        else\n        {\n            return 'No';\n        }\n    \n    }\n\n    /// <summary>\n    /// LMS_SUN-030708_Mid-StatesPullReport\n    /// Bruce Niu -10/11/2024\n    /// Get Payment Terms\n    /// </summary>\n    /// <param name = \"_CashDisc\">CashDisc</param>\n    /// <param name = \"_PaymTermId\">PaymTermId</param>\n    /// <returns>str</returns>\n    public str getPaymentTerms(str _CashDisc, str _PaymTermId)\n    {\n        CashDisc    cd  = CashDisc::find(_CashDisc);\n        container   con = conNull();\n        PaymTerm    pt  = PaymTerm::find(_PaymTermId);\n\n        if(cd.NumOfDays)\n        {\n            con += int2Str(cd.NumOfDays);\n        }\n\n        if(pt.PaymMethod)\n        {\n            con += enum2Str(pt.PaymMethod);\n        }\n\n        if(pt.NumOfDays)\n        {\n            con += int2Str(pt.NumOfDays);\n        }\n\n        if(conLen(con) > 0)\n        {\n            return con2Str(con, \" \");\n        }\n        else\n        {\n            return \"\";\n        }\n    }\n\n    /// <summary>\n    /// LMS_SUN-030708_Mid-StatesPullReport\n    /// Bruce Niu -10/11/2024\n    /// Get item id.\n    /// </summary>\n    /// <param name = \"_displayProductNumber\">DisplayProductNumber</param>\n    /// <returns>container</returns>\n    public container getItemId(LMSSalesHistorySummaryView _summaryView)\n    {\n        InventTable             inventtable;\n        InventDimCombination    inventDimCombination;\n        EcoResProduct           ecoResProduct;\n\n        // LMS_SUN-030708_Mid-StatesPullReport add by Ina Wang on 11/11/2024 begin\n        InventDim               inventDimLoc;\n\n        select firstonly ItemId, InventDimId, RetailVariantId, DistinctProductVariant from inventDimCombination\n            where inventDimCombination.ItemId       == _summaryView.ProductNumber\n            exists join inventDimLoc\n                where inventDimLoc.inventDimId      == inventDimCombination.InventDimId\n                    && inventDimLoc.InventColorId   == _summaryView.Color\n                    && inventDimLoc.InventSizeId    == _summaryView.Size;\n        \n        if(inventDimCombination.ItemId)\n        {\n            return [inventDimCombination.ItemId,inventDimCombination.InventDimId, inventDimCombination.productDescription(\"en-us\")];\n        }\n        else\n        {\n            select firstonly ItemId, Product from inventtable\n                exists join ecoResProduct\n                    where ecoResProduct.RecId                   == inventtable.Product\n                       && ecoResProduct.DisplayProductNumber    == _summaryView.ProductNumber;\n\n            return [inventtable.ItemId, InventDim::inventDimIdBlank(), inventtable.productDescription(\"en-us\")];\n        }\n\n        // LMS_SUN-030708_Mid-StatesPullReport add by Ina Wang on 11/11/2024 end\n    }\n}\n```","source":"_drafts/xpp-export-to-excel.md","raw":"---\ntitle: Export to excel\ncomments: true\ndate: 2024-12-23 22:20:30\ntags:\ncategories:\n - X++\ndescription: This article describes the way to export to excel\n---\n\n### Example Code\n\n```c#\nusing System.IO;\nusing OfficeOpenXml;\nusing OfficeOpenXml.Style;\nusing OfficeOpenXml.Table;\nusing OfficeOpenXml.Style.ExcelFillStyle;\nusing System.Drawing;\nclass LMSMidStatesPullService extends SysOperationServiceBase\n{\n    public date                     gFromDate;\n    public date                     gToDate;\n    public boolean                  hasheader = false;\n    public EcoResCategoryId         gCategory;\n    public LMSCateGoryTable         gCategoryTable;\n    public EcoResCategory           gEcoCategoryTable;\n    RetailReportSessionIdentifier   gsessionId = guid2Str(newGuid());\n\n    /// <summary>\n    /// LMS_SUN-029403_EXT-00015 Load to Truck Validation\n    /// Lance Shi - 7/17/2024\n    /// Process\n    /// </summary>\n    /// <param name = \"_contract\">LMSCleanUpLoadedLPTableContract</param>\n    public void process(LMSMidStatesPullContract _contract)\n    {\n        gFromDate           = _contract.parmFromDate();\n        gToDate             = _contract.parmToDate();\n        // LMS_SUN-030708_Mid-StatesPullReport add by Ina Wang on 11/21/2024 begin\n\n        gCategory           = _contract.parmCategory();\n        gEcoCategoryTable   = EcoResCategory::find(gCategory);\n\n        select firstonly RecId from gCategoryTable\n            where gCategoryTable.EcoResCategory     == gEcoCategoryTable.RecId\n              && gCategoryTable.SessionId           == gsessionId;\n\n        if(!gCategoryTable.RecId)\n        {\n            gCategoryTable.EcoResCategory   = gEcoCategoryTable.RecId;\n            gCategoryTable.SessionId        = gsessionId;\n            gCategoryTable.insert();\n        }\n\n        ttsbegin;\n        this.getAllCategory(gEcoCategoryTable.RecId);\n        this.createtab(_contract);\n\n        delete_from gCategoryTable\n            where gCategoryTable.SessionId == gsessionId;\n        ttscommit;\n        // LMS_SUN-030708_Mid-StatesPullReport add by Ina Wang on 11/21/2024 end\n    }\n\n    /// <summary>\n    /// LMS_SUN-030708_Mid-StatesPullReport\n    /// Bruce Niu -10/11/2024\n    /// Create tab.\n    /// </summary>\n    /// <param name = \"_contract\">LMSMidStatesPullContract</param>\n    public void createtab(LMSMidStatesPullContract _contract)\n    {\n        QueryRun                        queryRun    = new QueryRun(_contract.getQuery());\n        LMSSalesHistoryView             historyView;\n        container                       itemIdCon   = conNull();\n        System.IO.Stream                stream;\n        ExcelSpreadsheetName            sheet;\n        MemoryStream                    memoryStream = new MemoryStream();\n\n        using (var package = new ExcelPackage(memoryStream))\n        {\n            var currentRow = 1;\n\n            var                             worksheets          = package.get_Workbook().get_Worksheets();\n            OfficeOpenXml.ExcelWorksheet    SupplierWorksheet   = worksheets.Add(\"@LMS:LMSSupplierInformation\");\n            OfficeOpenXml.ExcelWorksheet    SalesDataWorksheet  = worksheets.Add(\"@LMS:LMSSalesData\");\n\n            itemIdCon = this.generateSalesData(SalesDataWorksheet, _contract);\n\n            if(itemIdCon)\n            {\n                this.generateSupplier(itemIdCon, SupplierWorksheet);\n        \n            }\n\n            package.Save();\n            file::SendFileToUser(memoryStream, \"@LMS:LMSMidStatsPullExcel\");\n        }\n    }\n\n    /// <summary>\n    /// LMS_SUN-030708_Mid-StatesPullReport\n    /// Bruce Niu -10/11/2024\n    /// Get query for range.\n    /// </summary>\n    /// <param name = \"_query\">Query</param>\n    /// <returns>Query</returns>\n    public Query  getQueryForRange(Query _query)\n    {\n        Query                   query = _query;\n        QueryBuildDataSource    qbds = _query.dataSourceTable(tableNum(LMSSalesHistorySummaryView)).addDataSource(tableNum(LMSSalesHistoryView));\n\n        qbds.joinMode(JoinMode::ExistsJoin);\n        qbds.addLink(fieldNum(LMSSalesHistorySummaryView, ProductNumber), fieldNum(LMSSalesHistoryView, ProductNumber));\n\n        // LMS_SUN-030708_Mid-StatesPullReport add by Ina Wang on 11/11/2024 begin\n        qbds.addLink(fieldNum(LMSSalesHistorySummaryView, Color), fieldNum(LMSSalesHistoryView, Color));\n        qbds.addLink(fieldNum(LMSSalesHistorySummaryView, Size), fieldNum(LMSSalesHistoryView, Size));\n        // LMS_SUN-030708_Mid-StatesPullReport add by Ina Wang on 11/11/2024 end\n\n        qbds.addRange(fieldNum(LMSSalesHistoryView, SalesHistoryDate)).value(SysQueryRangeUtil::dateRange(gFromDate, gToDate));\n\n        // LMS_SUN-030708_Mid-StatesPullReport add by Ina Wang on 11/21/2024 begin\n        if(gCategory)\n        {\n            EcoResCategoryNamedHierarchyRole    hierarchyId             = EcoResCategoryHierarchyRole::getHierarchiesByRole(EcoResCategoryNamedHierarchyRole::Retail).NamedCategoryHierarchyRole;\n            QueryBuildDataSource                qbdsCategoryExpanded    = _query.dataSourceTable(tableNum(LMSSalesHistoryView)).addDataSource(tableNum(EcoResProductCategoryExpanded));\n\n            qbdsCategoryExpanded.joinMode(JoinMode::ExistsJoin);\n            qbdsCategoryExpanded.addLink(fieldNum(LMSSalesHistoryView, ProductNumber), fieldNum(EcoResProductCategoryExpanded, ItemId));\n            qbdsCategoryExpanded.addRange(fieldNum(EcoResProductCategoryExpanded, NamedCategoryHierarchyRole)).value(queryValue(hierarchyId));\n\n            QueryBuildDataSource    qbdsCategoryTable     = _query.dataSourceTable(tableNum(EcoResProductCategoryExpanded)).addDataSource(tableNum(LMSCateGoryTable));\n            qbdsCategoryTable.joinMode(JoinMode::ExistsJoin);\n            qbdsCategoryTable.addLink(fieldNum(EcoResProductCategoryExpanded, RecIdCategory), fieldNum(LMSCateGoryTable, EcoResCategory));\n            qbdsCategoryTable.addRange(fieldNum(LMSCateGoryTable, SessionId)).value(queryValue(gsessionId));\n        }\n        // LMS_SUN-030708_Mid-StatesPullReport add by Ina Wang on 11/21/2024 end\n        return query;\n\n    }\n\n    /// <summary>\n    /// LMS_SUN-030708_Mid-StatesPullReport\n    /// Bruce Niu -10/11/2024\n    /// Generate sales data.\n    /// </summary>\n    /// <param name = \"_SalesDataWorksheet\">ExcelWorksheet</param>\n    /// <param name = \"_contract\">Contract</param>\n    /// <returns>container</returns>\n    public container generateSalesData(OfficeOpenXml.ExcelWorksheet _SalesDataWorksheet, LMSMidStatesPullContract _contract)\n    {\n        var                             SalesDatacells      = _SalesDataWorksheet.get_Cells();\n        Map                             map                 = new Map(Types::String, Types::Container);\n        int                             row                 = 1;\n        QueryRun                        queryRun            = new QueryRun(this.getQueryForRange(_contract.getQuery()));\n        LMSSalesHistorySummaryView      historyView;\n        LMSSalesHistoryView             historyViewRecord;\n        container                       supplerRow          = conNull();\n        container                       itemIdCon           = conNull();\n\n        OfficeOpenXml.ExcelRange cell = SalesDatacells.get_Item(1, 1);\n        cell.set_Value(\"@LMS:LMSMemberName\");\n\n        cell = SalesDatacells.get_Item(1, 2);\n        cell.set_Value(\"@LMS:LMSReportingVendor\");\n\n        cell = SalesDatacells.get_Item(1, 3);\n        cell.set_Value(\"@LMS:LMSItemNumber\");\n\n        cell = SalesDatacells.get_Item(1, 4);\n        cell.set_Value(\"@LMS:LMSMFGPart\");\n\n        cell = SalesDatacells.get_Item(1, 5);\n        cell.set_Value(\"@LMS:LMSItemDesc\");\n\n        cell = SalesDatacells.get_Item(1, 6);\n        cell.set_Value(\"@LMS:LMSUPC\");\n\n        cell = SalesDatacells.get_Item(1, 7);\n        cell.set_Value(\"@SYS850\");\n\n        cell = SalesDatacells.get_Item(1, 8);\n        cell.set_Value(\"@LMS:LMSClassLine\");\n\n        cell = SalesDatacells.get_Item(1, 9);\n        cell.set_Value(\"@LMS:LMSSubClassFineLine\");\n\n        int currentRow = 9;\n\n        container con = this.generateMonthColumn();\n\n        if(con)\n        {\n            for(int i = 1; i <= conlen(con); i ++)\n            {\n                currentRow ++;\n                cell = SalesDatacells.get_Item(1, currentRow);\n                cell.set_Value(conpeek(con, i));\n            }\n        }\n\n        currentRow ++;\n        cell = SalesDatacells.get_Item(1, currentRow);\n        cell.set_Value(\"@LMS:LMSTotalMonthSales\");\n\n        currentRow ++;\n        cell = SalesDatacells.get_Item(1, currentRow);\n        cell.set_Value(\"@LMS:LMSRepalcementCost\");\n\n        currentRow ++;\n        cell = SalesDatacells.get_Item(1, currentRow);\n        cell.set_Value(\"@LMS:LMSCompanyOnHand\");\n\n        currentRow ++;\n        cell = SalesDatacells.get_Item(1, currentRow);\n        cell.set_Value(\"@LMS:LMSSystemRetail\");\n\n        currentRow ++;\n        cell = SalesDatacells.get_Item(1, currentRow);\n        cell.set_Value(\"@LMS:LMSAverageUnitRetail\");\n\n        currentRow = 2;\n        container alldateCollection = this.getAlldateCollection();\n\n        while(queryRun.next())\n        {\n            historyView                 = queryRun.get(tableNum(LMSSalesHistorySummaryView));\n\n            container   itemIdDim       = this.getItemId(historyView);\n            ItemId      itemId          = conPeek(itemIdDim, 1);\n            InventDimId inventdIm       = conPeek(itemIdDim, 2);\n            str         description     = conPeek(itemIdDim, 3);\n            int         currentColumn   ;\n\n            InventTable inventTable;\n\n            select firstonly PrimaryVendorId from inventTable\n                where inventTable.ItemId == itemId;\n\n            VendTable   vendTable;\n\n            select firstonly Party from vendTable\n                where vendTable.AccountNum == inventTable.PrimaryVendorId;\n\n            if(itemIdCon == conNull())\n            {\n                itemIdCon += itemId;\n            }\n            else\n            {\n                if(!conFind(itemIdCon, itemId))\n                {\n                    itemIdCon += itemId;\n                }\n            }\n\n            cell = SalesDatacells.get_Item(currentRow, 1);\n            cell.set_Value(\"@LMS:LMSLMSupply\");\n\n            cell = SalesDatacells.get_Item(currentRow, 2);\n            cell.set_Value(vendTable.vendorName());\n\n            cell = SalesDatacells.get_Item(currentRow, 3);\n            cell.set_Value(historyView.ProductNumber);\n\n            cell = SalesDatacells.get_Item(currentRow, 4);\n            cell.set_Value(CustVendExternalItem::find(ModuleInventPurchSalesVendCustGroup::Vend, itemId, inventdIm, inventTable.PrimaryVendorId).ExternalItemId);\n\n            cell = SalesDatacells.get_Item(currentRow, 5);\n            cell.set_Value(description);\n\n            cell = SalesDatacells.get_Item(currentRow, 6);\n            cell.set_Value(this.getItemBarcode(itemId, inventdIm));\n\n            container conCate = this.getCategory(itemId);\n\n            cell = SalesDatacells.get_Item(currentRow, 7);\n            cell.set_Value(conPeek(conCate, 1));\n\n            cell = SalesDatacells.get_Item(currentRow, 8);\n            cell.set_Value(conPeek(conCate, 2));\n\n            cell = SalesDatacells.get_Item(currentRow, 9);\n            cell.set_Value(conPeek(conCate, 3));\n\n            for(currentColumn  = 10; currentColumn <= conLen(alldateCollection) + 9; currentColumn++)\n            {\n                container   conLine = conPeek(alldateCollection, currentColumn - 9);\n\n                select sum(Quantity) from historyViewRecord\n                    where historyViewRecord.ProductNumber       == historyView.ProductNumber\n                       && historyViewRecord.SalesHistoryDate    >= conPeek(conLine, 1)\n                       && historyViewRecord.SalesHistoryDate    <= conPeek(conLine, 2);\n\n                cell = SalesDatacells.get_Item(currentRow, currentColumn);\n                cell.set_Value(strFmt(\"%1\", historyViewRecord.Quantity));\n            \n            }\n\n            select sum(Quantity),sum(Amount) from historyViewRecord\n                    where historyViewRecord.ProductNumber       == historyView.ProductNumber\n                       && historyViewRecord.SalesHistoryDate    >= gFromDate\n                       && historyViewRecord.SalesHistoryDate    <= gToDate;\n\n            cell = SalesDatacells.get_Item(currentRow, currentColumn);\n            cell.set_Value(strFmt(\"%1\", historyViewRecord.Quantity));\n\n            currentColumn ++;\n\n            cell = SalesDatacells.get_Item(currentRow, currentColumn);\n            cell.set_Value(strFmt(\"%1\", InventTableModule::find(itemId, ModuleInventPurchSales::Purch).price));\n\n            currentColumn ++;\n\n            cell = SalesDatacells.get_Item(currentRow, currentColumn);\n            cell.set_Value(this.getinventOnhand(itemId, inventdIm));\n\n            currentColumn ++;\n\n            cell = SalesDatacells.get_Item(currentRow, currentColumn);\n            cell.set_Value(strFmt(\"%1\", InventTableModule::find(itemId, ModuleInventPurchSales::Sales).price));\n\n            currentColumn ++;\n\n            cell = SalesDatacells.get_Item(currentRow, currentColumn);\n            cell.set_Value(strFmt(\"%1\", historyViewRecord.Amount));\n\n            currentRow ++;\n        }\n\n        return itemIdCon;\n    }\n\n    /// <summary>\n    /// BAB_EXT-0002 – Dynamic Seasonality Coefficients\n    /// Bruce Niu 11/14/2024\n    /// getAllCategory\n    /// </summary>\n    public void getAllCategory(RecId _parentRecId)\n    {\n        EcoResCategory  cate;\n\n        while select RecId from cate\n            where cate.ParentCategory == _parentRecId\n        {\n            select firstonly RecId from gCategoryTable\n                where gCategoryTable.EcoResCategory     == cate.RecId\n                  && gCategoryTable.SessionId           == gsessionId;\n\n            if(!gCategoryTable)\n            {\n                gCategoryTable.EcoResCategory   = cate.RecId;\n                gCategoryTable.SessionId        = gsessionId;\n                gCategoryTable.insert();\n\n                this.getAllCategory(cate.recid);\n            }\n        }\n    }\n\n    /// <summary>\n    /// LMS_SUN-030708_Mid-StatesPullReport\n    /// Bruce Niu -10/11/2024\n    /// Get invent on hand.\n    /// </summary>\n    /// <param name = \"_itemId\">Item Id</param>\n    /// <param name = \"_inventdIm\">Invent Dim</param>\n    /// <returns>the string of inventOnhand</returns>\n    public str getinventOnhand(str _itemId, str _inventdIm)\n    {\n        InventDimParm         dimParm;\n        InventOnhand          onhand;\n        InventDim             inventDimNew;\n\n        inventDimNew = InventDim::find(_inventdIm);\n\n        dimParm.initFromInventDim(inventDimNew);\n\n        onhand      = InventOnhand::newItemDim(_itemId, inventDimNew, dimParm);\n\n        return strFmt(\"%1\", onhand.physicalInvent());\n    }\n\n    /// <summary>\n    /// LMS_SUN-030708_Mid-StatesPullReport\n    /// Bruce Niu -10/11/2024\n    /// Get category.\n    /// </summary>\n    /// <param name = \"_itemId\">Item Id</param>\n    /// <returns>container</returns>\n    public container  getCategory(str _itemId)\n    {\n        EcoResCategory          c1,c2,c3;\n        EcoResProductCategory   ecoResProductCate   = EcoResProductCategory::findByItemIdCategoryHierarchyRole(_itemId, EcoResCategoryNamedHierarchyRole::Retail);\n\n        c1 = EcoResCategory::find(ecoResProductCate.Category);\n        c2 = EcoResCategory::find(c1.ParentCategory);\n        c3 = EcoResCategory::find(c2.ParentCategory);\n        \n        return [c3.Name, c2.Name, c1.Name];\n    }\n\n    /// <summary>\n    /// LMS_SUN-030708_Mid-StatesPullReport\n    /// Bruce Niu -10/11/2024\n    /// Get Item Barcode\n    /// </summary>\n    /// <param name = \"_itemid\">Item Id</param>\n    /// <param name = \"_inventDimId\">Invent dim id</param>\n    /// <returns>ItemBarcode</returns>\n    public str getItemBarcode(str _itemid, str _inventDimId)\n    {\n        InventItemBarcode barcode;\n\n        select firstonly itemBarCode from barcode\n            where barcode.barcodeSetupId    == '@LMS:LMSUPC'\n               && barcode.inventDimId       == _inventDimId\n               && barcode.itemId            == _itemid;\n\n        return barcode.itemBarCode;\n    }\n\n    /// <summary>\n    /// LMS_SUN-030708_Mid-StatesPullReport\n    /// Bruce Niu -10/11/2024\n    /// Get all date collection.\n    /// </summary>\n    /// <returns>container</returns>\n    public container getAlldateCollection()\n    {\n        container con = conNull();\n        date        fD, tD;\n        \n        fD = gFromDate;\n        tD = endMth(fd);\n        \n        while(tD <= gToDate)\n        {\n            con += [[fD, td]];\n\n            fD = nextMth(fD);\n            fD = fD - (dayOfMth(fd) - 1);\n            tD = endMth(fd);\n        }\n\n        if(tD > gToDate && fD <= gToDate)\n        {\n            con += [[fD, gToDate]];\n        }\n\n        return con;\n    }\n\n    /// <summary>\n    /// LMS_SUN-030708_Mid-StatesPullReport\n    /// Bruce Niu -10/11/2024\n    /// Generate month column.\n    /// </summary>\n    /// <returns>container</returns>\n    public container generateMonthColumn()\n    {\n        container   con = conNull();\n        date        fd  = gFromDate;\n        date        Td  = endMth(gToDate);\n\n        if(gFromDate && gToDate)\n        {\n            while(fd <= Td)\n            {\n                con += strFmt(\"@LMS:LMSSalesUnits\", this.getMthName(mthOfYr(fd)), year(fd) mod 1000);\n\n                fd      = nextMth(fd);\n            }\n        }\n\n        return con;\n    }\n\n    /// <summary>\n    /// LMS_SUN-030708_Mid-StatesPullReport\n    /// Bruce Niu -10/11/2024\n    /// Get month name.\n    /// </summary>\n    /// <param name = \"_number\">number</param>\n    /// <returns>month name string</returns>\n    public str getMthName(int _number)\n    {\n        str mth = '';\n\n        switch(_number)\n        {\n            case 1:\n                mth = '@LMS:LMSJan';\n                break;\n            case 2:\n                mth = '@LMS:LMSFeb';\n                break;\n            case 3:\n                mth = '@LMS:LMSMar';\n                break;\n            case 4:\n                mth = '@LMS:LMSApr';\n                break;\n            case 5:\n                mth = '@LMS:LMSMay';\n                break;\n            case 6:\n                mth = '@LMS:LMSJun';\n                break;\n            case 7:\n                mth = '@LMS:LMSJul';\n                break;\n            case 8:\n                mth = '@LMS:LMSAug';\n                break;\n            case 9:\n                mth = '@LMS:LMSSep';\n                break;\n            case 10:\n                mth = '@LMS:LMSOct';\n                break;\n            case 11:\n                mth = '@LMS:LMSNov';\n                break;\n            case 12:\n                mth = '@LMS:LMSDec';\n                break;\n        \n        }\n\n        return mth;\n    \n    }\n\n    /// <summary>\n    /// LMS_SUN-030708_Mid-StatesPullReport\n    /// Bruce Niu -10/11/2024\n    /// Generate Supplier\n    /// </summary>\n    /// <param name = \"_con\">container</param>\n    /// <param name = \"_SupplierWorksheet\">ExcelWorksheet</param>\n    public void generateSupplier(container _con,  OfficeOpenXml.ExcelWorksheet    _SupplierWorksheet)\n    {\n        var         Suppliercells       = _SupplierWorksheet.get_Cells();\n        Map         map                 = new Map(Types::String, Types::Container);\n        int         currentColumn       = 1;\n        container   vendorCon           = conNull();\n        InventTable inventtable;\n\n        OfficeOpenXml.ExcelRange cell = Suppliercells.get_Item(1, 1);\n        cell.set_Value(\"@LMS:LMSItemCategory\");\n\n        cell = Suppliercells.get_Item(2, 1);\n        cell.set_Value(\"@LMS:LMSSupplierVendorName\");\n\n        cell = Suppliercells.get_Item(3, 1);\n        cell.set_Value(\"@LMS:LMSPaymentTermsDays\");\n\n        cell = Suppliercells.get_Item(4, 1);\n        cell.set_Value(\"@LMS:LMSFreightTerms\");\n\n        cell = Suppliercells.get_Item(5, 1);\n        cell.set_Value(\"@LMS:LMSFOBOriginPoint\");\n\n        cell = Suppliercells.get_Item(6, 1);\n        cell.set_Value(\"@LMS:LMSDelveryMethod\");\n\n        cell = Suppliercells.get_Item(7, 1);\n        cell.set_Value(\"@LMS:LMSMinimumOrder\");\n\n        cell = Suppliercells.get_Item(8, 1);\n        cell.set_Value(\"@LMS:LMSMinimumOrderAmount\");\n\n        cell = Suppliercells.get_Item(9, 1);\n        cell.set_Value(\"@LMS:LMSMidStates\");\n\n        cell = Suppliercells.get_Item(10, 1);\n        cell.set_Value(\"@LMS:LMSInitialStoreAllowance\");\n\n\n        cell = Suppliercells.get_Item(11, 1);\n        cell.set_Value(\"@LMS:LMSDefetiveAllowance\");\n\n\n        cell = Suppliercells.get_Item(12, 1);\n        cell.set_Value(\"@LMS:LMSCoopMarketingAllowance\");\n\n        cell = Suppliercells.get_Item(13, 1);\n        cell.set_Value(\"@LMS:LMSVolumeRebateAllowance\");\n\n        cell = Suppliercells.get_Item(14, 1);\n        cell.set_Value(\"@LMS:LMSOtherDiscounts\");\n\n        cell = Suppliercells.get_Item(15, 1);\n        cell.set_Value(\"@LMS:LMSReplacementCost\");\n\n        cell = Suppliercells.get_Item(16, 1);\n        cell.set_Value('@LMS:LMSReplacementCostInclude');\n\n        cell = Suppliercells.get_Item(17, 1);\n        cell.set_Value(\"@LMS:LMSComments\");\n\n        for(int i = 1; i<= conLen(_con); i++)\n        {\n            select firstonly PrimaryVendorId from inventtable\n                where inventtable.ItemId    == conPeek(_con, i);\n\n            if(inventtable.PrimaryVendorId && !conFind(vendorCon, inventtable.PrimaryVendorId))\n            {\n                vendorCon += inventtable.PrimaryVendorId;\n            }\n        }\n\n        for(int j = 1; j <= conLen(vendorCon); j++)\n        {\n            currentColumn ++;\n\n            if(currentColumn == 2)\n            {\n                cell = Suppliercells.get_Item(1, currentColumn);\n                cell.set_Value(\"@LMS:LMSCurrentSupplier\");\n            }\n            else\n            {\n                cell = Suppliercells.get_Item(1, currentColumn);\n                cell.set_Value(strFmt(\"@LMS:LMSSupplier\", currentColumn - 1));\n            }\n\n            VendTable   vendTable = VendTable::find(conPeek(vendorCon, j));\n\n            if(vendTable)\n            {\n                cell = Suppliercells.get_Item(2, currentColumn);\n                cell.set_Value(vendTable.name());\n\n                cell = Suppliercells.get_Item(3, currentColumn);\n                cell.set_Value(this.getPaymentTerms(vendTable.CashDisc, vendTable.PaymTermId));\n\n                cell = Suppliercells.get_Item(4, currentColumn);\n                cell.set_Value(this.getFreightTerms(vendTable.DlvTerm));\n\n                cell = Suppliercells.get_Item(5, currentColumn);\n                cell.set_Value(this.getFOBOriginPoint(vendTable.Party));\n                //6\n                cell = Suppliercells.get_Item(7, currentColumn);\n                cell.set_Value(int2Str(VendTable.LMSMinDollarOrder));\n\n                cell = Suppliercells.get_Item(8, currentColumn);\n                cell.set_Value(int2Str(VendTable.LMSMinUnitFreight) + \" \" + \"@SYS314952\");\n\n                cell = Suppliercells.get_Item(9, currentColumn);\n                cell.set_Value(this.getautoChargeLine(vendTable.accountnum, \"@LMS:LMSCBA\"));\n\n                //10\n\n                cell = Suppliercells.get_Item(11, currentColumn);\n                cell.set_Value(this.getautoChargeLine(vendTable.accountnum, \"@LMS:LMSDefective\"));\n\n                cell = Suppliercells.get_Item(12, currentColumn);\n                cell.set_Value(this.getautoChargeLine(vendTable.accountnum, \"@LMS:LMSCoop\"));\n\n                // 13 14 15 16 17 \n            }\n        }\n    }\n\n    /// <summary>\n    /// LMS_SUN-030708_Mid-StatesPullReport\n    /// Bruce Niu -10/11/2024\n    /// Get auto Charge Line\n    /// </summary>\n    /// <param name = \"_account\">Account</param>\n    /// <param name = \"_markupcode\">markup code</param>\n    /// <returns>str</returns>\n    public str getautoChargeLine(str _account, str _markupcode)\n    {\n        MarkupAutoTable autoTable;\n        MarkupAutoLine  autoLine;\n\n        select firstonly Value from autoLine\n            where autoLine.MarkupCode           == _markupcode\n            exists join autoTable\n                where autoTable.ModuleType      == MarkupModuleType::Vend\n                   && autoTable.AccountCode     == TableGroupAll::Table\n                   && autoTable.AccountRelation == _account\n                   && autoTable.ModuleCategory  == HeadingLine::Heading\n                    && autoTable.ItemCode       == TableGroupAll::All\n                   && autoTable.RecId           == autoLine.TableRecId\n                   && autoTable.TableId         == autoLine.TableTableId;\n\n        if(autoLine)\n        {\n            return strFmt(\"%1 %\", autoLine.Value);\n        }\n        else\n        {\n            return \"\";\n        }\n    }\n\n    /// <summary>\n    /// LMS_SUN-030708_Mid-StatesPullReport\n    /// Bruce Niu -10/11/2024\n    /// Get fob origin point.\n    /// </summary>\n    /// <param name = \"_party\">Int64</param>\n    /// <returns>str</returns>\n    public str getFOBOriginPoint(Int64 _party)\n    {\n        LogisticsPostalAddress  address     = DirParty::primaryPostalAddress(_party);\n        str                     originPoint = \"\";\n        container               con         = conNull();\n\n        con += address.City;\n        con += address.State;\n\n        return con2Str(con);\n    }\n\n    /// <summary>\n    /// LMS_SUN-030708_Mid-StatesPullReport\n    /// Bruce Niu -10/11/2024\n    /// Get freight terms.\n    /// </summary>\n    /// <param name = \"_dlvTerm\">dlvTerm</param>\n    /// <returns>FreightTerms str</returns>\n    public str getFreightTerms(str _dlvTerm)\n    {\n        container con = ['@LMS:LMSFFAFOBD', '@LMS:LMSFFAFOBO', '@LMS:LMSPPAFOBD', '@LMS:LMSPPAFOBO', '@LMS:LMSPPDFOBD', '@LMS:LMSPPDFOBO'];\n\n        if(conFind(con, _dlvTerm))\n        {\n            return 'Yes';\n        }\n        else\n        {\n            return 'No';\n        }\n    \n    }\n\n    /// <summary>\n    /// LMS_SUN-030708_Mid-StatesPullReport\n    /// Bruce Niu -10/11/2024\n    /// Get Payment Terms\n    /// </summary>\n    /// <param name = \"_CashDisc\">CashDisc</param>\n    /// <param name = \"_PaymTermId\">PaymTermId</param>\n    /// <returns>str</returns>\n    public str getPaymentTerms(str _CashDisc, str _PaymTermId)\n    {\n        CashDisc    cd  = CashDisc::find(_CashDisc);\n        container   con = conNull();\n        PaymTerm    pt  = PaymTerm::find(_PaymTermId);\n\n        if(cd.NumOfDays)\n        {\n            con += int2Str(cd.NumOfDays);\n        }\n\n        if(pt.PaymMethod)\n        {\n            con += enum2Str(pt.PaymMethod);\n        }\n\n        if(pt.NumOfDays)\n        {\n            con += int2Str(pt.NumOfDays);\n        }\n\n        if(conLen(con) > 0)\n        {\n            return con2Str(con, \" \");\n        }\n        else\n        {\n            return \"\";\n        }\n    }\n\n    /// <summary>\n    /// LMS_SUN-030708_Mid-StatesPullReport\n    /// Bruce Niu -10/11/2024\n    /// Get item id.\n    /// </summary>\n    /// <param name = \"_displayProductNumber\">DisplayProductNumber</param>\n    /// <returns>container</returns>\n    public container getItemId(LMSSalesHistorySummaryView _summaryView)\n    {\n        InventTable             inventtable;\n        InventDimCombination    inventDimCombination;\n        EcoResProduct           ecoResProduct;\n\n        // LMS_SUN-030708_Mid-StatesPullReport add by Ina Wang on 11/11/2024 begin\n        InventDim               inventDimLoc;\n\n        select firstonly ItemId, InventDimId, RetailVariantId, DistinctProductVariant from inventDimCombination\n            where inventDimCombination.ItemId       == _summaryView.ProductNumber\n            exists join inventDimLoc\n                where inventDimLoc.inventDimId      == inventDimCombination.InventDimId\n                    && inventDimLoc.InventColorId   == _summaryView.Color\n                    && inventDimLoc.InventSizeId    == _summaryView.Size;\n        \n        if(inventDimCombination.ItemId)\n        {\n            return [inventDimCombination.ItemId,inventDimCombination.InventDimId, inventDimCombination.productDescription(\"en-us\")];\n        }\n        else\n        {\n            select firstonly ItemId, Product from inventtable\n                exists join ecoResProduct\n                    where ecoResProduct.RecId                   == inventtable.Product\n                       && ecoResProduct.DisplayProductNumber    == _summaryView.ProductNumber;\n\n            return [inventtable.ItemId, InventDim::inventDimIdBlank(), inventtable.productDescription(\"en-us\")];\n        }\n\n        // LMS_SUN-030708_Mid-StatesPullReport add by Ina Wang on 11/11/2024 end\n    }\n}\n```","slug":"xpp-export-to-excel","published":0,"updated":"2025-07-08T12:05:00.509Z","layout":"post","photos":[],"_id":"cmcvxsshg00013cugebtg9yn9","content":"<h3 id=\"Example-Code\"><a href=\"#Example-Code\" class=\"headerlink\" title=\"Example Code\"></a>Example Code</h3><figure class=\"highlight c#\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br><span class=\"line\">249</span><br><span class=\"line\">250</span><br><span class=\"line\">251</span><br><span class=\"line\">252</span><br><span class=\"line\">253</span><br><span class=\"line\">254</span><br><span class=\"line\">255</span><br><span class=\"line\">256</span><br><span class=\"line\">257</span><br><span class=\"line\">258</span><br><span class=\"line\">259</span><br><span class=\"line\">260</span><br><span class=\"line\">261</span><br><span class=\"line\">262</span><br><span class=\"line\">263</span><br><span class=\"line\">264</span><br><span class=\"line\">265</span><br><span class=\"line\">266</span><br><span class=\"line\">267</span><br><span class=\"line\">268</span><br><span class=\"line\">269</span><br><span class=\"line\">270</span><br><span class=\"line\">271</span><br><span class=\"line\">272</span><br><span class=\"line\">273</span><br><span class=\"line\">274</span><br><span class=\"line\">275</span><br><span class=\"line\">276</span><br><span class=\"line\">277</span><br><span class=\"line\">278</span><br><span class=\"line\">279</span><br><span class=\"line\">280</span><br><span class=\"line\">281</span><br><span class=\"line\">282</span><br><span class=\"line\">283</span><br><span class=\"line\">284</span><br><span class=\"line\">285</span><br><span class=\"line\">286</span><br><span class=\"line\">287</span><br><span class=\"line\">288</span><br><span class=\"line\">289</span><br><span class=\"line\">290</span><br><span class=\"line\">291</span><br><span class=\"line\">292</span><br><span class=\"line\">293</span><br><span class=\"line\">294</span><br><span class=\"line\">295</span><br><span class=\"line\">296</span><br><span class=\"line\">297</span><br><span class=\"line\">298</span><br><span class=\"line\">299</span><br><span class=\"line\">300</span><br><span class=\"line\">301</span><br><span class=\"line\">302</span><br><span class=\"line\">303</span><br><span class=\"line\">304</span><br><span class=\"line\">305</span><br><span class=\"line\">306</span><br><span class=\"line\">307</span><br><span class=\"line\">308</span><br><span class=\"line\">309</span><br><span class=\"line\">310</span><br><span class=\"line\">311</span><br><span class=\"line\">312</span><br><span class=\"line\">313</span><br><span class=\"line\">314</span><br><span class=\"line\">315</span><br><span class=\"line\">316</span><br><span class=\"line\">317</span><br><span class=\"line\">318</span><br><span class=\"line\">319</span><br><span class=\"line\">320</span><br><span class=\"line\">321</span><br><span class=\"line\">322</span><br><span class=\"line\">323</span><br><span class=\"line\">324</span><br><span class=\"line\">325</span><br><span class=\"line\">326</span><br><span class=\"line\">327</span><br><span class=\"line\">328</span><br><span class=\"line\">329</span><br><span class=\"line\">330</span><br><span class=\"line\">331</span><br><span class=\"line\">332</span><br><span class=\"line\">333</span><br><span class=\"line\">334</span><br><span class=\"line\">335</span><br><span class=\"line\">336</span><br><span class=\"line\">337</span><br><span class=\"line\">338</span><br><span class=\"line\">339</span><br><span class=\"line\">340</span><br><span class=\"line\">341</span><br><span class=\"line\">342</span><br><span class=\"line\">343</span><br><span class=\"line\">344</span><br><span class=\"line\">345</span><br><span class=\"line\">346</span><br><span class=\"line\">347</span><br><span class=\"line\">348</span><br><span class=\"line\">349</span><br><span class=\"line\">350</span><br><span class=\"line\">351</span><br><span class=\"line\">352</span><br><span class=\"line\">353</span><br><span class=\"line\">354</span><br><span class=\"line\">355</span><br><span class=\"line\">356</span><br><span class=\"line\">357</span><br><span class=\"line\">358</span><br><span class=\"line\">359</span><br><span class=\"line\">360</span><br><span class=\"line\">361</span><br><span class=\"line\">362</span><br><span class=\"line\">363</span><br><span class=\"line\">364</span><br><span class=\"line\">365</span><br><span class=\"line\">366</span><br><span class=\"line\">367</span><br><span class=\"line\">368</span><br><span class=\"line\">369</span><br><span class=\"line\">370</span><br><span class=\"line\">371</span><br><span class=\"line\">372</span><br><span class=\"line\">373</span><br><span class=\"line\">374</span><br><span class=\"line\">375</span><br><span class=\"line\">376</span><br><span class=\"line\">377</span><br><span class=\"line\">378</span><br><span class=\"line\">379</span><br><span class=\"line\">380</span><br><span class=\"line\">381</span><br><span class=\"line\">382</span><br><span class=\"line\">383</span><br><span class=\"line\">384</span><br><span class=\"line\">385</span><br><span class=\"line\">386</span><br><span class=\"line\">387</span><br><span class=\"line\">388</span><br><span class=\"line\">389</span><br><span class=\"line\">390</span><br><span class=\"line\">391</span><br><span class=\"line\">392</span><br><span class=\"line\">393</span><br><span class=\"line\">394</span><br><span class=\"line\">395</span><br><span class=\"line\">396</span><br><span class=\"line\">397</span><br><span class=\"line\">398</span><br><span class=\"line\">399</span><br><span class=\"line\">400</span><br><span class=\"line\">401</span><br><span class=\"line\">402</span><br><span class=\"line\">403</span><br><span class=\"line\">404</span><br><span class=\"line\">405</span><br><span class=\"line\">406</span><br><span class=\"line\">407</span><br><span class=\"line\">408</span><br><span class=\"line\">409</span><br><span class=\"line\">410</span><br><span class=\"line\">411</span><br><span class=\"line\">412</span><br><span class=\"line\">413</span><br><span class=\"line\">414</span><br><span class=\"line\">415</span><br><span class=\"line\">416</span><br><span class=\"line\">417</span><br><span class=\"line\">418</span><br><span class=\"line\">419</span><br><span class=\"line\">420</span><br><span class=\"line\">421</span><br><span class=\"line\">422</span><br><span class=\"line\">423</span><br><span class=\"line\">424</span><br><span class=\"line\">425</span><br><span class=\"line\">426</span><br><span class=\"line\">427</span><br><span class=\"line\">428</span><br><span class=\"line\">429</span><br><span class=\"line\">430</span><br><span class=\"line\">431</span><br><span class=\"line\">432</span><br><span class=\"line\">433</span><br><span class=\"line\">434</span><br><span class=\"line\">435</span><br><span class=\"line\">436</span><br><span class=\"line\">437</span><br><span class=\"line\">438</span><br><span class=\"line\">439</span><br><span class=\"line\">440</span><br><span class=\"line\">441</span><br><span class=\"line\">442</span><br><span class=\"line\">443</span><br><span class=\"line\">444</span><br><span class=\"line\">445</span><br><span class=\"line\">446</span><br><span class=\"line\">447</span><br><span class=\"line\">448</span><br><span class=\"line\">449</span><br><span class=\"line\">450</span><br><span class=\"line\">451</span><br><span class=\"line\">452</span><br><span class=\"line\">453</span><br><span class=\"line\">454</span><br><span class=\"line\">455</span><br><span class=\"line\">456</span><br><span class=\"line\">457</span><br><span class=\"line\">458</span><br><span class=\"line\">459</span><br><span class=\"line\">460</span><br><span class=\"line\">461</span><br><span class=\"line\">462</span><br><span class=\"line\">463</span><br><span class=\"line\">464</span><br><span class=\"line\">465</span><br><span class=\"line\">466</span><br><span class=\"line\">467</span><br><span class=\"line\">468</span><br><span class=\"line\">469</span><br><span class=\"line\">470</span><br><span class=\"line\">471</span><br><span class=\"line\">472</span><br><span class=\"line\">473</span><br><span class=\"line\">474</span><br><span class=\"line\">475</span><br><span class=\"line\">476</span><br><span class=\"line\">477</span><br><span class=\"line\">478</span><br><span class=\"line\">479</span><br><span class=\"line\">480</span><br><span class=\"line\">481</span><br><span class=\"line\">482</span><br><span class=\"line\">483</span><br><span class=\"line\">484</span><br><span class=\"line\">485</span><br><span class=\"line\">486</span><br><span class=\"line\">487</span><br><span class=\"line\">488</span><br><span class=\"line\">489</span><br><span class=\"line\">490</span><br><span class=\"line\">491</span><br><span class=\"line\">492</span><br><span class=\"line\">493</span><br><span class=\"line\">494</span><br><span class=\"line\">495</span><br><span class=\"line\">496</span><br><span class=\"line\">497</span><br><span class=\"line\">498</span><br><span class=\"line\">499</span><br><span class=\"line\">500</span><br><span class=\"line\">501</span><br><span class=\"line\">502</span><br><span class=\"line\">503</span><br><span class=\"line\">504</span><br><span class=\"line\">505</span><br><span class=\"line\">506</span><br><span class=\"line\">507</span><br><span class=\"line\">508</span><br><span class=\"line\">509</span><br><span class=\"line\">510</span><br><span class=\"line\">511</span><br><span class=\"line\">512</span><br><span class=\"line\">513</span><br><span class=\"line\">514</span><br><span class=\"line\">515</span><br><span class=\"line\">516</span><br><span class=\"line\">517</span><br><span class=\"line\">518</span><br><span class=\"line\">519</span><br><span class=\"line\">520</span><br><span class=\"line\">521</span><br><span class=\"line\">522</span><br><span class=\"line\">523</span><br><span class=\"line\">524</span><br><span class=\"line\">525</span><br><span class=\"line\">526</span><br><span class=\"line\">527</span><br><span class=\"line\">528</span><br><span class=\"line\">529</span><br><span class=\"line\">530</span><br><span class=\"line\">531</span><br><span class=\"line\">532</span><br><span class=\"line\">533</span><br><span class=\"line\">534</span><br><span class=\"line\">535</span><br><span class=\"line\">536</span><br><span class=\"line\">537</span><br><span class=\"line\">538</span><br><span class=\"line\">539</span><br><span class=\"line\">540</span><br><span class=\"line\">541</span><br><span class=\"line\">542</span><br><span class=\"line\">543</span><br><span class=\"line\">544</span><br><span class=\"line\">545</span><br><span class=\"line\">546</span><br><span class=\"line\">547</span><br><span class=\"line\">548</span><br><span class=\"line\">549</span><br><span class=\"line\">550</span><br><span class=\"line\">551</span><br><span class=\"line\">552</span><br><span class=\"line\">553</span><br><span class=\"line\">554</span><br><span class=\"line\">555</span><br><span class=\"line\">556</span><br><span class=\"line\">557</span><br><span class=\"line\">558</span><br><span class=\"line\">559</span><br><span class=\"line\">560</span><br><span class=\"line\">561</span><br><span class=\"line\">562</span><br><span class=\"line\">563</span><br><span class=\"line\">564</span><br><span class=\"line\">565</span><br><span class=\"line\">566</span><br><span class=\"line\">567</span><br><span class=\"line\">568</span><br><span class=\"line\">569</span><br><span class=\"line\">570</span><br><span class=\"line\">571</span><br><span class=\"line\">572</span><br><span class=\"line\">573</span><br><span class=\"line\">574</span><br><span class=\"line\">575</span><br><span class=\"line\">576</span><br><span class=\"line\">577</span><br><span class=\"line\">578</span><br><span class=\"line\">579</span><br><span class=\"line\">580</span><br><span class=\"line\">581</span><br><span class=\"line\">582</span><br><span class=\"line\">583</span><br><span class=\"line\">584</span><br><span class=\"line\">585</span><br><span class=\"line\">586</span><br><span class=\"line\">587</span><br><span class=\"line\">588</span><br><span class=\"line\">589</span><br><span class=\"line\">590</span><br><span class=\"line\">591</span><br><span class=\"line\">592</span><br><span class=\"line\">593</span><br><span class=\"line\">594</span><br><span class=\"line\">595</span><br><span class=\"line\">596</span><br><span class=\"line\">597</span><br><span class=\"line\">598</span><br><span class=\"line\">599</span><br><span class=\"line\">600</span><br><span class=\"line\">601</span><br><span class=\"line\">602</span><br><span class=\"line\">603</span><br><span class=\"line\">604</span><br><span class=\"line\">605</span><br><span class=\"line\">606</span><br><span class=\"line\">607</span><br><span class=\"line\">608</span><br><span class=\"line\">609</span><br><span class=\"line\">610</span><br><span class=\"line\">611</span><br><span class=\"line\">612</span><br><span class=\"line\">613</span><br><span class=\"line\">614</span><br><span class=\"line\">615</span><br><span class=\"line\">616</span><br><span class=\"line\">617</span><br><span class=\"line\">618</span><br><span class=\"line\">619</span><br><span class=\"line\">620</span><br><span class=\"line\">621</span><br><span class=\"line\">622</span><br><span class=\"line\">623</span><br><span class=\"line\">624</span><br><span class=\"line\">625</span><br><span class=\"line\">626</span><br><span class=\"line\">627</span><br><span class=\"line\">628</span><br><span class=\"line\">629</span><br><span class=\"line\">630</span><br><span class=\"line\">631</span><br><span class=\"line\">632</span><br><span class=\"line\">633</span><br><span class=\"line\">634</span><br><span class=\"line\">635</span><br><span class=\"line\">636</span><br><span class=\"line\">637</span><br><span class=\"line\">638</span><br><span class=\"line\">639</span><br><span class=\"line\">640</span><br><span class=\"line\">641</span><br><span class=\"line\">642</span><br><span class=\"line\">643</span><br><span class=\"line\">644</span><br><span class=\"line\">645</span><br><span class=\"line\">646</span><br><span class=\"line\">647</span><br><span class=\"line\">648</span><br><span class=\"line\">649</span><br><span class=\"line\">650</span><br><span class=\"line\">651</span><br><span class=\"line\">652</span><br><span class=\"line\">653</span><br><span class=\"line\">654</span><br><span class=\"line\">655</span><br><span class=\"line\">656</span><br><span class=\"line\">657</span><br><span class=\"line\">658</span><br><span class=\"line\">659</span><br><span class=\"line\">660</span><br><span class=\"line\">661</span><br><span class=\"line\">662</span><br><span class=\"line\">663</span><br><span class=\"line\">664</span><br><span class=\"line\">665</span><br><span class=\"line\">666</span><br><span class=\"line\">667</span><br><span class=\"line\">668</span><br><span class=\"line\">669</span><br><span class=\"line\">670</span><br><span class=\"line\">671</span><br><span class=\"line\">672</span><br><span class=\"line\">673</span><br><span class=\"line\">674</span><br><span class=\"line\">675</span><br><span class=\"line\">676</span><br><span class=\"line\">677</span><br><span class=\"line\">678</span><br><span class=\"line\">679</span><br><span class=\"line\">680</span><br><span class=\"line\">681</span><br><span class=\"line\">682</span><br><span class=\"line\">683</span><br><span class=\"line\">684</span><br><span class=\"line\">685</span><br><span class=\"line\">686</span><br><span class=\"line\">687</span><br><span class=\"line\">688</span><br><span class=\"line\">689</span><br><span class=\"line\">690</span><br><span class=\"line\">691</span><br><span class=\"line\">692</span><br><span class=\"line\">693</span><br><span class=\"line\">694</span><br><span class=\"line\">695</span><br><span class=\"line\">696</span><br><span class=\"line\">697</span><br><span class=\"line\">698</span><br><span class=\"line\">699</span><br><span class=\"line\">700</span><br><span class=\"line\">701</span><br><span class=\"line\">702</span><br><span class=\"line\">703</span><br><span class=\"line\">704</span><br><span class=\"line\">705</span><br><span class=\"line\">706</span><br><span class=\"line\">707</span><br><span class=\"line\">708</span><br><span class=\"line\">709</span><br><span class=\"line\">710</span><br><span class=\"line\">711</span><br><span class=\"line\">712</span><br><span class=\"line\">713</span><br><span class=\"line\">714</span><br><span class=\"line\">715</span><br><span class=\"line\">716</span><br><span class=\"line\">717</span><br><span class=\"line\">718</span><br><span class=\"line\">719</span><br><span class=\"line\">720</span><br><span class=\"line\">721</span><br><span class=\"line\">722</span><br><span class=\"line\">723</span><br><span class=\"line\">724</span><br><span class=\"line\">725</span><br><span class=\"line\">726</span><br><span class=\"line\">727</span><br><span class=\"line\">728</span><br><span class=\"line\">729</span><br><span class=\"line\">730</span><br><span class=\"line\">731</span><br><span class=\"line\">732</span><br><span class=\"line\">733</span><br><span class=\"line\">734</span><br><span class=\"line\">735</span><br><span class=\"line\">736</span><br><span class=\"line\">737</span><br><span class=\"line\">738</span><br><span class=\"line\">739</span><br><span class=\"line\">740</span><br><span class=\"line\">741</span><br><span class=\"line\">742</span><br><span class=\"line\">743</span><br><span class=\"line\">744</span><br><span class=\"line\">745</span><br><span class=\"line\">746</span><br><span class=\"line\">747</span><br><span class=\"line\">748</span><br><span class=\"line\">749</span><br><span class=\"line\">750</span><br><span class=\"line\">751</span><br><span class=\"line\">752</span><br><span class=\"line\">753</span><br><span class=\"line\">754</span><br><span class=\"line\">755</span><br><span class=\"line\">756</span><br><span class=\"line\">757</span><br><span class=\"line\">758</span><br><span class=\"line\">759</span><br><span class=\"line\">760</span><br><span class=\"line\">761</span><br><span class=\"line\">762</span><br><span class=\"line\">763</span><br><span class=\"line\">764</span><br><span class=\"line\">765</span><br><span class=\"line\">766</span><br><span class=\"line\">767</span><br><span class=\"line\">768</span><br><span class=\"line\">769</span><br><span class=\"line\">770</span><br><span class=\"line\">771</span><br><span class=\"line\">772</span><br><span class=\"line\">773</span><br><span class=\"line\">774</span><br><span class=\"line\">775</span><br><span class=\"line\">776</span><br><span class=\"line\">777</span><br><span class=\"line\">778</span><br><span class=\"line\">779</span><br><span class=\"line\">780</span><br><span class=\"line\">781</span><br><span class=\"line\">782</span><br><span class=\"line\">783</span><br><span class=\"line\">784</span><br><span class=\"line\">785</span><br><span class=\"line\">786</span><br><span class=\"line\">787</span><br><span class=\"line\">788</span><br><span class=\"line\">789</span><br><span class=\"line\">790</span><br><span class=\"line\">791</span><br><span class=\"line\">792</span><br><span class=\"line\">793</span><br><span class=\"line\">794</span><br><span class=\"line\">795</span><br><span class=\"line\">796</span><br><span class=\"line\">797</span><br><span class=\"line\">798</span><br><span class=\"line\">799</span><br><span class=\"line\">800</span><br><span class=\"line\">801</span><br><span class=\"line\">802</span><br><span class=\"line\">803</span><br><span class=\"line\">804</span><br><span class=\"line\">805</span><br><span class=\"line\">806</span><br><span class=\"line\">807</span><br><span class=\"line\">808</span><br><span class=\"line\">809</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">using</span> System.IO;</span><br><span class=\"line\"><span class=\"keyword\">using</span> OfficeOpenXml;</span><br><span class=\"line\"><span class=\"keyword\">using</span> OfficeOpenXml.Style;</span><br><span class=\"line\"><span class=\"keyword\">using</span> OfficeOpenXml.Table;</span><br><span class=\"line\"><span class=\"keyword\">using</span> OfficeOpenXml.Style.ExcelFillStyle;</span><br><span class=\"line\"><span class=\"keyword\">using</span> System.Drawing;</span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title\">LMSMidStatesPullService</span> <span class=\"title\">extends</span> <span class=\"title\">SysOperationServiceBase</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> date                     gFromDate;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> date                     gToDate;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> boolean                  hasheader = <span class=\"literal\">false</span>;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> EcoResCategoryId         gCategory;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> LMSCateGoryTable         gCategoryTable;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> EcoResCategory           gEcoCategoryTable;</span><br><span class=\"line\">    RetailReportSessionIdentifier   gsessionId = guid2Str(newGuid());</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> LMS_SUN-029403_EXT-00015 Load to Truck Validation</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> Lance Shi - 7/17/2024</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> Process</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;/summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;param name = &quot;_contract&quot;&gt;</span>LMSCleanUpLoadedLPTableContract<span class=\"doctag\">&lt;/param&gt;</span></span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">process</span>(<span class=\"params\">LMSMidStatesPullContract _contract</span>)</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        gFromDate           = _contract.parmFromDate();</span><br><span class=\"line\">        gToDate             = _contract.parmToDate();</span><br><span class=\"line\">        <span class=\"comment\">// LMS_SUN-030708_Mid-StatesPullReport add by Ina Wang on 11/21/2024 begin</span></span><br><span class=\"line\"></span><br><span class=\"line\">        gCategory           = _contract.parmCategory();</span><br><span class=\"line\">        gEcoCategoryTable   = EcoResCategory::find(gCategory);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">select</span> firstonly RecId <span class=\"keyword\">from</span> gCategoryTable</span><br><span class=\"line\">            <span class=\"keyword\">where</span> gCategoryTable.EcoResCategory     == gEcoCategoryTable.RecId</span><br><span class=\"line\">              &amp;&amp; gCategoryTable.SessionId           == gsessionId;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span>(!gCategoryTable.RecId)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            gCategoryTable.EcoResCategory   = gEcoCategoryTable.RecId;</span><br><span class=\"line\">            gCategoryTable.SessionId        = gsessionId;</span><br><span class=\"line\">            gCategoryTable.insert();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        ttsbegin;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.getAllCategory(gEcoCategoryTable.RecId);</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.createtab(_contract);</span><br><span class=\"line\"></span><br><span class=\"line\">        delete_from gCategoryTable</span><br><span class=\"line\">            <span class=\"keyword\">where</span> gCategoryTable.SessionId == gsessionId;</span><br><span class=\"line\">        ttscommit;</span><br><span class=\"line\">        <span class=\"comment\">// LMS_SUN-030708_Mid-StatesPullReport add by Ina Wang on 11/21/2024 end</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> LMS_SUN-030708_Mid-StatesPullReport</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> Bruce Niu -10/11/2024</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> Create tab.</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;/summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;param name = &quot;_contract&quot;&gt;</span>LMSMidStatesPullContract<span class=\"doctag\">&lt;/param&gt;</span></span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">createtab</span>(<span class=\"params\">LMSMidStatesPullContract _contract</span>)</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        QueryRun                        queryRun    = <span class=\"keyword\">new</span> QueryRun(_contract.getQuery());</span><br><span class=\"line\">        LMSSalesHistoryView             historyView;</span><br><span class=\"line\">        container                       itemIdCon   = conNull();</span><br><span class=\"line\">        System.IO.Stream                stream;</span><br><span class=\"line\">        ExcelSpreadsheetName            sheet;</span><br><span class=\"line\">        MemoryStream                    memoryStream = <span class=\"keyword\">new</span> MemoryStream();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">using</span> (<span class=\"keyword\">var</span> package = <span class=\"keyword\">new</span> ExcelPackage(memoryStream))</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> currentRow = <span class=\"number\">1</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">var</span>                             worksheets          = package.get_Workbook().get_Worksheets();</span><br><span class=\"line\">            OfficeOpenXml.ExcelWorksheet    SupplierWorksheet   = worksheets.Add(<span class=\"string\">&quot;@LMS:LMSSupplierInformation&quot;</span>);</span><br><span class=\"line\">            OfficeOpenXml.ExcelWorksheet    SalesDataWorksheet  = worksheets.Add(<span class=\"string\">&quot;@LMS:LMSSalesData&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">            itemIdCon = <span class=\"keyword\">this</span>.generateSalesData(SalesDataWorksheet, _contract);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span>(itemIdCon)</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"keyword\">this</span>.generateSupplier(itemIdCon, SupplierWorksheet);</span><br><span class=\"line\">        </span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            package.Save();</span><br><span class=\"line\">            <span class=\"keyword\">file</span>::SendFileToUser(memoryStream, <span class=\"string\">&quot;@LMS:LMSMidStatsPullExcel&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> LMS_SUN-030708_Mid-StatesPullReport</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> Bruce Niu -10/11/2024</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> Get query for range.</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;/summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;param name = &quot;_query&quot;&gt;</span>Query<span class=\"doctag\">&lt;/param&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;returns&gt;</span>Query<span class=\"doctag\">&lt;/returns&gt;</span></span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Query  <span class=\"title\">getQueryForRange</span>(<span class=\"params\">Query _query</span>)</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        Query                   query = _query;</span><br><span class=\"line\">        QueryBuildDataSource    qbds = _query.dataSourceTable(tableNum(LMSSalesHistorySummaryView)).addDataSource(tableNum(LMSSalesHistoryView));</span><br><span class=\"line\"></span><br><span class=\"line\">        qbds.joinMode(JoinMode::ExistsJoin);</span><br><span class=\"line\">        qbds.addLink(fieldNum(LMSSalesHistorySummaryView, ProductNumber), fieldNum(LMSSalesHistoryView, ProductNumber));</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// LMS_SUN-030708_Mid-StatesPullReport add by Ina Wang on 11/11/2024 begin</span></span><br><span class=\"line\">        qbds.addLink(fieldNum(LMSSalesHistorySummaryView, Color), fieldNum(LMSSalesHistoryView, Color));</span><br><span class=\"line\">        qbds.addLink(fieldNum(LMSSalesHistorySummaryView, Size), fieldNum(LMSSalesHistoryView, Size));</span><br><span class=\"line\">        <span class=\"comment\">// LMS_SUN-030708_Mid-StatesPullReport add by Ina Wang on 11/11/2024 end</span></span><br><span class=\"line\"></span><br><span class=\"line\">        qbds.addRange(fieldNum(LMSSalesHistoryView, SalesHistoryDate)).<span class=\"keyword\">value</span>(SysQueryRangeUtil::dateRange(gFromDate, gToDate));</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// LMS_SUN-030708_Mid-StatesPullReport add by Ina Wang on 11/21/2024 begin</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span>(gCategory)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            EcoResCategoryNamedHierarchyRole    hierarchyId             = EcoResCategoryHierarchyRole::getHierarchiesByRole(EcoResCategoryNamedHierarchyRole::Retail).NamedCategoryHierarchyRole;</span><br><span class=\"line\">            QueryBuildDataSource                qbdsCategoryExpanded    = _query.dataSourceTable(tableNum(LMSSalesHistoryView)).addDataSource(tableNum(EcoResProductCategoryExpanded));</span><br><span class=\"line\"></span><br><span class=\"line\">            qbdsCategoryExpanded.joinMode(JoinMode::ExistsJoin);</span><br><span class=\"line\">            qbdsCategoryExpanded.addLink(fieldNum(LMSSalesHistoryView, ProductNumber), fieldNum(EcoResProductCategoryExpanded, ItemId));</span><br><span class=\"line\">            qbdsCategoryExpanded.addRange(fieldNum(EcoResProductCategoryExpanded, NamedCategoryHierarchyRole)).<span class=\"keyword\">value</span>(queryValue(hierarchyId));</span><br><span class=\"line\"></span><br><span class=\"line\">            QueryBuildDataSource    qbdsCategoryTable     = _query.dataSourceTable(tableNum(EcoResProductCategoryExpanded)).addDataSource(tableNum(LMSCateGoryTable));</span><br><span class=\"line\">            qbdsCategoryTable.joinMode(JoinMode::ExistsJoin);</span><br><span class=\"line\">            qbdsCategoryTable.addLink(fieldNum(EcoResProductCategoryExpanded, RecIdCategory), fieldNum(LMSCateGoryTable, EcoResCategory));</span><br><span class=\"line\">            qbdsCategoryTable.addRange(fieldNum(LMSCateGoryTable, SessionId)).<span class=\"keyword\">value</span>(queryValue(gsessionId));</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// LMS_SUN-030708_Mid-StatesPullReport add by Ina Wang on 11/21/2024 end</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> query;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> LMS_SUN-030708_Mid-StatesPullReport</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> Bruce Niu -10/11/2024</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> Generate sales data.</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;/summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;param name = &quot;_SalesDataWorksheet&quot;&gt;</span>ExcelWorksheet<span class=\"doctag\">&lt;/param&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;param name = &quot;_contract&quot;&gt;</span>Contract<span class=\"doctag\">&lt;/param&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;returns&gt;</span>container<span class=\"doctag\">&lt;/returns&gt;</span></span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> container <span class=\"title\">generateSalesData</span>(<span class=\"params\">OfficeOpenXml.ExcelWorksheet _SalesDataWorksheet, LMSMidStatesPullContract _contract</span>)</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span>                             SalesDatacells      = _SalesDataWorksheet.get_Cells();</span><br><span class=\"line\">        Map                             map                 = <span class=\"keyword\">new</span> Map(Types::String, Types::Container);</span><br><span class=\"line\">        <span class=\"built_in\">int</span>                             row                 = <span class=\"number\">1</span>;</span><br><span class=\"line\">        QueryRun                        queryRun            = <span class=\"keyword\">new</span> QueryRun(<span class=\"keyword\">this</span>.getQueryForRange(_contract.getQuery()));</span><br><span class=\"line\">        LMSSalesHistorySummaryView      historyView;</span><br><span class=\"line\">        LMSSalesHistoryView             historyViewRecord;</span><br><span class=\"line\">        container                       supplerRow          = conNull();</span><br><span class=\"line\">        container                       itemIdCon           = conNull();</span><br><span class=\"line\"></span><br><span class=\"line\">        OfficeOpenXml.ExcelRange cell = SalesDatacells.get_Item(<span class=\"number\">1</span>, <span class=\"number\">1</span>);</span><br><span class=\"line\">        cell.set_Value(<span class=\"string\">&quot;@LMS:LMSMemberName&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        cell = SalesDatacells.get_Item(<span class=\"number\">1</span>, <span class=\"number\">2</span>);</span><br><span class=\"line\">        cell.set_Value(<span class=\"string\">&quot;@LMS:LMSReportingVendor&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        cell = SalesDatacells.get_Item(<span class=\"number\">1</span>, <span class=\"number\">3</span>);</span><br><span class=\"line\">        cell.set_Value(<span class=\"string\">&quot;@LMS:LMSItemNumber&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        cell = SalesDatacells.get_Item(<span class=\"number\">1</span>, <span class=\"number\">4</span>);</span><br><span class=\"line\">        cell.set_Value(<span class=\"string\">&quot;@LMS:LMSMFGPart&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        cell = SalesDatacells.get_Item(<span class=\"number\">1</span>, <span class=\"number\">5</span>);</span><br><span class=\"line\">        cell.set_Value(<span class=\"string\">&quot;@LMS:LMSItemDesc&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        cell = SalesDatacells.get_Item(<span class=\"number\">1</span>, <span class=\"number\">6</span>);</span><br><span class=\"line\">        cell.set_Value(<span class=\"string\">&quot;@LMS:LMSUPC&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        cell = SalesDatacells.get_Item(<span class=\"number\">1</span>, <span class=\"number\">7</span>);</span><br><span class=\"line\">        cell.set_Value(<span class=\"string\">&quot;@SYS850&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        cell = SalesDatacells.get_Item(<span class=\"number\">1</span>, <span class=\"number\">8</span>);</span><br><span class=\"line\">        cell.set_Value(<span class=\"string\">&quot;@LMS:LMSClassLine&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        cell = SalesDatacells.get_Item(<span class=\"number\">1</span>, <span class=\"number\">9</span>);</span><br><span class=\"line\">        cell.set_Value(<span class=\"string\">&quot;@LMS:LMSSubClassFineLine&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"built_in\">int</span> currentRow = <span class=\"number\">9</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        container con = <span class=\"keyword\">this</span>.generateMonthColumn();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span>(con)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">for</span>(<span class=\"built_in\">int</span> i = <span class=\"number\">1</span>; i &lt;= conlen(con); i ++)</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                currentRow ++;</span><br><span class=\"line\">                cell = SalesDatacells.get_Item(<span class=\"number\">1</span>, currentRow);</span><br><span class=\"line\">                cell.set_Value(conpeek(con, i));</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        currentRow ++;</span><br><span class=\"line\">        cell = SalesDatacells.get_Item(<span class=\"number\">1</span>, currentRow);</span><br><span class=\"line\">        cell.set_Value(<span class=\"string\">&quot;@LMS:LMSTotalMonthSales&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        currentRow ++;</span><br><span class=\"line\">        cell = SalesDatacells.get_Item(<span class=\"number\">1</span>, currentRow);</span><br><span class=\"line\">        cell.set_Value(<span class=\"string\">&quot;@LMS:LMSRepalcementCost&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        currentRow ++;</span><br><span class=\"line\">        cell = SalesDatacells.get_Item(<span class=\"number\">1</span>, currentRow);</span><br><span class=\"line\">        cell.set_Value(<span class=\"string\">&quot;@LMS:LMSCompanyOnHand&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        currentRow ++;</span><br><span class=\"line\">        cell = SalesDatacells.get_Item(<span class=\"number\">1</span>, currentRow);</span><br><span class=\"line\">        cell.set_Value(<span class=\"string\">&quot;@LMS:LMSSystemRetail&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        currentRow ++;</span><br><span class=\"line\">        cell = SalesDatacells.get_Item(<span class=\"number\">1</span>, currentRow);</span><br><span class=\"line\">        cell.set_Value(<span class=\"string\">&quot;@LMS:LMSAverageUnitRetail&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        currentRow = <span class=\"number\">2</span>;</span><br><span class=\"line\">        container alldateCollection = <span class=\"keyword\">this</span>.getAlldateCollection();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">while</span>(queryRun.next())</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            historyView                 = queryRun.<span class=\"keyword\">get</span>(tableNum(LMSSalesHistorySummaryView));</span><br><span class=\"line\"></span><br><span class=\"line\">            container   itemIdDim       = <span class=\"keyword\">this</span>.getItemId(historyView);</span><br><span class=\"line\">            ItemId      itemId          = conPeek(itemIdDim, <span class=\"number\">1</span>);</span><br><span class=\"line\">            InventDimId inventdIm       = conPeek(itemIdDim, <span class=\"number\">2</span>);</span><br><span class=\"line\">            str         description     = conPeek(itemIdDim, <span class=\"number\">3</span>);</span><br><span class=\"line\">            <span class=\"built_in\">int</span>         currentColumn   ;</span><br><span class=\"line\"></span><br><span class=\"line\">            InventTable inventTable;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">select</span> firstonly PrimaryVendorId <span class=\"keyword\">from</span> inventTable</span><br><span class=\"line\">                <span class=\"keyword\">where</span> inventTable.ItemId == itemId;</span><br><span class=\"line\"></span><br><span class=\"line\">            VendTable   vendTable;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">select</span> firstonly Party <span class=\"keyword\">from</span> vendTable</span><br><span class=\"line\">                <span class=\"keyword\">where</span> vendTable.AccountNum == inventTable.PrimaryVendorId;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span>(itemIdCon == conNull())</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                itemIdCon += itemId;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">else</span></span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span>(!conFind(itemIdCon, itemId))</span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    itemIdCon += itemId;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            cell = SalesDatacells.get_Item(currentRow, <span class=\"number\">1</span>);</span><br><span class=\"line\">            cell.set_Value(<span class=\"string\">&quot;@LMS:LMSLMSupply&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">            cell = SalesDatacells.get_Item(currentRow, <span class=\"number\">2</span>);</span><br><span class=\"line\">            cell.set_Value(vendTable.vendorName());</span><br><span class=\"line\"></span><br><span class=\"line\">            cell = SalesDatacells.get_Item(currentRow, <span class=\"number\">3</span>);</span><br><span class=\"line\">            cell.set_Value(historyView.ProductNumber);</span><br><span class=\"line\"></span><br><span class=\"line\">            cell = SalesDatacells.get_Item(currentRow, <span class=\"number\">4</span>);</span><br><span class=\"line\">            cell.set_Value(CustVendExternalItem::find(ModuleInventPurchSalesVendCustGroup::Vend, itemId, inventdIm, inventTable.PrimaryVendorId).ExternalItemId);</span><br><span class=\"line\"></span><br><span class=\"line\">            cell = SalesDatacells.get_Item(currentRow, <span class=\"number\">5</span>);</span><br><span class=\"line\">            cell.set_Value(description);</span><br><span class=\"line\"></span><br><span class=\"line\">            cell = SalesDatacells.get_Item(currentRow, <span class=\"number\">6</span>);</span><br><span class=\"line\">            cell.set_Value(<span class=\"keyword\">this</span>.getItemBarcode(itemId, inventdIm));</span><br><span class=\"line\"></span><br><span class=\"line\">            container conCate = <span class=\"keyword\">this</span>.getCategory(itemId);</span><br><span class=\"line\"></span><br><span class=\"line\">            cell = SalesDatacells.get_Item(currentRow, <span class=\"number\">7</span>);</span><br><span class=\"line\">            cell.set_Value(conPeek(conCate, <span class=\"number\">1</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">            cell = SalesDatacells.get_Item(currentRow, <span class=\"number\">8</span>);</span><br><span class=\"line\">            cell.set_Value(conPeek(conCate, <span class=\"number\">2</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">            cell = SalesDatacells.get_Item(currentRow, <span class=\"number\">9</span>);</span><br><span class=\"line\">            cell.set_Value(conPeek(conCate, <span class=\"number\">3</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">for</span>(currentColumn  = <span class=\"number\">10</span>; currentColumn &lt;= conLen(alldateCollection) + <span class=\"number\">9</span>; currentColumn++)</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                container   conLine = conPeek(alldateCollection, currentColumn - <span class=\"number\">9</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"function\"><span class=\"keyword\">select</span> <span class=\"title\">sum</span>(<span class=\"params\">Quantity</span>) <span class=\"keyword\">from</span> historyViewRecord</span></span><br><span class=\"line\"><span class=\"function\">                    <span class=\"keyword\">where</span> historyViewRecord.ProductNumber</span>       == historyView.ProductNumber</span><br><span class=\"line\">                       &amp;&amp; historyViewRecord.SalesHistoryDate    &gt;= conPeek(conLine, <span class=\"number\">1</span>)</span><br><span class=\"line\">                       &amp;&amp; historyViewRecord.SalesHistoryDate    &lt;= conPeek(conLine, <span class=\"number\">2</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">                cell = SalesDatacells.get_Item(currentRow, currentColumn);</span><br><span class=\"line\">                cell.set_Value(strFmt(<span class=\"string\">&quot;%1&quot;</span>, historyViewRecord.Quantity));</span><br><span class=\"line\">            </span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"function\"><span class=\"keyword\">select</span> <span class=\"title\">sum</span>(<span class=\"params\">Quantity</span>),<span class=\"title\">sum</span>(<span class=\"params\">Amount</span>) <span class=\"keyword\">from</span> historyViewRecord</span></span><br><span class=\"line\"><span class=\"function\">                    <span class=\"keyword\">where</span> historyViewRecord.ProductNumber</span>       == historyView.ProductNumber</span><br><span class=\"line\">                       &amp;&amp; historyViewRecord.SalesHistoryDate    &gt;= gFromDate</span><br><span class=\"line\">                       &amp;&amp; historyViewRecord.SalesHistoryDate    &lt;= gToDate;</span><br><span class=\"line\"></span><br><span class=\"line\">            cell = SalesDatacells.get_Item(currentRow, currentColumn);</span><br><span class=\"line\">            cell.set_Value(strFmt(<span class=\"string\">&quot;%1&quot;</span>, historyViewRecord.Quantity));</span><br><span class=\"line\"></span><br><span class=\"line\">            currentColumn ++;</span><br><span class=\"line\"></span><br><span class=\"line\">            cell = SalesDatacells.get_Item(currentRow, currentColumn);</span><br><span class=\"line\">            cell.set_Value(strFmt(<span class=\"string\">&quot;%1&quot;</span>, InventTableModule::find(itemId, ModuleInventPurchSales::Purch).price));</span><br><span class=\"line\"></span><br><span class=\"line\">            currentColumn ++;</span><br><span class=\"line\"></span><br><span class=\"line\">            cell = SalesDatacells.get_Item(currentRow, currentColumn);</span><br><span class=\"line\">            cell.set_Value(<span class=\"keyword\">this</span>.getinventOnhand(itemId, inventdIm));</span><br><span class=\"line\"></span><br><span class=\"line\">            currentColumn ++;</span><br><span class=\"line\"></span><br><span class=\"line\">            cell = SalesDatacells.get_Item(currentRow, currentColumn);</span><br><span class=\"line\">            cell.set_Value(strFmt(<span class=\"string\">&quot;%1&quot;</span>, InventTableModule::find(itemId, ModuleInventPurchSales::Sales).price));</span><br><span class=\"line\"></span><br><span class=\"line\">            currentColumn ++;</span><br><span class=\"line\"></span><br><span class=\"line\">            cell = SalesDatacells.get_Item(currentRow, currentColumn);</span><br><span class=\"line\">            cell.set_Value(strFmt(<span class=\"string\">&quot;%1&quot;</span>, historyViewRecord.Amount));</span><br><span class=\"line\"></span><br><span class=\"line\">            currentRow ++;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> itemIdCon;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> BAB_EXT-0002 – Dynamic Seasonality Coefficients</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> Bruce Niu 11/14/2024</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> getAllCategory</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;/summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">getAllCategory</span>(<span class=\"params\">RecId _parentRecId</span>)</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        EcoResCategory  cate;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">while</span> <span class=\"keyword\">select</span> RecId <span class=\"keyword\">from</span> cate</span><br><span class=\"line\">            <span class=\"keyword\">where</span> cate.ParentCategory == _parentRecId</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">select</span> firstonly RecId <span class=\"keyword\">from</span> gCategoryTable</span><br><span class=\"line\">                <span class=\"keyword\">where</span> gCategoryTable.EcoResCategory     == cate.RecId</span><br><span class=\"line\">                  &amp;&amp; gCategoryTable.SessionId           == gsessionId;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span>(!gCategoryTable)</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                gCategoryTable.EcoResCategory   = cate.RecId;</span><br><span class=\"line\">                gCategoryTable.SessionId        = gsessionId;</span><br><span class=\"line\">                gCategoryTable.insert();</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"keyword\">this</span>.getAllCategory(cate.recid);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> LMS_SUN-030708_Mid-StatesPullReport</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> Bruce Niu -10/11/2024</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> Get invent on hand.</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;/summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;param name = &quot;_itemId&quot;&gt;</span>Item Id<span class=\"doctag\">&lt;/param&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;param name = &quot;_inventdIm&quot;&gt;</span>Invent Dim<span class=\"doctag\">&lt;/param&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;returns&gt;</span>the string of inventOnhand<span class=\"doctag\">&lt;/returns&gt;</span></span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> str <span class=\"title\">getinventOnhand</span>(<span class=\"params\">str _itemId, str _inventdIm</span>)</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        InventDimParm         dimParm;</span><br><span class=\"line\">        InventOnhand          onhand;</span><br><span class=\"line\">        InventDim             inventDimNew;</span><br><span class=\"line\"></span><br><span class=\"line\">        inventDimNew = InventDim::find(_inventdIm);</span><br><span class=\"line\"></span><br><span class=\"line\">        dimParm.initFromInventDim(inventDimNew);</span><br><span class=\"line\"></span><br><span class=\"line\">        onhand      = InventOnhand::newItemDim(_itemId, inventDimNew, dimParm);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> strFmt(<span class=\"string\">&quot;%1&quot;</span>, onhand.physicalInvent());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> LMS_SUN-030708_Mid-StatesPullReport</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> Bruce Niu -10/11/2024</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> Get category.</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;/summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;param name = &quot;_itemId&quot;&gt;</span>Item Id<span class=\"doctag\">&lt;/param&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;returns&gt;</span>container<span class=\"doctag\">&lt;/returns&gt;</span></span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> container  <span class=\"title\">getCategory</span>(<span class=\"params\">str _itemId</span>)</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        EcoResCategory          c1,c2,c3;</span><br><span class=\"line\">        EcoResProductCategory   ecoResProductCate   = EcoResProductCategory::findByItemIdCategoryHierarchyRole(_itemId, EcoResCategoryNamedHierarchyRole::Retail);</span><br><span class=\"line\"></span><br><span class=\"line\">        c1 = EcoResCategory::find(ecoResProductCate.Category);</span><br><span class=\"line\">        c2 = EcoResCategory::find(c1.ParentCategory);</span><br><span class=\"line\">        c3 = EcoResCategory::find(c2.ParentCategory);</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">return</span> [c3.Name, c2.Name, c1.Name];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> LMS_SUN-030708_Mid-StatesPullReport</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> Bruce Niu -10/11/2024</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> Get Item Barcode</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;/summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;param name = &quot;_itemid&quot;&gt;</span>Item Id<span class=\"doctag\">&lt;/param&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;param name = &quot;_inventDimId&quot;&gt;</span>Invent dim id<span class=\"doctag\">&lt;/param&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;returns&gt;</span>ItemBarcode<span class=\"doctag\">&lt;/returns&gt;</span></span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> str <span class=\"title\">getItemBarcode</span>(<span class=\"params\">str _itemid, str _inventDimId</span>)</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        InventItemBarcode barcode;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">select</span> firstonly itemBarCode <span class=\"keyword\">from</span> barcode</span><br><span class=\"line\">            <span class=\"keyword\">where</span> barcode.barcodeSetupId    == <span class=\"string\">&#x27;@LMS:LMSUPC&#x27;</span></span><br><span class=\"line\">               &amp;&amp; barcode.inventDimId       == _inventDimId</span><br><span class=\"line\">               &amp;&amp; barcode.itemId            == _itemid;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> barcode.itemBarCode;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> LMS_SUN-030708_Mid-StatesPullReport</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> Bruce Niu -10/11/2024</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> Get all date collection.</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;/summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;returns&gt;</span>container<span class=\"doctag\">&lt;/returns&gt;</span></span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> container <span class=\"title\">getAlldateCollection</span>()</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        container con = conNull();</span><br><span class=\"line\">        date        fD, tD;</span><br><span class=\"line\">        </span><br><span class=\"line\">        fD = gFromDate;</span><br><span class=\"line\">        tD = endMth(fd);</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">while</span>(tD &lt;= gToDate)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            con += [[fD, td]];</span><br><span class=\"line\"></span><br><span class=\"line\">            fD = nextMth(fD);</span><br><span class=\"line\">            fD = fD - (dayOfMth(fd) - <span class=\"number\">1</span>);</span><br><span class=\"line\">            tD = endMth(fd);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span>(tD &gt; gToDate &amp;&amp; fD &lt;= gToDate)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            con += [[fD, gToDate]];</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> con;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> LMS_SUN-030708_Mid-StatesPullReport</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> Bruce Niu -10/11/2024</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> Generate month column.</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;/summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;returns&gt;</span>container<span class=\"doctag\">&lt;/returns&gt;</span></span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> container <span class=\"title\">generateMonthColumn</span>()</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        container   con = conNull();</span><br><span class=\"line\">        date        fd  = gFromDate;</span><br><span class=\"line\">        date        Td  = endMth(gToDate);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span>(gFromDate &amp;&amp; gToDate)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">while</span>(fd &lt;= Td)</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                con += strFmt(<span class=\"string\">&quot;@LMS:LMSSalesUnits&quot;</span>, <span class=\"keyword\">this</span>.getMthName(mthOfYr(fd)), year(fd) mod <span class=\"number\">1000</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">                fd      = nextMth(fd);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> con;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> LMS_SUN-030708_Mid-StatesPullReport</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> Bruce Niu -10/11/2024</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> Get month name.</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;/summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;param name = &quot;_number&quot;&gt;</span>number<span class=\"doctag\">&lt;/param&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;returns&gt;</span>month name string<span class=\"doctag\">&lt;/returns&gt;</span></span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> str <span class=\"title\">getMthName</span>(<span class=\"params\"><span class=\"built_in\">int</span> _number</span>)</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        str mth = <span class=\"string\">&#x27;&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">switch</span>(_number)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">1</span>:</span><br><span class=\"line\">                mth = <span class=\"string\">&#x27;@LMS:LMSJan&#x27;</span>;</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">2</span>:</span><br><span class=\"line\">                mth = <span class=\"string\">&#x27;@LMS:LMSFeb&#x27;</span>;</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">3</span>:</span><br><span class=\"line\">                mth = <span class=\"string\">&#x27;@LMS:LMSMar&#x27;</span>;</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">4</span>:</span><br><span class=\"line\">                mth = <span class=\"string\">&#x27;@LMS:LMSApr&#x27;</span>;</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">5</span>:</span><br><span class=\"line\">                mth = <span class=\"string\">&#x27;@LMS:LMSMay&#x27;</span>;</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">6</span>:</span><br><span class=\"line\">                mth = <span class=\"string\">&#x27;@LMS:LMSJun&#x27;</span>;</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">7</span>:</span><br><span class=\"line\">                mth = <span class=\"string\">&#x27;@LMS:LMSJul&#x27;</span>;</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">8</span>:</span><br><span class=\"line\">                mth = <span class=\"string\">&#x27;@LMS:LMSAug&#x27;</span>;</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">9</span>:</span><br><span class=\"line\">                mth = <span class=\"string\">&#x27;@LMS:LMSSep&#x27;</span>;</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">10</span>:</span><br><span class=\"line\">                mth = <span class=\"string\">&#x27;@LMS:LMSOct&#x27;</span>;</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">11</span>:</span><br><span class=\"line\">                mth = <span class=\"string\">&#x27;@LMS:LMSNov&#x27;</span>;</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">12</span>:</span><br><span class=\"line\">                mth = <span class=\"string\">&#x27;@LMS:LMSDec&#x27;</span>;</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        </span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> mth;</span><br><span class=\"line\">    </span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> LMS_SUN-030708_Mid-StatesPullReport</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> Bruce Niu -10/11/2024</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> Generate Supplier</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;/summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;param name = &quot;_con&quot;&gt;</span>container<span class=\"doctag\">&lt;/param&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;param name = &quot;_SupplierWorksheet&quot;&gt;</span>ExcelWorksheet<span class=\"doctag\">&lt;/param&gt;</span></span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">generateSupplier</span>(<span class=\"params\">container _con,  OfficeOpenXml.ExcelWorksheet    _SupplierWorksheet</span>)</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span>         Suppliercells       = _SupplierWorksheet.get_Cells();</span><br><span class=\"line\">        Map         map                 = <span class=\"keyword\">new</span> Map(Types::String, Types::Container);</span><br><span class=\"line\">        <span class=\"built_in\">int</span>         currentColumn       = <span class=\"number\">1</span>;</span><br><span class=\"line\">        container   vendorCon           = conNull();</span><br><span class=\"line\">        InventTable inventtable;</span><br><span class=\"line\"></span><br><span class=\"line\">        OfficeOpenXml.ExcelRange cell = Suppliercells.get_Item(<span class=\"number\">1</span>, <span class=\"number\">1</span>);</span><br><span class=\"line\">        cell.set_Value(<span class=\"string\">&quot;@LMS:LMSItemCategory&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        cell = Suppliercells.get_Item(<span class=\"number\">2</span>, <span class=\"number\">1</span>);</span><br><span class=\"line\">        cell.set_Value(<span class=\"string\">&quot;@LMS:LMSSupplierVendorName&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        cell = Suppliercells.get_Item(<span class=\"number\">3</span>, <span class=\"number\">1</span>);</span><br><span class=\"line\">        cell.set_Value(<span class=\"string\">&quot;@LMS:LMSPaymentTermsDays&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        cell = Suppliercells.get_Item(<span class=\"number\">4</span>, <span class=\"number\">1</span>);</span><br><span class=\"line\">        cell.set_Value(<span class=\"string\">&quot;@LMS:LMSFreightTerms&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        cell = Suppliercells.get_Item(<span class=\"number\">5</span>, <span class=\"number\">1</span>);</span><br><span class=\"line\">        cell.set_Value(<span class=\"string\">&quot;@LMS:LMSFOBOriginPoint&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        cell = Suppliercells.get_Item(<span class=\"number\">6</span>, <span class=\"number\">1</span>);</span><br><span class=\"line\">        cell.set_Value(<span class=\"string\">&quot;@LMS:LMSDelveryMethod&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        cell = Suppliercells.get_Item(<span class=\"number\">7</span>, <span class=\"number\">1</span>);</span><br><span class=\"line\">        cell.set_Value(<span class=\"string\">&quot;@LMS:LMSMinimumOrder&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        cell = Suppliercells.get_Item(<span class=\"number\">8</span>, <span class=\"number\">1</span>);</span><br><span class=\"line\">        cell.set_Value(<span class=\"string\">&quot;@LMS:LMSMinimumOrderAmount&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        cell = Suppliercells.get_Item(<span class=\"number\">9</span>, <span class=\"number\">1</span>);</span><br><span class=\"line\">        cell.set_Value(<span class=\"string\">&quot;@LMS:LMSMidStates&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        cell = Suppliercells.get_Item(<span class=\"number\">10</span>, <span class=\"number\">1</span>);</span><br><span class=\"line\">        cell.set_Value(<span class=\"string\">&quot;@LMS:LMSInitialStoreAllowance&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        cell = Suppliercells.get_Item(<span class=\"number\">11</span>, <span class=\"number\">1</span>);</span><br><span class=\"line\">        cell.set_Value(<span class=\"string\">&quot;@LMS:LMSDefetiveAllowance&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        cell = Suppliercells.get_Item(<span class=\"number\">12</span>, <span class=\"number\">1</span>);</span><br><span class=\"line\">        cell.set_Value(<span class=\"string\">&quot;@LMS:LMSCoopMarketingAllowance&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        cell = Suppliercells.get_Item(<span class=\"number\">13</span>, <span class=\"number\">1</span>);</span><br><span class=\"line\">        cell.set_Value(<span class=\"string\">&quot;@LMS:LMSVolumeRebateAllowance&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        cell = Suppliercells.get_Item(<span class=\"number\">14</span>, <span class=\"number\">1</span>);</span><br><span class=\"line\">        cell.set_Value(<span class=\"string\">&quot;@LMS:LMSOtherDiscounts&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        cell = Suppliercells.get_Item(<span class=\"number\">15</span>, <span class=\"number\">1</span>);</span><br><span class=\"line\">        cell.set_Value(<span class=\"string\">&quot;@LMS:LMSReplacementCost&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        cell = Suppliercells.get_Item(<span class=\"number\">16</span>, <span class=\"number\">1</span>);</span><br><span class=\"line\">        cell.set_Value(<span class=\"string\">&#x27;@LMS:LMSReplacementCostInclude&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        cell = Suppliercells.get_Item(<span class=\"number\">17</span>, <span class=\"number\">1</span>);</span><br><span class=\"line\">        cell.set_Value(<span class=\"string\">&quot;@LMS:LMSComments&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"built_in\">int</span> i = <span class=\"number\">1</span>; i&lt;= conLen(_con); i++)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">select</span> firstonly PrimaryVendorId <span class=\"keyword\">from</span> inventtable</span><br><span class=\"line\">                <span class=\"keyword\">where</span> inventtable.ItemId    == conPeek(_con, i);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span>(inventtable.PrimaryVendorId &amp;&amp; !conFind(vendorCon, inventtable.PrimaryVendorId))</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                vendorCon += inventtable.PrimaryVendorId;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"built_in\">int</span> j = <span class=\"number\">1</span>; j &lt;= conLen(vendorCon); j++)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            currentColumn ++;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span>(currentColumn == <span class=\"number\">2</span>)</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                cell = Suppliercells.get_Item(<span class=\"number\">1</span>, currentColumn);</span><br><span class=\"line\">                cell.set_Value(<span class=\"string\">&quot;@LMS:LMSCurrentSupplier&quot;</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">else</span></span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                cell = Suppliercells.get_Item(<span class=\"number\">1</span>, currentColumn);</span><br><span class=\"line\">                cell.set_Value(strFmt(<span class=\"string\">&quot;@LMS:LMSSupplier&quot;</span>, currentColumn - <span class=\"number\">1</span>));</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            VendTable   vendTable = VendTable::find(conPeek(vendorCon, j));</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span>(vendTable)</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                cell = Suppliercells.get_Item(<span class=\"number\">2</span>, currentColumn);</span><br><span class=\"line\">                cell.set_Value(vendTable.name());</span><br><span class=\"line\"></span><br><span class=\"line\">                cell = Suppliercells.get_Item(<span class=\"number\">3</span>, currentColumn);</span><br><span class=\"line\">                cell.set_Value(<span class=\"keyword\">this</span>.getPaymentTerms(vendTable.CashDisc, vendTable.PaymTermId));</span><br><span class=\"line\"></span><br><span class=\"line\">                cell = Suppliercells.get_Item(<span class=\"number\">4</span>, currentColumn);</span><br><span class=\"line\">                cell.set_Value(<span class=\"keyword\">this</span>.getFreightTerms(vendTable.DlvTerm));</span><br><span class=\"line\"></span><br><span class=\"line\">                cell = Suppliercells.get_Item(<span class=\"number\">5</span>, currentColumn);</span><br><span class=\"line\">                cell.set_Value(<span class=\"keyword\">this</span>.getFOBOriginPoint(vendTable.Party));</span><br><span class=\"line\">                <span class=\"comment\">//6</span></span><br><span class=\"line\">                cell = Suppliercells.get_Item(<span class=\"number\">7</span>, currentColumn);</span><br><span class=\"line\">                cell.set_Value(int2Str(VendTable.LMSMinDollarOrder));</span><br><span class=\"line\"></span><br><span class=\"line\">                cell = Suppliercells.get_Item(<span class=\"number\">8</span>, currentColumn);</span><br><span class=\"line\">                cell.set_Value(int2Str(VendTable.LMSMinUnitFreight) + <span class=\"string\">&quot; &quot;</span> + <span class=\"string\">&quot;@SYS314952&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">                cell = Suppliercells.get_Item(<span class=\"number\">9</span>, currentColumn);</span><br><span class=\"line\">                cell.set_Value(<span class=\"keyword\">this</span>.getautoChargeLine(vendTable.accountnum, <span class=\"string\">&quot;@LMS:LMSCBA&quot;</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"comment\">//10</span></span><br><span class=\"line\"></span><br><span class=\"line\">                cell = Suppliercells.get_Item(<span class=\"number\">11</span>, currentColumn);</span><br><span class=\"line\">                cell.set_Value(<span class=\"keyword\">this</span>.getautoChargeLine(vendTable.accountnum, <span class=\"string\">&quot;@LMS:LMSDefective&quot;</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">                cell = Suppliercells.get_Item(<span class=\"number\">12</span>, currentColumn);</span><br><span class=\"line\">                cell.set_Value(<span class=\"keyword\">this</span>.getautoChargeLine(vendTable.accountnum, <span class=\"string\">&quot;@LMS:LMSCoop&quot;</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"comment\">// 13 14 15 16 17 </span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> LMS_SUN-030708_Mid-StatesPullReport</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> Bruce Niu -10/11/2024</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> Get auto Charge Line</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;/summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;param name = &quot;_account&quot;&gt;</span>Account<span class=\"doctag\">&lt;/param&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;param name = &quot;_markupcode&quot;&gt;</span>markup code<span class=\"doctag\">&lt;/param&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;returns&gt;</span>str<span class=\"doctag\">&lt;/returns&gt;</span></span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> str <span class=\"title\">getautoChargeLine</span>(<span class=\"params\">str _account, str _markupcode</span>)</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        MarkupAutoTable autoTable;</span><br><span class=\"line\">        MarkupAutoLine  autoLine;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">select</span> firstonly Value <span class=\"keyword\">from</span> autoLine</span><br><span class=\"line\">            <span class=\"keyword\">where</span> autoLine.MarkupCode           == _markupcode</span><br><span class=\"line\">            exists <span class=\"keyword\">join</span> autoTable</span><br><span class=\"line\">                <span class=\"keyword\">where</span> autoTable.ModuleType      == MarkupModuleType::Vend</span><br><span class=\"line\">                   &amp;&amp; autoTable.AccountCode     == TableGroupAll::Table</span><br><span class=\"line\">                   &amp;&amp; autoTable.AccountRelation == _account</span><br><span class=\"line\">                   &amp;&amp; autoTable.ModuleCategory  == HeadingLine::Heading</span><br><span class=\"line\">                    &amp;&amp; autoTable.ItemCode       == TableGroupAll::All</span><br><span class=\"line\">                   &amp;&amp; autoTable.RecId           == autoLine.TableRecId</span><br><span class=\"line\">                   &amp;&amp; autoTable.TableId         == autoLine.TableTableId;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span>(autoLine)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> strFmt(<span class=\"string\">&quot;%1 %&quot;</span>, autoLine.Value);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">else</span></span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> LMS_SUN-030708_Mid-StatesPullReport</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> Bruce Niu -10/11/2024</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> Get fob origin point.</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;/summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;param name = &quot;_party&quot;&gt;</span>Int64<span class=\"doctag\">&lt;/param&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;returns&gt;</span>str<span class=\"doctag\">&lt;/returns&gt;</span></span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> str <span class=\"title\">getFOBOriginPoint</span>(<span class=\"params\">Int64 _party</span>)</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        LogisticsPostalAddress  address     = DirParty::primaryPostalAddress(_party);</span><br><span class=\"line\">        str                     originPoint = <span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">        container               con         = conNull();</span><br><span class=\"line\"></span><br><span class=\"line\">        con += address.City;</span><br><span class=\"line\">        con += address.State;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> con2Str(con);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> LMS_SUN-030708_Mid-StatesPullReport</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> Bruce Niu -10/11/2024</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> Get freight terms.</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;/summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;param name = &quot;_dlvTerm&quot;&gt;</span>dlvTerm<span class=\"doctag\">&lt;/param&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;returns&gt;</span>FreightTerms str<span class=\"doctag\">&lt;/returns&gt;</span></span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> str <span class=\"title\">getFreightTerms</span>(<span class=\"params\">str _dlvTerm</span>)</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        container con = [<span class=\"string\">&#x27;@LMS:LMSFFAFOBD&#x27;</span>, <span class=\"string\">&#x27;@LMS:LMSFFAFOBO&#x27;</span>, <span class=\"string\">&#x27;@LMS:LMSPPAFOBD&#x27;</span>, <span class=\"string\">&#x27;@LMS:LMSPPAFOBO&#x27;</span>, <span class=\"string\">&#x27;@LMS:LMSPPDFOBD&#x27;</span>, <span class=\"string\">&#x27;@LMS:LMSPPDFOBO&#x27;</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span>(conFind(con, _dlvTerm))</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"string\">&#x27;Yes&#x27;</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">else</span></span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"string\">&#x27;No&#x27;</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> LMS_SUN-030708_Mid-StatesPullReport</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> Bruce Niu -10/11/2024</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> Get Payment Terms</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;/summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;param name = &quot;_CashDisc&quot;&gt;</span>CashDisc<span class=\"doctag\">&lt;/param&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;param name = &quot;_PaymTermId&quot;&gt;</span>PaymTermId<span class=\"doctag\">&lt;/param&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;returns&gt;</span>str<span class=\"doctag\">&lt;/returns&gt;</span></span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> str <span class=\"title\">getPaymentTerms</span>(<span class=\"params\">str _CashDisc, str _PaymTermId</span>)</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        CashDisc    cd  = CashDisc::find(_CashDisc);</span><br><span class=\"line\">        container   con = conNull();</span><br><span class=\"line\">        PaymTerm    pt  = PaymTerm::find(_PaymTermId);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span>(cd.NumOfDays)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            con += int2Str(cd.NumOfDays);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span>(pt.PaymMethod)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            con += enum2Str(pt.PaymMethod);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span>(pt.NumOfDays)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            con += int2Str(pt.NumOfDays);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span>(conLen(con) &gt; <span class=\"number\">0</span>)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> con2Str(con, <span class=\"string\">&quot; &quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">else</span></span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> LMS_SUN-030708_Mid-StatesPullReport</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> Bruce Niu -10/11/2024</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> Get item id.</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;/summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;param name = &quot;_displayProductNumber&quot;&gt;</span>DisplayProductNumber<span class=\"doctag\">&lt;/param&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;returns&gt;</span>container<span class=\"doctag\">&lt;/returns&gt;</span></span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> container <span class=\"title\">getItemId</span>(<span class=\"params\">LMSSalesHistorySummaryView _summaryView</span>)</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        InventTable             inventtable;</span><br><span class=\"line\">        InventDimCombination    inventDimCombination;</span><br><span class=\"line\">        EcoResProduct           ecoResProduct;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// LMS_SUN-030708_Mid-StatesPullReport add by Ina Wang on 11/11/2024 begin</span></span><br><span class=\"line\">        InventDim               inventDimLoc;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">select</span> firstonly ItemId, InventDimId, RetailVariantId, DistinctProductVariant <span class=\"keyword\">from</span> inventDimCombination</span><br><span class=\"line\">            <span class=\"keyword\">where</span> inventDimCombination.ItemId       == _summaryView.ProductNumber</span><br><span class=\"line\">            exists <span class=\"keyword\">join</span> inventDimLoc</span><br><span class=\"line\">                <span class=\"keyword\">where</span> inventDimLoc.inventDimId      == inventDimCombination.InventDimId</span><br><span class=\"line\">                    &amp;&amp; inventDimLoc.InventColorId   == _summaryView.Color</span><br><span class=\"line\">                    &amp;&amp; inventDimLoc.InventSizeId    == _summaryView.Size;</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">if</span>(inventDimCombination.ItemId)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> [inventDimCombination.ItemId,inventDimCombination.InventDimId, inventDimCombination.productDescription(<span class=\"string\">&quot;en-us&quot;</span>)];</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">else</span></span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">select</span> firstonly ItemId, Product <span class=\"keyword\">from</span> inventtable</span><br><span class=\"line\">                exists <span class=\"keyword\">join</span> ecoResProduct</span><br><span class=\"line\">                    <span class=\"keyword\">where</span> ecoResProduct.RecId                   == inventtable.Product</span><br><span class=\"line\">                       &amp;&amp; ecoResProduct.DisplayProductNumber    == _summaryView.ProductNumber;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">return</span> [inventtable.ItemId, InventDim::inventDimIdBlank(), inventtable.productDescription(<span class=\"string\">&quot;en-us&quot;</span>)];</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// LMS_SUN-030708_Mid-StatesPullReport add by Ina Wang on 11/11/2024 end</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>","excerpt":"","more":"<h3 id=\"Example-Code\"><a href=\"#Example-Code\" class=\"headerlink\" title=\"Example Code\"></a>Example Code</h3><figure class=\"highlight c#\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br><span class=\"line\">249</span><br><span class=\"line\">250</span><br><span class=\"line\">251</span><br><span class=\"line\">252</span><br><span class=\"line\">253</span><br><span class=\"line\">254</span><br><span class=\"line\">255</span><br><span class=\"line\">256</span><br><span class=\"line\">257</span><br><span class=\"line\">258</span><br><span class=\"line\">259</span><br><span class=\"line\">260</span><br><span class=\"line\">261</span><br><span class=\"line\">262</span><br><span class=\"line\">263</span><br><span class=\"line\">264</span><br><span class=\"line\">265</span><br><span class=\"line\">266</span><br><span class=\"line\">267</span><br><span class=\"line\">268</span><br><span class=\"line\">269</span><br><span class=\"line\">270</span><br><span class=\"line\">271</span><br><span class=\"line\">272</span><br><span class=\"line\">273</span><br><span class=\"line\">274</span><br><span class=\"line\">275</span><br><span class=\"line\">276</span><br><span class=\"line\">277</span><br><span class=\"line\">278</span><br><span class=\"line\">279</span><br><span class=\"line\">280</span><br><span class=\"line\">281</span><br><span class=\"line\">282</span><br><span class=\"line\">283</span><br><span class=\"line\">284</span><br><span class=\"line\">285</span><br><span class=\"line\">286</span><br><span class=\"line\">287</span><br><span class=\"line\">288</span><br><span class=\"line\">289</span><br><span class=\"line\">290</span><br><span class=\"line\">291</span><br><span class=\"line\">292</span><br><span class=\"line\">293</span><br><span class=\"line\">294</span><br><span class=\"line\">295</span><br><span class=\"line\">296</span><br><span class=\"line\">297</span><br><span class=\"line\">298</span><br><span class=\"line\">299</span><br><span class=\"line\">300</span><br><span class=\"line\">301</span><br><span class=\"line\">302</span><br><span class=\"line\">303</span><br><span class=\"line\">304</span><br><span class=\"line\">305</span><br><span class=\"line\">306</span><br><span class=\"line\">307</span><br><span class=\"line\">308</span><br><span class=\"line\">309</span><br><span class=\"line\">310</span><br><span class=\"line\">311</span><br><span class=\"line\">312</span><br><span class=\"line\">313</span><br><span class=\"line\">314</span><br><span class=\"line\">315</span><br><span class=\"line\">316</span><br><span class=\"line\">317</span><br><span class=\"line\">318</span><br><span class=\"line\">319</span><br><span class=\"line\">320</span><br><span class=\"line\">321</span><br><span class=\"line\">322</span><br><span class=\"line\">323</span><br><span class=\"line\">324</span><br><span class=\"line\">325</span><br><span class=\"line\">326</span><br><span class=\"line\">327</span><br><span class=\"line\">328</span><br><span class=\"line\">329</span><br><span class=\"line\">330</span><br><span class=\"line\">331</span><br><span class=\"line\">332</span><br><span class=\"line\">333</span><br><span class=\"line\">334</span><br><span class=\"line\">335</span><br><span class=\"line\">336</span><br><span class=\"line\">337</span><br><span class=\"line\">338</span><br><span class=\"line\">339</span><br><span class=\"line\">340</span><br><span class=\"line\">341</span><br><span class=\"line\">342</span><br><span class=\"line\">343</span><br><span class=\"line\">344</span><br><span class=\"line\">345</span><br><span class=\"line\">346</span><br><span class=\"line\">347</span><br><span class=\"line\">348</span><br><span class=\"line\">349</span><br><span class=\"line\">350</span><br><span class=\"line\">351</span><br><span class=\"line\">352</span><br><span class=\"line\">353</span><br><span class=\"line\">354</span><br><span class=\"line\">355</span><br><span class=\"line\">356</span><br><span class=\"line\">357</span><br><span class=\"line\">358</span><br><span class=\"line\">359</span><br><span class=\"line\">360</span><br><span class=\"line\">361</span><br><span class=\"line\">362</span><br><span class=\"line\">363</span><br><span class=\"line\">364</span><br><span class=\"line\">365</span><br><span class=\"line\">366</span><br><span class=\"line\">367</span><br><span class=\"line\">368</span><br><span class=\"line\">369</span><br><span class=\"line\">370</span><br><span class=\"line\">371</span><br><span class=\"line\">372</span><br><span class=\"line\">373</span><br><span class=\"line\">374</span><br><span class=\"line\">375</span><br><span class=\"line\">376</span><br><span class=\"line\">377</span><br><span class=\"line\">378</span><br><span class=\"line\">379</span><br><span class=\"line\">380</span><br><span class=\"line\">381</span><br><span class=\"line\">382</span><br><span class=\"line\">383</span><br><span class=\"line\">384</span><br><span class=\"line\">385</span><br><span class=\"line\">386</span><br><span class=\"line\">387</span><br><span class=\"line\">388</span><br><span class=\"line\">389</span><br><span class=\"line\">390</span><br><span class=\"line\">391</span><br><span class=\"line\">392</span><br><span class=\"line\">393</span><br><span class=\"line\">394</span><br><span class=\"line\">395</span><br><span class=\"line\">396</span><br><span class=\"line\">397</span><br><span class=\"line\">398</span><br><span class=\"line\">399</span><br><span class=\"line\">400</span><br><span class=\"line\">401</span><br><span class=\"line\">402</span><br><span class=\"line\">403</span><br><span class=\"line\">404</span><br><span class=\"line\">405</span><br><span class=\"line\">406</span><br><span class=\"line\">407</span><br><span class=\"line\">408</span><br><span class=\"line\">409</span><br><span class=\"line\">410</span><br><span class=\"line\">411</span><br><span class=\"line\">412</span><br><span class=\"line\">413</span><br><span class=\"line\">414</span><br><span class=\"line\">415</span><br><span class=\"line\">416</span><br><span class=\"line\">417</span><br><span class=\"line\">418</span><br><span class=\"line\">419</span><br><span class=\"line\">420</span><br><span class=\"line\">421</span><br><span class=\"line\">422</span><br><span class=\"line\">423</span><br><span class=\"line\">424</span><br><span class=\"line\">425</span><br><span class=\"line\">426</span><br><span class=\"line\">427</span><br><span class=\"line\">428</span><br><span class=\"line\">429</span><br><span class=\"line\">430</span><br><span class=\"line\">431</span><br><span class=\"line\">432</span><br><span class=\"line\">433</span><br><span class=\"line\">434</span><br><span class=\"line\">435</span><br><span class=\"line\">436</span><br><span class=\"line\">437</span><br><span class=\"line\">438</span><br><span class=\"line\">439</span><br><span class=\"line\">440</span><br><span class=\"line\">441</span><br><span class=\"line\">442</span><br><span class=\"line\">443</span><br><span class=\"line\">444</span><br><span class=\"line\">445</span><br><span class=\"line\">446</span><br><span class=\"line\">447</span><br><span class=\"line\">448</span><br><span class=\"line\">449</span><br><span class=\"line\">450</span><br><span class=\"line\">451</span><br><span class=\"line\">452</span><br><span class=\"line\">453</span><br><span class=\"line\">454</span><br><span class=\"line\">455</span><br><span class=\"line\">456</span><br><span class=\"line\">457</span><br><span class=\"line\">458</span><br><span class=\"line\">459</span><br><span class=\"line\">460</span><br><span class=\"line\">461</span><br><span class=\"line\">462</span><br><span class=\"line\">463</span><br><span class=\"line\">464</span><br><span class=\"line\">465</span><br><span class=\"line\">466</span><br><span class=\"line\">467</span><br><span class=\"line\">468</span><br><span class=\"line\">469</span><br><span class=\"line\">470</span><br><span class=\"line\">471</span><br><span class=\"line\">472</span><br><span class=\"line\">473</span><br><span class=\"line\">474</span><br><span class=\"line\">475</span><br><span class=\"line\">476</span><br><span class=\"line\">477</span><br><span class=\"line\">478</span><br><span class=\"line\">479</span><br><span class=\"line\">480</span><br><span class=\"line\">481</span><br><span class=\"line\">482</span><br><span class=\"line\">483</span><br><span class=\"line\">484</span><br><span class=\"line\">485</span><br><span class=\"line\">486</span><br><span class=\"line\">487</span><br><span class=\"line\">488</span><br><span class=\"line\">489</span><br><span class=\"line\">490</span><br><span class=\"line\">491</span><br><span class=\"line\">492</span><br><span class=\"line\">493</span><br><span class=\"line\">494</span><br><span class=\"line\">495</span><br><span class=\"line\">496</span><br><span class=\"line\">497</span><br><span class=\"line\">498</span><br><span class=\"line\">499</span><br><span class=\"line\">500</span><br><span class=\"line\">501</span><br><span class=\"line\">502</span><br><span class=\"line\">503</span><br><span class=\"line\">504</span><br><span class=\"line\">505</span><br><span class=\"line\">506</span><br><span class=\"line\">507</span><br><span class=\"line\">508</span><br><span class=\"line\">509</span><br><span class=\"line\">510</span><br><span class=\"line\">511</span><br><span class=\"line\">512</span><br><span class=\"line\">513</span><br><span class=\"line\">514</span><br><span class=\"line\">515</span><br><span class=\"line\">516</span><br><span class=\"line\">517</span><br><span class=\"line\">518</span><br><span class=\"line\">519</span><br><span class=\"line\">520</span><br><span class=\"line\">521</span><br><span class=\"line\">522</span><br><span class=\"line\">523</span><br><span class=\"line\">524</span><br><span class=\"line\">525</span><br><span class=\"line\">526</span><br><span class=\"line\">527</span><br><span class=\"line\">528</span><br><span class=\"line\">529</span><br><span class=\"line\">530</span><br><span class=\"line\">531</span><br><span class=\"line\">532</span><br><span class=\"line\">533</span><br><span class=\"line\">534</span><br><span class=\"line\">535</span><br><span class=\"line\">536</span><br><span class=\"line\">537</span><br><span class=\"line\">538</span><br><span class=\"line\">539</span><br><span class=\"line\">540</span><br><span class=\"line\">541</span><br><span class=\"line\">542</span><br><span class=\"line\">543</span><br><span class=\"line\">544</span><br><span class=\"line\">545</span><br><span class=\"line\">546</span><br><span class=\"line\">547</span><br><span class=\"line\">548</span><br><span class=\"line\">549</span><br><span class=\"line\">550</span><br><span class=\"line\">551</span><br><span class=\"line\">552</span><br><span class=\"line\">553</span><br><span class=\"line\">554</span><br><span class=\"line\">555</span><br><span class=\"line\">556</span><br><span class=\"line\">557</span><br><span class=\"line\">558</span><br><span class=\"line\">559</span><br><span class=\"line\">560</span><br><span class=\"line\">561</span><br><span class=\"line\">562</span><br><span class=\"line\">563</span><br><span class=\"line\">564</span><br><span class=\"line\">565</span><br><span class=\"line\">566</span><br><span class=\"line\">567</span><br><span class=\"line\">568</span><br><span class=\"line\">569</span><br><span class=\"line\">570</span><br><span class=\"line\">571</span><br><span class=\"line\">572</span><br><span class=\"line\">573</span><br><span class=\"line\">574</span><br><span class=\"line\">575</span><br><span class=\"line\">576</span><br><span class=\"line\">577</span><br><span class=\"line\">578</span><br><span class=\"line\">579</span><br><span class=\"line\">580</span><br><span class=\"line\">581</span><br><span class=\"line\">582</span><br><span class=\"line\">583</span><br><span class=\"line\">584</span><br><span class=\"line\">585</span><br><span class=\"line\">586</span><br><span class=\"line\">587</span><br><span class=\"line\">588</span><br><span class=\"line\">589</span><br><span class=\"line\">590</span><br><span class=\"line\">591</span><br><span class=\"line\">592</span><br><span class=\"line\">593</span><br><span class=\"line\">594</span><br><span class=\"line\">595</span><br><span class=\"line\">596</span><br><span class=\"line\">597</span><br><span class=\"line\">598</span><br><span class=\"line\">599</span><br><span class=\"line\">600</span><br><span class=\"line\">601</span><br><span class=\"line\">602</span><br><span class=\"line\">603</span><br><span class=\"line\">604</span><br><span class=\"line\">605</span><br><span class=\"line\">606</span><br><span class=\"line\">607</span><br><span class=\"line\">608</span><br><span class=\"line\">609</span><br><span class=\"line\">610</span><br><span class=\"line\">611</span><br><span class=\"line\">612</span><br><span class=\"line\">613</span><br><span class=\"line\">614</span><br><span class=\"line\">615</span><br><span class=\"line\">616</span><br><span class=\"line\">617</span><br><span class=\"line\">618</span><br><span class=\"line\">619</span><br><span class=\"line\">620</span><br><span class=\"line\">621</span><br><span class=\"line\">622</span><br><span class=\"line\">623</span><br><span class=\"line\">624</span><br><span class=\"line\">625</span><br><span class=\"line\">626</span><br><span class=\"line\">627</span><br><span class=\"line\">628</span><br><span class=\"line\">629</span><br><span class=\"line\">630</span><br><span class=\"line\">631</span><br><span class=\"line\">632</span><br><span class=\"line\">633</span><br><span class=\"line\">634</span><br><span class=\"line\">635</span><br><span class=\"line\">636</span><br><span class=\"line\">637</span><br><span class=\"line\">638</span><br><span class=\"line\">639</span><br><span class=\"line\">640</span><br><span class=\"line\">641</span><br><span class=\"line\">642</span><br><span class=\"line\">643</span><br><span class=\"line\">644</span><br><span class=\"line\">645</span><br><span class=\"line\">646</span><br><span class=\"line\">647</span><br><span class=\"line\">648</span><br><span class=\"line\">649</span><br><span class=\"line\">650</span><br><span class=\"line\">651</span><br><span class=\"line\">652</span><br><span class=\"line\">653</span><br><span class=\"line\">654</span><br><span class=\"line\">655</span><br><span class=\"line\">656</span><br><span class=\"line\">657</span><br><span class=\"line\">658</span><br><span class=\"line\">659</span><br><span class=\"line\">660</span><br><span class=\"line\">661</span><br><span class=\"line\">662</span><br><span class=\"line\">663</span><br><span class=\"line\">664</span><br><span class=\"line\">665</span><br><span class=\"line\">666</span><br><span class=\"line\">667</span><br><span class=\"line\">668</span><br><span class=\"line\">669</span><br><span class=\"line\">670</span><br><span class=\"line\">671</span><br><span class=\"line\">672</span><br><span class=\"line\">673</span><br><span class=\"line\">674</span><br><span class=\"line\">675</span><br><span class=\"line\">676</span><br><span class=\"line\">677</span><br><span class=\"line\">678</span><br><span class=\"line\">679</span><br><span class=\"line\">680</span><br><span class=\"line\">681</span><br><span class=\"line\">682</span><br><span class=\"line\">683</span><br><span class=\"line\">684</span><br><span class=\"line\">685</span><br><span class=\"line\">686</span><br><span class=\"line\">687</span><br><span class=\"line\">688</span><br><span class=\"line\">689</span><br><span class=\"line\">690</span><br><span class=\"line\">691</span><br><span class=\"line\">692</span><br><span class=\"line\">693</span><br><span class=\"line\">694</span><br><span class=\"line\">695</span><br><span class=\"line\">696</span><br><span class=\"line\">697</span><br><span class=\"line\">698</span><br><span class=\"line\">699</span><br><span class=\"line\">700</span><br><span class=\"line\">701</span><br><span class=\"line\">702</span><br><span class=\"line\">703</span><br><span class=\"line\">704</span><br><span class=\"line\">705</span><br><span class=\"line\">706</span><br><span class=\"line\">707</span><br><span class=\"line\">708</span><br><span class=\"line\">709</span><br><span class=\"line\">710</span><br><span class=\"line\">711</span><br><span class=\"line\">712</span><br><span class=\"line\">713</span><br><span class=\"line\">714</span><br><span class=\"line\">715</span><br><span class=\"line\">716</span><br><span class=\"line\">717</span><br><span class=\"line\">718</span><br><span class=\"line\">719</span><br><span class=\"line\">720</span><br><span class=\"line\">721</span><br><span class=\"line\">722</span><br><span class=\"line\">723</span><br><span class=\"line\">724</span><br><span class=\"line\">725</span><br><span class=\"line\">726</span><br><span class=\"line\">727</span><br><span class=\"line\">728</span><br><span class=\"line\">729</span><br><span class=\"line\">730</span><br><span class=\"line\">731</span><br><span class=\"line\">732</span><br><span class=\"line\">733</span><br><span class=\"line\">734</span><br><span class=\"line\">735</span><br><span class=\"line\">736</span><br><span class=\"line\">737</span><br><span class=\"line\">738</span><br><span class=\"line\">739</span><br><span class=\"line\">740</span><br><span class=\"line\">741</span><br><span class=\"line\">742</span><br><span class=\"line\">743</span><br><span class=\"line\">744</span><br><span class=\"line\">745</span><br><span class=\"line\">746</span><br><span class=\"line\">747</span><br><span class=\"line\">748</span><br><span class=\"line\">749</span><br><span class=\"line\">750</span><br><span class=\"line\">751</span><br><span class=\"line\">752</span><br><span class=\"line\">753</span><br><span class=\"line\">754</span><br><span class=\"line\">755</span><br><span class=\"line\">756</span><br><span class=\"line\">757</span><br><span class=\"line\">758</span><br><span class=\"line\">759</span><br><span class=\"line\">760</span><br><span class=\"line\">761</span><br><span class=\"line\">762</span><br><span class=\"line\">763</span><br><span class=\"line\">764</span><br><span class=\"line\">765</span><br><span class=\"line\">766</span><br><span class=\"line\">767</span><br><span class=\"line\">768</span><br><span class=\"line\">769</span><br><span class=\"line\">770</span><br><span class=\"line\">771</span><br><span class=\"line\">772</span><br><span class=\"line\">773</span><br><span class=\"line\">774</span><br><span class=\"line\">775</span><br><span class=\"line\">776</span><br><span class=\"line\">777</span><br><span class=\"line\">778</span><br><span class=\"line\">779</span><br><span class=\"line\">780</span><br><span class=\"line\">781</span><br><span class=\"line\">782</span><br><span class=\"line\">783</span><br><span class=\"line\">784</span><br><span class=\"line\">785</span><br><span class=\"line\">786</span><br><span class=\"line\">787</span><br><span class=\"line\">788</span><br><span class=\"line\">789</span><br><span class=\"line\">790</span><br><span class=\"line\">791</span><br><span class=\"line\">792</span><br><span class=\"line\">793</span><br><span class=\"line\">794</span><br><span class=\"line\">795</span><br><span class=\"line\">796</span><br><span class=\"line\">797</span><br><span class=\"line\">798</span><br><span class=\"line\">799</span><br><span class=\"line\">800</span><br><span class=\"line\">801</span><br><span class=\"line\">802</span><br><span class=\"line\">803</span><br><span class=\"line\">804</span><br><span class=\"line\">805</span><br><span class=\"line\">806</span><br><span class=\"line\">807</span><br><span class=\"line\">808</span><br><span class=\"line\">809</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">using</span> System.IO;</span><br><span class=\"line\"><span class=\"keyword\">using</span> OfficeOpenXml;</span><br><span class=\"line\"><span class=\"keyword\">using</span> OfficeOpenXml.Style;</span><br><span class=\"line\"><span class=\"keyword\">using</span> OfficeOpenXml.Table;</span><br><span class=\"line\"><span class=\"keyword\">using</span> OfficeOpenXml.Style.ExcelFillStyle;</span><br><span class=\"line\"><span class=\"keyword\">using</span> System.Drawing;</span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title\">LMSMidStatesPullService</span> <span class=\"title\">extends</span> <span class=\"title\">SysOperationServiceBase</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> date                     gFromDate;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> date                     gToDate;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> boolean                  hasheader = <span class=\"literal\">false</span>;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> EcoResCategoryId         gCategory;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> LMSCateGoryTable         gCategoryTable;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> EcoResCategory           gEcoCategoryTable;</span><br><span class=\"line\">    RetailReportSessionIdentifier   gsessionId = guid2Str(newGuid());</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> LMS_SUN-029403_EXT-00015 Load to Truck Validation</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> Lance Shi - 7/17/2024</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> Process</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;/summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;param name = &quot;_contract&quot;&gt;</span>LMSCleanUpLoadedLPTableContract<span class=\"doctag\">&lt;/param&gt;</span></span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">process</span>(<span class=\"params\">LMSMidStatesPullContract _contract</span>)</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        gFromDate           = _contract.parmFromDate();</span><br><span class=\"line\">        gToDate             = _contract.parmToDate();</span><br><span class=\"line\">        <span class=\"comment\">// LMS_SUN-030708_Mid-StatesPullReport add by Ina Wang on 11/21/2024 begin</span></span><br><span class=\"line\"></span><br><span class=\"line\">        gCategory           = _contract.parmCategory();</span><br><span class=\"line\">        gEcoCategoryTable   = EcoResCategory::find(gCategory);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">select</span> firstonly RecId <span class=\"keyword\">from</span> gCategoryTable</span><br><span class=\"line\">            <span class=\"keyword\">where</span> gCategoryTable.EcoResCategory     == gEcoCategoryTable.RecId</span><br><span class=\"line\">              &amp;&amp; gCategoryTable.SessionId           == gsessionId;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span>(!gCategoryTable.RecId)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            gCategoryTable.EcoResCategory   = gEcoCategoryTable.RecId;</span><br><span class=\"line\">            gCategoryTable.SessionId        = gsessionId;</span><br><span class=\"line\">            gCategoryTable.insert();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        ttsbegin;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.getAllCategory(gEcoCategoryTable.RecId);</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.createtab(_contract);</span><br><span class=\"line\"></span><br><span class=\"line\">        delete_from gCategoryTable</span><br><span class=\"line\">            <span class=\"keyword\">where</span> gCategoryTable.SessionId == gsessionId;</span><br><span class=\"line\">        ttscommit;</span><br><span class=\"line\">        <span class=\"comment\">// LMS_SUN-030708_Mid-StatesPullReport add by Ina Wang on 11/21/2024 end</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> LMS_SUN-030708_Mid-StatesPullReport</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> Bruce Niu -10/11/2024</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> Create tab.</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;/summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;param name = &quot;_contract&quot;&gt;</span>LMSMidStatesPullContract<span class=\"doctag\">&lt;/param&gt;</span></span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">createtab</span>(<span class=\"params\">LMSMidStatesPullContract _contract</span>)</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        QueryRun                        queryRun    = <span class=\"keyword\">new</span> QueryRun(_contract.getQuery());</span><br><span class=\"line\">        LMSSalesHistoryView             historyView;</span><br><span class=\"line\">        container                       itemIdCon   = conNull();</span><br><span class=\"line\">        System.IO.Stream                stream;</span><br><span class=\"line\">        ExcelSpreadsheetName            sheet;</span><br><span class=\"line\">        MemoryStream                    memoryStream = <span class=\"keyword\">new</span> MemoryStream();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">using</span> (<span class=\"keyword\">var</span> package = <span class=\"keyword\">new</span> ExcelPackage(memoryStream))</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> currentRow = <span class=\"number\">1</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">var</span>                             worksheets          = package.get_Workbook().get_Worksheets();</span><br><span class=\"line\">            OfficeOpenXml.ExcelWorksheet    SupplierWorksheet   = worksheets.Add(<span class=\"string\">&quot;@LMS:LMSSupplierInformation&quot;</span>);</span><br><span class=\"line\">            OfficeOpenXml.ExcelWorksheet    SalesDataWorksheet  = worksheets.Add(<span class=\"string\">&quot;@LMS:LMSSalesData&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">            itemIdCon = <span class=\"keyword\">this</span>.generateSalesData(SalesDataWorksheet, _contract);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span>(itemIdCon)</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"keyword\">this</span>.generateSupplier(itemIdCon, SupplierWorksheet);</span><br><span class=\"line\">        </span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            package.Save();</span><br><span class=\"line\">            <span class=\"keyword\">file</span>::SendFileToUser(memoryStream, <span class=\"string\">&quot;@LMS:LMSMidStatsPullExcel&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> LMS_SUN-030708_Mid-StatesPullReport</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> Bruce Niu -10/11/2024</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> Get query for range.</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;/summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;param name = &quot;_query&quot;&gt;</span>Query<span class=\"doctag\">&lt;/param&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;returns&gt;</span>Query<span class=\"doctag\">&lt;/returns&gt;</span></span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Query  <span class=\"title\">getQueryForRange</span>(<span class=\"params\">Query _query</span>)</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        Query                   query = _query;</span><br><span class=\"line\">        QueryBuildDataSource    qbds = _query.dataSourceTable(tableNum(LMSSalesHistorySummaryView)).addDataSource(tableNum(LMSSalesHistoryView));</span><br><span class=\"line\"></span><br><span class=\"line\">        qbds.joinMode(JoinMode::ExistsJoin);</span><br><span class=\"line\">        qbds.addLink(fieldNum(LMSSalesHistorySummaryView, ProductNumber), fieldNum(LMSSalesHistoryView, ProductNumber));</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// LMS_SUN-030708_Mid-StatesPullReport add by Ina Wang on 11/11/2024 begin</span></span><br><span class=\"line\">        qbds.addLink(fieldNum(LMSSalesHistorySummaryView, Color), fieldNum(LMSSalesHistoryView, Color));</span><br><span class=\"line\">        qbds.addLink(fieldNum(LMSSalesHistorySummaryView, Size), fieldNum(LMSSalesHistoryView, Size));</span><br><span class=\"line\">        <span class=\"comment\">// LMS_SUN-030708_Mid-StatesPullReport add by Ina Wang on 11/11/2024 end</span></span><br><span class=\"line\"></span><br><span class=\"line\">        qbds.addRange(fieldNum(LMSSalesHistoryView, SalesHistoryDate)).<span class=\"keyword\">value</span>(SysQueryRangeUtil::dateRange(gFromDate, gToDate));</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// LMS_SUN-030708_Mid-StatesPullReport add by Ina Wang on 11/21/2024 begin</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span>(gCategory)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            EcoResCategoryNamedHierarchyRole    hierarchyId             = EcoResCategoryHierarchyRole::getHierarchiesByRole(EcoResCategoryNamedHierarchyRole::Retail).NamedCategoryHierarchyRole;</span><br><span class=\"line\">            QueryBuildDataSource                qbdsCategoryExpanded    = _query.dataSourceTable(tableNum(LMSSalesHistoryView)).addDataSource(tableNum(EcoResProductCategoryExpanded));</span><br><span class=\"line\"></span><br><span class=\"line\">            qbdsCategoryExpanded.joinMode(JoinMode::ExistsJoin);</span><br><span class=\"line\">            qbdsCategoryExpanded.addLink(fieldNum(LMSSalesHistoryView, ProductNumber), fieldNum(EcoResProductCategoryExpanded, ItemId));</span><br><span class=\"line\">            qbdsCategoryExpanded.addRange(fieldNum(EcoResProductCategoryExpanded, NamedCategoryHierarchyRole)).<span class=\"keyword\">value</span>(queryValue(hierarchyId));</span><br><span class=\"line\"></span><br><span class=\"line\">            QueryBuildDataSource    qbdsCategoryTable     = _query.dataSourceTable(tableNum(EcoResProductCategoryExpanded)).addDataSource(tableNum(LMSCateGoryTable));</span><br><span class=\"line\">            qbdsCategoryTable.joinMode(JoinMode::ExistsJoin);</span><br><span class=\"line\">            qbdsCategoryTable.addLink(fieldNum(EcoResProductCategoryExpanded, RecIdCategory), fieldNum(LMSCateGoryTable, EcoResCategory));</span><br><span class=\"line\">            qbdsCategoryTable.addRange(fieldNum(LMSCateGoryTable, SessionId)).<span class=\"keyword\">value</span>(queryValue(gsessionId));</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// LMS_SUN-030708_Mid-StatesPullReport add by Ina Wang on 11/21/2024 end</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> query;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> LMS_SUN-030708_Mid-StatesPullReport</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> Bruce Niu -10/11/2024</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> Generate sales data.</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;/summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;param name = &quot;_SalesDataWorksheet&quot;&gt;</span>ExcelWorksheet<span class=\"doctag\">&lt;/param&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;param name = &quot;_contract&quot;&gt;</span>Contract<span class=\"doctag\">&lt;/param&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;returns&gt;</span>container<span class=\"doctag\">&lt;/returns&gt;</span></span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> container <span class=\"title\">generateSalesData</span>(<span class=\"params\">OfficeOpenXml.ExcelWorksheet _SalesDataWorksheet, LMSMidStatesPullContract _contract</span>)</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span>                             SalesDatacells      = _SalesDataWorksheet.get_Cells();</span><br><span class=\"line\">        Map                             map                 = <span class=\"keyword\">new</span> Map(Types::String, Types::Container);</span><br><span class=\"line\">        <span class=\"built_in\">int</span>                             row                 = <span class=\"number\">1</span>;</span><br><span class=\"line\">        QueryRun                        queryRun            = <span class=\"keyword\">new</span> QueryRun(<span class=\"keyword\">this</span>.getQueryForRange(_contract.getQuery()));</span><br><span class=\"line\">        LMSSalesHistorySummaryView      historyView;</span><br><span class=\"line\">        LMSSalesHistoryView             historyViewRecord;</span><br><span class=\"line\">        container                       supplerRow          = conNull();</span><br><span class=\"line\">        container                       itemIdCon           = conNull();</span><br><span class=\"line\"></span><br><span class=\"line\">        OfficeOpenXml.ExcelRange cell = SalesDatacells.get_Item(<span class=\"number\">1</span>, <span class=\"number\">1</span>);</span><br><span class=\"line\">        cell.set_Value(<span class=\"string\">&quot;@LMS:LMSMemberName&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        cell = SalesDatacells.get_Item(<span class=\"number\">1</span>, <span class=\"number\">2</span>);</span><br><span class=\"line\">        cell.set_Value(<span class=\"string\">&quot;@LMS:LMSReportingVendor&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        cell = SalesDatacells.get_Item(<span class=\"number\">1</span>, <span class=\"number\">3</span>);</span><br><span class=\"line\">        cell.set_Value(<span class=\"string\">&quot;@LMS:LMSItemNumber&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        cell = SalesDatacells.get_Item(<span class=\"number\">1</span>, <span class=\"number\">4</span>);</span><br><span class=\"line\">        cell.set_Value(<span class=\"string\">&quot;@LMS:LMSMFGPart&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        cell = SalesDatacells.get_Item(<span class=\"number\">1</span>, <span class=\"number\">5</span>);</span><br><span class=\"line\">        cell.set_Value(<span class=\"string\">&quot;@LMS:LMSItemDesc&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        cell = SalesDatacells.get_Item(<span class=\"number\">1</span>, <span class=\"number\">6</span>);</span><br><span class=\"line\">        cell.set_Value(<span class=\"string\">&quot;@LMS:LMSUPC&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        cell = SalesDatacells.get_Item(<span class=\"number\">1</span>, <span class=\"number\">7</span>);</span><br><span class=\"line\">        cell.set_Value(<span class=\"string\">&quot;@SYS850&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        cell = SalesDatacells.get_Item(<span class=\"number\">1</span>, <span class=\"number\">8</span>);</span><br><span class=\"line\">        cell.set_Value(<span class=\"string\">&quot;@LMS:LMSClassLine&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        cell = SalesDatacells.get_Item(<span class=\"number\">1</span>, <span class=\"number\">9</span>);</span><br><span class=\"line\">        cell.set_Value(<span class=\"string\">&quot;@LMS:LMSSubClassFineLine&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"built_in\">int</span> currentRow = <span class=\"number\">9</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        container con = <span class=\"keyword\">this</span>.generateMonthColumn();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span>(con)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">for</span>(<span class=\"built_in\">int</span> i = <span class=\"number\">1</span>; i &lt;= conlen(con); i ++)</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                currentRow ++;</span><br><span class=\"line\">                cell = SalesDatacells.get_Item(<span class=\"number\">1</span>, currentRow);</span><br><span class=\"line\">                cell.set_Value(conpeek(con, i));</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        currentRow ++;</span><br><span class=\"line\">        cell = SalesDatacells.get_Item(<span class=\"number\">1</span>, currentRow);</span><br><span class=\"line\">        cell.set_Value(<span class=\"string\">&quot;@LMS:LMSTotalMonthSales&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        currentRow ++;</span><br><span class=\"line\">        cell = SalesDatacells.get_Item(<span class=\"number\">1</span>, currentRow);</span><br><span class=\"line\">        cell.set_Value(<span class=\"string\">&quot;@LMS:LMSRepalcementCost&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        currentRow ++;</span><br><span class=\"line\">        cell = SalesDatacells.get_Item(<span class=\"number\">1</span>, currentRow);</span><br><span class=\"line\">        cell.set_Value(<span class=\"string\">&quot;@LMS:LMSCompanyOnHand&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        currentRow ++;</span><br><span class=\"line\">        cell = SalesDatacells.get_Item(<span class=\"number\">1</span>, currentRow);</span><br><span class=\"line\">        cell.set_Value(<span class=\"string\">&quot;@LMS:LMSSystemRetail&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        currentRow ++;</span><br><span class=\"line\">        cell = SalesDatacells.get_Item(<span class=\"number\">1</span>, currentRow);</span><br><span class=\"line\">        cell.set_Value(<span class=\"string\">&quot;@LMS:LMSAverageUnitRetail&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        currentRow = <span class=\"number\">2</span>;</span><br><span class=\"line\">        container alldateCollection = <span class=\"keyword\">this</span>.getAlldateCollection();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">while</span>(queryRun.next())</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            historyView                 = queryRun.<span class=\"keyword\">get</span>(tableNum(LMSSalesHistorySummaryView));</span><br><span class=\"line\"></span><br><span class=\"line\">            container   itemIdDim       = <span class=\"keyword\">this</span>.getItemId(historyView);</span><br><span class=\"line\">            ItemId      itemId          = conPeek(itemIdDim, <span class=\"number\">1</span>);</span><br><span class=\"line\">            InventDimId inventdIm       = conPeek(itemIdDim, <span class=\"number\">2</span>);</span><br><span class=\"line\">            str         description     = conPeek(itemIdDim, <span class=\"number\">3</span>);</span><br><span class=\"line\">            <span class=\"built_in\">int</span>         currentColumn   ;</span><br><span class=\"line\"></span><br><span class=\"line\">            InventTable inventTable;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">select</span> firstonly PrimaryVendorId <span class=\"keyword\">from</span> inventTable</span><br><span class=\"line\">                <span class=\"keyword\">where</span> inventTable.ItemId == itemId;</span><br><span class=\"line\"></span><br><span class=\"line\">            VendTable   vendTable;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">select</span> firstonly Party <span class=\"keyword\">from</span> vendTable</span><br><span class=\"line\">                <span class=\"keyword\">where</span> vendTable.AccountNum == inventTable.PrimaryVendorId;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span>(itemIdCon == conNull())</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                itemIdCon += itemId;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">else</span></span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span>(!conFind(itemIdCon, itemId))</span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    itemIdCon += itemId;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            cell = SalesDatacells.get_Item(currentRow, <span class=\"number\">1</span>);</span><br><span class=\"line\">            cell.set_Value(<span class=\"string\">&quot;@LMS:LMSLMSupply&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">            cell = SalesDatacells.get_Item(currentRow, <span class=\"number\">2</span>);</span><br><span class=\"line\">            cell.set_Value(vendTable.vendorName());</span><br><span class=\"line\"></span><br><span class=\"line\">            cell = SalesDatacells.get_Item(currentRow, <span class=\"number\">3</span>);</span><br><span class=\"line\">            cell.set_Value(historyView.ProductNumber);</span><br><span class=\"line\"></span><br><span class=\"line\">            cell = SalesDatacells.get_Item(currentRow, <span class=\"number\">4</span>);</span><br><span class=\"line\">            cell.set_Value(CustVendExternalItem::find(ModuleInventPurchSalesVendCustGroup::Vend, itemId, inventdIm, inventTable.PrimaryVendorId).ExternalItemId);</span><br><span class=\"line\"></span><br><span class=\"line\">            cell = SalesDatacells.get_Item(currentRow, <span class=\"number\">5</span>);</span><br><span class=\"line\">            cell.set_Value(description);</span><br><span class=\"line\"></span><br><span class=\"line\">            cell = SalesDatacells.get_Item(currentRow, <span class=\"number\">6</span>);</span><br><span class=\"line\">            cell.set_Value(<span class=\"keyword\">this</span>.getItemBarcode(itemId, inventdIm));</span><br><span class=\"line\"></span><br><span class=\"line\">            container conCate = <span class=\"keyword\">this</span>.getCategory(itemId);</span><br><span class=\"line\"></span><br><span class=\"line\">            cell = SalesDatacells.get_Item(currentRow, <span class=\"number\">7</span>);</span><br><span class=\"line\">            cell.set_Value(conPeek(conCate, <span class=\"number\">1</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">            cell = SalesDatacells.get_Item(currentRow, <span class=\"number\">8</span>);</span><br><span class=\"line\">            cell.set_Value(conPeek(conCate, <span class=\"number\">2</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">            cell = SalesDatacells.get_Item(currentRow, <span class=\"number\">9</span>);</span><br><span class=\"line\">            cell.set_Value(conPeek(conCate, <span class=\"number\">3</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">for</span>(currentColumn  = <span class=\"number\">10</span>; currentColumn &lt;= conLen(alldateCollection) + <span class=\"number\">9</span>; currentColumn++)</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                container   conLine = conPeek(alldateCollection, currentColumn - <span class=\"number\">9</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"function\"><span class=\"keyword\">select</span> <span class=\"title\">sum</span>(<span class=\"params\">Quantity</span>) <span class=\"keyword\">from</span> historyViewRecord</span></span><br><span class=\"line\"><span class=\"function\">                    <span class=\"keyword\">where</span> historyViewRecord.ProductNumber</span>       == historyView.ProductNumber</span><br><span class=\"line\">                       &amp;&amp; historyViewRecord.SalesHistoryDate    &gt;= conPeek(conLine, <span class=\"number\">1</span>)</span><br><span class=\"line\">                       &amp;&amp; historyViewRecord.SalesHistoryDate    &lt;= conPeek(conLine, <span class=\"number\">2</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">                cell = SalesDatacells.get_Item(currentRow, currentColumn);</span><br><span class=\"line\">                cell.set_Value(strFmt(<span class=\"string\">&quot;%1&quot;</span>, historyViewRecord.Quantity));</span><br><span class=\"line\">            </span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"function\"><span class=\"keyword\">select</span> <span class=\"title\">sum</span>(<span class=\"params\">Quantity</span>),<span class=\"title\">sum</span>(<span class=\"params\">Amount</span>) <span class=\"keyword\">from</span> historyViewRecord</span></span><br><span class=\"line\"><span class=\"function\">                    <span class=\"keyword\">where</span> historyViewRecord.ProductNumber</span>       == historyView.ProductNumber</span><br><span class=\"line\">                       &amp;&amp; historyViewRecord.SalesHistoryDate    &gt;= gFromDate</span><br><span class=\"line\">                       &amp;&amp; historyViewRecord.SalesHistoryDate    &lt;= gToDate;</span><br><span class=\"line\"></span><br><span class=\"line\">            cell = SalesDatacells.get_Item(currentRow, currentColumn);</span><br><span class=\"line\">            cell.set_Value(strFmt(<span class=\"string\">&quot;%1&quot;</span>, historyViewRecord.Quantity));</span><br><span class=\"line\"></span><br><span class=\"line\">            currentColumn ++;</span><br><span class=\"line\"></span><br><span class=\"line\">            cell = SalesDatacells.get_Item(currentRow, currentColumn);</span><br><span class=\"line\">            cell.set_Value(strFmt(<span class=\"string\">&quot;%1&quot;</span>, InventTableModule::find(itemId, ModuleInventPurchSales::Purch).price));</span><br><span class=\"line\"></span><br><span class=\"line\">            currentColumn ++;</span><br><span class=\"line\"></span><br><span class=\"line\">            cell = SalesDatacells.get_Item(currentRow, currentColumn);</span><br><span class=\"line\">            cell.set_Value(<span class=\"keyword\">this</span>.getinventOnhand(itemId, inventdIm));</span><br><span class=\"line\"></span><br><span class=\"line\">            currentColumn ++;</span><br><span class=\"line\"></span><br><span class=\"line\">            cell = SalesDatacells.get_Item(currentRow, currentColumn);</span><br><span class=\"line\">            cell.set_Value(strFmt(<span class=\"string\">&quot;%1&quot;</span>, InventTableModule::find(itemId, ModuleInventPurchSales::Sales).price));</span><br><span class=\"line\"></span><br><span class=\"line\">            currentColumn ++;</span><br><span class=\"line\"></span><br><span class=\"line\">            cell = SalesDatacells.get_Item(currentRow, currentColumn);</span><br><span class=\"line\">            cell.set_Value(strFmt(<span class=\"string\">&quot;%1&quot;</span>, historyViewRecord.Amount));</span><br><span class=\"line\"></span><br><span class=\"line\">            currentRow ++;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> itemIdCon;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> BAB_EXT-0002 – Dynamic Seasonality Coefficients</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> Bruce Niu 11/14/2024</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> getAllCategory</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;/summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">getAllCategory</span>(<span class=\"params\">RecId _parentRecId</span>)</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        EcoResCategory  cate;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">while</span> <span class=\"keyword\">select</span> RecId <span class=\"keyword\">from</span> cate</span><br><span class=\"line\">            <span class=\"keyword\">where</span> cate.ParentCategory == _parentRecId</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">select</span> firstonly RecId <span class=\"keyword\">from</span> gCategoryTable</span><br><span class=\"line\">                <span class=\"keyword\">where</span> gCategoryTable.EcoResCategory     == cate.RecId</span><br><span class=\"line\">                  &amp;&amp; gCategoryTable.SessionId           == gsessionId;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span>(!gCategoryTable)</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                gCategoryTable.EcoResCategory   = cate.RecId;</span><br><span class=\"line\">                gCategoryTable.SessionId        = gsessionId;</span><br><span class=\"line\">                gCategoryTable.insert();</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"keyword\">this</span>.getAllCategory(cate.recid);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> LMS_SUN-030708_Mid-StatesPullReport</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> Bruce Niu -10/11/2024</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> Get invent on hand.</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;/summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;param name = &quot;_itemId&quot;&gt;</span>Item Id<span class=\"doctag\">&lt;/param&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;param name = &quot;_inventdIm&quot;&gt;</span>Invent Dim<span class=\"doctag\">&lt;/param&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;returns&gt;</span>the string of inventOnhand<span class=\"doctag\">&lt;/returns&gt;</span></span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> str <span class=\"title\">getinventOnhand</span>(<span class=\"params\">str _itemId, str _inventdIm</span>)</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        InventDimParm         dimParm;</span><br><span class=\"line\">        InventOnhand          onhand;</span><br><span class=\"line\">        InventDim             inventDimNew;</span><br><span class=\"line\"></span><br><span class=\"line\">        inventDimNew = InventDim::find(_inventdIm);</span><br><span class=\"line\"></span><br><span class=\"line\">        dimParm.initFromInventDim(inventDimNew);</span><br><span class=\"line\"></span><br><span class=\"line\">        onhand      = InventOnhand::newItemDim(_itemId, inventDimNew, dimParm);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> strFmt(<span class=\"string\">&quot;%1&quot;</span>, onhand.physicalInvent());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> LMS_SUN-030708_Mid-StatesPullReport</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> Bruce Niu -10/11/2024</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> Get category.</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;/summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;param name = &quot;_itemId&quot;&gt;</span>Item Id<span class=\"doctag\">&lt;/param&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;returns&gt;</span>container<span class=\"doctag\">&lt;/returns&gt;</span></span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> container  <span class=\"title\">getCategory</span>(<span class=\"params\">str _itemId</span>)</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        EcoResCategory          c1,c2,c3;</span><br><span class=\"line\">        EcoResProductCategory   ecoResProductCate   = EcoResProductCategory::findByItemIdCategoryHierarchyRole(_itemId, EcoResCategoryNamedHierarchyRole::Retail);</span><br><span class=\"line\"></span><br><span class=\"line\">        c1 = EcoResCategory::find(ecoResProductCate.Category);</span><br><span class=\"line\">        c2 = EcoResCategory::find(c1.ParentCategory);</span><br><span class=\"line\">        c3 = EcoResCategory::find(c2.ParentCategory);</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">return</span> [c3.Name, c2.Name, c1.Name];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> LMS_SUN-030708_Mid-StatesPullReport</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> Bruce Niu -10/11/2024</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> Get Item Barcode</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;/summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;param name = &quot;_itemid&quot;&gt;</span>Item Id<span class=\"doctag\">&lt;/param&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;param name = &quot;_inventDimId&quot;&gt;</span>Invent dim id<span class=\"doctag\">&lt;/param&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;returns&gt;</span>ItemBarcode<span class=\"doctag\">&lt;/returns&gt;</span></span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> str <span class=\"title\">getItemBarcode</span>(<span class=\"params\">str _itemid, str _inventDimId</span>)</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        InventItemBarcode barcode;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">select</span> firstonly itemBarCode <span class=\"keyword\">from</span> barcode</span><br><span class=\"line\">            <span class=\"keyword\">where</span> barcode.barcodeSetupId    == <span class=\"string\">&#x27;@LMS:LMSUPC&#x27;</span></span><br><span class=\"line\">               &amp;&amp; barcode.inventDimId       == _inventDimId</span><br><span class=\"line\">               &amp;&amp; barcode.itemId            == _itemid;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> barcode.itemBarCode;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> LMS_SUN-030708_Mid-StatesPullReport</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> Bruce Niu -10/11/2024</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> Get all date collection.</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;/summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;returns&gt;</span>container<span class=\"doctag\">&lt;/returns&gt;</span></span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> container <span class=\"title\">getAlldateCollection</span>()</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        container con = conNull();</span><br><span class=\"line\">        date        fD, tD;</span><br><span class=\"line\">        </span><br><span class=\"line\">        fD = gFromDate;</span><br><span class=\"line\">        tD = endMth(fd);</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">while</span>(tD &lt;= gToDate)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            con += [[fD, td]];</span><br><span class=\"line\"></span><br><span class=\"line\">            fD = nextMth(fD);</span><br><span class=\"line\">            fD = fD - (dayOfMth(fd) - <span class=\"number\">1</span>);</span><br><span class=\"line\">            tD = endMth(fd);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span>(tD &gt; gToDate &amp;&amp; fD &lt;= gToDate)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            con += [[fD, gToDate]];</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> con;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> LMS_SUN-030708_Mid-StatesPullReport</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> Bruce Niu -10/11/2024</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> Generate month column.</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;/summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;returns&gt;</span>container<span class=\"doctag\">&lt;/returns&gt;</span></span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> container <span class=\"title\">generateMonthColumn</span>()</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        container   con = conNull();</span><br><span class=\"line\">        date        fd  = gFromDate;</span><br><span class=\"line\">        date        Td  = endMth(gToDate);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span>(gFromDate &amp;&amp; gToDate)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">while</span>(fd &lt;= Td)</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                con += strFmt(<span class=\"string\">&quot;@LMS:LMSSalesUnits&quot;</span>, <span class=\"keyword\">this</span>.getMthName(mthOfYr(fd)), year(fd) mod <span class=\"number\">1000</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">                fd      = nextMth(fd);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> con;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> LMS_SUN-030708_Mid-StatesPullReport</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> Bruce Niu -10/11/2024</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> Get month name.</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;/summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;param name = &quot;_number&quot;&gt;</span>number<span class=\"doctag\">&lt;/param&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;returns&gt;</span>month name string<span class=\"doctag\">&lt;/returns&gt;</span></span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> str <span class=\"title\">getMthName</span>(<span class=\"params\"><span class=\"built_in\">int</span> _number</span>)</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        str mth = <span class=\"string\">&#x27;&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">switch</span>(_number)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">1</span>:</span><br><span class=\"line\">                mth = <span class=\"string\">&#x27;@LMS:LMSJan&#x27;</span>;</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">2</span>:</span><br><span class=\"line\">                mth = <span class=\"string\">&#x27;@LMS:LMSFeb&#x27;</span>;</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">3</span>:</span><br><span class=\"line\">                mth = <span class=\"string\">&#x27;@LMS:LMSMar&#x27;</span>;</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">4</span>:</span><br><span class=\"line\">                mth = <span class=\"string\">&#x27;@LMS:LMSApr&#x27;</span>;</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">5</span>:</span><br><span class=\"line\">                mth = <span class=\"string\">&#x27;@LMS:LMSMay&#x27;</span>;</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">6</span>:</span><br><span class=\"line\">                mth = <span class=\"string\">&#x27;@LMS:LMSJun&#x27;</span>;</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">7</span>:</span><br><span class=\"line\">                mth = <span class=\"string\">&#x27;@LMS:LMSJul&#x27;</span>;</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">8</span>:</span><br><span class=\"line\">                mth = <span class=\"string\">&#x27;@LMS:LMSAug&#x27;</span>;</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">9</span>:</span><br><span class=\"line\">                mth = <span class=\"string\">&#x27;@LMS:LMSSep&#x27;</span>;</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">10</span>:</span><br><span class=\"line\">                mth = <span class=\"string\">&#x27;@LMS:LMSOct&#x27;</span>;</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">11</span>:</span><br><span class=\"line\">                mth = <span class=\"string\">&#x27;@LMS:LMSNov&#x27;</span>;</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">12</span>:</span><br><span class=\"line\">                mth = <span class=\"string\">&#x27;@LMS:LMSDec&#x27;</span>;</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        </span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> mth;</span><br><span class=\"line\">    </span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> LMS_SUN-030708_Mid-StatesPullReport</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> Bruce Niu -10/11/2024</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> Generate Supplier</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;/summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;param name = &quot;_con&quot;&gt;</span>container<span class=\"doctag\">&lt;/param&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;param name = &quot;_SupplierWorksheet&quot;&gt;</span>ExcelWorksheet<span class=\"doctag\">&lt;/param&gt;</span></span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">generateSupplier</span>(<span class=\"params\">container _con,  OfficeOpenXml.ExcelWorksheet    _SupplierWorksheet</span>)</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span>         Suppliercells       = _SupplierWorksheet.get_Cells();</span><br><span class=\"line\">        Map         map                 = <span class=\"keyword\">new</span> Map(Types::String, Types::Container);</span><br><span class=\"line\">        <span class=\"built_in\">int</span>         currentColumn       = <span class=\"number\">1</span>;</span><br><span class=\"line\">        container   vendorCon           = conNull();</span><br><span class=\"line\">        InventTable inventtable;</span><br><span class=\"line\"></span><br><span class=\"line\">        OfficeOpenXml.ExcelRange cell = Suppliercells.get_Item(<span class=\"number\">1</span>, <span class=\"number\">1</span>);</span><br><span class=\"line\">        cell.set_Value(<span class=\"string\">&quot;@LMS:LMSItemCategory&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        cell = Suppliercells.get_Item(<span class=\"number\">2</span>, <span class=\"number\">1</span>);</span><br><span class=\"line\">        cell.set_Value(<span class=\"string\">&quot;@LMS:LMSSupplierVendorName&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        cell = Suppliercells.get_Item(<span class=\"number\">3</span>, <span class=\"number\">1</span>);</span><br><span class=\"line\">        cell.set_Value(<span class=\"string\">&quot;@LMS:LMSPaymentTermsDays&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        cell = Suppliercells.get_Item(<span class=\"number\">4</span>, <span class=\"number\">1</span>);</span><br><span class=\"line\">        cell.set_Value(<span class=\"string\">&quot;@LMS:LMSFreightTerms&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        cell = Suppliercells.get_Item(<span class=\"number\">5</span>, <span class=\"number\">1</span>);</span><br><span class=\"line\">        cell.set_Value(<span class=\"string\">&quot;@LMS:LMSFOBOriginPoint&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        cell = Suppliercells.get_Item(<span class=\"number\">6</span>, <span class=\"number\">1</span>);</span><br><span class=\"line\">        cell.set_Value(<span class=\"string\">&quot;@LMS:LMSDelveryMethod&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        cell = Suppliercells.get_Item(<span class=\"number\">7</span>, <span class=\"number\">1</span>);</span><br><span class=\"line\">        cell.set_Value(<span class=\"string\">&quot;@LMS:LMSMinimumOrder&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        cell = Suppliercells.get_Item(<span class=\"number\">8</span>, <span class=\"number\">1</span>);</span><br><span class=\"line\">        cell.set_Value(<span class=\"string\">&quot;@LMS:LMSMinimumOrderAmount&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        cell = Suppliercells.get_Item(<span class=\"number\">9</span>, <span class=\"number\">1</span>);</span><br><span class=\"line\">        cell.set_Value(<span class=\"string\">&quot;@LMS:LMSMidStates&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        cell = Suppliercells.get_Item(<span class=\"number\">10</span>, <span class=\"number\">1</span>);</span><br><span class=\"line\">        cell.set_Value(<span class=\"string\">&quot;@LMS:LMSInitialStoreAllowance&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        cell = Suppliercells.get_Item(<span class=\"number\">11</span>, <span class=\"number\">1</span>);</span><br><span class=\"line\">        cell.set_Value(<span class=\"string\">&quot;@LMS:LMSDefetiveAllowance&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        cell = Suppliercells.get_Item(<span class=\"number\">12</span>, <span class=\"number\">1</span>);</span><br><span class=\"line\">        cell.set_Value(<span class=\"string\">&quot;@LMS:LMSCoopMarketingAllowance&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        cell = Suppliercells.get_Item(<span class=\"number\">13</span>, <span class=\"number\">1</span>);</span><br><span class=\"line\">        cell.set_Value(<span class=\"string\">&quot;@LMS:LMSVolumeRebateAllowance&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        cell = Suppliercells.get_Item(<span class=\"number\">14</span>, <span class=\"number\">1</span>);</span><br><span class=\"line\">        cell.set_Value(<span class=\"string\">&quot;@LMS:LMSOtherDiscounts&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        cell = Suppliercells.get_Item(<span class=\"number\">15</span>, <span class=\"number\">1</span>);</span><br><span class=\"line\">        cell.set_Value(<span class=\"string\">&quot;@LMS:LMSReplacementCost&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        cell = Suppliercells.get_Item(<span class=\"number\">16</span>, <span class=\"number\">1</span>);</span><br><span class=\"line\">        cell.set_Value(<span class=\"string\">&#x27;@LMS:LMSReplacementCostInclude&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        cell = Suppliercells.get_Item(<span class=\"number\">17</span>, <span class=\"number\">1</span>);</span><br><span class=\"line\">        cell.set_Value(<span class=\"string\">&quot;@LMS:LMSComments&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"built_in\">int</span> i = <span class=\"number\">1</span>; i&lt;= conLen(_con); i++)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">select</span> firstonly PrimaryVendorId <span class=\"keyword\">from</span> inventtable</span><br><span class=\"line\">                <span class=\"keyword\">where</span> inventtable.ItemId    == conPeek(_con, i);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span>(inventtable.PrimaryVendorId &amp;&amp; !conFind(vendorCon, inventtable.PrimaryVendorId))</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                vendorCon += inventtable.PrimaryVendorId;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"built_in\">int</span> j = <span class=\"number\">1</span>; j &lt;= conLen(vendorCon); j++)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            currentColumn ++;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span>(currentColumn == <span class=\"number\">2</span>)</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                cell = Suppliercells.get_Item(<span class=\"number\">1</span>, currentColumn);</span><br><span class=\"line\">                cell.set_Value(<span class=\"string\">&quot;@LMS:LMSCurrentSupplier&quot;</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">else</span></span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                cell = Suppliercells.get_Item(<span class=\"number\">1</span>, currentColumn);</span><br><span class=\"line\">                cell.set_Value(strFmt(<span class=\"string\">&quot;@LMS:LMSSupplier&quot;</span>, currentColumn - <span class=\"number\">1</span>));</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            VendTable   vendTable = VendTable::find(conPeek(vendorCon, j));</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span>(vendTable)</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                cell = Suppliercells.get_Item(<span class=\"number\">2</span>, currentColumn);</span><br><span class=\"line\">                cell.set_Value(vendTable.name());</span><br><span class=\"line\"></span><br><span class=\"line\">                cell = Suppliercells.get_Item(<span class=\"number\">3</span>, currentColumn);</span><br><span class=\"line\">                cell.set_Value(<span class=\"keyword\">this</span>.getPaymentTerms(vendTable.CashDisc, vendTable.PaymTermId));</span><br><span class=\"line\"></span><br><span class=\"line\">                cell = Suppliercells.get_Item(<span class=\"number\">4</span>, currentColumn);</span><br><span class=\"line\">                cell.set_Value(<span class=\"keyword\">this</span>.getFreightTerms(vendTable.DlvTerm));</span><br><span class=\"line\"></span><br><span class=\"line\">                cell = Suppliercells.get_Item(<span class=\"number\">5</span>, currentColumn);</span><br><span class=\"line\">                cell.set_Value(<span class=\"keyword\">this</span>.getFOBOriginPoint(vendTable.Party));</span><br><span class=\"line\">                <span class=\"comment\">//6</span></span><br><span class=\"line\">                cell = Suppliercells.get_Item(<span class=\"number\">7</span>, currentColumn);</span><br><span class=\"line\">                cell.set_Value(int2Str(VendTable.LMSMinDollarOrder));</span><br><span class=\"line\"></span><br><span class=\"line\">                cell = Suppliercells.get_Item(<span class=\"number\">8</span>, currentColumn);</span><br><span class=\"line\">                cell.set_Value(int2Str(VendTable.LMSMinUnitFreight) + <span class=\"string\">&quot; &quot;</span> + <span class=\"string\">&quot;@SYS314952&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">                cell = Suppliercells.get_Item(<span class=\"number\">9</span>, currentColumn);</span><br><span class=\"line\">                cell.set_Value(<span class=\"keyword\">this</span>.getautoChargeLine(vendTable.accountnum, <span class=\"string\">&quot;@LMS:LMSCBA&quot;</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"comment\">//10</span></span><br><span class=\"line\"></span><br><span class=\"line\">                cell = Suppliercells.get_Item(<span class=\"number\">11</span>, currentColumn);</span><br><span class=\"line\">                cell.set_Value(<span class=\"keyword\">this</span>.getautoChargeLine(vendTable.accountnum, <span class=\"string\">&quot;@LMS:LMSDefective&quot;</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">                cell = Suppliercells.get_Item(<span class=\"number\">12</span>, currentColumn);</span><br><span class=\"line\">                cell.set_Value(<span class=\"keyword\">this</span>.getautoChargeLine(vendTable.accountnum, <span class=\"string\">&quot;@LMS:LMSCoop&quot;</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"comment\">// 13 14 15 16 17 </span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> LMS_SUN-030708_Mid-StatesPullReport</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> Bruce Niu -10/11/2024</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> Get auto Charge Line</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;/summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;param name = &quot;_account&quot;&gt;</span>Account<span class=\"doctag\">&lt;/param&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;param name = &quot;_markupcode&quot;&gt;</span>markup code<span class=\"doctag\">&lt;/param&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;returns&gt;</span>str<span class=\"doctag\">&lt;/returns&gt;</span></span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> str <span class=\"title\">getautoChargeLine</span>(<span class=\"params\">str _account, str _markupcode</span>)</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        MarkupAutoTable autoTable;</span><br><span class=\"line\">        MarkupAutoLine  autoLine;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">select</span> firstonly Value <span class=\"keyword\">from</span> autoLine</span><br><span class=\"line\">            <span class=\"keyword\">where</span> autoLine.MarkupCode           == _markupcode</span><br><span class=\"line\">            exists <span class=\"keyword\">join</span> autoTable</span><br><span class=\"line\">                <span class=\"keyword\">where</span> autoTable.ModuleType      == MarkupModuleType::Vend</span><br><span class=\"line\">                   &amp;&amp; autoTable.AccountCode     == TableGroupAll::Table</span><br><span class=\"line\">                   &amp;&amp; autoTable.AccountRelation == _account</span><br><span class=\"line\">                   &amp;&amp; autoTable.ModuleCategory  == HeadingLine::Heading</span><br><span class=\"line\">                    &amp;&amp; autoTable.ItemCode       == TableGroupAll::All</span><br><span class=\"line\">                   &amp;&amp; autoTable.RecId           == autoLine.TableRecId</span><br><span class=\"line\">                   &amp;&amp; autoTable.TableId         == autoLine.TableTableId;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span>(autoLine)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> strFmt(<span class=\"string\">&quot;%1 %&quot;</span>, autoLine.Value);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">else</span></span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> LMS_SUN-030708_Mid-StatesPullReport</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> Bruce Niu -10/11/2024</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> Get fob origin point.</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;/summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;param name = &quot;_party&quot;&gt;</span>Int64<span class=\"doctag\">&lt;/param&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;returns&gt;</span>str<span class=\"doctag\">&lt;/returns&gt;</span></span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> str <span class=\"title\">getFOBOriginPoint</span>(<span class=\"params\">Int64 _party</span>)</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        LogisticsPostalAddress  address     = DirParty::primaryPostalAddress(_party);</span><br><span class=\"line\">        str                     originPoint = <span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">        container               con         = conNull();</span><br><span class=\"line\"></span><br><span class=\"line\">        con += address.City;</span><br><span class=\"line\">        con += address.State;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> con2Str(con);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> LMS_SUN-030708_Mid-StatesPullReport</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> Bruce Niu -10/11/2024</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> Get freight terms.</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;/summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;param name = &quot;_dlvTerm&quot;&gt;</span>dlvTerm<span class=\"doctag\">&lt;/param&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;returns&gt;</span>FreightTerms str<span class=\"doctag\">&lt;/returns&gt;</span></span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> str <span class=\"title\">getFreightTerms</span>(<span class=\"params\">str _dlvTerm</span>)</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        container con = [<span class=\"string\">&#x27;@LMS:LMSFFAFOBD&#x27;</span>, <span class=\"string\">&#x27;@LMS:LMSFFAFOBO&#x27;</span>, <span class=\"string\">&#x27;@LMS:LMSPPAFOBD&#x27;</span>, <span class=\"string\">&#x27;@LMS:LMSPPAFOBO&#x27;</span>, <span class=\"string\">&#x27;@LMS:LMSPPDFOBD&#x27;</span>, <span class=\"string\">&#x27;@LMS:LMSPPDFOBO&#x27;</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span>(conFind(con, _dlvTerm))</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"string\">&#x27;Yes&#x27;</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">else</span></span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"string\">&#x27;No&#x27;</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> LMS_SUN-030708_Mid-StatesPullReport</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> Bruce Niu -10/11/2024</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> Get Payment Terms</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;/summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;param name = &quot;_CashDisc&quot;&gt;</span>CashDisc<span class=\"doctag\">&lt;/param&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;param name = &quot;_PaymTermId&quot;&gt;</span>PaymTermId<span class=\"doctag\">&lt;/param&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;returns&gt;</span>str<span class=\"doctag\">&lt;/returns&gt;</span></span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> str <span class=\"title\">getPaymentTerms</span>(<span class=\"params\">str _CashDisc, str _PaymTermId</span>)</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        CashDisc    cd  = CashDisc::find(_CashDisc);</span><br><span class=\"line\">        container   con = conNull();</span><br><span class=\"line\">        PaymTerm    pt  = PaymTerm::find(_PaymTermId);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span>(cd.NumOfDays)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            con += int2Str(cd.NumOfDays);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span>(pt.PaymMethod)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            con += enum2Str(pt.PaymMethod);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span>(pt.NumOfDays)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            con += int2Str(pt.NumOfDays);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span>(conLen(con) &gt; <span class=\"number\">0</span>)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> con2Str(con, <span class=\"string\">&quot; &quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">else</span></span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> LMS_SUN-030708_Mid-StatesPullReport</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> Bruce Niu -10/11/2024</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> Get item id.</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;/summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;param name = &quot;_displayProductNumber&quot;&gt;</span>DisplayProductNumber<span class=\"doctag\">&lt;/param&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;returns&gt;</span>container<span class=\"doctag\">&lt;/returns&gt;</span></span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> container <span class=\"title\">getItemId</span>(<span class=\"params\">LMSSalesHistorySummaryView _summaryView</span>)</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        InventTable             inventtable;</span><br><span class=\"line\">        InventDimCombination    inventDimCombination;</span><br><span class=\"line\">        EcoResProduct           ecoResProduct;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// LMS_SUN-030708_Mid-StatesPullReport add by Ina Wang on 11/11/2024 begin</span></span><br><span class=\"line\">        InventDim               inventDimLoc;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">select</span> firstonly ItemId, InventDimId, RetailVariantId, DistinctProductVariant <span class=\"keyword\">from</span> inventDimCombination</span><br><span class=\"line\">            <span class=\"keyword\">where</span> inventDimCombination.ItemId       == _summaryView.ProductNumber</span><br><span class=\"line\">            exists <span class=\"keyword\">join</span> inventDimLoc</span><br><span class=\"line\">                <span class=\"keyword\">where</span> inventDimLoc.inventDimId      == inventDimCombination.InventDimId</span><br><span class=\"line\">                    &amp;&amp; inventDimLoc.InventColorId   == _summaryView.Color</span><br><span class=\"line\">                    &amp;&amp; inventDimLoc.InventSizeId    == _summaryView.Size;</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">if</span>(inventDimCombination.ItemId)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> [inventDimCombination.ItemId,inventDimCombination.InventDimId, inventDimCombination.productDescription(<span class=\"string\">&quot;en-us&quot;</span>)];</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">else</span></span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">select</span> firstonly ItemId, Product <span class=\"keyword\">from</span> inventtable</span><br><span class=\"line\">                exists <span class=\"keyword\">join</span> ecoResProduct</span><br><span class=\"line\">                    <span class=\"keyword\">where</span> ecoResProduct.RecId                   == inventtable.Product</span><br><span class=\"line\">                       &amp;&amp; ecoResProduct.DisplayProductNumber    == _summaryView.ProductNumber;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">return</span> [inventtable.ItemId, InventDim::inventDimIdBlank(), inventtable.productDescription(<span class=\"string\">&quot;en-us&quot;</span>)];</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// LMS_SUN-030708_Mid-StatesPullReport add by Ina Wang on 11/11/2024 end</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>"},{"title":"How To Call A Form Using X++","comments":1,"date":"2024-12-23T14:23:46.000Z","description":"This article describes the way to Call A Form Using X++","_content":"\n[How To Call A Form Using X++](https://dynamics365musings.com/call-a-form-using-xpp/)","source":"_drafts/xpp-open-onhandlist.md","raw":"---\ntitle: How To Call A Form Using X++\ncomments: true\ndate: 2024-12-23 22:23:46\ntags:\ncategories:\n - X++\ndescription: This article describes the way to Call A Form Using X++\n---\n\n[How To Call A Form Using X++](https://dynamics365musings.com/call-a-form-using-xpp/)","slug":"xpp-open-onhandlist","published":0,"updated":"2025-07-08T12:05:00.509Z","layout":"post","photos":[],"_id":"cmcvxsshi00033cug6gb6fvcu","content":"<p><a href=\"https://dynamics365musings.com/call-a-form-using-xpp/\">How To Call A Form Using X++</a></p>\n","excerpt":"","more":"<p><a href=\"https://dynamics365musings.com/call-a-form-using-xpp/\">How To Call A Form Using X++</a></p>\n"},{"title":"微软【AI-900】考试准备系列博客一","comments":1,"date":"2025-02-24T13:40:09.000Z","description":"本文记录着【AI-900】入门认证考试的学习笔记","_content":"\n## Microsoft Azure 人工智能基础：人工智能概述\n\n### 第一部分\n\n#### 人工智能介绍\n\n人工智能使我们能够构建令人惊叹的软件，这些软件可以改善医疗保健，使人们能够克服身体上的缺点，增强智能基础设施，创造令人难以置信的娱乐体验，甚至拯救地球！\n\n#### 什么是人工智能？\n\n简单地说，人工智能是一种模仿人类行为和能力的软件。主要工作负载包括：\n- **机器学习**：这通常是人工智能系统的基础，也是我们“教”计算机模型做出预测并从数据中得出结论的方式\n- **计算机视觉**：人工智能通过摄像头、视频和图像从视觉上解读世界的能力\n- **自然语言处理**：在人工智能中，计算机能够解释书面或口头语言，并以实物回应\n- **文档智能**：人工智能中的功能，用于管理、处理和使用表单和文档中的大量数据\n- **知识挖掘**：人工智能从大量非结构化数据中提取信息的能力，以创建可搜索的知识存储\n- **生成式人工智能**：人工智能中的功能，可以创建各种格式的原创内容，包括自然语言、图像、代码等\n\n#### 理解机器学习\n\n机器学习是大多数人工智能解决方案的基础。自20世纪50年代以来，研究人员（通常被称为数据科学家）一直在研究人工智能的不同方法。人工智能的大多数现代应用都起源于机器学习，这是人工智能的一个分支，结合了计算机科学和数学。\n\n让我们从一个现实世界的例子开始，看看如何使用机器学习来解决一个难题。\n\n**可持续农业技术**对于最大限度地提高粮食产量，同时保护脆弱的环境至关重要。澳大利亚农业科技公司The Yield利用传感器、数据和机器学习来帮助农民做出与天气、土壤和植物条件相关的明智决策。\n\n#### 机器学习如何工作\n\n那么机器是如何学习的呢？\n\n答案是，从数据中。在当今世界，我们在日常生活中创造了大量的数据。从我们发送的短信、电子邮件和社交媒体帖子，到我们在手机上拍摄的照片和视频，我们产生了大量的信息。在我们的家庭、汽车、城市、公共交通基础设施和工厂中，数以百万计的传感器仍在创造更多的数据。\n\n数据科学家可以使用所有这些数据来训练机器学习模型，这些模型可以根据他们在数据中发现的关系进行预测和推断。\n\n机器学习模型试图捕捉数据之间的关系。例如，假设一个环境保护组织希望志愿者使用手机应用程序识别和分类不同种类的野花。下面的动画展示了如何使用机器学习来实现这一场景。\n\n{% asset_img \"machine-learn.gif\" \"machine learn\" %}\n\n1. 一个由植物学家和科学家组成的团队收集野花样本的数据\n2. 研究小组给样品贴上了正确的物种标签\n3. 使用一种**算法**处理标记的数据，该算法可以找到样本特征与标记物种之间的关系\n4. 算法的结果被封装在一个模型中\n5. 当志愿者发现新的样本时，该模型可以识别正确的物种标签\n\n人工智能的方法已经发展到可以完成更复杂的任务。这些复杂的模型构成了人工智能能力的基础。\n\n#### 在 Microsoft Azure 中的机器学习\n\n微软Azure提供Azure机器学习服务——一个基于云的平台，用于创建、管理和发布机器学习模型。Azure Machine Learning Studio提供多种创作体验，例如：\n\n- 自动化机器学习：该功能使非专家能够从数据中快速创建有效的机器学习模型\n- Azure机器学习设计器：一个图形界面，支持机器学习解决方案的无代码开发\n- 数据度量可视化：用可视化分析和优化您的实验\n- 笔记本：在直接集成在studio中的托管 Jupyter Notebook 服务器中编写和运行自己的代码\n\n### 第二部分\n\n#### 理解计算机视觉\n\n计算机视觉是人工智能的一个领域，处理视觉处理。让我们来探索一下计算机视觉带来的一些可能性。\n\nSeeing AI应用程序是计算机视觉力量的一个很好的例子。这款应用专为盲人和低视力群体设计，利用人工智能的力量打开视觉世界，描述附近的人、文字和物体。\n\n#### 计算机视觉模型和功能\n\n大多数计算机视觉解决方案都是基于机器学习模型的，这些模型可以应用于来自相机、视频或图像的视觉输入。下表描述了常见的计算机视觉任务。\n\n| 任务                 | 描述                                                         |\n| -------------------- | ------------------------------------------------------------ |\n| 图像分类             | 图像分类包括训练机器学习模型根据图像的内容对图像进行分类。例如，在交通监控解决方案中，您可能会使用图像分类模型，根据图像包含的车辆类型（如出租车、公共汽车、骑自行车的人等）对图像进行分类。 |\n| 对象检测             | 训练对象检测机器学习模型对图像中的单个对象进行分类，并使用边界框识别它们的位置。例如，交通监控解决方案可能使用对象检测来识别不同类别车辆的位置。 |\n| 语义分解             | 语义分割是一种先进的机器学习技术，其中图像中的单个像素根据它们所属的对象进行分类。例如，一个交通监控解决方案可能会用“掩模”层覆盖交通图像，用特定的颜色突出显示不同的车辆。 |\n| 图像分析             | 您可以创建将机器学习模型与高级图像分析技术相结合的解决方案，以从图像中提取信息，包括可以帮助对图像进行分类的“标签”，甚至是总结图像中显示的场景的描述性说明。 |\n| 人脸识别，分析和识别 | 人脸检测是物体检测的一种特殊形式，它在图像中定位人脸。这可以与分类和面部几何分析技术相结合，根据面部特征识别个体。 |\n| 光学学符识别（OCR）  | 光学字符识别是一种用于检测和读取图像中的文本的技术。您可以使用OCR读取照片中的文本（例如，道路标志或商店门面），或者从扫描的文档（例如信件、发票或表单）中提取信息。 |\n\n#### 在 Microsoft Azure 中的计算机视觉服务\n\n你可以使用微软的Azure AI Vision来开发计算机视觉解决方案。这些服务特性可以在Azure Vision Studio和其他编程语言中使用和测试。Azure AI Vision的一些功能包括：\n\n- **图像分析**：分析图像和视频，提取描述、标签、对象和文本的功能。\n- **面部**：使您能够构建面部检测和面部识别解决方案的功能。\n- **光学字符识别（OCR）**：从图像中提取打印或手写文本的功能，从而可以访问扫描文本的数字版本。\n\n### 第三部分\n\n#### 理解自然语言处理\n\n自然语言处理（NLP）是人工智能的一个领域，用于创建能够理解书面和口头语言的软件。\n\nNLP使您能够创建以下软件：\n\n- 分析和解释文档、电子邮件和其他来源的文本。\n- 口译口语，并综合言语反应。\n- 自动翻译语言之间的口头或书面短语。\n- 解释命令并决定适当的行动。\n\n例如，《Starship Commander》是一款发生在科幻世界中的虚拟现实（VR）游戏。游戏使用自然语言处理，让玩家能够控制剧情，并与游戏角色和星际飞船系统互动。\n\n#### 在 Microsoft Azure 中的自然语言处理\n\n你可以使用微软的Azure AI语言来构建自然语言处理解决方案。Azure AI Language的一些功能包括理解和分析文本，训练能够理解口语或基于文本的命令的会话语言模型，以及构建智能应用程序。\n\n微软的Azure AI Speech是另一项可用于构建自然语言处理解决方案的服务。Azure AI语音功能包括语音识别和合成、实时翻译、对话转录等。\n\n微软的Azure人工智能翻译器使用神经机器翻译（NMT）模型进行翻译，分析文本的语义上下文，从而提供更准确、更完整的翻译。\n\n您可以在Azure语言工作室中探索Azure AI语言功能，在Azure Language Studio中探索Azure AI语音功能。服务功能可以在工作室和其他编程语言中使用和测试。\n\n#### 理解文档智能和知识挖掘\n\n文档智能是人工智能的一个领域，用于管理、处理和使用在表格和文档中发现的大量各种数据。文档智能使您能够创建能够自动处理合同、健康文件、财务表格等的软件\n\n#### 在 Microsoft Azure 中的文档智能\n\n你可以使用微软的Azure AI文档智能来构建管理和加速扫描文档数据收集的解决方案。Azure AI文档智能的特性有助于自动化应用程序和工作流中的文档处理，增强数据驱动策略，并丰富文档搜索功能。您可以使用预构建的模型为发票、收据、健康保险卡、税务表格等添加智能文档处理。你还可以使用Azure AI Document Intelligence用你自己的标记数据集创建自定义模型。服务特性可以在文档智能工作室和其他编程语言中使用和测试。\n\n{% asset_img \"document-intelligence-studio.png\" \"document intelligence studio\" %}\n\n#### 知识挖掘\n\n知识挖掘是一个术语，用于描述从大量非结构化数据中提取信息以创建可搜索的知识存储的解决方案。\n\n#### 在 Microsoft Azure 中进行知识挖掘\n\n微软的一个知识挖掘解决方案是Azure AI Search，这是一个私有的企业搜索解决方案，拥有构建索引的工具。这些索引可以仅供内部使用，或者在面向公众的互联网资产上启用可搜索的内容。\n\nAzure AI Search可以利用Azure AI服务的内置AI功能，如图像处理、文档智能和自然语言处理来提取数据。该产品的人工智能功能可以索引以前无法搜索的文档，并快速从大量数据中提取和显示见解。\n\n### 第四部分\n\n#### 理解生成式 AI \n\n生成式人工智能描述了人工智能中创造原创内容的一类功能。人们通常与内置在聊天应用程序中的生成式人工智能进行交互。生成式人工智能应用程序接受自然语言输入，并以各种格式（包括自然语言、图像、代码和音频）返回适当的响应。\n\n#### 在 Microsoft Azure 中的生成式 AI\n\n在Microsoft Azure中，您可以使用Azure OpenAI服务来构建生成式AI解决方案。Azure OpenAI服务是微软用于部署、定制和托管生成AI模型的云解决方案。它将OpenAI最先进的模型和api与Azure云平台的安全性和可扩展性结合在一起。\n\nAzure OpenAI支持许多基础模型选择，可以满足不同的需求。这些服务功能可以在Azure AI Foundry上使用和测试，Azure AI Foundry是微软设计企业级AI解决方案的平台。您可以使用Azure AI Foundry门户来管理、开发和自定义生成AI模型。\n\n### 第五部分\n\n#### 人工智能的挑战与风险\n\n人工智能是一个强大的工具，可以用来极大地造福世界。然而，像任何工具一样，必须负责任地使用它。\n\n下表显示了人工智能应用程序开发人员面临的一些潜在挑战和风险。","source":"_posts/ai-900-exam-preparation-1.md","raw":"---\ntitle: 微软【AI-900】考试准备系列博客一\ncomments: true\ndate: 2025-02-24 21:40:09\ncategories:\n - ai\ndescription: 本文记录着【AI-900】入门认证考试的学习笔记\n---\n\n## Microsoft Azure 人工智能基础：人工智能概述\n\n### 第一部分\n\n#### 人工智能介绍\n\n人工智能使我们能够构建令人惊叹的软件，这些软件可以改善医疗保健，使人们能够克服身体上的缺点，增强智能基础设施，创造令人难以置信的娱乐体验，甚至拯救地球！\n\n#### 什么是人工智能？\n\n简单地说，人工智能是一种模仿人类行为和能力的软件。主要工作负载包括：\n- **机器学习**：这通常是人工智能系统的基础，也是我们“教”计算机模型做出预测并从数据中得出结论的方式\n- **计算机视觉**：人工智能通过摄像头、视频和图像从视觉上解读世界的能力\n- **自然语言处理**：在人工智能中，计算机能够解释书面或口头语言，并以实物回应\n- **文档智能**：人工智能中的功能，用于管理、处理和使用表单和文档中的大量数据\n- **知识挖掘**：人工智能从大量非结构化数据中提取信息的能力，以创建可搜索的知识存储\n- **生成式人工智能**：人工智能中的功能，可以创建各种格式的原创内容，包括自然语言、图像、代码等\n\n#### 理解机器学习\n\n机器学习是大多数人工智能解决方案的基础。自20世纪50年代以来，研究人员（通常被称为数据科学家）一直在研究人工智能的不同方法。人工智能的大多数现代应用都起源于机器学习，这是人工智能的一个分支，结合了计算机科学和数学。\n\n让我们从一个现实世界的例子开始，看看如何使用机器学习来解决一个难题。\n\n**可持续农业技术**对于最大限度地提高粮食产量，同时保护脆弱的环境至关重要。澳大利亚农业科技公司The Yield利用传感器、数据和机器学习来帮助农民做出与天气、土壤和植物条件相关的明智决策。\n\n#### 机器学习如何工作\n\n那么机器是如何学习的呢？\n\n答案是，从数据中。在当今世界，我们在日常生活中创造了大量的数据。从我们发送的短信、电子邮件和社交媒体帖子，到我们在手机上拍摄的照片和视频，我们产生了大量的信息。在我们的家庭、汽车、城市、公共交通基础设施和工厂中，数以百万计的传感器仍在创造更多的数据。\n\n数据科学家可以使用所有这些数据来训练机器学习模型，这些模型可以根据他们在数据中发现的关系进行预测和推断。\n\n机器学习模型试图捕捉数据之间的关系。例如，假设一个环境保护组织希望志愿者使用手机应用程序识别和分类不同种类的野花。下面的动画展示了如何使用机器学习来实现这一场景。\n\n{% asset_img \"machine-learn.gif\" \"machine learn\" %}\n\n1. 一个由植物学家和科学家组成的团队收集野花样本的数据\n2. 研究小组给样品贴上了正确的物种标签\n3. 使用一种**算法**处理标记的数据，该算法可以找到样本特征与标记物种之间的关系\n4. 算法的结果被封装在一个模型中\n5. 当志愿者发现新的样本时，该模型可以识别正确的物种标签\n\n人工智能的方法已经发展到可以完成更复杂的任务。这些复杂的模型构成了人工智能能力的基础。\n\n#### 在 Microsoft Azure 中的机器学习\n\n微软Azure提供Azure机器学习服务——一个基于云的平台，用于创建、管理和发布机器学习模型。Azure Machine Learning Studio提供多种创作体验，例如：\n\n- 自动化机器学习：该功能使非专家能够从数据中快速创建有效的机器学习模型\n- Azure机器学习设计器：一个图形界面，支持机器学习解决方案的无代码开发\n- 数据度量可视化：用可视化分析和优化您的实验\n- 笔记本：在直接集成在studio中的托管 Jupyter Notebook 服务器中编写和运行自己的代码\n\n### 第二部分\n\n#### 理解计算机视觉\n\n计算机视觉是人工智能的一个领域，处理视觉处理。让我们来探索一下计算机视觉带来的一些可能性。\n\nSeeing AI应用程序是计算机视觉力量的一个很好的例子。这款应用专为盲人和低视力群体设计，利用人工智能的力量打开视觉世界，描述附近的人、文字和物体。\n\n#### 计算机视觉模型和功能\n\n大多数计算机视觉解决方案都是基于机器学习模型的，这些模型可以应用于来自相机、视频或图像的视觉输入。下表描述了常见的计算机视觉任务。\n\n| 任务                 | 描述                                                         |\n| -------------------- | ------------------------------------------------------------ |\n| 图像分类             | 图像分类包括训练机器学习模型根据图像的内容对图像进行分类。例如，在交通监控解决方案中，您可能会使用图像分类模型，根据图像包含的车辆类型（如出租车、公共汽车、骑自行车的人等）对图像进行分类。 |\n| 对象检测             | 训练对象检测机器学习模型对图像中的单个对象进行分类，并使用边界框识别它们的位置。例如，交通监控解决方案可能使用对象检测来识别不同类别车辆的位置。 |\n| 语义分解             | 语义分割是一种先进的机器学习技术，其中图像中的单个像素根据它们所属的对象进行分类。例如，一个交通监控解决方案可能会用“掩模”层覆盖交通图像，用特定的颜色突出显示不同的车辆。 |\n| 图像分析             | 您可以创建将机器学习模型与高级图像分析技术相结合的解决方案，以从图像中提取信息，包括可以帮助对图像进行分类的“标签”，甚至是总结图像中显示的场景的描述性说明。 |\n| 人脸识别，分析和识别 | 人脸检测是物体检测的一种特殊形式，它在图像中定位人脸。这可以与分类和面部几何分析技术相结合，根据面部特征识别个体。 |\n| 光学学符识别（OCR）  | 光学字符识别是一种用于检测和读取图像中的文本的技术。您可以使用OCR读取照片中的文本（例如，道路标志或商店门面），或者从扫描的文档（例如信件、发票或表单）中提取信息。 |\n\n#### 在 Microsoft Azure 中的计算机视觉服务\n\n你可以使用微软的Azure AI Vision来开发计算机视觉解决方案。这些服务特性可以在Azure Vision Studio和其他编程语言中使用和测试。Azure AI Vision的一些功能包括：\n\n- **图像分析**：分析图像和视频，提取描述、标签、对象和文本的功能。\n- **面部**：使您能够构建面部检测和面部识别解决方案的功能。\n- **光学字符识别（OCR）**：从图像中提取打印或手写文本的功能，从而可以访问扫描文本的数字版本。\n\n### 第三部分\n\n#### 理解自然语言处理\n\n自然语言处理（NLP）是人工智能的一个领域，用于创建能够理解书面和口头语言的软件。\n\nNLP使您能够创建以下软件：\n\n- 分析和解释文档、电子邮件和其他来源的文本。\n- 口译口语，并综合言语反应。\n- 自动翻译语言之间的口头或书面短语。\n- 解释命令并决定适当的行动。\n\n例如，《Starship Commander》是一款发生在科幻世界中的虚拟现实（VR）游戏。游戏使用自然语言处理，让玩家能够控制剧情，并与游戏角色和星际飞船系统互动。\n\n#### 在 Microsoft Azure 中的自然语言处理\n\n你可以使用微软的Azure AI语言来构建自然语言处理解决方案。Azure AI Language的一些功能包括理解和分析文本，训练能够理解口语或基于文本的命令的会话语言模型，以及构建智能应用程序。\n\n微软的Azure AI Speech是另一项可用于构建自然语言处理解决方案的服务。Azure AI语音功能包括语音识别和合成、实时翻译、对话转录等。\n\n微软的Azure人工智能翻译器使用神经机器翻译（NMT）模型进行翻译，分析文本的语义上下文，从而提供更准确、更完整的翻译。\n\n您可以在Azure语言工作室中探索Azure AI语言功能，在Azure Language Studio中探索Azure AI语音功能。服务功能可以在工作室和其他编程语言中使用和测试。\n\n#### 理解文档智能和知识挖掘\n\n文档智能是人工智能的一个领域，用于管理、处理和使用在表格和文档中发现的大量各种数据。文档智能使您能够创建能够自动处理合同、健康文件、财务表格等的软件\n\n#### 在 Microsoft Azure 中的文档智能\n\n你可以使用微软的Azure AI文档智能来构建管理和加速扫描文档数据收集的解决方案。Azure AI文档智能的特性有助于自动化应用程序和工作流中的文档处理，增强数据驱动策略，并丰富文档搜索功能。您可以使用预构建的模型为发票、收据、健康保险卡、税务表格等添加智能文档处理。你还可以使用Azure AI Document Intelligence用你自己的标记数据集创建自定义模型。服务特性可以在文档智能工作室和其他编程语言中使用和测试。\n\n{% asset_img \"document-intelligence-studio.png\" \"document intelligence studio\" %}\n\n#### 知识挖掘\n\n知识挖掘是一个术语，用于描述从大量非结构化数据中提取信息以创建可搜索的知识存储的解决方案。\n\n#### 在 Microsoft Azure 中进行知识挖掘\n\n微软的一个知识挖掘解决方案是Azure AI Search，这是一个私有的企业搜索解决方案，拥有构建索引的工具。这些索引可以仅供内部使用，或者在面向公众的互联网资产上启用可搜索的内容。\n\nAzure AI Search可以利用Azure AI服务的内置AI功能，如图像处理、文档智能和自然语言处理来提取数据。该产品的人工智能功能可以索引以前无法搜索的文档，并快速从大量数据中提取和显示见解。\n\n### 第四部分\n\n#### 理解生成式 AI \n\n生成式人工智能描述了人工智能中创造原创内容的一类功能。人们通常与内置在聊天应用程序中的生成式人工智能进行交互。生成式人工智能应用程序接受自然语言输入，并以各种格式（包括自然语言、图像、代码和音频）返回适当的响应。\n\n#### 在 Microsoft Azure 中的生成式 AI\n\n在Microsoft Azure中，您可以使用Azure OpenAI服务来构建生成式AI解决方案。Azure OpenAI服务是微软用于部署、定制和托管生成AI模型的云解决方案。它将OpenAI最先进的模型和api与Azure云平台的安全性和可扩展性结合在一起。\n\nAzure OpenAI支持许多基础模型选择，可以满足不同的需求。这些服务功能可以在Azure AI Foundry上使用和测试，Azure AI Foundry是微软设计企业级AI解决方案的平台。您可以使用Azure AI Foundry门户来管理、开发和自定义生成AI模型。\n\n### 第五部分\n\n#### 人工智能的挑战与风险\n\n人工智能是一个强大的工具，可以用来极大地造福世界。然而，像任何工具一样，必须负责任地使用它。\n\n下表显示了人工智能应用程序开发人员面临的一些潜在挑战和风险。","slug":"ai-900-exam-preparation-1","published":1,"updated":"2025-07-08T12:05:00.522Z","layout":"post","photos":[],"_id":"cmcvxsshj00053cugbxsce93r","content":"<h2 id=\"Microsoft-Azure-人工智能基础：人工智能概述\"><a href=\"#Microsoft-Azure-人工智能基础：人工智能概述\" class=\"headerlink\" title=\"Microsoft Azure 人工智能基础：人工智能概述\"></a>Microsoft Azure 人工智能基础：人工智能概述</h2><h3 id=\"第一部分\"><a href=\"#第一部分\" class=\"headerlink\" title=\"第一部分\"></a>第一部分</h3><h4 id=\"人工智能介绍\"><a href=\"#人工智能介绍\" class=\"headerlink\" title=\"人工智能介绍\"></a>人工智能介绍</h4><p>人工智能使我们能够构建令人惊叹的软件，这些软件可以改善医疗保健，使人们能够克服身体上的缺点，增强智能基础设施，创造令人难以置信的娱乐体验，甚至拯救地球！</p>\n<h4 id=\"什么是人工智能？\"><a href=\"#什么是人工智能？\" class=\"headerlink\" title=\"什么是人工智能？\"></a>什么是人工智能？</h4><p>简单地说，人工智能是一种模仿人类行为和能力的软件。主要工作负载包括：</p>\n<ul>\n<li><strong>机器学习</strong>：这通常是人工智能系统的基础，也是我们“教”计算机模型做出预测并从数据中得出结论的方式</li>\n<li><strong>计算机视觉</strong>：人工智能通过摄像头、视频和图像从视觉上解读世界的能力</li>\n<li><strong>自然语言处理</strong>：在人工智能中，计算机能够解释书面或口头语言，并以实物回应</li>\n<li><strong>文档智能</strong>：人工智能中的功能，用于管理、处理和使用表单和文档中的大量数据</li>\n<li><strong>知识挖掘</strong>：人工智能从大量非结构化数据中提取信息的能力，以创建可搜索的知识存储</li>\n<li><strong>生成式人工智能</strong>：人工智能中的功能，可以创建各种格式的原创内容，包括自然语言、图像、代码等</li>\n</ul>\n<h4 id=\"理解机器学习\"><a href=\"#理解机器学习\" class=\"headerlink\" title=\"理解机器学习\"></a>理解机器学习</h4><p>机器学习是大多数人工智能解决方案的基础。自20世纪50年代以来，研究人员（通常被称为数据科学家）一直在研究人工智能的不同方法。人工智能的大多数现代应用都起源于机器学习，这是人工智能的一个分支，结合了计算机科学和数学。</p>\n<p>让我们从一个现实世界的例子开始，看看如何使用机器学习来解决一个难题。</p>\n<p><strong>可持续农业技术</strong>对于最大限度地提高粮食产量，同时保护脆弱的环境至关重要。澳大利亚农业科技公司The Yield利用传感器、数据和机器学习来帮助农民做出与天气、土壤和植物条件相关的明智决策。</p>\n<h4 id=\"机器学习如何工作\"><a href=\"#机器学习如何工作\" class=\"headerlink\" title=\"机器学习如何工作\"></a>机器学习如何工作</h4><p>那么机器是如何学习的呢？</p>\n<p>答案是，从数据中。在当今世界，我们在日常生活中创造了大量的数据。从我们发送的短信、电子邮件和社交媒体帖子，到我们在手机上拍摄的照片和视频，我们产生了大量的信息。在我们的家庭、汽车、城市、公共交通基础设施和工厂中，数以百万计的传感器仍在创造更多的数据。</p>\n<p>数据科学家可以使用所有这些数据来训练机器学习模型，这些模型可以根据他们在数据中发现的关系进行预测和推断。</p>\n<p>机器学习模型试图捕捉数据之间的关系。例如，假设一个环境保护组织希望志愿者使用手机应用程序识别和分类不同种类的野花。下面的动画展示了如何使用机器学习来实现这一场景。</p>\n<img src=\"/2025/02/24/ai-900-exam-preparation-1/machine-learn.gif\" class=\"\" title=\"machine learn\">\n\n<ol>\n<li>一个由植物学家和科学家组成的团队收集野花样本的数据</li>\n<li>研究小组给样品贴上了正确的物种标签</li>\n<li>使用一种<strong>算法</strong>处理标记的数据，该算法可以找到样本特征与标记物种之间的关系</li>\n<li>算法的结果被封装在一个模型中</li>\n<li>当志愿者发现新的样本时，该模型可以识别正确的物种标签</li>\n</ol>\n<p>人工智能的方法已经发展到可以完成更复杂的任务。这些复杂的模型构成了人工智能能力的基础。</p>\n<h4 id=\"在-Microsoft-Azure-中的机器学习\"><a href=\"#在-Microsoft-Azure-中的机器学习\" class=\"headerlink\" title=\"在 Microsoft Azure 中的机器学习\"></a>在 Microsoft Azure 中的机器学习</h4><p>微软Azure提供Azure机器学习服务——一个基于云的平台，用于创建、管理和发布机器学习模型。Azure Machine Learning Studio提供多种创作体验，例如：</p>\n<ul>\n<li>自动化机器学习：该功能使非专家能够从数据中快速创建有效的机器学习模型</li>\n<li>Azure机器学习设计器：一个图形界面，支持机器学习解决方案的无代码开发</li>\n<li>数据度量可视化：用可视化分析和优化您的实验</li>\n<li>笔记本：在直接集成在studio中的托管 Jupyter Notebook 服务器中编写和运行自己的代码</li>\n</ul>\n<h3 id=\"第二部分\"><a href=\"#第二部分\" class=\"headerlink\" title=\"第二部分\"></a>第二部分</h3><h4 id=\"理解计算机视觉\"><a href=\"#理解计算机视觉\" class=\"headerlink\" title=\"理解计算机视觉\"></a>理解计算机视觉</h4><p>计算机视觉是人工智能的一个领域，处理视觉处理。让我们来探索一下计算机视觉带来的一些可能性。</p>\n<p>Seeing AI应用程序是计算机视觉力量的一个很好的例子。这款应用专为盲人和低视力群体设计，利用人工智能的力量打开视觉世界，描述附近的人、文字和物体。</p>\n<h4 id=\"计算机视觉模型和功能\"><a href=\"#计算机视觉模型和功能\" class=\"headerlink\" title=\"计算机视觉模型和功能\"></a>计算机视觉模型和功能</h4><p>大多数计算机视觉解决方案都是基于机器学习模型的，这些模型可以应用于来自相机、视频或图像的视觉输入。下表描述了常见的计算机视觉任务。</p>\n<table>\n<thead>\n<tr>\n<th>任务</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>图像分类</td>\n<td>图像分类包括训练机器学习模型根据图像的内容对图像进行分类。例如，在交通监控解决方案中，您可能会使用图像分类模型，根据图像包含的车辆类型（如出租车、公共汽车、骑自行车的人等）对图像进行分类。</td>\n</tr>\n<tr>\n<td>对象检测</td>\n<td>训练对象检测机器学习模型对图像中的单个对象进行分类，并使用边界框识别它们的位置。例如，交通监控解决方案可能使用对象检测来识别不同类别车辆的位置。</td>\n</tr>\n<tr>\n<td>语义分解</td>\n<td>语义分割是一种先进的机器学习技术，其中图像中的单个像素根据它们所属的对象进行分类。例如，一个交通监控解决方案可能会用“掩模”层覆盖交通图像，用特定的颜色突出显示不同的车辆。</td>\n</tr>\n<tr>\n<td>图像分析</td>\n<td>您可以创建将机器学习模型与高级图像分析技术相结合的解决方案，以从图像中提取信息，包括可以帮助对图像进行分类的“标签”，甚至是总结图像中显示的场景的描述性说明。</td>\n</tr>\n<tr>\n<td>人脸识别，分析和识别</td>\n<td>人脸检测是物体检测的一种特殊形式，它在图像中定位人脸。这可以与分类和面部几何分析技术相结合，根据面部特征识别个体。</td>\n</tr>\n<tr>\n<td>光学学符识别（OCR）</td>\n<td>光学字符识别是一种用于检测和读取图像中的文本的技术。您可以使用OCR读取照片中的文本（例如，道路标志或商店门面），或者从扫描的文档（例如信件、发票或表单）中提取信息。</td>\n</tr>\n</tbody></table>\n<h4 id=\"在-Microsoft-Azure-中的计算机视觉服务\"><a href=\"#在-Microsoft-Azure-中的计算机视觉服务\" class=\"headerlink\" title=\"在 Microsoft Azure 中的计算机视觉服务\"></a>在 Microsoft Azure 中的计算机视觉服务</h4><p>你可以使用微软的Azure AI Vision来开发计算机视觉解决方案。这些服务特性可以在Azure Vision Studio和其他编程语言中使用和测试。Azure AI Vision的一些功能包括：</p>\n<ul>\n<li><strong>图像分析</strong>：分析图像和视频，提取描述、标签、对象和文本的功能。</li>\n<li><strong>面部</strong>：使您能够构建面部检测和面部识别解决方案的功能。</li>\n<li><strong>光学字符识别（OCR）</strong>：从图像中提取打印或手写文本的功能，从而可以访问扫描文本的数字版本。</li>\n</ul>\n<h3 id=\"第三部分\"><a href=\"#第三部分\" class=\"headerlink\" title=\"第三部分\"></a>第三部分</h3><h4 id=\"理解自然语言处理\"><a href=\"#理解自然语言处理\" class=\"headerlink\" title=\"理解自然语言处理\"></a>理解自然语言处理</h4><p>自然语言处理（NLP）是人工智能的一个领域，用于创建能够理解书面和口头语言的软件。</p>\n<p>NLP使您能够创建以下软件：</p>\n<ul>\n<li>分析和解释文档、电子邮件和其他来源的文本。</li>\n<li>口译口语，并综合言语反应。</li>\n<li>自动翻译语言之间的口头或书面短语。</li>\n<li>解释命令并决定适当的行动。</li>\n</ul>\n<p>例如，《Starship Commander》是一款发生在科幻世界中的虚拟现实（VR）游戏。游戏使用自然语言处理，让玩家能够控制剧情，并与游戏角色和星际飞船系统互动。</p>\n<h4 id=\"在-Microsoft-Azure-中的自然语言处理\"><a href=\"#在-Microsoft-Azure-中的自然语言处理\" class=\"headerlink\" title=\"在 Microsoft Azure 中的自然语言处理\"></a>在 Microsoft Azure 中的自然语言处理</h4><p>你可以使用微软的Azure AI语言来构建自然语言处理解决方案。Azure AI Language的一些功能包括理解和分析文本，训练能够理解口语或基于文本的命令的会话语言模型，以及构建智能应用程序。</p>\n<p>微软的Azure AI Speech是另一项可用于构建自然语言处理解决方案的服务。Azure AI语音功能包括语音识别和合成、实时翻译、对话转录等。</p>\n<p>微软的Azure人工智能翻译器使用神经机器翻译（NMT）模型进行翻译，分析文本的语义上下文，从而提供更准确、更完整的翻译。</p>\n<p>您可以在Azure语言工作室中探索Azure AI语言功能，在Azure Language Studio中探索Azure AI语音功能。服务功能可以在工作室和其他编程语言中使用和测试。</p>\n<h4 id=\"理解文档智能和知识挖掘\"><a href=\"#理解文档智能和知识挖掘\" class=\"headerlink\" title=\"理解文档智能和知识挖掘\"></a>理解文档智能和知识挖掘</h4><p>文档智能是人工智能的一个领域，用于管理、处理和使用在表格和文档中发现的大量各种数据。文档智能使您能够创建能够自动处理合同、健康文件、财务表格等的软件</p>\n<h4 id=\"在-Microsoft-Azure-中的文档智能\"><a href=\"#在-Microsoft-Azure-中的文档智能\" class=\"headerlink\" title=\"在 Microsoft Azure 中的文档智能\"></a>在 Microsoft Azure 中的文档智能</h4><p>你可以使用微软的Azure AI文档智能来构建管理和加速扫描文档数据收集的解决方案。Azure AI文档智能的特性有助于自动化应用程序和工作流中的文档处理，增强数据驱动策略，并丰富文档搜索功能。您可以使用预构建的模型为发票、收据、健康保险卡、税务表格等添加智能文档处理。你还可以使用Azure AI Document Intelligence用你自己的标记数据集创建自定义模型。服务特性可以在文档智能工作室和其他编程语言中使用和测试。</p>\n<img src=\"/2025/02/24/ai-900-exam-preparation-1/document-intelligence-studio.png\" class=\"\" title=\"document intelligence studio\">\n\n<h4 id=\"知识挖掘\"><a href=\"#知识挖掘\" class=\"headerlink\" title=\"知识挖掘\"></a>知识挖掘</h4><p>知识挖掘是一个术语，用于描述从大量非结构化数据中提取信息以创建可搜索的知识存储的解决方案。</p>\n<h4 id=\"在-Microsoft-Azure-中进行知识挖掘\"><a href=\"#在-Microsoft-Azure-中进行知识挖掘\" class=\"headerlink\" title=\"在 Microsoft Azure 中进行知识挖掘\"></a>在 Microsoft Azure 中进行知识挖掘</h4><p>微软的一个知识挖掘解决方案是Azure AI Search，这是一个私有的企业搜索解决方案，拥有构建索引的工具。这些索引可以仅供内部使用，或者在面向公众的互联网资产上启用可搜索的内容。</p>\n<p>Azure AI Search可以利用Azure AI服务的内置AI功能，如图像处理、文档智能和自然语言处理来提取数据。该产品的人工智能功能可以索引以前无法搜索的文档，并快速从大量数据中提取和显示见解。</p>\n<h3 id=\"第四部分\"><a href=\"#第四部分\" class=\"headerlink\" title=\"第四部分\"></a>第四部分</h3><h4 id=\"理解生成式-AI\"><a href=\"#理解生成式-AI\" class=\"headerlink\" title=\"理解生成式 AI\"></a>理解生成式 AI</h4><p>生成式人工智能描述了人工智能中创造原创内容的一类功能。人们通常与内置在聊天应用程序中的生成式人工智能进行交互。生成式人工智能应用程序接受自然语言输入，并以各种格式（包括自然语言、图像、代码和音频）返回适当的响应。</p>\n<h4 id=\"在-Microsoft-Azure-中的生成式-AI\"><a href=\"#在-Microsoft-Azure-中的生成式-AI\" class=\"headerlink\" title=\"在 Microsoft Azure 中的生成式 AI\"></a>在 Microsoft Azure 中的生成式 AI</h4><p>在Microsoft Azure中，您可以使用Azure OpenAI服务来构建生成式AI解决方案。Azure OpenAI服务是微软用于部署、定制和托管生成AI模型的云解决方案。它将OpenAI最先进的模型和api与Azure云平台的安全性和可扩展性结合在一起。</p>\n<p>Azure OpenAI支持许多基础模型选择，可以满足不同的需求。这些服务功能可以在Azure AI Foundry上使用和测试，Azure AI Foundry是微软设计企业级AI解决方案的平台。您可以使用Azure AI Foundry门户来管理、开发和自定义生成AI模型。</p>\n<h3 id=\"第五部分\"><a href=\"#第五部分\" class=\"headerlink\" title=\"第五部分\"></a>第五部分</h3><h4 id=\"人工智能的挑战与风险\"><a href=\"#人工智能的挑战与风险\" class=\"headerlink\" title=\"人工智能的挑战与风险\"></a>人工智能的挑战与风险</h4><p>人工智能是一个强大的工具，可以用来极大地造福世界。然而，像任何工具一样，必须负责任地使用它。</p>\n<p>下表显示了人工智能应用程序开发人员面临的一些潜在挑战和风险。</p>\n","excerpt":"","more":"<h2 id=\"Microsoft-Azure-人工智能基础：人工智能概述\"><a href=\"#Microsoft-Azure-人工智能基础：人工智能概述\" class=\"headerlink\" title=\"Microsoft Azure 人工智能基础：人工智能概述\"></a>Microsoft Azure 人工智能基础：人工智能概述</h2><h3 id=\"第一部分\"><a href=\"#第一部分\" class=\"headerlink\" title=\"第一部分\"></a>第一部分</h3><h4 id=\"人工智能介绍\"><a href=\"#人工智能介绍\" class=\"headerlink\" title=\"人工智能介绍\"></a>人工智能介绍</h4><p>人工智能使我们能够构建令人惊叹的软件，这些软件可以改善医疗保健，使人们能够克服身体上的缺点，增强智能基础设施，创造令人难以置信的娱乐体验，甚至拯救地球！</p>\n<h4 id=\"什么是人工智能？\"><a href=\"#什么是人工智能？\" class=\"headerlink\" title=\"什么是人工智能？\"></a>什么是人工智能？</h4><p>简单地说，人工智能是一种模仿人类行为和能力的软件。主要工作负载包括：</p>\n<ul>\n<li><strong>机器学习</strong>：这通常是人工智能系统的基础，也是我们“教”计算机模型做出预测并从数据中得出结论的方式</li>\n<li><strong>计算机视觉</strong>：人工智能通过摄像头、视频和图像从视觉上解读世界的能力</li>\n<li><strong>自然语言处理</strong>：在人工智能中，计算机能够解释书面或口头语言，并以实物回应</li>\n<li><strong>文档智能</strong>：人工智能中的功能，用于管理、处理和使用表单和文档中的大量数据</li>\n<li><strong>知识挖掘</strong>：人工智能从大量非结构化数据中提取信息的能力，以创建可搜索的知识存储</li>\n<li><strong>生成式人工智能</strong>：人工智能中的功能，可以创建各种格式的原创内容，包括自然语言、图像、代码等</li>\n</ul>\n<h4 id=\"理解机器学习\"><a href=\"#理解机器学习\" class=\"headerlink\" title=\"理解机器学习\"></a>理解机器学习</h4><p>机器学习是大多数人工智能解决方案的基础。自20世纪50年代以来，研究人员（通常被称为数据科学家）一直在研究人工智能的不同方法。人工智能的大多数现代应用都起源于机器学习，这是人工智能的一个分支，结合了计算机科学和数学。</p>\n<p>让我们从一个现实世界的例子开始，看看如何使用机器学习来解决一个难题。</p>\n<p><strong>可持续农业技术</strong>对于最大限度地提高粮食产量，同时保护脆弱的环境至关重要。澳大利亚农业科技公司The Yield利用传感器、数据和机器学习来帮助农民做出与天气、土壤和植物条件相关的明智决策。</p>\n<h4 id=\"机器学习如何工作\"><a href=\"#机器学习如何工作\" class=\"headerlink\" title=\"机器学习如何工作\"></a>机器学习如何工作</h4><p>那么机器是如何学习的呢？</p>\n<p>答案是，从数据中。在当今世界，我们在日常生活中创造了大量的数据。从我们发送的短信、电子邮件和社交媒体帖子，到我们在手机上拍摄的照片和视频，我们产生了大量的信息。在我们的家庭、汽车、城市、公共交通基础设施和工厂中，数以百万计的传感器仍在创造更多的数据。</p>\n<p>数据科学家可以使用所有这些数据来训练机器学习模型，这些模型可以根据他们在数据中发现的关系进行预测和推断。</p>\n<p>机器学习模型试图捕捉数据之间的关系。例如，假设一个环境保护组织希望志愿者使用手机应用程序识别和分类不同种类的野花。下面的动画展示了如何使用机器学习来实现这一场景。</p>\n<img src=\"/2025/02/24/ai-900-exam-preparation-1/machine-learn.gif\" class=\"\" title=\"machine learn\">\n\n<ol>\n<li>一个由植物学家和科学家组成的团队收集野花样本的数据</li>\n<li>研究小组给样品贴上了正确的物种标签</li>\n<li>使用一种<strong>算法</strong>处理标记的数据，该算法可以找到样本特征与标记物种之间的关系</li>\n<li>算法的结果被封装在一个模型中</li>\n<li>当志愿者发现新的样本时，该模型可以识别正确的物种标签</li>\n</ol>\n<p>人工智能的方法已经发展到可以完成更复杂的任务。这些复杂的模型构成了人工智能能力的基础。</p>\n<h4 id=\"在-Microsoft-Azure-中的机器学习\"><a href=\"#在-Microsoft-Azure-中的机器学习\" class=\"headerlink\" title=\"在 Microsoft Azure 中的机器学习\"></a>在 Microsoft Azure 中的机器学习</h4><p>微软Azure提供Azure机器学习服务——一个基于云的平台，用于创建、管理和发布机器学习模型。Azure Machine Learning Studio提供多种创作体验，例如：</p>\n<ul>\n<li>自动化机器学习：该功能使非专家能够从数据中快速创建有效的机器学习模型</li>\n<li>Azure机器学习设计器：一个图形界面，支持机器学习解决方案的无代码开发</li>\n<li>数据度量可视化：用可视化分析和优化您的实验</li>\n<li>笔记本：在直接集成在studio中的托管 Jupyter Notebook 服务器中编写和运行自己的代码</li>\n</ul>\n<h3 id=\"第二部分\"><a href=\"#第二部分\" class=\"headerlink\" title=\"第二部分\"></a>第二部分</h3><h4 id=\"理解计算机视觉\"><a href=\"#理解计算机视觉\" class=\"headerlink\" title=\"理解计算机视觉\"></a>理解计算机视觉</h4><p>计算机视觉是人工智能的一个领域，处理视觉处理。让我们来探索一下计算机视觉带来的一些可能性。</p>\n<p>Seeing AI应用程序是计算机视觉力量的一个很好的例子。这款应用专为盲人和低视力群体设计，利用人工智能的力量打开视觉世界，描述附近的人、文字和物体。</p>\n<h4 id=\"计算机视觉模型和功能\"><a href=\"#计算机视觉模型和功能\" class=\"headerlink\" title=\"计算机视觉模型和功能\"></a>计算机视觉模型和功能</h4><p>大多数计算机视觉解决方案都是基于机器学习模型的，这些模型可以应用于来自相机、视频或图像的视觉输入。下表描述了常见的计算机视觉任务。</p>\n<table>\n<thead>\n<tr>\n<th>任务</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>图像分类</td>\n<td>图像分类包括训练机器学习模型根据图像的内容对图像进行分类。例如，在交通监控解决方案中，您可能会使用图像分类模型，根据图像包含的车辆类型（如出租车、公共汽车、骑自行车的人等）对图像进行分类。</td>\n</tr>\n<tr>\n<td>对象检测</td>\n<td>训练对象检测机器学习模型对图像中的单个对象进行分类，并使用边界框识别它们的位置。例如，交通监控解决方案可能使用对象检测来识别不同类别车辆的位置。</td>\n</tr>\n<tr>\n<td>语义分解</td>\n<td>语义分割是一种先进的机器学习技术，其中图像中的单个像素根据它们所属的对象进行分类。例如，一个交通监控解决方案可能会用“掩模”层覆盖交通图像，用特定的颜色突出显示不同的车辆。</td>\n</tr>\n<tr>\n<td>图像分析</td>\n<td>您可以创建将机器学习模型与高级图像分析技术相结合的解决方案，以从图像中提取信息，包括可以帮助对图像进行分类的“标签”，甚至是总结图像中显示的场景的描述性说明。</td>\n</tr>\n<tr>\n<td>人脸识别，分析和识别</td>\n<td>人脸检测是物体检测的一种特殊形式，它在图像中定位人脸。这可以与分类和面部几何分析技术相结合，根据面部特征识别个体。</td>\n</tr>\n<tr>\n<td>光学学符识别（OCR）</td>\n<td>光学字符识别是一种用于检测和读取图像中的文本的技术。您可以使用OCR读取照片中的文本（例如，道路标志或商店门面），或者从扫描的文档（例如信件、发票或表单）中提取信息。</td>\n</tr>\n</tbody></table>\n<h4 id=\"在-Microsoft-Azure-中的计算机视觉服务\"><a href=\"#在-Microsoft-Azure-中的计算机视觉服务\" class=\"headerlink\" title=\"在 Microsoft Azure 中的计算机视觉服务\"></a>在 Microsoft Azure 中的计算机视觉服务</h4><p>你可以使用微软的Azure AI Vision来开发计算机视觉解决方案。这些服务特性可以在Azure Vision Studio和其他编程语言中使用和测试。Azure AI Vision的一些功能包括：</p>\n<ul>\n<li><strong>图像分析</strong>：分析图像和视频，提取描述、标签、对象和文本的功能。</li>\n<li><strong>面部</strong>：使您能够构建面部检测和面部识别解决方案的功能。</li>\n<li><strong>光学字符识别（OCR）</strong>：从图像中提取打印或手写文本的功能，从而可以访问扫描文本的数字版本。</li>\n</ul>\n<h3 id=\"第三部分\"><a href=\"#第三部分\" class=\"headerlink\" title=\"第三部分\"></a>第三部分</h3><h4 id=\"理解自然语言处理\"><a href=\"#理解自然语言处理\" class=\"headerlink\" title=\"理解自然语言处理\"></a>理解自然语言处理</h4><p>自然语言处理（NLP）是人工智能的一个领域，用于创建能够理解书面和口头语言的软件。</p>\n<p>NLP使您能够创建以下软件：</p>\n<ul>\n<li>分析和解释文档、电子邮件和其他来源的文本。</li>\n<li>口译口语，并综合言语反应。</li>\n<li>自动翻译语言之间的口头或书面短语。</li>\n<li>解释命令并决定适当的行动。</li>\n</ul>\n<p>例如，《Starship Commander》是一款发生在科幻世界中的虚拟现实（VR）游戏。游戏使用自然语言处理，让玩家能够控制剧情，并与游戏角色和星际飞船系统互动。</p>\n<h4 id=\"在-Microsoft-Azure-中的自然语言处理\"><a href=\"#在-Microsoft-Azure-中的自然语言处理\" class=\"headerlink\" title=\"在 Microsoft Azure 中的自然语言处理\"></a>在 Microsoft Azure 中的自然语言处理</h4><p>你可以使用微软的Azure AI语言来构建自然语言处理解决方案。Azure AI Language的一些功能包括理解和分析文本，训练能够理解口语或基于文本的命令的会话语言模型，以及构建智能应用程序。</p>\n<p>微软的Azure AI Speech是另一项可用于构建自然语言处理解决方案的服务。Azure AI语音功能包括语音识别和合成、实时翻译、对话转录等。</p>\n<p>微软的Azure人工智能翻译器使用神经机器翻译（NMT）模型进行翻译，分析文本的语义上下文，从而提供更准确、更完整的翻译。</p>\n<p>您可以在Azure语言工作室中探索Azure AI语言功能，在Azure Language Studio中探索Azure AI语音功能。服务功能可以在工作室和其他编程语言中使用和测试。</p>\n<h4 id=\"理解文档智能和知识挖掘\"><a href=\"#理解文档智能和知识挖掘\" class=\"headerlink\" title=\"理解文档智能和知识挖掘\"></a>理解文档智能和知识挖掘</h4><p>文档智能是人工智能的一个领域，用于管理、处理和使用在表格和文档中发现的大量各种数据。文档智能使您能够创建能够自动处理合同、健康文件、财务表格等的软件</p>\n<h4 id=\"在-Microsoft-Azure-中的文档智能\"><a href=\"#在-Microsoft-Azure-中的文档智能\" class=\"headerlink\" title=\"在 Microsoft Azure 中的文档智能\"></a>在 Microsoft Azure 中的文档智能</h4><p>你可以使用微软的Azure AI文档智能来构建管理和加速扫描文档数据收集的解决方案。Azure AI文档智能的特性有助于自动化应用程序和工作流中的文档处理，增强数据驱动策略，并丰富文档搜索功能。您可以使用预构建的模型为发票、收据、健康保险卡、税务表格等添加智能文档处理。你还可以使用Azure AI Document Intelligence用你自己的标记数据集创建自定义模型。服务特性可以在文档智能工作室和其他编程语言中使用和测试。</p>\n<img src=\"/2025/02/24/ai-900-exam-preparation-1/document-intelligence-studio.png\" class=\"\" title=\"document intelligence studio\">\n\n<h4 id=\"知识挖掘\"><a href=\"#知识挖掘\" class=\"headerlink\" title=\"知识挖掘\"></a>知识挖掘</h4><p>知识挖掘是一个术语，用于描述从大量非结构化数据中提取信息以创建可搜索的知识存储的解决方案。</p>\n<h4 id=\"在-Microsoft-Azure-中进行知识挖掘\"><a href=\"#在-Microsoft-Azure-中进行知识挖掘\" class=\"headerlink\" title=\"在 Microsoft Azure 中进行知识挖掘\"></a>在 Microsoft Azure 中进行知识挖掘</h4><p>微软的一个知识挖掘解决方案是Azure AI Search，这是一个私有的企业搜索解决方案，拥有构建索引的工具。这些索引可以仅供内部使用，或者在面向公众的互联网资产上启用可搜索的内容。</p>\n<p>Azure AI Search可以利用Azure AI服务的内置AI功能，如图像处理、文档智能和自然语言处理来提取数据。该产品的人工智能功能可以索引以前无法搜索的文档，并快速从大量数据中提取和显示见解。</p>\n<h3 id=\"第四部分\"><a href=\"#第四部分\" class=\"headerlink\" title=\"第四部分\"></a>第四部分</h3><h4 id=\"理解生成式-AI\"><a href=\"#理解生成式-AI\" class=\"headerlink\" title=\"理解生成式 AI\"></a>理解生成式 AI</h4><p>生成式人工智能描述了人工智能中创造原创内容的一类功能。人们通常与内置在聊天应用程序中的生成式人工智能进行交互。生成式人工智能应用程序接受自然语言输入，并以各种格式（包括自然语言、图像、代码和音频）返回适当的响应。</p>\n<h4 id=\"在-Microsoft-Azure-中的生成式-AI\"><a href=\"#在-Microsoft-Azure-中的生成式-AI\" class=\"headerlink\" title=\"在 Microsoft Azure 中的生成式 AI\"></a>在 Microsoft Azure 中的生成式 AI</h4><p>在Microsoft Azure中，您可以使用Azure OpenAI服务来构建生成式AI解决方案。Azure OpenAI服务是微软用于部署、定制和托管生成AI模型的云解决方案。它将OpenAI最先进的模型和api与Azure云平台的安全性和可扩展性结合在一起。</p>\n<p>Azure OpenAI支持许多基础模型选择，可以满足不同的需求。这些服务功能可以在Azure AI Foundry上使用和测试，Azure AI Foundry是微软设计企业级AI解决方案的平台。您可以使用Azure AI Foundry门户来管理、开发和自定义生成AI模型。</p>\n<h3 id=\"第五部分\"><a href=\"#第五部分\" class=\"headerlink\" title=\"第五部分\"></a>第五部分</h3><h4 id=\"人工智能的挑战与风险\"><a href=\"#人工智能的挑战与风险\" class=\"headerlink\" title=\"人工智能的挑战与风险\"></a>人工智能的挑战与风险</h4><p>人工智能是一个强大的工具，可以用来极大地造福世界。然而，像任何工具一样，必须负责任地使用它。</p>\n<p>下表显示了人工智能应用程序开发人员面临的一些潜在挑战和风险。</p>\n"},{"title":"利用 Microsoft Entra ID 保护 API","comments":1,"date":"2025-03-29T08:05:54.000Z","description":"该文档介绍两种使用Microsoft Entra ID（原Azure AD）保护API的方法：基于JWT的身份验证和基于OpenID Connect的授权。前者通过生成令牌、配置OWIN中间件及角色授权实现API保护，后者详细说明在Azure门户注册应用、配置认证参数，并在ASP.NET中集成OpenID Connect中间件的流程，均包含C#代码示例和关键配置步骤。","_content":"\n# 利用 Microsoft Entra ID 保护 API\n\n> **Microsoft Entra ID** 旧名字是 Azure AD，详细信息请阅读官方文档：[Microsoft Entra ID 微软官方文档]([Microsoft 标识平台文档 - Microsoft identity platform | Microsoft Learn](https://learn.microsoft.com/zh-cn/entra/identity-platform/))\n>\n> **JWT** (JSON Web Token) 为轻量级的认证方案，具体原理请看：[一文读懂 JWT](https://www.ruanyifeng.com/blog/2018/07/json_web_token-tutorial.html)\n>\n> 基于ASP.NET Web API2框架架构，设计并实现了 Microsoft Entra ID 身份认证与 JWT 令牌授权的双重安全机制，形成完整的API接口防护体系，确保服务调用的合法性与数据交互的安全性。\n\n## 基于 JWT 身份验证与授权\n\n> 本文所有的代码为 C#，但方法是通用的，可基于不同的平台和语言进行变换。\n\n### 1.安装必要的 Nuget 包\n\n- System.IdentityModel.Tokens.Jwt\n\n- Microsoft.Owin.Security.Jwt\n\n- Microsoft.AspNet.WebApi.Owin\n\n- Microsoft.Owin.Host.SystemWeb\n\n### 2.创建 JWT 生成工具类\n\n```csharp\npublic class JwtManager\n{\n  private static readonly string SecretKey = \"your-secret-key-至少32位长度\"; *//* *实际部署时请替换为安全密钥*\n\n  public static string GenerateToken(string username, string role, int expireMinutes = 60)\n  {\n        var securityKey = new SymmetricSecurityKey(Convert.FromBase64String(SecretKey));\n        var credentials = new SigningCredentials(securityKey, SecurityAlgorithms.HmacSha256);\n        var claims = new[]\n        {\n              new Claim(ClaimTypes.Name, username),\n              new Claim(ClaimTypes.Role, role),\n              new Claim(JwtRegisteredClaimNames.Jti, Guid.NewGuid().ToString())\n        };\n        var token = new JwtSecurityToken(\n            issuer: \"your-api\",\n            audience: \"client-app\",\n            claims: claims,\n            expires: DateTime.UtcNow.AddMinutes(expireMinutes),\n            signingCredentials: credentials\n        );\n        return new JwtSecurityTokenHandler().WriteToken(token);\n  }\n\n}\n```\n\n### 3.配置 OWIN 中间件\n\n```csharp\n[assembly: OwinStartup(typeof(YourNamespace.Startup))]\nnamespace YourNamespace\n{\n    public class Startup\n    {\n        public void Configuration(IAppBuilder app)\n        {\n            // 配置 JWT 验证\n            var jwtOptions = new JwtBearerAuthenticationOptions\n            {\n                AuthenticationMode = AuthenticationMode.Active,\n                TokenValidationParameters = new TokenValidationParameters()\n                {\n                    ValidateIssuer = true,\n                    ValidIssuer = \"your-api\",\n                    ValidateAudience = true,\n                    ValidAudience = \"client-app\",\n                    ValidateIssuerSigningKey = true,\n                    IssuerSigningKey = new SymmetricSecurityKey(\n                        Convert.FromBase64String(JwtManager.SecretKey)),\n                    ValidateLifetime = true\n                }\n            };\n            app.UseJwtBearerAuthentication(jwtOptions);\n            // 初始化 Web API\n            HttpConfiguration config = new HttpConfiguration();\n            WebApiConfig.Register(config);\n            app.UseWebApi(config);\n        }\n    }\n}\n```\n\n### 4.创建登录接口\n\n```csharp\npublic class LoginRequest\n{\n    public string Username { get; set; }\n    public string Password { get; set; }\n}\n\n[RoutePrefix(\"api/auth\")]\npublic class AuthController : ApiController\n{\n    [HttpPost]\n    [Route(\"login\")]\n    [AllowAnonymous]\n    [ResponseType(typeof(string))]\n    public IHttpActionResult Login(LoginRequest request)\n    {\n        // 示例验证逻辑（实际需替换为数据库验证）\n        if (request.Username == \"admin\" && request.Password == \"admin123\")\n        {\n            var token = JwtManager.GenerateToken(request.Username, \"Admin\");\n            return Ok(new { Token = token });\n        }\n\n        return Unauthorized(); // 401 未授权\n    }\n}\n\n```\n\n### 5.保护 API 断点\n\n```csharp\n[RoutePrefix(\"api/protected\")]\n[Authorize] // 整个控制器需要认证\npublic class ProtectedController : ApiController\n{\n    [HttpGet]\n    [Route(\"admin\")]\n    [Authorize(Roles = \"Admin\")] // 仅允许 Admin 角色访问\n    public IHttpActionResult AdminOnly()\n    {\n        var username = User.Identity.Name;\n        return Ok($\"Hello Admin {username}!\");\n    }\n\n    [HttpGet]\n    [Route(\"user\")]\n    public IHttpActionResult AnyAuthenticatedUser()\n    {\n        return Ok($\"Welcome {User.Identity.Name}!\");\n    }\n}\n```\n\n## 基于 Open ID Connecttion 和 Azure AD 的授权\n\n官方文档：[OAuth 2.0 和 OpenID Connect 协议 - Microsoft identity platform | Microsoft Learn](https://learn.microsoft.com/zh-cn/entra/identity-platform/v2-protocols)\n\n### 1.在 Azure Entra Admin Center 创建租户\n\n官方文档：[Quickstart: Call a web API that is protected by the Microsoft identity platform - Microsoft identity platform | Microsoft Learn](https://learn.microsoft.com/zh-cn/entra/identity-platform/quickstart-web-api-aspnet-sign-in?tabs=aspnet-workforce)\n\n1. 登录到 Azure Entra Admin Center；\n   {% asset_img \"image1.png\" \"image1\" %}\n2. 找到左侧的 Identity > Applications > App registrations；\n   {% asset_img \"image2.png\" \"image2\" %}\n3. 点击 New registration；\n   a) 在 Name 输入显示名称；如：Reg_01；\n   b) Supported account types 选择只允许当前组织的账号；\n   c) 重定向 URI 选择 Web 类型，并输入如下三个 uri (以开发环境版本为例):\n   ​              i. http://localhost:8080/\n   ​             ii. http://localhost:8080/signin-oidc\n   ​            iii. http://localhost:8080/signout-callback-oidc\n4. 创建完成后，进入 detail 页面点击 Authentication；\n   a) 将 ID tokens 选中并保存\n   {% asset_img \"image3.png\" \"image3\" %}\n5. 进入 Certificates & Secrets > Client Secrets。创建新的客户端密钥，并复制密钥值；\n   {% asset_img \"image4.png\" \"image4\" %}\n6. 进入 Overview，将 Application ID 与 Tenant ID 复制下来备用;\n   {% asset_img \"image5.png\" \"image5\" %}\n\n### 2.在 ASP.NET使用OpenIdConnectAuthenticationOptions\n\n```csharp\npublic class Startup\n{\n    private string clientId = \" clientId \";\n    private string tenantId = \" tenantId \";\n    private string clientSecret = \" clientSecret \";\n\n    public void Configuration(IAppBuilder app)\n    {      \t app.SetDefaultSignInAsAuthenticationType(CookieAuthenticationDefaults.AuthenticationType);\n        app.UseCookieAuthentication(new CookieAuthenticationOptions {\n            AuthenticationType = CookieAuthenticationDefaults.AuthenticationType,\n            CookieManager = new SystemWebCookieManager(), // 修复 Cookie 管理问题\n            CookieSameSite = SameSiteMode.None,\n            CookieSecure = CookieSecureOption.SameAsRequest,\n            ExpireTimeSpan = TimeSpan.FromMinutes(60)\n        });\n\n            配置 Azure AD OpenID Connect 认证\n        app.UseOpenIdConnectAuthentication(new OpenIdConnectAuthenticationOptions\n        {\n            AuthenticationMode = AuthenticationMode.Active,\n            ClientId = clientId,\n            ClientSecret = clientSecret,\n            Authority = $\"https://login.microsoftonline.com/{tenantId}/v2.0\",\n            RedirectUri = \"http://localhost:60026/signin-oidc\",\n            PostLogoutRedirectUri = \"http://localhost:60026/\",\n            Scope = OpenIdConnectScope.OpenIdProfile + \" email\",\n            ResponseType = OpenIdConnectResponseType.CodeIdToken,\n            TokenValidationParameters = new TokenValidationParameters\n            {\n                ValidateIssuer = true,\n                ValidIssuer = $\"https://sts.windows.net/{tenantId}/\"\n            },                \n            Notifications = new OpenIdConnectAuthenticationNotifications\n            {\n                AuthorizationCodeReceived = async context =>\n                {\n                    try\n                    {\n                        // 1. 获取 Token\n                        var authContext = new AuthenticationContext($\"https://login.microsoftonline.com/{tenantId}\");\n                        var clientCredential = new ClientCredential(clientId, clientSecret);\n                        var result = await authContext.AcquireTokenByAuthorizationCodeAsync(\n                            context.Code,\n                            new Uri(context.RedirectUri),\n                            clientCredential);\n                        System.Diagnostics.Debug.WriteLine($\"Access Token: {result.AccessToken}\");                         \n                        context.AuthenticationTicket.Identity.AddClaim(new Claim(\"access_token\", result.AccessToken));\n                    }\n                    catch (Exception ex)\n                    {\n                        // 记录错误日志\n                        System.Diagnostics.Trace.TraceError($\"Token 获取失败: {ex}\");\n                        context.HandleResponse();\n                        context.Response.Redirect(\"/Error?code=token_failure\");\n                    }                        \n                },\n                AuthenticationFailed = context =>\n                {\n                    System.Diagnostics.Trace.TraceError($\"认证失败: {context.Exception}\");\n                    context.HandleResponse();\n                    context.Response.Redirect(\"/Error?message=\" + context.Exception.Message);\n                    return Task.CompletedTask;\n                }\n            }\n        }); \n        // 初始化 Web API\n        HttpConfiguration config = new HttpConfiguration();\n        WebApiConfig.Register(config);\n        app.UseWebApi(config);\n    }\n}\n```\n1. 上述代码是在启动之前配置并启用 **Azure AD OpenID Connect** 认证服务。\n\n2. 创建登录接口\n\n```csharp\npublic class AccountController : Controller\n{\n    public void Login()\n    {\n        if (!Request.IsAuthenticated)\n        {\n            // 触发 Azure AD 登录\n            HttpContext.GetOwinContext().Authentication.Challenge(\n                new AuthenticationProperties { RedirectUri = \"/\" },\n                OpenIdConnectAuthenticationDefaults.AuthenticationType);\n        }\n    }\n\n    public void Logout()\n    {\n        // 注销本地 Cookie 和 Azure AD 会话\n        HttpContext.GetOwinContext().Authentication.SignOut(\n            CookieAuthenticationDefaults.AuthenticationType,\n            OpenIdConnectAuthenticationDefaults.AuthenticationType);\n    }\n}\n```\n\n## 基于 JWT 与 Azure AD 设置授权\n\n上面两章我们学习了如何使用 JWT 与 Azure AD(**也称 Azure Entra**)；当我们正在开发一个最小 API 服务，并想要使用 JWT 对 API 进行授权时，也需要调用该 API 的客户端拥有特定的权限。\n\n**这就需要组合使用 Azure AD (Azure Entra)** **与 JWT** 。\n\n整个授权的流程图如下：\n{% asset_img \"image6.png\" \"image6\" %}\n\n- 客户端在调用API前首先需要向授权服务器 (Azure Entra) 发出授权认证申请；\n\n- 授权服务器得到申请并验证成功后会返回 access token；\n\n- 客户端在调用API时会带上 access token；\n\n- API 服务接收到请求后，会向授权服务器验证 access token，在验证成功后会响应给客户端。\n\n### 1.启用 JWT\n\n1. 在 startup 配置启用 **JwtBearerAuthenticationOptions**；\n\n```csharp\napiApp.UseJwtBearerAuthentication(new JwtBearerAuthenticationOptions\n{\n    TokenValidationParameters = new TokenValidationParameters\n    {\n        ValidIssuer = $\"https://sts.windows.net/{tenantId}/\",\n        ValidAudience = \"api://\" + clientId,\n        IssuerSigningKeyResolver = (token, securityToken, kid, validationParameters) =>\n        {\n            var metadataAddress = $\"https://login.microsoftonline.com/{tenantId}/.well-known/openid-configuration\";\n            var metadata = new ConfigurationManager<OpenIdConnectConfiguration>(\n                metadataAddress,\n                new OpenIdConnectConfigurationRetriever()\n            ).GetConfigurationAsync().Result;\n            return metadata.SigningKeys;\n        }\n    }\n});\n\n```\n\n2. 使用 [Authorize] 注解标记接口，代表调用它之前需要 JWT 授权；\n\n```csharp\npublic class TestController : ApiController\n{\n    [Authorize] // 要求 JWT 授权\n    [HttpGet]\n    [Route(\"api/test\")]\n    public IHttpActionResult GetData()\n    {\n        return Ok(new { message = \"API 认证成功！\" });\n    }\n}\n```\n\n### 2.配置 Azure AD\n\n#### 2.1 注册客户端应用\n\n**步骤 1**：注册客户端应用\n\n1. 返回 **应用注册** → **新注册**。\n   - **名称**：输入客户端应用名称（例如 MyClientApp）。\n   - **支持的账户类型**：选择 **仅此组织目录中的账户**。\n   - **重定向 URI**：选择 **Web**，输入 http://localhost（本地测试用）。\n   - 点击 **注册**。\n\n**步骤 2**：配置客户端凭据\n\n1. 在客户端应用页面中，进入 **证书和密码** → **客户端密码** → **新建客户端密码**。\n   - **说明**：输入名称（例如 MyClientSecret）。\n   - **过期时间**：选择有效期（例如 6 个月）。\n   - 点击 **添加**。\n2. **复制客户端密码值**：保存此值（稍后无法再查看）。\n\n#### 2.2 注册服务端应用\n\n> **如果还没有服务端的 registration**，可以按照上述的步骤一注册新的应用。\n\n1. 进入 ​**API** **权限** → ​**添加权限** → ​**我的 API**；\n2. 选择之前注册的 API 应用（例如 MyProtectedAPI）；\n3. 选择 ​委托的权限 或 ​应用程序权限；\n4. 委托的权限：用户登录后访问 API（例如 access_as_api）；\n5. 应用程序权限：后台服务直接访问 API（无需用户登录）；\n6. 点击 ​**添加权限**。\n\n#### 2.3 测试\n\n利用 postman 代替客户端进行测试，需要注意以下几点：\n\n1. Client_id 需要填客户端的 application id；\n2. Client_secret 需要填客户端的 secret；\n3. Scope 需要填服务端的 scope。\n\n{% asset_img \"image7.png\" \"image7\" %}\nJavascript 请求示例代码如下：\n\n```csharp\nconst tokenUrl = \n`https://login.microsoftonline.com/${pm.environment.get(\"tenant_id\")}/oauth2/v2.0/token`;\nconst clientId = pm.environment.get(\"client_id\");\nconst clientSecret = pm.environment.get(\"client_secret\");\nconst scope = pm.environment.get(\"api_audience\") + \"/.default\";\n\npm.sendRequest({\n  url: tokenUrl,\n  method: 'POST',\n  header: { 'Content-Type': 'application/x-www-form-urlencoded' },\n  body: {\n    mode: 'urlencoded',\n    urlencoded: [\n      { key: 'client_id', value: clientId },\n      { key: 'client_secret', value: clientSecret },\n      { key: 'scope', value: scope },\n      { key: 'grant_type', value: 'client_credentials' }\n    ]\n  }\n}, (err, res) => {\n  if (!err) {\n    pm.environment.set(\"access_token\", res.json().access_token);\n  }\n});\n\n```\n\n> 获取 token 后，将 token 带入到请求中即可\n>\n> http://localhost:60026/api/test\n>\n> bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6IkpETmFfNGk0cjdGZ2lnTDNzS……\n\n ","source":"_posts/API.md","raw":"---\ntitle: 利用 Microsoft Entra ID 保护 API\ncomments: true\ndate: 2025-03-29 16:05:54\ntags:\ncategories:\n - asp.net\ndescription: 该文档介绍两种使用Microsoft Entra ID（原Azure AD）保护API的方法：基于JWT的身份验证和基于OpenID Connect的授权。前者通过生成令牌、配置OWIN中间件及角色授权实现API保护，后者详细说明在Azure门户注册应用、配置认证参数，并在ASP.NET中集成OpenID Connect中间件的流程，均包含C#代码示例和关键配置步骤。\n---\n\n# 利用 Microsoft Entra ID 保护 API\n\n> **Microsoft Entra ID** 旧名字是 Azure AD，详细信息请阅读官方文档：[Microsoft Entra ID 微软官方文档]([Microsoft 标识平台文档 - Microsoft identity platform | Microsoft Learn](https://learn.microsoft.com/zh-cn/entra/identity-platform/))\n>\n> **JWT** (JSON Web Token) 为轻量级的认证方案，具体原理请看：[一文读懂 JWT](https://www.ruanyifeng.com/blog/2018/07/json_web_token-tutorial.html)\n>\n> 基于ASP.NET Web API2框架架构，设计并实现了 Microsoft Entra ID 身份认证与 JWT 令牌授权的双重安全机制，形成完整的API接口防护体系，确保服务调用的合法性与数据交互的安全性。\n\n## 基于 JWT 身份验证与授权\n\n> 本文所有的代码为 C#，但方法是通用的，可基于不同的平台和语言进行变换。\n\n### 1.安装必要的 Nuget 包\n\n- System.IdentityModel.Tokens.Jwt\n\n- Microsoft.Owin.Security.Jwt\n\n- Microsoft.AspNet.WebApi.Owin\n\n- Microsoft.Owin.Host.SystemWeb\n\n### 2.创建 JWT 生成工具类\n\n```csharp\npublic class JwtManager\n{\n  private static readonly string SecretKey = \"your-secret-key-至少32位长度\"; *//* *实际部署时请替换为安全密钥*\n\n  public static string GenerateToken(string username, string role, int expireMinutes = 60)\n  {\n        var securityKey = new SymmetricSecurityKey(Convert.FromBase64String(SecretKey));\n        var credentials = new SigningCredentials(securityKey, SecurityAlgorithms.HmacSha256);\n        var claims = new[]\n        {\n              new Claim(ClaimTypes.Name, username),\n              new Claim(ClaimTypes.Role, role),\n              new Claim(JwtRegisteredClaimNames.Jti, Guid.NewGuid().ToString())\n        };\n        var token = new JwtSecurityToken(\n            issuer: \"your-api\",\n            audience: \"client-app\",\n            claims: claims,\n            expires: DateTime.UtcNow.AddMinutes(expireMinutes),\n            signingCredentials: credentials\n        );\n        return new JwtSecurityTokenHandler().WriteToken(token);\n  }\n\n}\n```\n\n### 3.配置 OWIN 中间件\n\n```csharp\n[assembly: OwinStartup(typeof(YourNamespace.Startup))]\nnamespace YourNamespace\n{\n    public class Startup\n    {\n        public void Configuration(IAppBuilder app)\n        {\n            // 配置 JWT 验证\n            var jwtOptions = new JwtBearerAuthenticationOptions\n            {\n                AuthenticationMode = AuthenticationMode.Active,\n                TokenValidationParameters = new TokenValidationParameters()\n                {\n                    ValidateIssuer = true,\n                    ValidIssuer = \"your-api\",\n                    ValidateAudience = true,\n                    ValidAudience = \"client-app\",\n                    ValidateIssuerSigningKey = true,\n                    IssuerSigningKey = new SymmetricSecurityKey(\n                        Convert.FromBase64String(JwtManager.SecretKey)),\n                    ValidateLifetime = true\n                }\n            };\n            app.UseJwtBearerAuthentication(jwtOptions);\n            // 初始化 Web API\n            HttpConfiguration config = new HttpConfiguration();\n            WebApiConfig.Register(config);\n            app.UseWebApi(config);\n        }\n    }\n}\n```\n\n### 4.创建登录接口\n\n```csharp\npublic class LoginRequest\n{\n    public string Username { get; set; }\n    public string Password { get; set; }\n}\n\n[RoutePrefix(\"api/auth\")]\npublic class AuthController : ApiController\n{\n    [HttpPost]\n    [Route(\"login\")]\n    [AllowAnonymous]\n    [ResponseType(typeof(string))]\n    public IHttpActionResult Login(LoginRequest request)\n    {\n        // 示例验证逻辑（实际需替换为数据库验证）\n        if (request.Username == \"admin\" && request.Password == \"admin123\")\n        {\n            var token = JwtManager.GenerateToken(request.Username, \"Admin\");\n            return Ok(new { Token = token });\n        }\n\n        return Unauthorized(); // 401 未授权\n    }\n}\n\n```\n\n### 5.保护 API 断点\n\n```csharp\n[RoutePrefix(\"api/protected\")]\n[Authorize] // 整个控制器需要认证\npublic class ProtectedController : ApiController\n{\n    [HttpGet]\n    [Route(\"admin\")]\n    [Authorize(Roles = \"Admin\")] // 仅允许 Admin 角色访问\n    public IHttpActionResult AdminOnly()\n    {\n        var username = User.Identity.Name;\n        return Ok($\"Hello Admin {username}!\");\n    }\n\n    [HttpGet]\n    [Route(\"user\")]\n    public IHttpActionResult AnyAuthenticatedUser()\n    {\n        return Ok($\"Welcome {User.Identity.Name}!\");\n    }\n}\n```\n\n## 基于 Open ID Connecttion 和 Azure AD 的授权\n\n官方文档：[OAuth 2.0 和 OpenID Connect 协议 - Microsoft identity platform | Microsoft Learn](https://learn.microsoft.com/zh-cn/entra/identity-platform/v2-protocols)\n\n### 1.在 Azure Entra Admin Center 创建租户\n\n官方文档：[Quickstart: Call a web API that is protected by the Microsoft identity platform - Microsoft identity platform | Microsoft Learn](https://learn.microsoft.com/zh-cn/entra/identity-platform/quickstart-web-api-aspnet-sign-in?tabs=aspnet-workforce)\n\n1. 登录到 Azure Entra Admin Center；\n   {% asset_img \"image1.png\" \"image1\" %}\n2. 找到左侧的 Identity > Applications > App registrations；\n   {% asset_img \"image2.png\" \"image2\" %}\n3. 点击 New registration；\n   a) 在 Name 输入显示名称；如：Reg_01；\n   b) Supported account types 选择只允许当前组织的账号；\n   c) 重定向 URI 选择 Web 类型，并输入如下三个 uri (以开发环境版本为例):\n   ​              i. http://localhost:8080/\n   ​             ii. http://localhost:8080/signin-oidc\n   ​            iii. http://localhost:8080/signout-callback-oidc\n4. 创建完成后，进入 detail 页面点击 Authentication；\n   a) 将 ID tokens 选中并保存\n   {% asset_img \"image3.png\" \"image3\" %}\n5. 进入 Certificates & Secrets > Client Secrets。创建新的客户端密钥，并复制密钥值；\n   {% asset_img \"image4.png\" \"image4\" %}\n6. 进入 Overview，将 Application ID 与 Tenant ID 复制下来备用;\n   {% asset_img \"image5.png\" \"image5\" %}\n\n### 2.在 ASP.NET使用OpenIdConnectAuthenticationOptions\n\n```csharp\npublic class Startup\n{\n    private string clientId = \" clientId \";\n    private string tenantId = \" tenantId \";\n    private string clientSecret = \" clientSecret \";\n\n    public void Configuration(IAppBuilder app)\n    {      \t app.SetDefaultSignInAsAuthenticationType(CookieAuthenticationDefaults.AuthenticationType);\n        app.UseCookieAuthentication(new CookieAuthenticationOptions {\n            AuthenticationType = CookieAuthenticationDefaults.AuthenticationType,\n            CookieManager = new SystemWebCookieManager(), // 修复 Cookie 管理问题\n            CookieSameSite = SameSiteMode.None,\n            CookieSecure = CookieSecureOption.SameAsRequest,\n            ExpireTimeSpan = TimeSpan.FromMinutes(60)\n        });\n\n            配置 Azure AD OpenID Connect 认证\n        app.UseOpenIdConnectAuthentication(new OpenIdConnectAuthenticationOptions\n        {\n            AuthenticationMode = AuthenticationMode.Active,\n            ClientId = clientId,\n            ClientSecret = clientSecret,\n            Authority = $\"https://login.microsoftonline.com/{tenantId}/v2.0\",\n            RedirectUri = \"http://localhost:60026/signin-oidc\",\n            PostLogoutRedirectUri = \"http://localhost:60026/\",\n            Scope = OpenIdConnectScope.OpenIdProfile + \" email\",\n            ResponseType = OpenIdConnectResponseType.CodeIdToken,\n            TokenValidationParameters = new TokenValidationParameters\n            {\n                ValidateIssuer = true,\n                ValidIssuer = $\"https://sts.windows.net/{tenantId}/\"\n            },                \n            Notifications = new OpenIdConnectAuthenticationNotifications\n            {\n                AuthorizationCodeReceived = async context =>\n                {\n                    try\n                    {\n                        // 1. 获取 Token\n                        var authContext = new AuthenticationContext($\"https://login.microsoftonline.com/{tenantId}\");\n                        var clientCredential = new ClientCredential(clientId, clientSecret);\n                        var result = await authContext.AcquireTokenByAuthorizationCodeAsync(\n                            context.Code,\n                            new Uri(context.RedirectUri),\n                            clientCredential);\n                        System.Diagnostics.Debug.WriteLine($\"Access Token: {result.AccessToken}\");                         \n                        context.AuthenticationTicket.Identity.AddClaim(new Claim(\"access_token\", result.AccessToken));\n                    }\n                    catch (Exception ex)\n                    {\n                        // 记录错误日志\n                        System.Diagnostics.Trace.TraceError($\"Token 获取失败: {ex}\");\n                        context.HandleResponse();\n                        context.Response.Redirect(\"/Error?code=token_failure\");\n                    }                        \n                },\n                AuthenticationFailed = context =>\n                {\n                    System.Diagnostics.Trace.TraceError($\"认证失败: {context.Exception}\");\n                    context.HandleResponse();\n                    context.Response.Redirect(\"/Error?message=\" + context.Exception.Message);\n                    return Task.CompletedTask;\n                }\n            }\n        }); \n        // 初始化 Web API\n        HttpConfiguration config = new HttpConfiguration();\n        WebApiConfig.Register(config);\n        app.UseWebApi(config);\n    }\n}\n```\n1. 上述代码是在启动之前配置并启用 **Azure AD OpenID Connect** 认证服务。\n\n2. 创建登录接口\n\n```csharp\npublic class AccountController : Controller\n{\n    public void Login()\n    {\n        if (!Request.IsAuthenticated)\n        {\n            // 触发 Azure AD 登录\n            HttpContext.GetOwinContext().Authentication.Challenge(\n                new AuthenticationProperties { RedirectUri = \"/\" },\n                OpenIdConnectAuthenticationDefaults.AuthenticationType);\n        }\n    }\n\n    public void Logout()\n    {\n        // 注销本地 Cookie 和 Azure AD 会话\n        HttpContext.GetOwinContext().Authentication.SignOut(\n            CookieAuthenticationDefaults.AuthenticationType,\n            OpenIdConnectAuthenticationDefaults.AuthenticationType);\n    }\n}\n```\n\n## 基于 JWT 与 Azure AD 设置授权\n\n上面两章我们学习了如何使用 JWT 与 Azure AD(**也称 Azure Entra**)；当我们正在开发一个最小 API 服务，并想要使用 JWT 对 API 进行授权时，也需要调用该 API 的客户端拥有特定的权限。\n\n**这就需要组合使用 Azure AD (Azure Entra)** **与 JWT** 。\n\n整个授权的流程图如下：\n{% asset_img \"image6.png\" \"image6\" %}\n\n- 客户端在调用API前首先需要向授权服务器 (Azure Entra) 发出授权认证申请；\n\n- 授权服务器得到申请并验证成功后会返回 access token；\n\n- 客户端在调用API时会带上 access token；\n\n- API 服务接收到请求后，会向授权服务器验证 access token，在验证成功后会响应给客户端。\n\n### 1.启用 JWT\n\n1. 在 startup 配置启用 **JwtBearerAuthenticationOptions**；\n\n```csharp\napiApp.UseJwtBearerAuthentication(new JwtBearerAuthenticationOptions\n{\n    TokenValidationParameters = new TokenValidationParameters\n    {\n        ValidIssuer = $\"https://sts.windows.net/{tenantId}/\",\n        ValidAudience = \"api://\" + clientId,\n        IssuerSigningKeyResolver = (token, securityToken, kid, validationParameters) =>\n        {\n            var metadataAddress = $\"https://login.microsoftonline.com/{tenantId}/.well-known/openid-configuration\";\n            var metadata = new ConfigurationManager<OpenIdConnectConfiguration>(\n                metadataAddress,\n                new OpenIdConnectConfigurationRetriever()\n            ).GetConfigurationAsync().Result;\n            return metadata.SigningKeys;\n        }\n    }\n});\n\n```\n\n2. 使用 [Authorize] 注解标记接口，代表调用它之前需要 JWT 授权；\n\n```csharp\npublic class TestController : ApiController\n{\n    [Authorize] // 要求 JWT 授权\n    [HttpGet]\n    [Route(\"api/test\")]\n    public IHttpActionResult GetData()\n    {\n        return Ok(new { message = \"API 认证成功！\" });\n    }\n}\n```\n\n### 2.配置 Azure AD\n\n#### 2.1 注册客户端应用\n\n**步骤 1**：注册客户端应用\n\n1. 返回 **应用注册** → **新注册**。\n   - **名称**：输入客户端应用名称（例如 MyClientApp）。\n   - **支持的账户类型**：选择 **仅此组织目录中的账户**。\n   - **重定向 URI**：选择 **Web**，输入 http://localhost（本地测试用）。\n   - 点击 **注册**。\n\n**步骤 2**：配置客户端凭据\n\n1. 在客户端应用页面中，进入 **证书和密码** → **客户端密码** → **新建客户端密码**。\n   - **说明**：输入名称（例如 MyClientSecret）。\n   - **过期时间**：选择有效期（例如 6 个月）。\n   - 点击 **添加**。\n2. **复制客户端密码值**：保存此值（稍后无法再查看）。\n\n#### 2.2 注册服务端应用\n\n> **如果还没有服务端的 registration**，可以按照上述的步骤一注册新的应用。\n\n1. 进入 ​**API** **权限** → ​**添加权限** → ​**我的 API**；\n2. 选择之前注册的 API 应用（例如 MyProtectedAPI）；\n3. 选择 ​委托的权限 或 ​应用程序权限；\n4. 委托的权限：用户登录后访问 API（例如 access_as_api）；\n5. 应用程序权限：后台服务直接访问 API（无需用户登录）；\n6. 点击 ​**添加权限**。\n\n#### 2.3 测试\n\n利用 postman 代替客户端进行测试，需要注意以下几点：\n\n1. Client_id 需要填客户端的 application id；\n2. Client_secret 需要填客户端的 secret；\n3. Scope 需要填服务端的 scope。\n\n{% asset_img \"image7.png\" \"image7\" %}\nJavascript 请求示例代码如下：\n\n```csharp\nconst tokenUrl = \n`https://login.microsoftonline.com/${pm.environment.get(\"tenant_id\")}/oauth2/v2.0/token`;\nconst clientId = pm.environment.get(\"client_id\");\nconst clientSecret = pm.environment.get(\"client_secret\");\nconst scope = pm.environment.get(\"api_audience\") + \"/.default\";\n\npm.sendRequest({\n  url: tokenUrl,\n  method: 'POST',\n  header: { 'Content-Type': 'application/x-www-form-urlencoded' },\n  body: {\n    mode: 'urlencoded',\n    urlencoded: [\n      { key: 'client_id', value: clientId },\n      { key: 'client_secret', value: clientSecret },\n      { key: 'scope', value: scope },\n      { key: 'grant_type', value: 'client_credentials' }\n    ]\n  }\n}, (err, res) => {\n  if (!err) {\n    pm.environment.set(\"access_token\", res.json().access_token);\n  }\n});\n\n```\n\n> 获取 token 后，将 token 带入到请求中即可\n>\n> http://localhost:60026/api/test\n>\n> bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6IkpETmFfNGk0cjdGZ2lnTDNzS……\n\n ","slug":"API","published":1,"updated":"2025-07-08T12:05:00.509Z","layout":"post","photos":[],"_id":"cmcvxsshk00063cughrey9k0u","content":"<h1 id=\"利用-Microsoft-Entra-ID-保护-API\"><a href=\"#利用-Microsoft-Entra-ID-保护-API\" class=\"headerlink\" title=\"利用 Microsoft Entra ID 保护 API\"></a>利用 Microsoft Entra ID 保护 API</h1><blockquote>\n<p><strong>Microsoft Entra ID</strong> 旧名字是 Azure AD，详细信息请阅读官方文档：[Microsoft Entra ID 微软官方文档](<a href=\"https://learn.microsoft.com/zh-cn/entra/identity-platform/\">Microsoft 标识平台文档 - Microsoft identity platform | Microsoft Learn</a>)</p>\n<p><strong>JWT</strong> (JSON Web Token) 为轻量级的认证方案，具体原理请看：<a href=\"https://www.ruanyifeng.com/blog/2018/07/json_web_token-tutorial.html\">一文读懂 JWT</a></p>\n<p>基于ASP.NET Web API2框架架构，设计并实现了 Microsoft Entra ID 身份认证与 JWT 令牌授权的双重安全机制，形成完整的API接口防护体系，确保服务调用的合法性与数据交互的安全性。</p>\n</blockquote>\n<h2 id=\"基于-JWT-身份验证与授权\"><a href=\"#基于-JWT-身份验证与授权\" class=\"headerlink\" title=\"基于 JWT 身份验证与授权\"></a>基于 JWT 身份验证与授权</h2><blockquote>\n<p>本文所有的代码为 C#，但方法是通用的，可基于不同的平台和语言进行变换。</p>\n</blockquote>\n<h3 id=\"1-安装必要的-Nuget-包\"><a href=\"#1-安装必要的-Nuget-包\" class=\"headerlink\" title=\"1.安装必要的 Nuget 包\"></a>1.安装必要的 Nuget 包</h3><ul>\n<li><p>System.IdentityModel.Tokens.Jwt</p>\n</li>\n<li><p>Microsoft.Owin.Security.Jwt</p>\n</li>\n<li><p>Microsoft.AspNet.WebApi.Owin</p>\n</li>\n<li><p>Microsoft.Owin.Host.SystemWeb</p>\n</li>\n</ul>\n<h3 id=\"2-创建-JWT-生成工具类\"><a href=\"#2-创建-JWT-生成工具类\" class=\"headerlink\" title=\"2.创建 JWT 生成工具类\"></a>2.创建 JWT 生成工具类</h3><figure class=\"highlight csharp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title\">JwtManager</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">readonly</span> <span class=\"built_in\">string</span> SecretKey = <span class=\"string\">&quot;your-secret-key-至少32位长度&quot;</span>; *<span class=\"comment\">//* *实际部署时请替换为安全密钥*</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"built_in\">string</span> <span class=\"title\">GenerateToken</span>(<span class=\"params\"><span class=\"built_in\">string</span> username, <span class=\"built_in\">string</span> role, <span class=\"built_in\">int</span> expireMinutes = <span class=\"number\">60</span></span>)</span></span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> securityKey = <span class=\"keyword\">new</span> SymmetricSecurityKey(Convert.FromBase64String(SecretKey));</span><br><span class=\"line\">        <span class=\"keyword\">var</span> credentials = <span class=\"keyword\">new</span> SigningCredentials(securityKey, SecurityAlgorithms.HmacSha256);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> claims = <span class=\"keyword\">new</span>[]</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">              <span class=\"keyword\">new</span> Claim(ClaimTypes.Name, username),</span><br><span class=\"line\">              <span class=\"keyword\">new</span> Claim(ClaimTypes.Role, role),</span><br><span class=\"line\">              <span class=\"keyword\">new</span> Claim(JwtRegisteredClaimNames.Jti, Guid.NewGuid().ToString())</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> token = <span class=\"keyword\">new</span> JwtSecurityToken(</span><br><span class=\"line\">            issuer: <span class=\"string\">&quot;your-api&quot;</span>,</span><br><span class=\"line\">            audience: <span class=\"string\">&quot;client-app&quot;</span>,</span><br><span class=\"line\">            claims: claims,</span><br><span class=\"line\">            expires: DateTime.UtcNow.AddMinutes(expireMinutes),</span><br><span class=\"line\">            signingCredentials: credentials</span><br><span class=\"line\">        );</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> JwtSecurityTokenHandler().WriteToken(token);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"3-配置-OWIN-中间件\"><a href=\"#3-配置-OWIN-中间件\" class=\"headerlink\" title=\"3.配置 OWIN 中间件\"></a>3.配置 OWIN 中间件</h3><figure class=\"highlight csharp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[<span class=\"meta\">assembly: OwinStartup(typeof(YourNamespace.Startup))</span>]</span><br><span class=\"line\"><span class=\"keyword\">namespace</span> <span class=\"title\">YourNamespace</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title\">Startup</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">Configuration</span>(<span class=\"params\">IAppBuilder app</span>)</span></span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"comment\">// 配置 JWT 验证</span></span><br><span class=\"line\">            <span class=\"keyword\">var</span> jwtOptions = <span class=\"keyword\">new</span> JwtBearerAuthenticationOptions</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                AuthenticationMode = AuthenticationMode.Active,</span><br><span class=\"line\">                TokenValidationParameters = <span class=\"keyword\">new</span> TokenValidationParameters()</span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    ValidateIssuer = <span class=\"literal\">true</span>,</span><br><span class=\"line\">                    ValidIssuer = <span class=\"string\">&quot;your-api&quot;</span>,</span><br><span class=\"line\">                    ValidateAudience = <span class=\"literal\">true</span>,</span><br><span class=\"line\">                    ValidAudience = <span class=\"string\">&quot;client-app&quot;</span>,</span><br><span class=\"line\">                    ValidateIssuerSigningKey = <span class=\"literal\">true</span>,</span><br><span class=\"line\">                    IssuerSigningKey = <span class=\"keyword\">new</span> SymmetricSecurityKey(</span><br><span class=\"line\">                        Convert.FromBase64String(JwtManager.SecretKey)),</span><br><span class=\"line\">                    ValidateLifetime = <span class=\"literal\">true</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;;</span><br><span class=\"line\">            app.UseJwtBearerAuthentication(jwtOptions);</span><br><span class=\"line\">            <span class=\"comment\">// 初始化 Web API</span></span><br><span class=\"line\">            HttpConfiguration config = <span class=\"keyword\">new</span> HttpConfiguration();</span><br><span class=\"line\">            WebApiConfig.Register(config);</span><br><span class=\"line\">            app.UseWebApi(config);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"4-创建登录接口\"><a href=\"#4-创建登录接口\" class=\"headerlink\" title=\"4.创建登录接口\"></a>4.创建登录接口</h3><figure class=\"highlight csharp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title\">LoginRequest</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"built_in\">string</span> Username &#123; <span class=\"keyword\">get</span>; <span class=\"keyword\">set</span>; &#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"built_in\">string</span> Password &#123; <span class=\"keyword\">get</span>; <span class=\"keyword\">set</span>; &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">[<span class=\"meta\">RoutePrefix(<span class=\"string\">&quot;api/auth&quot;</span>)</span>]</span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title\">AuthController</span> : <span class=\"title\">ApiController</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    [<span class=\"meta\">HttpPost</span>]</span><br><span class=\"line\">    [<span class=\"meta\">Route(<span class=\"string\">&quot;login&quot;</span>)</span>]</span><br><span class=\"line\">    [<span class=\"meta\">AllowAnonymous</span>]</span><br><span class=\"line\">    [<span class=\"meta\">ResponseType(typeof(string))</span>]</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> IHttpActionResult <span class=\"title\">Login</span>(<span class=\"params\">LoginRequest request</span>)</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 示例验证逻辑（实际需替换为数据库验证）</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (request.Username == <span class=\"string\">&quot;admin&quot;</span> &amp;&amp; request.Password == <span class=\"string\">&quot;admin123&quot;</span>)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> token = JwtManager.GenerateToken(request.Username, <span class=\"string\">&quot;Admin&quot;</span>);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> Ok(<span class=\"keyword\">new</span> &#123; Token = token &#125;);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> Unauthorized(); <span class=\"comment\">// 401 未授权</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"5-保护-API-断点\"><a href=\"#5-保护-API-断点\" class=\"headerlink\" title=\"5.保护 API 断点\"></a>5.保护 API 断点</h3><figure class=\"highlight csharp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[<span class=\"meta\">RoutePrefix(<span class=\"string\">&quot;api/protected&quot;</span>)</span>]</span><br><span class=\"line\">[<span class=\"meta\">Authorize</span>] <span class=\"comment\">// 整个控制器需要认证</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title\">ProtectedController</span> : <span class=\"title\">ApiController</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    [<span class=\"meta\">HttpGet</span>]</span><br><span class=\"line\">    [<span class=\"meta\">Route(<span class=\"string\">&quot;admin&quot;</span>)</span>]</span><br><span class=\"line\">    [<span class=\"meta\">Authorize(Roles = <span class=\"string\">&quot;Admin&quot;</span>)</span>] <span class=\"comment\">// 仅允许 Admin 角色访问</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> IHttpActionResult <span class=\"title\">AdminOnly</span>()</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> username = User.Identity.Name;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> Ok(<span class=\"string\">$&quot;Hello Admin <span class=\"subst\">&#123;username&#125;</span>!&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    [<span class=\"meta\">HttpGet</span>]</span><br><span class=\"line\">    [<span class=\"meta\">Route(<span class=\"string\">&quot;user&quot;</span>)</span>]</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> IHttpActionResult <span class=\"title\">AnyAuthenticatedUser</span>()</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> Ok(<span class=\"string\">$&quot;Welcome <span class=\"subst\">&#123;User.Identity.Name&#125;</span>!&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"基于-Open-ID-Connecttion-和-Azure-AD-的授权\"><a href=\"#基于-Open-ID-Connecttion-和-Azure-AD-的授权\" class=\"headerlink\" title=\"基于 Open ID Connecttion 和 Azure AD 的授权\"></a>基于 Open ID Connecttion 和 Azure AD 的授权</h2><p>官方文档：<a href=\"https://learn.microsoft.com/zh-cn/entra/identity-platform/v2-protocols\">OAuth 2.0 和 OpenID Connect 协议 - Microsoft identity platform | Microsoft Learn</a></p>\n<h3 id=\"1-在-Azure-Entra-Admin-Center-创建租户\"><a href=\"#1-在-Azure-Entra-Admin-Center-创建租户\" class=\"headerlink\" title=\"1.在 Azure Entra Admin Center 创建租户\"></a>1.在 Azure Entra Admin Center 创建租户</h3><p>官方文档：<a href=\"https://learn.microsoft.com/zh-cn/entra/identity-platform/quickstart-web-api-aspnet-sign-in?tabs=aspnet-workforce\">Quickstart: Call a web API that is protected by the Microsoft identity platform - Microsoft identity platform | Microsoft Learn</a></p>\n<ol>\n<li>登录到 Azure Entra Admin Center；<img src=\"/2025/03/29/API/image1.png\" class=\"\" title=\"image1\"></li>\n<li>找到左侧的 Identity &gt; Applications &gt; App registrations；<img src=\"/2025/03/29/API/image2.png\" class=\"\" title=\"image2\"></li>\n<li>点击 New registration；<br>a) 在 Name 输入显示名称；如：Reg_01；<br>b) Supported account types 选择只允许当前组织的账号；<br>c) 重定向 URI 选择 Web 类型，并输入如下三个 uri (以开发环境版本为例):<br>​              i. <a href=\"http://localhost:8080/\">http://localhost:8080/</a><br>​             ii. <a href=\"http://localhost:8080/signin-oidc\">http://localhost:8080/signin-oidc</a><br>​            iii. <a href=\"http://localhost:8080/signout-callback-oidc\">http://localhost:8080/signout-callback-oidc</a></li>\n<li>创建完成后，进入 detail 页面点击 Authentication；<br>a) 将 ID tokens 选中并保存<img src=\"/2025/03/29/API/image3.png\" class=\"\" title=\"image3\"></li>\n<li>进入 Certificates &amp; Secrets &gt; Client Secrets。创建新的客户端密钥，并复制密钥值；<img src=\"/2025/03/29/API/image4.png\" class=\"\" title=\"image4\"></li>\n<li>进入 Overview，将 Application ID 与 Tenant ID 复制下来备用;<img src=\"/2025/03/29/API/image5.png\" class=\"\" title=\"image5\"></li>\n</ol>\n<h3 id=\"2-在-ASP-NET使用OpenIdConnectAuthenticationOptions\"><a href=\"#2-在-ASP-NET使用OpenIdConnectAuthenticationOptions\" class=\"headerlink\" title=\"2.在 ASP.NET使用OpenIdConnectAuthenticationOptions\"></a>2.在 ASP.NET使用OpenIdConnectAuthenticationOptions</h3><figure class=\"highlight csharp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title\">Startup</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"built_in\">string</span> clientId = <span class=\"string\">&quot; clientId &quot;</span>;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"built_in\">string</span> tenantId = <span class=\"string\">&quot; tenantId &quot;</span>;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"built_in\">string</span> clientSecret = <span class=\"string\">&quot; clientSecret &quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">Configuration</span>(<span class=\"params\">IAppBuilder app</span>)</span></span><br><span class=\"line\">    &#123;      \t app.SetDefaultSignInAsAuthenticationType(CookieAuthenticationDefaults.AuthenticationType);</span><br><span class=\"line\">        app.UseCookieAuthentication(<span class=\"keyword\">new</span> CookieAuthenticationOptions &#123;</span><br><span class=\"line\">            AuthenticationType = CookieAuthenticationDefaults.AuthenticationType,</span><br><span class=\"line\">            CookieManager = <span class=\"keyword\">new</span> SystemWebCookieManager(), <span class=\"comment\">// 修复 Cookie 管理问题</span></span><br><span class=\"line\">            CookieSameSite = SameSiteMode.None,</span><br><span class=\"line\">            CookieSecure = CookieSecureOption.SameAsRequest,</span><br><span class=\"line\">            ExpireTimeSpan = TimeSpan.FromMinutes(<span class=\"number\">60</span>)</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">            配置 Azure AD OpenID Connect 认证</span><br><span class=\"line\">        app.UseOpenIdConnectAuthentication(<span class=\"keyword\">new</span> OpenIdConnectAuthenticationOptions</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            AuthenticationMode = AuthenticationMode.Active,</span><br><span class=\"line\">            ClientId = clientId,</span><br><span class=\"line\">            ClientSecret = clientSecret,</span><br><span class=\"line\">            Authority = <span class=\"string\">$&quot;https://login.microsoftonline.com/<span class=\"subst\">&#123;tenantId&#125;</span>/v2.0&quot;</span>,</span><br><span class=\"line\">            RedirectUri = <span class=\"string\">&quot;http://localhost:60026/signin-oidc&quot;</span>,</span><br><span class=\"line\">            PostLogoutRedirectUri = <span class=\"string\">&quot;http://localhost:60026/&quot;</span>,</span><br><span class=\"line\">            Scope = OpenIdConnectScope.OpenIdProfile + <span class=\"string\">&quot; email&quot;</span>,</span><br><span class=\"line\">            ResponseType = OpenIdConnectResponseType.CodeIdToken,</span><br><span class=\"line\">            TokenValidationParameters = <span class=\"keyword\">new</span> TokenValidationParameters</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                ValidateIssuer = <span class=\"literal\">true</span>,</span><br><span class=\"line\">                ValidIssuer = <span class=\"string\">$&quot;https://sts.windows.net/<span class=\"subst\">&#123;tenantId&#125;</span>/&quot;</span></span><br><span class=\"line\">            &#125;,                </span><br><span class=\"line\">            Notifications = <span class=\"keyword\">new</span> OpenIdConnectAuthenticationNotifications</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                AuthorizationCodeReceived = <span class=\"keyword\">async</span> context =&gt;</span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">try</span></span><br><span class=\"line\">                    &#123;</span><br><span class=\"line\">                        <span class=\"comment\">// 1. 获取 Token</span></span><br><span class=\"line\">                        <span class=\"keyword\">var</span> authContext = <span class=\"keyword\">new</span> AuthenticationContext(<span class=\"string\">$&quot;https://login.microsoftonline.com/<span class=\"subst\">&#123;tenantId&#125;</span>&quot;</span>);</span><br><span class=\"line\">                        <span class=\"keyword\">var</span> clientCredential = <span class=\"keyword\">new</span> ClientCredential(clientId, clientSecret);</span><br><span class=\"line\">                        <span class=\"keyword\">var</span> result = <span class=\"keyword\">await</span> authContext.AcquireTokenByAuthorizationCodeAsync(</span><br><span class=\"line\">                            context.Code,</span><br><span class=\"line\">                            <span class=\"keyword\">new</span> Uri(context.RedirectUri),</span><br><span class=\"line\">                            clientCredential);</span><br><span class=\"line\">                        System.Diagnostics.Debug.WriteLine(<span class=\"string\">$&quot;Access Token: <span class=\"subst\">&#123;result.AccessToken&#125;</span>&quot;</span>);                         </span><br><span class=\"line\">                        context.AuthenticationTicket.Identity.AddClaim(<span class=\"keyword\">new</span> Claim(<span class=\"string\">&quot;access_token&quot;</span>, result.AccessToken));</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                    <span class=\"keyword\">catch</span> (Exception ex)</span><br><span class=\"line\">                    &#123;</span><br><span class=\"line\">                        <span class=\"comment\">// 记录错误日志</span></span><br><span class=\"line\">                        System.Diagnostics.Trace.TraceError(<span class=\"string\">$&quot;Token 获取失败: <span class=\"subst\">&#123;ex&#125;</span>&quot;</span>);</span><br><span class=\"line\">                        context.HandleResponse();</span><br><span class=\"line\">                        context.Response.Redirect(<span class=\"string\">&quot;/Error?code=token_failure&quot;</span>);</span><br><span class=\"line\">                    &#125;                        </span><br><span class=\"line\">                &#125;,</span><br><span class=\"line\">                AuthenticationFailed = context =&gt;</span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    System.Diagnostics.Trace.TraceError(<span class=\"string\">$&quot;认证失败: <span class=\"subst\">&#123;context.Exception&#125;</span>&quot;</span>);</span><br><span class=\"line\">                    context.HandleResponse();</span><br><span class=\"line\">                    context.Response.Redirect(<span class=\"string\">&quot;/Error?message=&quot;</span> + context.Exception.Message);</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> Task.CompletedTask;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;); </span><br><span class=\"line\">        <span class=\"comment\">// 初始化 Web API</span></span><br><span class=\"line\">        HttpConfiguration config = <span class=\"keyword\">new</span> HttpConfiguration();</span><br><span class=\"line\">        WebApiConfig.Register(config);</span><br><span class=\"line\">        app.UseWebApi(config);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ol>\n<li><p>上述代码是在启动之前配置并启用 <strong>Azure AD OpenID Connect</strong> 认证服务。</p>\n</li>\n<li><p>创建登录接口</p>\n</li>\n</ol>\n<figure class=\"highlight csharp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title\">AccountController</span> : <span class=\"title\">Controller</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">Login</span>()</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!Request.IsAuthenticated)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"comment\">// 触发 Azure AD 登录</span></span><br><span class=\"line\">            HttpContext.GetOwinContext().Authentication.Challenge(</span><br><span class=\"line\">                <span class=\"keyword\">new</span> AuthenticationProperties &#123; RedirectUri = <span class=\"string\">&quot;/&quot;</span> &#125;,</span><br><span class=\"line\">                OpenIdConnectAuthenticationDefaults.AuthenticationType);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">Logout</span>()</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 注销本地 Cookie 和 Azure AD 会话</span></span><br><span class=\"line\">        HttpContext.GetOwinContext().Authentication.SignOut(</span><br><span class=\"line\">            CookieAuthenticationDefaults.AuthenticationType,</span><br><span class=\"line\">            OpenIdConnectAuthenticationDefaults.AuthenticationType);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"基于-JWT-与-Azure-AD-设置授权\"><a href=\"#基于-JWT-与-Azure-AD-设置授权\" class=\"headerlink\" title=\"基于 JWT 与 Azure AD 设置授权\"></a>基于 JWT 与 Azure AD 设置授权</h2><p>上面两章我们学习了如何使用 JWT 与 Azure AD(<strong>也称 Azure Entra</strong>)；当我们正在开发一个最小 API 服务，并想要使用 JWT 对 API 进行授权时，也需要调用该 API 的客户端拥有特定的权限。</p>\n<p><strong>这就需要组合使用 Azure AD (Azure Entra)</strong> <strong>与 JWT</strong> 。</p>\n<p>整个授权的流程图如下：</p>\n<img src=\"/2025/03/29/API/image6.png\" class=\"\" title=\"image6\">\n\n<ul>\n<li><p>客户端在调用API前首先需要向授权服务器 (Azure Entra) 发出授权认证申请；</p>\n</li>\n<li><p>授权服务器得到申请并验证成功后会返回 access token；</p>\n</li>\n<li><p>客户端在调用API时会带上 access token；</p>\n</li>\n<li><p>API 服务接收到请求后，会向授权服务器验证 access token，在验证成功后会响应给客户端。</p>\n</li>\n</ul>\n<h3 id=\"1-启用-JWT\"><a href=\"#1-启用-JWT\" class=\"headerlink\" title=\"1.启用 JWT\"></a>1.启用 JWT</h3><ol>\n<li>在 startup 配置启用 <strong>JwtBearerAuthenticationOptions</strong>；</li>\n</ol>\n<figure class=\"highlight csharp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apiApp.UseJwtBearerAuthentication(<span class=\"keyword\">new</span> JwtBearerAuthenticationOptions</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    TokenValidationParameters = <span class=\"keyword\">new</span> TokenValidationParameters</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        ValidIssuer = <span class=\"string\">$&quot;https://sts.windows.net/<span class=\"subst\">&#123;tenantId&#125;</span>/&quot;</span>,</span><br><span class=\"line\">        ValidAudience = <span class=\"string\">&quot;api://&quot;</span> + clientId,</span><br><span class=\"line\">        IssuerSigningKeyResolver = (token, securityToken, kid, validationParameters) =&gt;</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> metadataAddress = <span class=\"string\">$&quot;https://login.microsoftonline.com/<span class=\"subst\">&#123;tenantId&#125;</span>/.well-known/openid-configuration&quot;</span>;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> metadata = <span class=\"keyword\">new</span> ConfigurationManager&lt;OpenIdConnectConfiguration&gt;(</span><br><span class=\"line\">                metadataAddress,</span><br><span class=\"line\">                <span class=\"keyword\">new</span> OpenIdConnectConfigurationRetriever()</span><br><span class=\"line\">            ).GetConfigurationAsync().Result;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> metadata.SigningKeys;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>使用 [Authorize] 注解标记接口，代表调用它之前需要 JWT 授权；</li>\n</ol>\n<figure class=\"highlight csharp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title\">TestController</span> : <span class=\"title\">ApiController</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    [<span class=\"meta\">Authorize</span>] <span class=\"comment\">// 要求 JWT 授权</span></span><br><span class=\"line\">    [<span class=\"meta\">HttpGet</span>]</span><br><span class=\"line\">    [<span class=\"meta\">Route(<span class=\"string\">&quot;api/test&quot;</span>)</span>]</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> IHttpActionResult <span class=\"title\">GetData</span>()</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> Ok(<span class=\"keyword\">new</span> &#123; message = <span class=\"string\">&quot;API 认证成功！&quot;</span> &#125;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-配置-Azure-AD\"><a href=\"#2-配置-Azure-AD\" class=\"headerlink\" title=\"2.配置 Azure AD\"></a>2.配置 Azure AD</h3><h4 id=\"2-1-注册客户端应用\"><a href=\"#2-1-注册客户端应用\" class=\"headerlink\" title=\"2.1 注册客户端应用\"></a>2.1 注册客户端应用</h4><p><strong>步骤 1</strong>：注册客户端应用</p>\n<ol>\n<li>返回 <strong>应用注册</strong> → <strong>新注册</strong>。<ul>\n<li><strong>名称</strong>：输入客户端应用名称（例如 MyClientApp）。</li>\n<li><strong>支持的账户类型</strong>：选择 <strong>仅此组织目录中的账户</strong>。</li>\n<li><strong>重定向 URI</strong>：选择 <strong>Web</strong>，输入 <a href=\"http://localhost(本地测试用)./\">http://localhost（本地测试用）。</a></li>\n<li>点击 <strong>注册</strong>。</li>\n</ul>\n</li>\n</ol>\n<p><strong>步骤 2</strong>：配置客户端凭据</p>\n<ol>\n<li>在客户端应用页面中，进入 <strong>证书和密码</strong> → <strong>客户端密码</strong> → <strong>新建客户端密码</strong>。<ul>\n<li><strong>说明</strong>：输入名称（例如 MyClientSecret）。</li>\n<li><strong>过期时间</strong>：选择有效期（例如 6 个月）。</li>\n<li>点击 <strong>添加</strong>。</li>\n</ul>\n</li>\n<li><strong>复制客户端密码值</strong>：保存此值（稍后无法再查看）。</li>\n</ol>\n<h4 id=\"2-2-注册服务端应用\"><a href=\"#2-2-注册服务端应用\" class=\"headerlink\" title=\"2.2 注册服务端应用\"></a>2.2 注册服务端应用</h4><blockquote>\n<p><strong>如果还没有服务端的 registration</strong>，可以按照上述的步骤一注册新的应用。</p>\n</blockquote>\n<ol>\n<li>进入 ​<strong>API</strong> <strong>权限</strong> → ​<strong>添加权限</strong> → ​<strong>我的 API</strong>；</li>\n<li>选择之前注册的 API 应用（例如 MyProtectedAPI）；</li>\n<li>选择 ​委托的权限 或 ​应用程序权限；</li>\n<li>委托的权限：用户登录后访问 API（例如 access_as_api）；</li>\n<li>应用程序权限：后台服务直接访问 API（无需用户登录）；</li>\n<li>点击 ​<strong>添加权限</strong>。</li>\n</ol>\n<h4 id=\"2-3-测试\"><a href=\"#2-3-测试\" class=\"headerlink\" title=\"2.3 测试\"></a>2.3 测试</h4><p>利用 postman 代替客户端进行测试，需要注意以下几点：</p>\n<ol>\n<li>Client_id 需要填客户端的 application id；</li>\n<li>Client_secret 需要填客户端的 secret；</li>\n<li>Scope 需要填服务端的 scope。</li>\n</ol>\n<img src=\"/2025/03/29/API/image7.png\" class=\"\" title=\"image7\">\n<p>Javascript 请求示例代码如下：</p>\n<figure class=\"highlight csharp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> tokenUrl = </span><br><span class=\"line\">`https:<span class=\"comment\">//login.microsoftonline.com/$&#123;pm.environment.get(&quot;tenant_id&quot;)&#125;/oauth2/v2.0/token`;</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> clientId = pm.environment.<span class=\"keyword\">get</span>(<span class=\"string\">&quot;client_id&quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> clientSecret = pm.environment.<span class=\"keyword\">get</span>(<span class=\"string\">&quot;client_secret&quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> scope = pm.environment.<span class=\"keyword\">get</span>(<span class=\"string\">&quot;api_audience&quot;</span>) + <span class=\"string\">&quot;/.default&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">pm.sendRequest(&#123;</span><br><span class=\"line\">  url: tokenUrl,</span><br><span class=\"line\">  method: <span class=\"string\">&#x27;POST&#x27;</span>,</span><br><span class=\"line\">  header: &#123; <span class=\"string\">&#x27;Content-Type&#x27;</span>: <span class=\"string\">&#x27;application/x-www-form-urlencoded&#x27;</span> &#125;,</span><br><span class=\"line\">  body: &#123;</span><br><span class=\"line\">    mode: <span class=\"string\">&#x27;urlencoded&#x27;</span>,</span><br><span class=\"line\">    urlencoded: [</span><br><span class=\"line\">      &#123; key: <span class=\"string\">&#x27;client_id&#x27;</span>, <span class=\"keyword\">value</span>: clientId &#125;,</span><br><span class=\"line\">      &#123; key: <span class=\"string\">&#x27;client_secret&#x27;</span>, <span class=\"keyword\">value</span>: clientSecret &#125;,</span><br><span class=\"line\">      &#123; key: <span class=\"string\">&#x27;scope&#x27;</span>, <span class=\"keyword\">value</span>: scope &#125;,</span><br><span class=\"line\">      &#123; key: <span class=\"string\">&#x27;grant_type&#x27;</span>, <span class=\"keyword\">value</span>: <span class=\"string\">&#x27;client_credentials&#x27;</span> &#125;</span><br><span class=\"line\">    ]</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;, (err, res) =&gt; &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!err) &#123;</span><br><span class=\"line\">    pm.environment.<span class=\"keyword\">set</span>(<span class=\"string\">&quot;access_token&quot;</span>, res.json().access_token);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>获取 token 后，将 token 带入到请求中即可</p>\n<p><a href=\"http://localhost:60026/api/test\">http://localhost:60026/api/test</a></p>\n<p>bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6IkpETmFfNGk0cjdGZ2lnTDNzS……</p>\n</blockquote>\n","excerpt":"","more":"<h1 id=\"利用-Microsoft-Entra-ID-保护-API\"><a href=\"#利用-Microsoft-Entra-ID-保护-API\" class=\"headerlink\" title=\"利用 Microsoft Entra ID 保护 API\"></a>利用 Microsoft Entra ID 保护 API</h1><blockquote>\n<p><strong>Microsoft Entra ID</strong> 旧名字是 Azure AD，详细信息请阅读官方文档：[Microsoft Entra ID 微软官方文档](<a href=\"https://learn.microsoft.com/zh-cn/entra/identity-platform/\">Microsoft 标识平台文档 - Microsoft identity platform | Microsoft Learn</a>)</p>\n<p><strong>JWT</strong> (JSON Web Token) 为轻量级的认证方案，具体原理请看：<a href=\"https://www.ruanyifeng.com/blog/2018/07/json_web_token-tutorial.html\">一文读懂 JWT</a></p>\n<p>基于ASP.NET Web API2框架架构，设计并实现了 Microsoft Entra ID 身份认证与 JWT 令牌授权的双重安全机制，形成完整的API接口防护体系，确保服务调用的合法性与数据交互的安全性。</p>\n</blockquote>\n<h2 id=\"基于-JWT-身份验证与授权\"><a href=\"#基于-JWT-身份验证与授权\" class=\"headerlink\" title=\"基于 JWT 身份验证与授权\"></a>基于 JWT 身份验证与授权</h2><blockquote>\n<p>本文所有的代码为 C#，但方法是通用的，可基于不同的平台和语言进行变换。</p>\n</blockquote>\n<h3 id=\"1-安装必要的-Nuget-包\"><a href=\"#1-安装必要的-Nuget-包\" class=\"headerlink\" title=\"1.安装必要的 Nuget 包\"></a>1.安装必要的 Nuget 包</h3><ul>\n<li><p>System.IdentityModel.Tokens.Jwt</p>\n</li>\n<li><p>Microsoft.Owin.Security.Jwt</p>\n</li>\n<li><p>Microsoft.AspNet.WebApi.Owin</p>\n</li>\n<li><p>Microsoft.Owin.Host.SystemWeb</p>\n</li>\n</ul>\n<h3 id=\"2-创建-JWT-生成工具类\"><a href=\"#2-创建-JWT-生成工具类\" class=\"headerlink\" title=\"2.创建 JWT 生成工具类\"></a>2.创建 JWT 生成工具类</h3><figure class=\"highlight csharp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title\">JwtManager</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">readonly</span> <span class=\"built_in\">string</span> SecretKey = <span class=\"string\">&quot;your-secret-key-至少32位长度&quot;</span>; *<span class=\"comment\">//* *实际部署时请替换为安全密钥*</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"built_in\">string</span> <span class=\"title\">GenerateToken</span>(<span class=\"params\"><span class=\"built_in\">string</span> username, <span class=\"built_in\">string</span> role, <span class=\"built_in\">int</span> expireMinutes = <span class=\"number\">60</span></span>)</span></span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> securityKey = <span class=\"keyword\">new</span> SymmetricSecurityKey(Convert.FromBase64String(SecretKey));</span><br><span class=\"line\">        <span class=\"keyword\">var</span> credentials = <span class=\"keyword\">new</span> SigningCredentials(securityKey, SecurityAlgorithms.HmacSha256);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> claims = <span class=\"keyword\">new</span>[]</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">              <span class=\"keyword\">new</span> Claim(ClaimTypes.Name, username),</span><br><span class=\"line\">              <span class=\"keyword\">new</span> Claim(ClaimTypes.Role, role),</span><br><span class=\"line\">              <span class=\"keyword\">new</span> Claim(JwtRegisteredClaimNames.Jti, Guid.NewGuid().ToString())</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> token = <span class=\"keyword\">new</span> JwtSecurityToken(</span><br><span class=\"line\">            issuer: <span class=\"string\">&quot;your-api&quot;</span>,</span><br><span class=\"line\">            audience: <span class=\"string\">&quot;client-app&quot;</span>,</span><br><span class=\"line\">            claims: claims,</span><br><span class=\"line\">            expires: DateTime.UtcNow.AddMinutes(expireMinutes),</span><br><span class=\"line\">            signingCredentials: credentials</span><br><span class=\"line\">        );</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> JwtSecurityTokenHandler().WriteToken(token);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"3-配置-OWIN-中间件\"><a href=\"#3-配置-OWIN-中间件\" class=\"headerlink\" title=\"3.配置 OWIN 中间件\"></a>3.配置 OWIN 中间件</h3><figure class=\"highlight csharp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[<span class=\"meta\">assembly: OwinStartup(typeof(YourNamespace.Startup))</span>]</span><br><span class=\"line\"><span class=\"keyword\">namespace</span> <span class=\"title\">YourNamespace</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title\">Startup</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">Configuration</span>(<span class=\"params\">IAppBuilder app</span>)</span></span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"comment\">// 配置 JWT 验证</span></span><br><span class=\"line\">            <span class=\"keyword\">var</span> jwtOptions = <span class=\"keyword\">new</span> JwtBearerAuthenticationOptions</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                AuthenticationMode = AuthenticationMode.Active,</span><br><span class=\"line\">                TokenValidationParameters = <span class=\"keyword\">new</span> TokenValidationParameters()</span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    ValidateIssuer = <span class=\"literal\">true</span>,</span><br><span class=\"line\">                    ValidIssuer = <span class=\"string\">&quot;your-api&quot;</span>,</span><br><span class=\"line\">                    ValidateAudience = <span class=\"literal\">true</span>,</span><br><span class=\"line\">                    ValidAudience = <span class=\"string\">&quot;client-app&quot;</span>,</span><br><span class=\"line\">                    ValidateIssuerSigningKey = <span class=\"literal\">true</span>,</span><br><span class=\"line\">                    IssuerSigningKey = <span class=\"keyword\">new</span> SymmetricSecurityKey(</span><br><span class=\"line\">                        Convert.FromBase64String(JwtManager.SecretKey)),</span><br><span class=\"line\">                    ValidateLifetime = <span class=\"literal\">true</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;;</span><br><span class=\"line\">            app.UseJwtBearerAuthentication(jwtOptions);</span><br><span class=\"line\">            <span class=\"comment\">// 初始化 Web API</span></span><br><span class=\"line\">            HttpConfiguration config = <span class=\"keyword\">new</span> HttpConfiguration();</span><br><span class=\"line\">            WebApiConfig.Register(config);</span><br><span class=\"line\">            app.UseWebApi(config);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"4-创建登录接口\"><a href=\"#4-创建登录接口\" class=\"headerlink\" title=\"4.创建登录接口\"></a>4.创建登录接口</h3><figure class=\"highlight csharp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title\">LoginRequest</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"built_in\">string</span> Username &#123; <span class=\"keyword\">get</span>; <span class=\"keyword\">set</span>; &#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"built_in\">string</span> Password &#123; <span class=\"keyword\">get</span>; <span class=\"keyword\">set</span>; &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">[<span class=\"meta\">RoutePrefix(<span class=\"string\">&quot;api/auth&quot;</span>)</span>]</span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title\">AuthController</span> : <span class=\"title\">ApiController</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    [<span class=\"meta\">HttpPost</span>]</span><br><span class=\"line\">    [<span class=\"meta\">Route(<span class=\"string\">&quot;login&quot;</span>)</span>]</span><br><span class=\"line\">    [<span class=\"meta\">AllowAnonymous</span>]</span><br><span class=\"line\">    [<span class=\"meta\">ResponseType(typeof(string))</span>]</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> IHttpActionResult <span class=\"title\">Login</span>(<span class=\"params\">LoginRequest request</span>)</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 示例验证逻辑（实际需替换为数据库验证）</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (request.Username == <span class=\"string\">&quot;admin&quot;</span> &amp;&amp; request.Password == <span class=\"string\">&quot;admin123&quot;</span>)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> token = JwtManager.GenerateToken(request.Username, <span class=\"string\">&quot;Admin&quot;</span>);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> Ok(<span class=\"keyword\">new</span> &#123; Token = token &#125;);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> Unauthorized(); <span class=\"comment\">// 401 未授权</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"5-保护-API-断点\"><a href=\"#5-保护-API-断点\" class=\"headerlink\" title=\"5.保护 API 断点\"></a>5.保护 API 断点</h3><figure class=\"highlight csharp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[<span class=\"meta\">RoutePrefix(<span class=\"string\">&quot;api/protected&quot;</span>)</span>]</span><br><span class=\"line\">[<span class=\"meta\">Authorize</span>] <span class=\"comment\">// 整个控制器需要认证</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title\">ProtectedController</span> : <span class=\"title\">ApiController</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    [<span class=\"meta\">HttpGet</span>]</span><br><span class=\"line\">    [<span class=\"meta\">Route(<span class=\"string\">&quot;admin&quot;</span>)</span>]</span><br><span class=\"line\">    [<span class=\"meta\">Authorize(Roles = <span class=\"string\">&quot;Admin&quot;</span>)</span>] <span class=\"comment\">// 仅允许 Admin 角色访问</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> IHttpActionResult <span class=\"title\">AdminOnly</span>()</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> username = User.Identity.Name;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> Ok(<span class=\"string\">$&quot;Hello Admin <span class=\"subst\">&#123;username&#125;</span>!&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    [<span class=\"meta\">HttpGet</span>]</span><br><span class=\"line\">    [<span class=\"meta\">Route(<span class=\"string\">&quot;user&quot;</span>)</span>]</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> IHttpActionResult <span class=\"title\">AnyAuthenticatedUser</span>()</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> Ok(<span class=\"string\">$&quot;Welcome <span class=\"subst\">&#123;User.Identity.Name&#125;</span>!&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"基于-Open-ID-Connecttion-和-Azure-AD-的授权\"><a href=\"#基于-Open-ID-Connecttion-和-Azure-AD-的授权\" class=\"headerlink\" title=\"基于 Open ID Connecttion 和 Azure AD 的授权\"></a>基于 Open ID Connecttion 和 Azure AD 的授权</h2><p>官方文档：<a href=\"https://learn.microsoft.com/zh-cn/entra/identity-platform/v2-protocols\">OAuth 2.0 和 OpenID Connect 协议 - Microsoft identity platform | Microsoft Learn</a></p>\n<h3 id=\"1-在-Azure-Entra-Admin-Center-创建租户\"><a href=\"#1-在-Azure-Entra-Admin-Center-创建租户\" class=\"headerlink\" title=\"1.在 Azure Entra Admin Center 创建租户\"></a>1.在 Azure Entra Admin Center 创建租户</h3><p>官方文档：<a href=\"https://learn.microsoft.com/zh-cn/entra/identity-platform/quickstart-web-api-aspnet-sign-in?tabs=aspnet-workforce\">Quickstart: Call a web API that is protected by the Microsoft identity platform - Microsoft identity platform | Microsoft Learn</a></p>\n<ol>\n<li>登录到 Azure Entra Admin Center；<img src=\"/2025/03/29/API/image1.png\" class=\"\" title=\"image1\"></li>\n<li>找到左侧的 Identity &gt; Applications &gt; App registrations；<img src=\"/2025/03/29/API/image2.png\" class=\"\" title=\"image2\"></li>\n<li>点击 New registration；<br>a) 在 Name 输入显示名称；如：Reg_01；<br>b) Supported account types 选择只允许当前组织的账号；<br>c) 重定向 URI 选择 Web 类型，并输入如下三个 uri (以开发环境版本为例):<br>​              i. <a href=\"http://localhost:8080/\">http://localhost:8080/</a><br>​             ii. <a href=\"http://localhost:8080/signin-oidc\">http://localhost:8080/signin-oidc</a><br>​            iii. <a href=\"http://localhost:8080/signout-callback-oidc\">http://localhost:8080/signout-callback-oidc</a></li>\n<li>创建完成后，进入 detail 页面点击 Authentication；<br>a) 将 ID tokens 选中并保存<img src=\"/2025/03/29/API/image3.png\" class=\"\" title=\"image3\"></li>\n<li>进入 Certificates &amp; Secrets &gt; Client Secrets。创建新的客户端密钥，并复制密钥值；<img src=\"/2025/03/29/API/image4.png\" class=\"\" title=\"image4\"></li>\n<li>进入 Overview，将 Application ID 与 Tenant ID 复制下来备用;<img src=\"/2025/03/29/API/image5.png\" class=\"\" title=\"image5\"></li>\n</ol>\n<h3 id=\"2-在-ASP-NET使用OpenIdConnectAuthenticationOptions\"><a href=\"#2-在-ASP-NET使用OpenIdConnectAuthenticationOptions\" class=\"headerlink\" title=\"2.在 ASP.NET使用OpenIdConnectAuthenticationOptions\"></a>2.在 ASP.NET使用OpenIdConnectAuthenticationOptions</h3><figure class=\"highlight csharp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title\">Startup</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"built_in\">string</span> clientId = <span class=\"string\">&quot; clientId &quot;</span>;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"built_in\">string</span> tenantId = <span class=\"string\">&quot; tenantId &quot;</span>;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"built_in\">string</span> clientSecret = <span class=\"string\">&quot; clientSecret &quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">Configuration</span>(<span class=\"params\">IAppBuilder app</span>)</span></span><br><span class=\"line\">    &#123;      \t app.SetDefaultSignInAsAuthenticationType(CookieAuthenticationDefaults.AuthenticationType);</span><br><span class=\"line\">        app.UseCookieAuthentication(<span class=\"keyword\">new</span> CookieAuthenticationOptions &#123;</span><br><span class=\"line\">            AuthenticationType = CookieAuthenticationDefaults.AuthenticationType,</span><br><span class=\"line\">            CookieManager = <span class=\"keyword\">new</span> SystemWebCookieManager(), <span class=\"comment\">// 修复 Cookie 管理问题</span></span><br><span class=\"line\">            CookieSameSite = SameSiteMode.None,</span><br><span class=\"line\">            CookieSecure = CookieSecureOption.SameAsRequest,</span><br><span class=\"line\">            ExpireTimeSpan = TimeSpan.FromMinutes(<span class=\"number\">60</span>)</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">            配置 Azure AD OpenID Connect 认证</span><br><span class=\"line\">        app.UseOpenIdConnectAuthentication(<span class=\"keyword\">new</span> OpenIdConnectAuthenticationOptions</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            AuthenticationMode = AuthenticationMode.Active,</span><br><span class=\"line\">            ClientId = clientId,</span><br><span class=\"line\">            ClientSecret = clientSecret,</span><br><span class=\"line\">            Authority = <span class=\"string\">$&quot;https://login.microsoftonline.com/<span class=\"subst\">&#123;tenantId&#125;</span>/v2.0&quot;</span>,</span><br><span class=\"line\">            RedirectUri = <span class=\"string\">&quot;http://localhost:60026/signin-oidc&quot;</span>,</span><br><span class=\"line\">            PostLogoutRedirectUri = <span class=\"string\">&quot;http://localhost:60026/&quot;</span>,</span><br><span class=\"line\">            Scope = OpenIdConnectScope.OpenIdProfile + <span class=\"string\">&quot; email&quot;</span>,</span><br><span class=\"line\">            ResponseType = OpenIdConnectResponseType.CodeIdToken,</span><br><span class=\"line\">            TokenValidationParameters = <span class=\"keyword\">new</span> TokenValidationParameters</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                ValidateIssuer = <span class=\"literal\">true</span>,</span><br><span class=\"line\">                ValidIssuer = <span class=\"string\">$&quot;https://sts.windows.net/<span class=\"subst\">&#123;tenantId&#125;</span>/&quot;</span></span><br><span class=\"line\">            &#125;,                </span><br><span class=\"line\">            Notifications = <span class=\"keyword\">new</span> OpenIdConnectAuthenticationNotifications</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                AuthorizationCodeReceived = <span class=\"keyword\">async</span> context =&gt;</span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">try</span></span><br><span class=\"line\">                    &#123;</span><br><span class=\"line\">                        <span class=\"comment\">// 1. 获取 Token</span></span><br><span class=\"line\">                        <span class=\"keyword\">var</span> authContext = <span class=\"keyword\">new</span> AuthenticationContext(<span class=\"string\">$&quot;https://login.microsoftonline.com/<span class=\"subst\">&#123;tenantId&#125;</span>&quot;</span>);</span><br><span class=\"line\">                        <span class=\"keyword\">var</span> clientCredential = <span class=\"keyword\">new</span> ClientCredential(clientId, clientSecret);</span><br><span class=\"line\">                        <span class=\"keyword\">var</span> result = <span class=\"keyword\">await</span> authContext.AcquireTokenByAuthorizationCodeAsync(</span><br><span class=\"line\">                            context.Code,</span><br><span class=\"line\">                            <span class=\"keyword\">new</span> Uri(context.RedirectUri),</span><br><span class=\"line\">                            clientCredential);</span><br><span class=\"line\">                        System.Diagnostics.Debug.WriteLine(<span class=\"string\">$&quot;Access Token: <span class=\"subst\">&#123;result.AccessToken&#125;</span>&quot;</span>);                         </span><br><span class=\"line\">                        context.AuthenticationTicket.Identity.AddClaim(<span class=\"keyword\">new</span> Claim(<span class=\"string\">&quot;access_token&quot;</span>, result.AccessToken));</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                    <span class=\"keyword\">catch</span> (Exception ex)</span><br><span class=\"line\">                    &#123;</span><br><span class=\"line\">                        <span class=\"comment\">// 记录错误日志</span></span><br><span class=\"line\">                        System.Diagnostics.Trace.TraceError(<span class=\"string\">$&quot;Token 获取失败: <span class=\"subst\">&#123;ex&#125;</span>&quot;</span>);</span><br><span class=\"line\">                        context.HandleResponse();</span><br><span class=\"line\">                        context.Response.Redirect(<span class=\"string\">&quot;/Error?code=token_failure&quot;</span>);</span><br><span class=\"line\">                    &#125;                        </span><br><span class=\"line\">                &#125;,</span><br><span class=\"line\">                AuthenticationFailed = context =&gt;</span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    System.Diagnostics.Trace.TraceError(<span class=\"string\">$&quot;认证失败: <span class=\"subst\">&#123;context.Exception&#125;</span>&quot;</span>);</span><br><span class=\"line\">                    context.HandleResponse();</span><br><span class=\"line\">                    context.Response.Redirect(<span class=\"string\">&quot;/Error?message=&quot;</span> + context.Exception.Message);</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> Task.CompletedTask;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;); </span><br><span class=\"line\">        <span class=\"comment\">// 初始化 Web API</span></span><br><span class=\"line\">        HttpConfiguration config = <span class=\"keyword\">new</span> HttpConfiguration();</span><br><span class=\"line\">        WebApiConfig.Register(config);</span><br><span class=\"line\">        app.UseWebApi(config);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ol>\n<li><p>上述代码是在启动之前配置并启用 <strong>Azure AD OpenID Connect</strong> 认证服务。</p>\n</li>\n<li><p>创建登录接口</p>\n</li>\n</ol>\n<figure class=\"highlight csharp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title\">AccountController</span> : <span class=\"title\">Controller</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">Login</span>()</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!Request.IsAuthenticated)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"comment\">// 触发 Azure AD 登录</span></span><br><span class=\"line\">            HttpContext.GetOwinContext().Authentication.Challenge(</span><br><span class=\"line\">                <span class=\"keyword\">new</span> AuthenticationProperties &#123; RedirectUri = <span class=\"string\">&quot;/&quot;</span> &#125;,</span><br><span class=\"line\">                OpenIdConnectAuthenticationDefaults.AuthenticationType);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">Logout</span>()</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 注销本地 Cookie 和 Azure AD 会话</span></span><br><span class=\"line\">        HttpContext.GetOwinContext().Authentication.SignOut(</span><br><span class=\"line\">            CookieAuthenticationDefaults.AuthenticationType,</span><br><span class=\"line\">            OpenIdConnectAuthenticationDefaults.AuthenticationType);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"基于-JWT-与-Azure-AD-设置授权\"><a href=\"#基于-JWT-与-Azure-AD-设置授权\" class=\"headerlink\" title=\"基于 JWT 与 Azure AD 设置授权\"></a>基于 JWT 与 Azure AD 设置授权</h2><p>上面两章我们学习了如何使用 JWT 与 Azure AD(<strong>也称 Azure Entra</strong>)；当我们正在开发一个最小 API 服务，并想要使用 JWT 对 API 进行授权时，也需要调用该 API 的客户端拥有特定的权限。</p>\n<p><strong>这就需要组合使用 Azure AD (Azure Entra)</strong> <strong>与 JWT</strong> 。</p>\n<p>整个授权的流程图如下：</p>\n<img src=\"/2025/03/29/API/image6.png\" class=\"\" title=\"image6\">\n\n<ul>\n<li><p>客户端在调用API前首先需要向授权服务器 (Azure Entra) 发出授权认证申请；</p>\n</li>\n<li><p>授权服务器得到申请并验证成功后会返回 access token；</p>\n</li>\n<li><p>客户端在调用API时会带上 access token；</p>\n</li>\n<li><p>API 服务接收到请求后，会向授权服务器验证 access token，在验证成功后会响应给客户端。</p>\n</li>\n</ul>\n<h3 id=\"1-启用-JWT\"><a href=\"#1-启用-JWT\" class=\"headerlink\" title=\"1.启用 JWT\"></a>1.启用 JWT</h3><ol>\n<li>在 startup 配置启用 <strong>JwtBearerAuthenticationOptions</strong>；</li>\n</ol>\n<figure class=\"highlight csharp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apiApp.UseJwtBearerAuthentication(<span class=\"keyword\">new</span> JwtBearerAuthenticationOptions</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    TokenValidationParameters = <span class=\"keyword\">new</span> TokenValidationParameters</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        ValidIssuer = <span class=\"string\">$&quot;https://sts.windows.net/<span class=\"subst\">&#123;tenantId&#125;</span>/&quot;</span>,</span><br><span class=\"line\">        ValidAudience = <span class=\"string\">&quot;api://&quot;</span> + clientId,</span><br><span class=\"line\">        IssuerSigningKeyResolver = (token, securityToken, kid, validationParameters) =&gt;</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> metadataAddress = <span class=\"string\">$&quot;https://login.microsoftonline.com/<span class=\"subst\">&#123;tenantId&#125;</span>/.well-known/openid-configuration&quot;</span>;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> metadata = <span class=\"keyword\">new</span> ConfigurationManager&lt;OpenIdConnectConfiguration&gt;(</span><br><span class=\"line\">                metadataAddress,</span><br><span class=\"line\">                <span class=\"keyword\">new</span> OpenIdConnectConfigurationRetriever()</span><br><span class=\"line\">            ).GetConfigurationAsync().Result;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> metadata.SigningKeys;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>使用 [Authorize] 注解标记接口，代表调用它之前需要 JWT 授权；</li>\n</ol>\n<figure class=\"highlight csharp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title\">TestController</span> : <span class=\"title\">ApiController</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    [<span class=\"meta\">Authorize</span>] <span class=\"comment\">// 要求 JWT 授权</span></span><br><span class=\"line\">    [<span class=\"meta\">HttpGet</span>]</span><br><span class=\"line\">    [<span class=\"meta\">Route(<span class=\"string\">&quot;api/test&quot;</span>)</span>]</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> IHttpActionResult <span class=\"title\">GetData</span>()</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> Ok(<span class=\"keyword\">new</span> &#123; message = <span class=\"string\">&quot;API 认证成功！&quot;</span> &#125;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-配置-Azure-AD\"><a href=\"#2-配置-Azure-AD\" class=\"headerlink\" title=\"2.配置 Azure AD\"></a>2.配置 Azure AD</h3><h4 id=\"2-1-注册客户端应用\"><a href=\"#2-1-注册客户端应用\" class=\"headerlink\" title=\"2.1 注册客户端应用\"></a>2.1 注册客户端应用</h4><p><strong>步骤 1</strong>：注册客户端应用</p>\n<ol>\n<li>返回 <strong>应用注册</strong> → <strong>新注册</strong>。<ul>\n<li><strong>名称</strong>：输入客户端应用名称（例如 MyClientApp）。</li>\n<li><strong>支持的账户类型</strong>：选择 <strong>仅此组织目录中的账户</strong>。</li>\n<li><strong>重定向 URI</strong>：选择 <strong>Web</strong>，输入 <a href=\"http://localhost(本地测试用)./\">http://localhost（本地测试用）。</a></li>\n<li>点击 <strong>注册</strong>。</li>\n</ul>\n</li>\n</ol>\n<p><strong>步骤 2</strong>：配置客户端凭据</p>\n<ol>\n<li>在客户端应用页面中，进入 <strong>证书和密码</strong> → <strong>客户端密码</strong> → <strong>新建客户端密码</strong>。<ul>\n<li><strong>说明</strong>：输入名称（例如 MyClientSecret）。</li>\n<li><strong>过期时间</strong>：选择有效期（例如 6 个月）。</li>\n<li>点击 <strong>添加</strong>。</li>\n</ul>\n</li>\n<li><strong>复制客户端密码值</strong>：保存此值（稍后无法再查看）。</li>\n</ol>\n<h4 id=\"2-2-注册服务端应用\"><a href=\"#2-2-注册服务端应用\" class=\"headerlink\" title=\"2.2 注册服务端应用\"></a>2.2 注册服务端应用</h4><blockquote>\n<p><strong>如果还没有服务端的 registration</strong>，可以按照上述的步骤一注册新的应用。</p>\n</blockquote>\n<ol>\n<li>进入 ​<strong>API</strong> <strong>权限</strong> → ​<strong>添加权限</strong> → ​<strong>我的 API</strong>；</li>\n<li>选择之前注册的 API 应用（例如 MyProtectedAPI）；</li>\n<li>选择 ​委托的权限 或 ​应用程序权限；</li>\n<li>委托的权限：用户登录后访问 API（例如 access_as_api）；</li>\n<li>应用程序权限：后台服务直接访问 API（无需用户登录）；</li>\n<li>点击 ​<strong>添加权限</strong>。</li>\n</ol>\n<h4 id=\"2-3-测试\"><a href=\"#2-3-测试\" class=\"headerlink\" title=\"2.3 测试\"></a>2.3 测试</h4><p>利用 postman 代替客户端进行测试，需要注意以下几点：</p>\n<ol>\n<li>Client_id 需要填客户端的 application id；</li>\n<li>Client_secret 需要填客户端的 secret；</li>\n<li>Scope 需要填服务端的 scope。</li>\n</ol>\n<img src=\"/2025/03/29/API/image7.png\" class=\"\" title=\"image7\">\n<p>Javascript 请求示例代码如下：</p>\n<figure class=\"highlight csharp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> tokenUrl = </span><br><span class=\"line\">`https:<span class=\"comment\">//login.microsoftonline.com/$&#123;pm.environment.get(&quot;tenant_id&quot;)&#125;/oauth2/v2.0/token`;</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> clientId = pm.environment.<span class=\"keyword\">get</span>(<span class=\"string\">&quot;client_id&quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> clientSecret = pm.environment.<span class=\"keyword\">get</span>(<span class=\"string\">&quot;client_secret&quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> scope = pm.environment.<span class=\"keyword\">get</span>(<span class=\"string\">&quot;api_audience&quot;</span>) + <span class=\"string\">&quot;/.default&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">pm.sendRequest(&#123;</span><br><span class=\"line\">  url: tokenUrl,</span><br><span class=\"line\">  method: <span class=\"string\">&#x27;POST&#x27;</span>,</span><br><span class=\"line\">  header: &#123; <span class=\"string\">&#x27;Content-Type&#x27;</span>: <span class=\"string\">&#x27;application/x-www-form-urlencoded&#x27;</span> &#125;,</span><br><span class=\"line\">  body: &#123;</span><br><span class=\"line\">    mode: <span class=\"string\">&#x27;urlencoded&#x27;</span>,</span><br><span class=\"line\">    urlencoded: [</span><br><span class=\"line\">      &#123; key: <span class=\"string\">&#x27;client_id&#x27;</span>, <span class=\"keyword\">value</span>: clientId &#125;,</span><br><span class=\"line\">      &#123; key: <span class=\"string\">&#x27;client_secret&#x27;</span>, <span class=\"keyword\">value</span>: clientSecret &#125;,</span><br><span class=\"line\">      &#123; key: <span class=\"string\">&#x27;scope&#x27;</span>, <span class=\"keyword\">value</span>: scope &#125;,</span><br><span class=\"line\">      &#123; key: <span class=\"string\">&#x27;grant_type&#x27;</span>, <span class=\"keyword\">value</span>: <span class=\"string\">&#x27;client_credentials&#x27;</span> &#125;</span><br><span class=\"line\">    ]</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;, (err, res) =&gt; &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!err) &#123;</span><br><span class=\"line\">    pm.environment.<span class=\"keyword\">set</span>(<span class=\"string\">&quot;access_token&quot;</span>, res.json().access_token);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>获取 token 后，将 token 带入到请求中即可</p>\n<p><a href=\"http://localhost:60026/api/test\">http://localhost:60026/api/test</a></p>\n<p>bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6IkpETmFfNGk0cjdGZ2lnTDNzS……</p>\n</blockquote>\n"},{"title":"微软【AI-900】考试准备系列博客二","comments":1,"date":"2025-02-25T13:04:43.000Z","description":"本文记录着【AI-900】入门认证考试的学习笔记","_content":"\n## Microsoft Azure AI 基础\n\n### 第一部分\n\n#### 什么是机器学习\n\n机器学习起源于数据的统计和数学建模。 机器学习的基本理念是使用过去观测到的数据来预测未知的结果或值。 例如：\n\n- 冰淇淋店的老板可能会使用某个应用，结合历史销售和天气记录，根据天气预报来预测他们在某一天可能会售出多少个冰淇淋。\n- 医生可能会使用以往患者的临床数据来运行自动测试，以根据体重、血糖水平和其他测量值等因素来预测新患者是否有患糖尿病的风险。\n- 南极研究人员可能会利用过去的观测值，根据鸟类脚蹼、喙和其他物理属性的测量，自动识别不同的企鹅物种（例如阿德利企鹅、白眉企鹅或帽带企鹅）。\n\n#### 机器学习作为一种函数\n\n由于机器学习基于数学和统计学，因此通常会使用数学术语来思考机器学习模型。 从根本上讲，机器学习模型是一种软件应用程序，它封装一个函数用于根据一个或多个输入值计算输出值。 定义该函数的过程称为训练。 定义函数后，可以使用它在称为“推理”的过程中预测新值。\n\n让我们探讨一下训练和推理所涉及的步骤。\n\n{% asset_img \"machine-learning.png\" \"machine learn\" %}\n\n1. 训练数据由过去的观测值组成。 在大多数情况下，观测值包括观测到的事物的属性或特征，以及要训练模型来预测的事物的已知值（称为标签）。\n    在数学术语中，你经常会看到使用速记变量名称 x 引用的特征，以及使用 y 引用的标签。 通常，观测值由多个特征值组成，因此 x 实际上是一个向量（包含多个值的数组），如下所示：[x1,x2,x3,...]。\n    为了澄清这一点，让我们分析前面所述的示例：\n    - 在冰淇淋销售场景中，我们的目标是训练一个可以根据天气预测冰淇淋销售数量的模型。 当天的天气测量值（温度、降雨量、风速等）是特征 (x)，每日售出的冰淇淋数量是标签 (y)。\n    - 在医疗场景中，目标是根据患者的临床测量值预测患者是否有患糖尿病的风险。 患者的测量值（体重、血糖水平等）是特征 (x)，患糖尿病的可能性（例如，1 表示有风险，0 表示没有风险）是标签 (y)。\n    - 在南极研究场景中，我们希望根据企鹅的物理属性来预测其物种。 企鹅的关键测量值（脚蹼的长度、喙的宽度等）是特征 (x)，物种（例如，0 表示阿德利企鹅，1 表示白眉企鹅，2 表示帽带企鹅）是标签 (y)。\n\n2. 将对数据应用某种算法，以尝试确定特征与标签之间的关系，然后泛化这种关系，以便针对 x 执行计算来计算 y。 使用的具体算法取决于要解决的预测问题的类型（稍后会详细介绍），但基本原 则是尝试将一个函数拟合到数据，其中的特征值可用于计算标签\n\n3. 算法的结果是一个模型，该模型将算法派生的计算封装为函数 - 我们称之为 f。 采用数学表示法：\n\ny = f(x)\n\n4. 完成训练阶段后，训练的模型可用于推理。 模型本质上是一个软件程序，可以封装训练过程生成的函数。 你可以输入一组特征值，并接收相应标签的预测结果作为输出。 由于模型的输出是函数计算的预测值而不是观测值，因此你经常会看到函数的输出显示为 ŷ（戏称为“y-hat”）\n\n### 第二部分\n\n#### 机器学习类型\n\n机器学习有多种类型，必须根据尝试预测的内容应用适当的类型。 下图显示了常见机器学习类型的细目。\n\n{% asset_img \"machine-learning-types.png\" \"machine learn type\" %}\n\n##### 监督式机器学习\n\n监督式机器学习是机器学习算法的一个通用术语，其中训练数据包括特征值和已知标签值。 监督式机器学习用于通过确定过去观测值中特征与标签之间的关系来训练模型，以便将来可以预测特征的未知标签。\n\n###### 回归\n\n回归是监督式机器学习的一种形式，其中模型预测的标签是数值。 例如：\n\n- 给定一天销售的冰淇淋数量，基于温度、降雨量和风速。\n- 物业的销售价格，基于物业大小（以平方英尺为单位）、所含卧室数量及所在位置的社会经济指标。\n- 汽车燃油效率（以英里/加仑为单位），基于发动机大小、重量、宽度、高度和长度。\n\n###### 分类\n\n分类是监督式机器学习的一种形式，其中标签表示一个分类或类。 有两种常见的分类场景。\n\n**二元分类**\n在二元分类中，标签确定观察到的项是（或不是）特定类的实例。 换句话说，二元分类模型预测两个互斥结果中的一个。 例如：\n\n- 基于体重、年龄、血糖水平等临床指标，患者是否有患糖尿病的风险。\n- 基于收入、信用记录、年龄和其他因素，银行客户是否会拖欠贷款。\n- 基于人口统计属性和过去的购买情况，邮寄列表客户是否会对营销产品/服务做出积极响应。\n\n在所有这些示例中，模型为单个可能类预测二进制 true/false 或积极/消极预测。\n\n**多类分类**\n\n多类分类扩展了二元分类，以预测表示多个可能类之一的标签。 例如，\n\n- 企鹅的物种（阿德利企鹅、巴布亚企鹅或帽带企鹅），基于身体测量。\n- 电影的流派（喜剧、恐怖、爱情、冒险或科幻），基于演员、导演和预算。\n\n在涉及一组已知多个类的场景中，多类分类用于预测互斥标签。 例如，一只企鹅不能同时是巴布亚企鹅和阿德利企鹅。 但是，还可以使用一些算法来训练多标签分类模型，其中对于单个观测值可能有多个有效标签。 例如，一部电影可能同时被归类为科幻和喜剧。\n\n##### 非监督式机器学习\n非监督式机器学习涉及使用仅包含特征值且没有任何已知标签的数据来训练模型。 非监督式机器学习算法确定训练数据中观测值的特征之间的关系。\n\n###### 群集/聚类分析\n非监督式机器学习最常见的形式是聚类分析。 聚类分析算法基于观测值的特征识别观测值之间的相似性，并将它们分组到离散群集中。 例如：\n\n- 根据花的大小、叶数和花瓣数量，对类似的花进行分组。\n- 根据人口统计属性和购买行为，确定类似客户的组。\n\n在某些方面，聚类分析类似于多类分类；因为它将观侧值分类为离散组。 区别在于，使用分类时，你已经知道训练数据中的观测值所属的类；因此，该算法的工作原理是确定特征与已知分类标签之间的关系。 在聚类分析中，没有以前已知的分类标签，算法完全基于特征的相似性对数据观测值进行分组。\n\n在某些情况下，聚类分析用于确定在训练分类模型之前存在的类集。 例如，可以使用聚类分析将客户细分到多个组，然后对这些组进行分析，以识别不同的客户类并对其进行分类（高价值 - 低交易量、经常购买小额产品等）。 然后，可以使用分类来标记聚类分析结果中的观测值，并使用标记的数据来训练预测新客户可能属于哪个客户类别的分类模型。\n\n### 第三部分\n\n#### 回归\n\n回归模型经过训练，基于包括特征和已知标签的训练数据来预测数值标签值。 训练回归模型（或者实际上，任何监督式机器学习模型）的过程涉及多次迭代，在这些迭代中，你使用适当的算法（通常带有一些参数化设置）来训练模型，评估模型的预测性能，并通过使用不同的算法和参数重复训练过程来优化模型，直到达到可接受的预测准确性级别。\n\n{% asset_img \"supervised-training.png\" \"supervised training\" %}\n\n此图显示了监督式机器学习模型的训练过程的四个关键元素：\n\n- 拆分训练数据（随机）以创建用于训练模型的数据集，同时保留要用于验证已训练模型的一部分数据。\n- 使用算法以将训练数据拟合到模型。 对于回归模型，使用回归算法，例如线性回归。\n- 使用保留的验证数据，通过预测特征的标签来测试模型。\n- 将验证数据集中的已知实际标签与模型预测的标签进行比较。 然后，聚合预测的标签值和实际的标签值之间的差异以计算一个指标，该指标指示模型对验证数据的预测准确度。\n\n每次训练、验证和评估迭代后，可以使用不同的算法和参数重复该过程，直到达到可接受的评估指标。\n\n#### 示例 - 回归\n\n让我们通过一个简化的示例来探索回归，在该示例中，我们将训练一个模型以基于单个特征值 (x) 预测数值标签 (y)。 大多数实际场景涉及多个特征值，这增加了一些复杂性；但原理是相同的。\n\n对于示例，让我们继续使用之前讨论过的冰淇淋销售场景。 对于特征，我们将考虑温度（假设该值是给定日期的最高温度），我们希望训练模型以预测的标签是当天售出的冰淇淋数量。 我们将从一些历史数据开始，其中包括每日温度 (x) 和冰淇淋销售额 (y) 的记录：\n\n| 温度 (x) | 冰淇淋销售额 (y) |\n| -------- | ---------------- |\n| 51       | 1                |\n| 52       | 0                |\n| 67       | 14               |\n| 65       | 14               |\n| 70       | 23               |\n| 69       | 20               |\n| 72       | 23               |\n| 75       | 26               |\n| 73       | 22               |\n| 81       | 30               |\n| 78       | 26               |\n| 83       | 36               |\n\n##### 训练回归模型\n\n首先，我们将拆分数据，并使用其中一部分数据来训练模型。 下面是训练数据集：\n\n| 温度 (x) | 冰淇淋销售额 (y) |\n| -------- | ---------------- |\n| 51       | 1                |\n| 65       | 14               |\n| 69       | 20               |\n| 72       | 23               |\n| 75       | 26               |\n| 81       | 30               |\n\n若要深入了解这些 x 和 y 值如何相互关联，我们可以将它们绘制为沿两个轴的坐标，如下所示：\n\n{% asset_img \"scatter-plot.png\" \"scatter plot\" %}\n\n现在，我们已准备好将算法应用于训练数据，并将其拟合到将运算应用于 x 以计算 y 的函数。 其中一种算法是线性回归，它的工作原理是派生一个函数，该函数通过 x 和 y 值的交点生成一条直线，同时最小化直线和绘制点之间的平均距离，如下所示：\n\n{% asset_img \"regression-line.png\" \"regression line\" %}\n\n这条直线是函数的可视表示形式，其中直线的斜率描述了如何针对给定的 x 值计算 y 值。 这条直线在 50 处与 x 轴相交，因此当 x 为 50 时，y 为 0。 从绘图中的轴标记可以看出，直线倾斜，使得沿 x 轴每增加 5，沿 y 轴就会增加 5；因此当 x 为 55 时，y 为 5；当 x 为60时，y 为 10，依此类推。 若要针对给定的 x 值计算 y 值，函数只需减去 50；换句话说，函数可以如下表示：\n\nf(x) = x-50\n\n可以使用此函数来预测任何给定温度下一天售出的冰淇淋数量。 例如，假设天气预报告诉我们，明天将是 77 度。 我们可以应用模型来计算 77-50，并预测我们明天将销售 27 个冰淇淋。\n\n但是我们的模型有多准确呢？\n\n##### 评估回归模型\n\n为了验证模型并评估其预测效果，我们保留了一些已知标签 (y) 值的数据。 下面是我们保留的数据：\n\n| 温度 (x) | 冰淇淋销售额 (y) |\n| -------- | ---------------- |\n| 52       | 0                |\n| 67       | 14               |\n| 70       | 23               |\n| 73       | 22               |\n| 78       | 26               |\n| 83       | 36               |\n\n可以使用模型根据特征 (x) 值来预测此数据集中每个观测值的标签；然后，将预测的标签 (ŷ) 与已知的实际标签值 (y) 进行比较。\n\n使用前面训练的模型（该模型封装函数 f(x) = x-50），可生成以下预测：\n\n| 温度 (x) | 实际销售额 (y) |\n| -------- | -------------- |\n| 52       | 0              |\n| 67       | 14             |\n| 70       | 23             |\n| 73       | 22             |\n| 78       | 26             |\n| 83       | 36             |\n\n我们可以针对特征值绘制预测标签和实际标签，如下所示：\n\n{% asset_img \"regression-variance.png\" \"regression variance\" %}\n\n预测标签由模型计算，因此它们位于函数线上，但是由函数计算的 ŷ 值与来自验证数据集的实际 y 值之间存在一些差异；这在绘图上表示为 ŷ 值和 y 值之间的线，显示预测值与实际值的差距。\n\n##### 回归评估指标\n\n根据预测值和实际值之间的差异，可以计算用于评估回归模型的一些常见指标。\n\n平均绝对误差 (MAE)\n\n此示例中的方差指示每个预测错误的冰淇淋数量。 预测是高于还是低于实际值无关紧要（例如，-3 和 +3 都表示方差为 3）。 此指标被称为每个预测的绝对误差，并且可以被总结为整个验证集的平均绝对误差 (MAE)。\n\n在冰淇淋示例中，绝对误差（2、3、3、1、2 和 3）的平均值为 2.33。\n\n###### 均方误差 (MSE)\n\n平均绝对误差指标同等地考虑预测标签和实际标签之间的所有差异。 然而，相比误差较少但较大的模型，一个始终误差较小的模型可能更可取。 生成“放大”较大误差的指标的一种方法是对单个误差求平方，并计算平方值的平均值。 此指标被称为均方误差 (MSE)。\n\n在我们的冰淇淋示例中，绝对值平方（4、9、9、1、4 和 9）的平均值为 6。\n\n###### 均方根误差 (RMSE)\n\n均方误差有助于考虑误差的幅度，但是因为它对误差值进行平方，所以得到的指标不再代表标签测量的量。 换句话说，我们可以说模型的 MSE 为 6，但这并不能衡量它在被错误预测的冰淇淋数量方面的准确性；6 只是一个数字分数，表示验证预测中的错误级别。\n\n如果要根据冰淇淋的数量来衡量误差，我们需要计算 MSE 的平方根；不出所料，这生成了一个名为均方根误差的指标。 在本例中，为 √6，即 2.45（冰淇淋）。\n\n###### 决定系数 (R2)\n\n到目前为止，所有指标都比较预测值与实际值之间的差异，以评估模型。 然而，在现实中，模型考虑到了冰淇淋日销售额中的一些自然随机差异。 在线性回归模型中，训练算法拟合一条直线，使函数和已知标签值之间的平均方差最小化。 决定系数（通常称为 R2 或 R 平方）是一种指标，用于测量验证结果中可由模型解释的方差比例，而不是验证数据的某些异常方面（例如，由于当地节日，某一天的冰淇淋销售量非常不寻常）。\n\nR2 的计算比前面的指标更复杂。 它将预测标签和实际标签之间的平方差之和与实际标签值和实际标签值的平均值之间的平方差之和进行比较，如下所示：\n\nR2 = 1- ∑(y-ŷ)2 ÷ ∑(y-ȳ)2\n\n如果这看起来很复杂，不要太担心；大多数机器学习工具都可以为你计算指标。 重要的一点是，结果是一个介于 0 和 1 之间的值，该值描述了模型所解释的方差的比例。 简单来说，此值越接近 1，模型就越拟合验证数据。 对于冰淇淋回归模型，根据验证数据计算的 R2 为 0.95。\n\n### 第四部分\n\n#### 二元分类\n\n分类与回归一样，是一种受监督的机器学习技术，因此遵循相同的适用于训练、验证和评估模型的迭代过程。 用于训练分类模型的算法不是像回归模型那样计算数值，而是计算类分配的概率值以及用于评估模型性能的评估指标，将预测类与实际类进行比较。\n\n二元分类算法用于训练模型，该模型可预测单个类的两个可能标签之一。 本质上是预测 true 或 false。 在大多数实际方案中，用于训练和验证模型的数据观测值包含多个特征 (x) 值和一个为 1 或 0 的 y 值。\n\n#### 示例 - 二元分类\n\n为了了解二元分类的工作原理，我们来看一个简化的示例，该示例使用单个特征 (x) 来预测标签 y 是 1 还是 0。 在此示例中，我们将使用患者的血糖水平来预测患者是否患有糖尿病。 下面是用于训练模型的数据：\n\n| 血糖 (x) | **糖尿病？ (y)** |\n| -------- | ---------------- |\n| 67       | 0                |\n| 103      | 1                |\n| 114      | 1                |\n| 72       | 0                |\n| 116      | 1                |\n| 65       | 0                |\n\n##### 训练二元分类模型\n\n为了训练模型，我们将使用一种算法将训练数据拟合为一个函数，该函数计算类标签为 true（换句话说，患者有糖尿病）的概率。 概率以某个 0.0 到 1.0 之间的值来度量，使得所有可能的类的总概率为 1.0。 例如，如果一名患者患糖尿病的概率为 0.7，那么该患者未患糖尿病的相应概率为 0.3。\n\n有许多可用于二元分类的算法，例如逻辑回归，它会导出值在 0.0 到 1.0 之间的 sigmoid（S 形）函数，如下所示：\n\n{% asset_img \"sigmoid-plot.png\" \"sigmoid plot\" %}\n\n> 尽管名称如此，但在机器学习中，逻辑回归用于分类，而不是用于回归。 重点是它生成的函数的逻辑性质，该函数描述了下限值和上限值（用于二元分类时为 0.0 和 1.0）之间的 S 形曲线。\n\n该算法生成的函数描述了 x 为给定值时 y 为 true (y=1) 的概率。 从数学上来说，可以这样表达该函数：\n\nf(x) = P(y=1 | x)\n\n就训练数据中六个观测值中的三个来说，我们知道 y 肯定为 true，因此就这些观测值来说，y=1 的概率为 1.0；就其他三个来说，我们知道 y 肯定为 false，因此 y=1 的概率为 0.0。 S 形曲线描绘了概率分布情况，因此在曲线上标出 x 的值就可以确定 y 为 1 的相应概率。\n\n该图还包含一条水平线，指示基于此函数的模型将预测 true (1) 或 false (0) 的阈值。 阈值位于 y (P(y) = 0.5) 的中间点。 对于此点或高于此点的任何值，模型会预测 true (1)；而对于低于此点的任何值，模型会预测 false (0)。 例如，对于血糖水平为 90 的患者，该函数将得出的概率值为 0.9。 由于 0.9 高于阈值 0.5，因此模型会预测 true (1) - 换句话说，预测患者患有糖尿病。\n\n##### 评估二元分类模型\n\n与回归一样，在训练二元分类模型时，我们会保留一个随机数据子集来验证训练后的模型。 假设我们保留以下数据来验证糖尿病分类器：\n\n| 血糖 (x) | 糖尿病？ (y) |\n| -------- | ------------ |\n| 66       | 0            |\n| 107      | 1            |\n| 112      | 1            |\n| 71       | 0            |\n| 87       | 1            |\n| 89       | 1            |\n\n将我们之前派生的逻辑函数应用于 x 值会生成下图。\n\n{% asset_img \"classification-predictions.png\" \"classification predictions\" %}\n\n模型为每个观测值生成预测标签 1 或 0，具体取决于函数计算出的概率是高于阈值还是低于阈值。 然后，我们可以将预测的类标签 (ŷ) 与实际的类标签 (y) 进行比较，如下所示：\n\n| 血糖 (x) | 实际的糖尿病诊断 (y) | 预测的糖尿病诊断 (ŷ) |\n| -------- | -------------------- | -------------------- |\n| 66       | 0                    | 0                    |\n| 107      | 1                    | 1                    |\n| 112      | 1                    | 1                    |\n| 71       | 0                    | 0                    |\n| 87       | 1                    | 0                    |\n| 89       | 1                    | 1                    |\n\n##### 二元分类评估指标\n\n计算二元分类模型的评估指标的第一步通常是为每个可能的类标签创建正确预测和错误预测的数量矩阵：\n\n{% asset_img \"binary-confusion-matrix.png\" \"binary confusion matrix\" %}\n\n此可视化效果称为混淆矩阵，它显示预测总计，其中：\n\n- ŷ=0 且 y=0：真阴性 (TN)\n- ŷ=1 且 y=0：假阳性 (FP)\n- ŷ=0 且 y=1：假阴性 (FN)\n- ŷ=1 且 y=1：真阳性 (TP)\n\n混淆矩阵的排列是这样的：正确 (true) 预测显示在从左上角到右下角的对角线上。 通常情况下，颜色强度用于指示每个单元格中的预测数量，因此快速浏览一下预测良好的模型应该就会看出深阴影对角线趋势。\n\n###### 精确度\n\n可以根据混淆矩阵计算出的最简单指标是准确度 - 模型正确预测的比例。 准确度的计算方式如下：\n\n(TN+TP) ÷ (TN+FN+FP+TP)\n\n在我们的糖尿病示例中，计算如下：\n\n(2+3) ÷ (2+1+0+3)\n\n= 5 ÷ 6\n\n= **0.83**\n\n因此，就我们的验证数据来说，糖尿病分类模型在 83% 的情况下产生正确的预测。\n\n准确度一开始似乎是评估模型的一个很好的指标，但请考虑这一点。 假设 11% 的人口患有糖尿病。 可以创建一个始终预测 0 的模型，即使在没有真正尝试通过评估患者的特征来区分患者的情况下，其准确率仍可达到 89%。 我们真正需要的是更深入地了解模型在预测 1（代表阳性病例）和 0（代表阴性病例）时的表现。\n\n###### 召回率\n\n召回率是度量此模型正确识别的阳性病例比例的指标。 换句话说，与确实患有糖尿病的患者人数相比，此模型预测有多少人患有糖尿病？\n\n召回率的公式为：\n\nTP ÷ (TP+FN)\n\n就我们的糖尿病示例来说：\n\n3 ÷ (3+1)\n\n= 3 ÷ 4\n\n= **0.75**\n\n因此，我们的模型正确地将 75% 的糖尿病患者识别为糖尿病患者。\n\n###### 精度\n\n精准率是与召回率类似的指标，但度量的是预测为阳性病例且真实标签实际上也为阳性的比例。 换句话说，在模型预测患有糖尿病的患者中，实际患有糖尿病的患者的比例是多少？\n\n精准率公式为：\n\nTP ÷ (TP+FP)\n\n就我们的糖尿病示例来说：\n\n3 ÷ (3+0)\n\n= 3 ÷ 3\n\n= **1.0**\n\n因此，在我们的模型预测的患有糖尿病的患者中，100% 的人确实患有糖尿病。\n\n###### F1 分数\n\nF1 分数是一个结合了召回率和精准率的总体指标。 F1 分数的公式为：\n\n(2 x 精准率 x 召回率) ÷ (精准率 + 召回率)\n\n就我们的糖尿病示例来说：\n\n(2 x 1.0 x 0.75) ÷ (1.0 + 0.75)\n\n= 1.5 ÷ 1.75\n\n**= 0.86**\n\n###### 曲线下面积 (AUC)\n\n召回率的另一个名称是真阳性率 (TPR)。此外还有一个称为假阳性率 (FPR) 的等效指标，其计算公式为 FP÷(FP+TN)。 我们已经知道，在使用阈值 0.5 时，我们的模型的 TPR 为 0.75。我们可以使用 FPR 的公式计算出 0÷2 的值为 0。\n\n当然，如果我们更改模型预测 true (1) 的阈值，则会影响阳性和阴性预测的数量，因此会更改 TPR 和 FPR 指标。 这些指标通常用于通过绘制接收方操作特征 (ROC) 曲线来评估模型，该曲线会比较 0.0 到 1.0 之间的每个可能阈值的 TPR 和 FPR：\n\n{% asset_img \"roc-chart.png\" \"roc chart\" %}\n\n完美模型的 ROC 曲线会沿左侧的 TPR 轴直线上升，然后穿过顶部的 FPR 轴。 由于曲线的绘图面积为 1x1，因此该完美曲线下的面积将为 1.0（这意味着模型始终是正确的）。 相比之下，从左下角到右上角的对角线表示通过随机猜测二进制标签获得的结果；产生的曲线下面积为 0.5。 换句话说，给定两个可能的类标签，你可以合理预期猜对的概率为 50%。\n\n就我们的糖尿病模型来说，会生成上面的曲线，曲线下面积 (AUC) 指标为 0.875。 由于 AUC 高于 0.5，因此我们可以得出结论：该模型在预测患者是否患有糖尿病方面比随机猜测的表现更好。\n","source":"_posts/ai-900-exam-preparation-2.md","raw":"---\ntitle: 微软【AI-900】考试准备系列博客二\ncomments: true\ndate: 2025-02-25 21:04:43\ncategories:\n - ai\ndescription: 本文记录着【AI-900】入门认证考试的学习笔记\n---\n\n## Microsoft Azure AI 基础\n\n### 第一部分\n\n#### 什么是机器学习\n\n机器学习起源于数据的统计和数学建模。 机器学习的基本理念是使用过去观测到的数据来预测未知的结果或值。 例如：\n\n- 冰淇淋店的老板可能会使用某个应用，结合历史销售和天气记录，根据天气预报来预测他们在某一天可能会售出多少个冰淇淋。\n- 医生可能会使用以往患者的临床数据来运行自动测试，以根据体重、血糖水平和其他测量值等因素来预测新患者是否有患糖尿病的风险。\n- 南极研究人员可能会利用过去的观测值，根据鸟类脚蹼、喙和其他物理属性的测量，自动识别不同的企鹅物种（例如阿德利企鹅、白眉企鹅或帽带企鹅）。\n\n#### 机器学习作为一种函数\n\n由于机器学习基于数学和统计学，因此通常会使用数学术语来思考机器学习模型。 从根本上讲，机器学习模型是一种软件应用程序，它封装一个函数用于根据一个或多个输入值计算输出值。 定义该函数的过程称为训练。 定义函数后，可以使用它在称为“推理”的过程中预测新值。\n\n让我们探讨一下训练和推理所涉及的步骤。\n\n{% asset_img \"machine-learning.png\" \"machine learn\" %}\n\n1. 训练数据由过去的观测值组成。 在大多数情况下，观测值包括观测到的事物的属性或特征，以及要训练模型来预测的事物的已知值（称为标签）。\n    在数学术语中，你经常会看到使用速记变量名称 x 引用的特征，以及使用 y 引用的标签。 通常，观测值由多个特征值组成，因此 x 实际上是一个向量（包含多个值的数组），如下所示：[x1,x2,x3,...]。\n    为了澄清这一点，让我们分析前面所述的示例：\n    - 在冰淇淋销售场景中，我们的目标是训练一个可以根据天气预测冰淇淋销售数量的模型。 当天的天气测量值（温度、降雨量、风速等）是特征 (x)，每日售出的冰淇淋数量是标签 (y)。\n    - 在医疗场景中，目标是根据患者的临床测量值预测患者是否有患糖尿病的风险。 患者的测量值（体重、血糖水平等）是特征 (x)，患糖尿病的可能性（例如，1 表示有风险，0 表示没有风险）是标签 (y)。\n    - 在南极研究场景中，我们希望根据企鹅的物理属性来预测其物种。 企鹅的关键测量值（脚蹼的长度、喙的宽度等）是特征 (x)，物种（例如，0 表示阿德利企鹅，1 表示白眉企鹅，2 表示帽带企鹅）是标签 (y)。\n\n2. 将对数据应用某种算法，以尝试确定特征与标签之间的关系，然后泛化这种关系，以便针对 x 执行计算来计算 y。 使用的具体算法取决于要解决的预测问题的类型（稍后会详细介绍），但基本原 则是尝试将一个函数拟合到数据，其中的特征值可用于计算标签\n\n3. 算法的结果是一个模型，该模型将算法派生的计算封装为函数 - 我们称之为 f。 采用数学表示法：\n\ny = f(x)\n\n4. 完成训练阶段后，训练的模型可用于推理。 模型本质上是一个软件程序，可以封装训练过程生成的函数。 你可以输入一组特征值，并接收相应标签的预测结果作为输出。 由于模型的输出是函数计算的预测值而不是观测值，因此你经常会看到函数的输出显示为 ŷ（戏称为“y-hat”）\n\n### 第二部分\n\n#### 机器学习类型\n\n机器学习有多种类型，必须根据尝试预测的内容应用适当的类型。 下图显示了常见机器学习类型的细目。\n\n{% asset_img \"machine-learning-types.png\" \"machine learn type\" %}\n\n##### 监督式机器学习\n\n监督式机器学习是机器学习算法的一个通用术语，其中训练数据包括特征值和已知标签值。 监督式机器学习用于通过确定过去观测值中特征与标签之间的关系来训练模型，以便将来可以预测特征的未知标签。\n\n###### 回归\n\n回归是监督式机器学习的一种形式，其中模型预测的标签是数值。 例如：\n\n- 给定一天销售的冰淇淋数量，基于温度、降雨量和风速。\n- 物业的销售价格，基于物业大小（以平方英尺为单位）、所含卧室数量及所在位置的社会经济指标。\n- 汽车燃油效率（以英里/加仑为单位），基于发动机大小、重量、宽度、高度和长度。\n\n###### 分类\n\n分类是监督式机器学习的一种形式，其中标签表示一个分类或类。 有两种常见的分类场景。\n\n**二元分类**\n在二元分类中，标签确定观察到的项是（或不是）特定类的实例。 换句话说，二元分类模型预测两个互斥结果中的一个。 例如：\n\n- 基于体重、年龄、血糖水平等临床指标，患者是否有患糖尿病的风险。\n- 基于收入、信用记录、年龄和其他因素，银行客户是否会拖欠贷款。\n- 基于人口统计属性和过去的购买情况，邮寄列表客户是否会对营销产品/服务做出积极响应。\n\n在所有这些示例中，模型为单个可能类预测二进制 true/false 或积极/消极预测。\n\n**多类分类**\n\n多类分类扩展了二元分类，以预测表示多个可能类之一的标签。 例如，\n\n- 企鹅的物种（阿德利企鹅、巴布亚企鹅或帽带企鹅），基于身体测量。\n- 电影的流派（喜剧、恐怖、爱情、冒险或科幻），基于演员、导演和预算。\n\n在涉及一组已知多个类的场景中，多类分类用于预测互斥标签。 例如，一只企鹅不能同时是巴布亚企鹅和阿德利企鹅。 但是，还可以使用一些算法来训练多标签分类模型，其中对于单个观测值可能有多个有效标签。 例如，一部电影可能同时被归类为科幻和喜剧。\n\n##### 非监督式机器学习\n非监督式机器学习涉及使用仅包含特征值且没有任何已知标签的数据来训练模型。 非监督式机器学习算法确定训练数据中观测值的特征之间的关系。\n\n###### 群集/聚类分析\n非监督式机器学习最常见的形式是聚类分析。 聚类分析算法基于观测值的特征识别观测值之间的相似性，并将它们分组到离散群集中。 例如：\n\n- 根据花的大小、叶数和花瓣数量，对类似的花进行分组。\n- 根据人口统计属性和购买行为，确定类似客户的组。\n\n在某些方面，聚类分析类似于多类分类；因为它将观侧值分类为离散组。 区别在于，使用分类时，你已经知道训练数据中的观测值所属的类；因此，该算法的工作原理是确定特征与已知分类标签之间的关系。 在聚类分析中，没有以前已知的分类标签，算法完全基于特征的相似性对数据观测值进行分组。\n\n在某些情况下，聚类分析用于确定在训练分类模型之前存在的类集。 例如，可以使用聚类分析将客户细分到多个组，然后对这些组进行分析，以识别不同的客户类并对其进行分类（高价值 - 低交易量、经常购买小额产品等）。 然后，可以使用分类来标记聚类分析结果中的观测值，并使用标记的数据来训练预测新客户可能属于哪个客户类别的分类模型。\n\n### 第三部分\n\n#### 回归\n\n回归模型经过训练，基于包括特征和已知标签的训练数据来预测数值标签值。 训练回归模型（或者实际上，任何监督式机器学习模型）的过程涉及多次迭代，在这些迭代中，你使用适当的算法（通常带有一些参数化设置）来训练模型，评估模型的预测性能，并通过使用不同的算法和参数重复训练过程来优化模型，直到达到可接受的预测准确性级别。\n\n{% asset_img \"supervised-training.png\" \"supervised training\" %}\n\n此图显示了监督式机器学习模型的训练过程的四个关键元素：\n\n- 拆分训练数据（随机）以创建用于训练模型的数据集，同时保留要用于验证已训练模型的一部分数据。\n- 使用算法以将训练数据拟合到模型。 对于回归模型，使用回归算法，例如线性回归。\n- 使用保留的验证数据，通过预测特征的标签来测试模型。\n- 将验证数据集中的已知实际标签与模型预测的标签进行比较。 然后，聚合预测的标签值和实际的标签值之间的差异以计算一个指标，该指标指示模型对验证数据的预测准确度。\n\n每次训练、验证和评估迭代后，可以使用不同的算法和参数重复该过程，直到达到可接受的评估指标。\n\n#### 示例 - 回归\n\n让我们通过一个简化的示例来探索回归，在该示例中，我们将训练一个模型以基于单个特征值 (x) 预测数值标签 (y)。 大多数实际场景涉及多个特征值，这增加了一些复杂性；但原理是相同的。\n\n对于示例，让我们继续使用之前讨论过的冰淇淋销售场景。 对于特征，我们将考虑温度（假设该值是给定日期的最高温度），我们希望训练模型以预测的标签是当天售出的冰淇淋数量。 我们将从一些历史数据开始，其中包括每日温度 (x) 和冰淇淋销售额 (y) 的记录：\n\n| 温度 (x) | 冰淇淋销售额 (y) |\n| -------- | ---------------- |\n| 51       | 1                |\n| 52       | 0                |\n| 67       | 14               |\n| 65       | 14               |\n| 70       | 23               |\n| 69       | 20               |\n| 72       | 23               |\n| 75       | 26               |\n| 73       | 22               |\n| 81       | 30               |\n| 78       | 26               |\n| 83       | 36               |\n\n##### 训练回归模型\n\n首先，我们将拆分数据，并使用其中一部分数据来训练模型。 下面是训练数据集：\n\n| 温度 (x) | 冰淇淋销售额 (y) |\n| -------- | ---------------- |\n| 51       | 1                |\n| 65       | 14               |\n| 69       | 20               |\n| 72       | 23               |\n| 75       | 26               |\n| 81       | 30               |\n\n若要深入了解这些 x 和 y 值如何相互关联，我们可以将它们绘制为沿两个轴的坐标，如下所示：\n\n{% asset_img \"scatter-plot.png\" \"scatter plot\" %}\n\n现在，我们已准备好将算法应用于训练数据，并将其拟合到将运算应用于 x 以计算 y 的函数。 其中一种算法是线性回归，它的工作原理是派生一个函数，该函数通过 x 和 y 值的交点生成一条直线，同时最小化直线和绘制点之间的平均距离，如下所示：\n\n{% asset_img \"regression-line.png\" \"regression line\" %}\n\n这条直线是函数的可视表示形式，其中直线的斜率描述了如何针对给定的 x 值计算 y 值。 这条直线在 50 处与 x 轴相交，因此当 x 为 50 时，y 为 0。 从绘图中的轴标记可以看出，直线倾斜，使得沿 x 轴每增加 5，沿 y 轴就会增加 5；因此当 x 为 55 时，y 为 5；当 x 为60时，y 为 10，依此类推。 若要针对给定的 x 值计算 y 值，函数只需减去 50；换句话说，函数可以如下表示：\n\nf(x) = x-50\n\n可以使用此函数来预测任何给定温度下一天售出的冰淇淋数量。 例如，假设天气预报告诉我们，明天将是 77 度。 我们可以应用模型来计算 77-50，并预测我们明天将销售 27 个冰淇淋。\n\n但是我们的模型有多准确呢？\n\n##### 评估回归模型\n\n为了验证模型并评估其预测效果，我们保留了一些已知标签 (y) 值的数据。 下面是我们保留的数据：\n\n| 温度 (x) | 冰淇淋销售额 (y) |\n| -------- | ---------------- |\n| 52       | 0                |\n| 67       | 14               |\n| 70       | 23               |\n| 73       | 22               |\n| 78       | 26               |\n| 83       | 36               |\n\n可以使用模型根据特征 (x) 值来预测此数据集中每个观测值的标签；然后，将预测的标签 (ŷ) 与已知的实际标签值 (y) 进行比较。\n\n使用前面训练的模型（该模型封装函数 f(x) = x-50），可生成以下预测：\n\n| 温度 (x) | 实际销售额 (y) |\n| -------- | -------------- |\n| 52       | 0              |\n| 67       | 14             |\n| 70       | 23             |\n| 73       | 22             |\n| 78       | 26             |\n| 83       | 36             |\n\n我们可以针对特征值绘制预测标签和实际标签，如下所示：\n\n{% asset_img \"regression-variance.png\" \"regression variance\" %}\n\n预测标签由模型计算，因此它们位于函数线上，但是由函数计算的 ŷ 值与来自验证数据集的实际 y 值之间存在一些差异；这在绘图上表示为 ŷ 值和 y 值之间的线，显示预测值与实际值的差距。\n\n##### 回归评估指标\n\n根据预测值和实际值之间的差异，可以计算用于评估回归模型的一些常见指标。\n\n平均绝对误差 (MAE)\n\n此示例中的方差指示每个预测错误的冰淇淋数量。 预测是高于还是低于实际值无关紧要（例如，-3 和 +3 都表示方差为 3）。 此指标被称为每个预测的绝对误差，并且可以被总结为整个验证集的平均绝对误差 (MAE)。\n\n在冰淇淋示例中，绝对误差（2、3、3、1、2 和 3）的平均值为 2.33。\n\n###### 均方误差 (MSE)\n\n平均绝对误差指标同等地考虑预测标签和实际标签之间的所有差异。 然而，相比误差较少但较大的模型，一个始终误差较小的模型可能更可取。 生成“放大”较大误差的指标的一种方法是对单个误差求平方，并计算平方值的平均值。 此指标被称为均方误差 (MSE)。\n\n在我们的冰淇淋示例中，绝对值平方（4、9、9、1、4 和 9）的平均值为 6。\n\n###### 均方根误差 (RMSE)\n\n均方误差有助于考虑误差的幅度，但是因为它对误差值进行平方，所以得到的指标不再代表标签测量的量。 换句话说，我们可以说模型的 MSE 为 6，但这并不能衡量它在被错误预测的冰淇淋数量方面的准确性；6 只是一个数字分数，表示验证预测中的错误级别。\n\n如果要根据冰淇淋的数量来衡量误差，我们需要计算 MSE 的平方根；不出所料，这生成了一个名为均方根误差的指标。 在本例中，为 √6，即 2.45（冰淇淋）。\n\n###### 决定系数 (R2)\n\n到目前为止，所有指标都比较预测值与实际值之间的差异，以评估模型。 然而，在现实中，模型考虑到了冰淇淋日销售额中的一些自然随机差异。 在线性回归模型中，训练算法拟合一条直线，使函数和已知标签值之间的平均方差最小化。 决定系数（通常称为 R2 或 R 平方）是一种指标，用于测量验证结果中可由模型解释的方差比例，而不是验证数据的某些异常方面（例如，由于当地节日，某一天的冰淇淋销售量非常不寻常）。\n\nR2 的计算比前面的指标更复杂。 它将预测标签和实际标签之间的平方差之和与实际标签值和实际标签值的平均值之间的平方差之和进行比较，如下所示：\n\nR2 = 1- ∑(y-ŷ)2 ÷ ∑(y-ȳ)2\n\n如果这看起来很复杂，不要太担心；大多数机器学习工具都可以为你计算指标。 重要的一点是，结果是一个介于 0 和 1 之间的值，该值描述了模型所解释的方差的比例。 简单来说，此值越接近 1，模型就越拟合验证数据。 对于冰淇淋回归模型，根据验证数据计算的 R2 为 0.95。\n\n### 第四部分\n\n#### 二元分类\n\n分类与回归一样，是一种受监督的机器学习技术，因此遵循相同的适用于训练、验证和评估模型的迭代过程。 用于训练分类模型的算法不是像回归模型那样计算数值，而是计算类分配的概率值以及用于评估模型性能的评估指标，将预测类与实际类进行比较。\n\n二元分类算法用于训练模型，该模型可预测单个类的两个可能标签之一。 本质上是预测 true 或 false。 在大多数实际方案中，用于训练和验证模型的数据观测值包含多个特征 (x) 值和一个为 1 或 0 的 y 值。\n\n#### 示例 - 二元分类\n\n为了了解二元分类的工作原理，我们来看一个简化的示例，该示例使用单个特征 (x) 来预测标签 y 是 1 还是 0。 在此示例中，我们将使用患者的血糖水平来预测患者是否患有糖尿病。 下面是用于训练模型的数据：\n\n| 血糖 (x) | **糖尿病？ (y)** |\n| -------- | ---------------- |\n| 67       | 0                |\n| 103      | 1                |\n| 114      | 1                |\n| 72       | 0                |\n| 116      | 1                |\n| 65       | 0                |\n\n##### 训练二元分类模型\n\n为了训练模型，我们将使用一种算法将训练数据拟合为一个函数，该函数计算类标签为 true（换句话说，患者有糖尿病）的概率。 概率以某个 0.0 到 1.0 之间的值来度量，使得所有可能的类的总概率为 1.0。 例如，如果一名患者患糖尿病的概率为 0.7，那么该患者未患糖尿病的相应概率为 0.3。\n\n有许多可用于二元分类的算法，例如逻辑回归，它会导出值在 0.0 到 1.0 之间的 sigmoid（S 形）函数，如下所示：\n\n{% asset_img \"sigmoid-plot.png\" \"sigmoid plot\" %}\n\n> 尽管名称如此，但在机器学习中，逻辑回归用于分类，而不是用于回归。 重点是它生成的函数的逻辑性质，该函数描述了下限值和上限值（用于二元分类时为 0.0 和 1.0）之间的 S 形曲线。\n\n该算法生成的函数描述了 x 为给定值时 y 为 true (y=1) 的概率。 从数学上来说，可以这样表达该函数：\n\nf(x) = P(y=1 | x)\n\n就训练数据中六个观测值中的三个来说，我们知道 y 肯定为 true，因此就这些观测值来说，y=1 的概率为 1.0；就其他三个来说，我们知道 y 肯定为 false，因此 y=1 的概率为 0.0。 S 形曲线描绘了概率分布情况，因此在曲线上标出 x 的值就可以确定 y 为 1 的相应概率。\n\n该图还包含一条水平线，指示基于此函数的模型将预测 true (1) 或 false (0) 的阈值。 阈值位于 y (P(y) = 0.5) 的中间点。 对于此点或高于此点的任何值，模型会预测 true (1)；而对于低于此点的任何值，模型会预测 false (0)。 例如，对于血糖水平为 90 的患者，该函数将得出的概率值为 0.9。 由于 0.9 高于阈值 0.5，因此模型会预测 true (1) - 换句话说，预测患者患有糖尿病。\n\n##### 评估二元分类模型\n\n与回归一样，在训练二元分类模型时，我们会保留一个随机数据子集来验证训练后的模型。 假设我们保留以下数据来验证糖尿病分类器：\n\n| 血糖 (x) | 糖尿病？ (y) |\n| -------- | ------------ |\n| 66       | 0            |\n| 107      | 1            |\n| 112      | 1            |\n| 71       | 0            |\n| 87       | 1            |\n| 89       | 1            |\n\n将我们之前派生的逻辑函数应用于 x 值会生成下图。\n\n{% asset_img \"classification-predictions.png\" \"classification predictions\" %}\n\n模型为每个观测值生成预测标签 1 或 0，具体取决于函数计算出的概率是高于阈值还是低于阈值。 然后，我们可以将预测的类标签 (ŷ) 与实际的类标签 (y) 进行比较，如下所示：\n\n| 血糖 (x) | 实际的糖尿病诊断 (y) | 预测的糖尿病诊断 (ŷ) |\n| -------- | -------------------- | -------------------- |\n| 66       | 0                    | 0                    |\n| 107      | 1                    | 1                    |\n| 112      | 1                    | 1                    |\n| 71       | 0                    | 0                    |\n| 87       | 1                    | 0                    |\n| 89       | 1                    | 1                    |\n\n##### 二元分类评估指标\n\n计算二元分类模型的评估指标的第一步通常是为每个可能的类标签创建正确预测和错误预测的数量矩阵：\n\n{% asset_img \"binary-confusion-matrix.png\" \"binary confusion matrix\" %}\n\n此可视化效果称为混淆矩阵，它显示预测总计，其中：\n\n- ŷ=0 且 y=0：真阴性 (TN)\n- ŷ=1 且 y=0：假阳性 (FP)\n- ŷ=0 且 y=1：假阴性 (FN)\n- ŷ=1 且 y=1：真阳性 (TP)\n\n混淆矩阵的排列是这样的：正确 (true) 预测显示在从左上角到右下角的对角线上。 通常情况下，颜色强度用于指示每个单元格中的预测数量，因此快速浏览一下预测良好的模型应该就会看出深阴影对角线趋势。\n\n###### 精确度\n\n可以根据混淆矩阵计算出的最简单指标是准确度 - 模型正确预测的比例。 准确度的计算方式如下：\n\n(TN+TP) ÷ (TN+FN+FP+TP)\n\n在我们的糖尿病示例中，计算如下：\n\n(2+3) ÷ (2+1+0+3)\n\n= 5 ÷ 6\n\n= **0.83**\n\n因此，就我们的验证数据来说，糖尿病分类模型在 83% 的情况下产生正确的预测。\n\n准确度一开始似乎是评估模型的一个很好的指标，但请考虑这一点。 假设 11% 的人口患有糖尿病。 可以创建一个始终预测 0 的模型，即使在没有真正尝试通过评估患者的特征来区分患者的情况下，其准确率仍可达到 89%。 我们真正需要的是更深入地了解模型在预测 1（代表阳性病例）和 0（代表阴性病例）时的表现。\n\n###### 召回率\n\n召回率是度量此模型正确识别的阳性病例比例的指标。 换句话说，与确实患有糖尿病的患者人数相比，此模型预测有多少人患有糖尿病？\n\n召回率的公式为：\n\nTP ÷ (TP+FN)\n\n就我们的糖尿病示例来说：\n\n3 ÷ (3+1)\n\n= 3 ÷ 4\n\n= **0.75**\n\n因此，我们的模型正确地将 75% 的糖尿病患者识别为糖尿病患者。\n\n###### 精度\n\n精准率是与召回率类似的指标，但度量的是预测为阳性病例且真实标签实际上也为阳性的比例。 换句话说，在模型预测患有糖尿病的患者中，实际患有糖尿病的患者的比例是多少？\n\n精准率公式为：\n\nTP ÷ (TP+FP)\n\n就我们的糖尿病示例来说：\n\n3 ÷ (3+0)\n\n= 3 ÷ 3\n\n= **1.0**\n\n因此，在我们的模型预测的患有糖尿病的患者中，100% 的人确实患有糖尿病。\n\n###### F1 分数\n\nF1 分数是一个结合了召回率和精准率的总体指标。 F1 分数的公式为：\n\n(2 x 精准率 x 召回率) ÷ (精准率 + 召回率)\n\n就我们的糖尿病示例来说：\n\n(2 x 1.0 x 0.75) ÷ (1.0 + 0.75)\n\n= 1.5 ÷ 1.75\n\n**= 0.86**\n\n###### 曲线下面积 (AUC)\n\n召回率的另一个名称是真阳性率 (TPR)。此外还有一个称为假阳性率 (FPR) 的等效指标，其计算公式为 FP÷(FP+TN)。 我们已经知道，在使用阈值 0.5 时，我们的模型的 TPR 为 0.75。我们可以使用 FPR 的公式计算出 0÷2 的值为 0。\n\n当然，如果我们更改模型预测 true (1) 的阈值，则会影响阳性和阴性预测的数量，因此会更改 TPR 和 FPR 指标。 这些指标通常用于通过绘制接收方操作特征 (ROC) 曲线来评估模型，该曲线会比较 0.0 到 1.0 之间的每个可能阈值的 TPR 和 FPR：\n\n{% asset_img \"roc-chart.png\" \"roc chart\" %}\n\n完美模型的 ROC 曲线会沿左侧的 TPR 轴直线上升，然后穿过顶部的 FPR 轴。 由于曲线的绘图面积为 1x1，因此该完美曲线下的面积将为 1.0（这意味着模型始终是正确的）。 相比之下，从左下角到右上角的对角线表示通过随机猜测二进制标签获得的结果；产生的曲线下面积为 0.5。 换句话说，给定两个可能的类标签，你可以合理预期猜对的概率为 50%。\n\n就我们的糖尿病模型来说，会生成上面的曲线，曲线下面积 (AUC) 指标为 0.875。 由于 AUC 高于 0.5，因此我们可以得出结论：该模型在预测患者是否患有糖尿病方面比随机猜测的表现更好。\n","slug":"ai-900-exam-preparation-2","published":1,"updated":"2025-07-08T12:05:00.534Z","layout":"post","photos":[],"_id":"cmcvxsshl00083cug7vb59e9x","content":"<h2 id=\"Microsoft-Azure-AI-基础\"><a href=\"#Microsoft-Azure-AI-基础\" class=\"headerlink\" title=\"Microsoft Azure AI 基础\"></a>Microsoft Azure AI 基础</h2><h3 id=\"第一部分\"><a href=\"#第一部分\" class=\"headerlink\" title=\"第一部分\"></a>第一部分</h3><h4 id=\"什么是机器学习\"><a href=\"#什么是机器学习\" class=\"headerlink\" title=\"什么是机器学习\"></a>什么是机器学习</h4><p>机器学习起源于数据的统计和数学建模。 机器学习的基本理念是使用过去观测到的数据来预测未知的结果或值。 例如：</p>\n<ul>\n<li>冰淇淋店的老板可能会使用某个应用，结合历史销售和天气记录，根据天气预报来预测他们在某一天可能会售出多少个冰淇淋。</li>\n<li>医生可能会使用以往患者的临床数据来运行自动测试，以根据体重、血糖水平和其他测量值等因素来预测新患者是否有患糖尿病的风险。</li>\n<li>南极研究人员可能会利用过去的观测值，根据鸟类脚蹼、喙和其他物理属性的测量，自动识别不同的企鹅物种（例如阿德利企鹅、白眉企鹅或帽带企鹅）。</li>\n</ul>\n<h4 id=\"机器学习作为一种函数\"><a href=\"#机器学习作为一种函数\" class=\"headerlink\" title=\"机器学习作为一种函数\"></a>机器学习作为一种函数</h4><p>由于机器学习基于数学和统计学，因此通常会使用数学术语来思考机器学习模型。 从根本上讲，机器学习模型是一种软件应用程序，它封装一个函数用于根据一个或多个输入值计算输出值。 定义该函数的过程称为训练。 定义函数后，可以使用它在称为“推理”的过程中预测新值。</p>\n<p>让我们探讨一下训练和推理所涉及的步骤。</p>\n<img src=\"/2025/02/25/ai-900-exam-preparation-2/machine-learning.png\" class=\"\" title=\"machine learn\">\n\n<ol>\n<li><p>训练数据由过去的观测值组成。 在大多数情况下，观测值包括观测到的事物的属性或特征，以及要训练模型来预测的事物的已知值（称为标签）。<br> 在数学术语中，你经常会看到使用速记变量名称 x 引用的特征，以及使用 y 引用的标签。 通常，观测值由多个特征值组成，因此 x 实际上是一个向量（包含多个值的数组），如下所示：[x1,x2,x3,…]。<br> 为了澄清这一点，让我们分析前面所述的示例：</p>\n<ul>\n<li>在冰淇淋销售场景中，我们的目标是训练一个可以根据天气预测冰淇淋销售数量的模型。 当天的天气测量值（温度、降雨量、风速等）是特征 (x)，每日售出的冰淇淋数量是标签 (y)。</li>\n<li>在医疗场景中，目标是根据患者的临床测量值预测患者是否有患糖尿病的风险。 患者的测量值（体重、血糖水平等）是特征 (x)，患糖尿病的可能性（例如，1 表示有风险，0 表示没有风险）是标签 (y)。</li>\n<li>在南极研究场景中，我们希望根据企鹅的物理属性来预测其物种。 企鹅的关键测量值（脚蹼的长度、喙的宽度等）是特征 (x)，物种（例如，0 表示阿德利企鹅，1 表示白眉企鹅，2 表示帽带企鹅）是标签 (y)。</li>\n</ul>\n</li>\n<li><p>将对数据应用某种算法，以尝试确定特征与标签之间的关系，然后泛化这种关系，以便针对 x 执行计算来计算 y。 使用的具体算法取决于要解决的预测问题的类型（稍后会详细介绍），但基本原 则是尝试将一个函数拟合到数据，其中的特征值可用于计算标签</p>\n</li>\n<li><p>算法的结果是一个模型，该模型将算法派生的计算封装为函数 - 我们称之为 f。 采用数学表示法：</p>\n</li>\n</ol>\n<p>y &#x3D; f(x)</p>\n<ol start=\"4\">\n<li>完成训练阶段后，训练的模型可用于推理。 模型本质上是一个软件程序，可以封装训练过程生成的函数。 你可以输入一组特征值，并接收相应标签的预测结果作为输出。 由于模型的输出是函数计算的预测值而不是观测值，因此你经常会看到函数的输出显示为 ŷ（戏称为“y-hat”）</li>\n</ol>\n<h3 id=\"第二部分\"><a href=\"#第二部分\" class=\"headerlink\" title=\"第二部分\"></a>第二部分</h3><h4 id=\"机器学习类型\"><a href=\"#机器学习类型\" class=\"headerlink\" title=\"机器学习类型\"></a>机器学习类型</h4><p>机器学习有多种类型，必须根据尝试预测的内容应用适当的类型。 下图显示了常见机器学习类型的细目。</p>\n<img src=\"/2025/02/25/ai-900-exam-preparation-2/machine-learning-types.png\" class=\"\" title=\"machine learn type\">\n\n<h5 id=\"监督式机器学习\"><a href=\"#监督式机器学习\" class=\"headerlink\" title=\"监督式机器学习\"></a>监督式机器学习</h5><p>监督式机器学习是机器学习算法的一个通用术语，其中训练数据包括特征值和已知标签值。 监督式机器学习用于通过确定过去观测值中特征与标签之间的关系来训练模型，以便将来可以预测特征的未知标签。</p>\n<h6 id=\"回归\"><a href=\"#回归\" class=\"headerlink\" title=\"回归\"></a>回归</h6><p>回归是监督式机器学习的一种形式，其中模型预测的标签是数值。 例如：</p>\n<ul>\n<li>给定一天销售的冰淇淋数量，基于温度、降雨量和风速。</li>\n<li>物业的销售价格，基于物业大小（以平方英尺为单位）、所含卧室数量及所在位置的社会经济指标。</li>\n<li>汽车燃油效率（以英里&#x2F;加仑为单位），基于发动机大小、重量、宽度、高度和长度。</li>\n</ul>\n<h6 id=\"分类\"><a href=\"#分类\" class=\"headerlink\" title=\"分类\"></a>分类</h6><p>分类是监督式机器学习的一种形式，其中标签表示一个分类或类。 有两种常见的分类场景。</p>\n<p><strong>二元分类</strong><br>在二元分类中，标签确定观察到的项是（或不是）特定类的实例。 换句话说，二元分类模型预测两个互斥结果中的一个。 例如：</p>\n<ul>\n<li>基于体重、年龄、血糖水平等临床指标，患者是否有患糖尿病的风险。</li>\n<li>基于收入、信用记录、年龄和其他因素，银行客户是否会拖欠贷款。</li>\n<li>基于人口统计属性和过去的购买情况，邮寄列表客户是否会对营销产品&#x2F;服务做出积极响应。</li>\n</ul>\n<p>在所有这些示例中，模型为单个可能类预测二进制 true&#x2F;false 或积极&#x2F;消极预测。</p>\n<p><strong>多类分类</strong></p>\n<p>多类分类扩展了二元分类，以预测表示多个可能类之一的标签。 例如，</p>\n<ul>\n<li>企鹅的物种（阿德利企鹅、巴布亚企鹅或帽带企鹅），基于身体测量。</li>\n<li>电影的流派（喜剧、恐怖、爱情、冒险或科幻），基于演员、导演和预算。</li>\n</ul>\n<p>在涉及一组已知多个类的场景中，多类分类用于预测互斥标签。 例如，一只企鹅不能同时是巴布亚企鹅和阿德利企鹅。 但是，还可以使用一些算法来训练多标签分类模型，其中对于单个观测值可能有多个有效标签。 例如，一部电影可能同时被归类为科幻和喜剧。</p>\n<h5 id=\"非监督式机器学习\"><a href=\"#非监督式机器学习\" class=\"headerlink\" title=\"非监督式机器学习\"></a>非监督式机器学习</h5><p>非监督式机器学习涉及使用仅包含特征值且没有任何已知标签的数据来训练模型。 非监督式机器学习算法确定训练数据中观测值的特征之间的关系。</p>\n<h6 id=\"群集-聚类分析\"><a href=\"#群集-聚类分析\" class=\"headerlink\" title=\"群集&#x2F;聚类分析\"></a>群集&#x2F;聚类分析</h6><p>非监督式机器学习最常见的形式是聚类分析。 聚类分析算法基于观测值的特征识别观测值之间的相似性，并将它们分组到离散群集中。 例如：</p>\n<ul>\n<li>根据花的大小、叶数和花瓣数量，对类似的花进行分组。</li>\n<li>根据人口统计属性和购买行为，确定类似客户的组。</li>\n</ul>\n<p>在某些方面，聚类分析类似于多类分类；因为它将观侧值分类为离散组。 区别在于，使用分类时，你已经知道训练数据中的观测值所属的类；因此，该算法的工作原理是确定特征与已知分类标签之间的关系。 在聚类分析中，没有以前已知的分类标签，算法完全基于特征的相似性对数据观测值进行分组。</p>\n<p>在某些情况下，聚类分析用于确定在训练分类模型之前存在的类集。 例如，可以使用聚类分析将客户细分到多个组，然后对这些组进行分析，以识别不同的客户类并对其进行分类（高价值 - 低交易量、经常购买小额产品等）。 然后，可以使用分类来标记聚类分析结果中的观测值，并使用标记的数据来训练预测新客户可能属于哪个客户类别的分类模型。</p>\n<h3 id=\"第三部分\"><a href=\"#第三部分\" class=\"headerlink\" title=\"第三部分\"></a>第三部分</h3><h4 id=\"回归-1\"><a href=\"#回归-1\" class=\"headerlink\" title=\"回归\"></a>回归</h4><p>回归模型经过训练，基于包括特征和已知标签的训练数据来预测数值标签值。 训练回归模型（或者实际上，任何监督式机器学习模型）的过程涉及多次迭代，在这些迭代中，你使用适当的算法（通常带有一些参数化设置）来训练模型，评估模型的预测性能，并通过使用不同的算法和参数重复训练过程来优化模型，直到达到可接受的预测准确性级别。</p>\n<img src=\"/2025/02/25/ai-900-exam-preparation-2/supervised-training.png\" class=\"\" title=\"supervised training\">\n\n<p>此图显示了监督式机器学习模型的训练过程的四个关键元素：</p>\n<ul>\n<li>拆分训练数据（随机）以创建用于训练模型的数据集，同时保留要用于验证已训练模型的一部分数据。</li>\n<li>使用算法以将训练数据拟合到模型。 对于回归模型，使用回归算法，例如线性回归。</li>\n<li>使用保留的验证数据，通过预测特征的标签来测试模型。</li>\n<li>将验证数据集中的已知实际标签与模型预测的标签进行比较。 然后，聚合预测的标签值和实际的标签值之间的差异以计算一个指标，该指标指示模型对验证数据的预测准确度。</li>\n</ul>\n<p>每次训练、验证和评估迭代后，可以使用不同的算法和参数重复该过程，直到达到可接受的评估指标。</p>\n<h4 id=\"示例-回归\"><a href=\"#示例-回归\" class=\"headerlink\" title=\"示例 - 回归\"></a>示例 - 回归</h4><p>让我们通过一个简化的示例来探索回归，在该示例中，我们将训练一个模型以基于单个特征值 (x) 预测数值标签 (y)。 大多数实际场景涉及多个特征值，这增加了一些复杂性；但原理是相同的。</p>\n<p>对于示例，让我们继续使用之前讨论过的冰淇淋销售场景。 对于特征，我们将考虑温度（假设该值是给定日期的最高温度），我们希望训练模型以预测的标签是当天售出的冰淇淋数量。 我们将从一些历史数据开始，其中包括每日温度 (x) 和冰淇淋销售额 (y) 的记录：</p>\n<table>\n<thead>\n<tr>\n<th>温度 (x)</th>\n<th>冰淇淋销售额 (y)</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>51</td>\n<td>1</td>\n</tr>\n<tr>\n<td>52</td>\n<td>0</td>\n</tr>\n<tr>\n<td>67</td>\n<td>14</td>\n</tr>\n<tr>\n<td>65</td>\n<td>14</td>\n</tr>\n<tr>\n<td>70</td>\n<td>23</td>\n</tr>\n<tr>\n<td>69</td>\n<td>20</td>\n</tr>\n<tr>\n<td>72</td>\n<td>23</td>\n</tr>\n<tr>\n<td>75</td>\n<td>26</td>\n</tr>\n<tr>\n<td>73</td>\n<td>22</td>\n</tr>\n<tr>\n<td>81</td>\n<td>30</td>\n</tr>\n<tr>\n<td>78</td>\n<td>26</td>\n</tr>\n<tr>\n<td>83</td>\n<td>36</td>\n</tr>\n</tbody></table>\n<h5 id=\"训练回归模型\"><a href=\"#训练回归模型\" class=\"headerlink\" title=\"训练回归模型\"></a>训练回归模型</h5><p>首先，我们将拆分数据，并使用其中一部分数据来训练模型。 下面是训练数据集：</p>\n<table>\n<thead>\n<tr>\n<th>温度 (x)</th>\n<th>冰淇淋销售额 (y)</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>51</td>\n<td>1</td>\n</tr>\n<tr>\n<td>65</td>\n<td>14</td>\n</tr>\n<tr>\n<td>69</td>\n<td>20</td>\n</tr>\n<tr>\n<td>72</td>\n<td>23</td>\n</tr>\n<tr>\n<td>75</td>\n<td>26</td>\n</tr>\n<tr>\n<td>81</td>\n<td>30</td>\n</tr>\n</tbody></table>\n<p>若要深入了解这些 x 和 y 值如何相互关联，我们可以将它们绘制为沿两个轴的坐标，如下所示：</p>\n<img src=\"/2025/02/25/ai-900-exam-preparation-2/scatter-plot.png\" class=\"\" title=\"scatter plot\">\n\n<p>现在，我们已准备好将算法应用于训练数据，并将其拟合到将运算应用于 x 以计算 y 的函数。 其中一种算法是线性回归，它的工作原理是派生一个函数，该函数通过 x 和 y 值的交点生成一条直线，同时最小化直线和绘制点之间的平均距离，如下所示：</p>\n<img src=\"/2025/02/25/ai-900-exam-preparation-2/regression-line.png\" class=\"\" title=\"regression line\">\n\n<p>这条直线是函数的可视表示形式，其中直线的斜率描述了如何针对给定的 x 值计算 y 值。 这条直线在 50 处与 x 轴相交，因此当 x 为 50 时，y 为 0。 从绘图中的轴标记可以看出，直线倾斜，使得沿 x 轴每增加 5，沿 y 轴就会增加 5；因此当 x 为 55 时，y 为 5；当 x 为60时，y 为 10，依此类推。 若要针对给定的 x 值计算 y 值，函数只需减去 50；换句话说，函数可以如下表示：</p>\n<p>f(x) &#x3D; x-50</p>\n<p>可以使用此函数来预测任何给定温度下一天售出的冰淇淋数量。 例如，假设天气预报告诉我们，明天将是 77 度。 我们可以应用模型来计算 77-50，并预测我们明天将销售 27 个冰淇淋。</p>\n<p>但是我们的模型有多准确呢？</p>\n<h5 id=\"评估回归模型\"><a href=\"#评估回归模型\" class=\"headerlink\" title=\"评估回归模型\"></a>评估回归模型</h5><p>为了验证模型并评估其预测效果，我们保留了一些已知标签 (y) 值的数据。 下面是我们保留的数据：</p>\n<table>\n<thead>\n<tr>\n<th>温度 (x)</th>\n<th>冰淇淋销售额 (y)</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>52</td>\n<td>0</td>\n</tr>\n<tr>\n<td>67</td>\n<td>14</td>\n</tr>\n<tr>\n<td>70</td>\n<td>23</td>\n</tr>\n<tr>\n<td>73</td>\n<td>22</td>\n</tr>\n<tr>\n<td>78</td>\n<td>26</td>\n</tr>\n<tr>\n<td>83</td>\n<td>36</td>\n</tr>\n</tbody></table>\n<p>可以使用模型根据特征 (x) 值来预测此数据集中每个观测值的标签；然后，将预测的标签 (ŷ) 与已知的实际标签值 (y) 进行比较。</p>\n<p>使用前面训练的模型（该模型封装函数 f(x) &#x3D; x-50），可生成以下预测：</p>\n<table>\n<thead>\n<tr>\n<th>温度 (x)</th>\n<th>实际销售额 (y)</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>52</td>\n<td>0</td>\n</tr>\n<tr>\n<td>67</td>\n<td>14</td>\n</tr>\n<tr>\n<td>70</td>\n<td>23</td>\n</tr>\n<tr>\n<td>73</td>\n<td>22</td>\n</tr>\n<tr>\n<td>78</td>\n<td>26</td>\n</tr>\n<tr>\n<td>83</td>\n<td>36</td>\n</tr>\n</tbody></table>\n<p>我们可以针对特征值绘制预测标签和实际标签，如下所示：</p>\n\n\n<p>预测标签由模型计算，因此它们位于函数线上，但是由函数计算的 ŷ 值与来自验证数据集的实际 y 值之间存在一些差异；这在绘图上表示为 ŷ 值和 y 值之间的线，显示预测值与实际值的差距。</p>\n<h5 id=\"回归评估指标\"><a href=\"#回归评估指标\" class=\"headerlink\" title=\"回归评估指标\"></a>回归评估指标</h5><p>根据预测值和实际值之间的差异，可以计算用于评估回归模型的一些常见指标。</p>\n<p>平均绝对误差 (MAE)</p>\n<p>此示例中的方差指示每个预测错误的冰淇淋数量。 预测是高于还是低于实际值无关紧要（例如，-3 和 +3 都表示方差为 3）。 此指标被称为每个预测的绝对误差，并且可以被总结为整个验证集的平均绝对误差 (MAE)。</p>\n<p>在冰淇淋示例中，绝对误差（2、3、3、1、2 和 3）的平均值为 2.33。</p>\n<h6 id=\"均方误差-MSE\"><a href=\"#均方误差-MSE\" class=\"headerlink\" title=\"均方误差 (MSE)\"></a>均方误差 (MSE)</h6><p>平均绝对误差指标同等地考虑预测标签和实际标签之间的所有差异。 然而，相比误差较少但较大的模型，一个始终误差较小的模型可能更可取。 生成“放大”较大误差的指标的一种方法是对单个误差求平方，并计算平方值的平均值。 此指标被称为均方误差 (MSE)。</p>\n<p>在我们的冰淇淋示例中，绝对值平方（4、9、9、1、4 和 9）的平均值为 6。</p>\n<h6 id=\"均方根误差-RMSE\"><a href=\"#均方根误差-RMSE\" class=\"headerlink\" title=\"均方根误差 (RMSE)\"></a>均方根误差 (RMSE)</h6><p>均方误差有助于考虑误差的幅度，但是因为它对误差值进行平方，所以得到的指标不再代表标签测量的量。 换句话说，我们可以说模型的 MSE 为 6，但这并不能衡量它在被错误预测的冰淇淋数量方面的准确性；6 只是一个数字分数，表示验证预测中的错误级别。</p>\n<p>如果要根据冰淇淋的数量来衡量误差，我们需要计算 MSE 的平方根；不出所料，这生成了一个名为均方根误差的指标。 在本例中，为 √6，即 2.45（冰淇淋）。</p>\n<h6 id=\"决定系数-R2\"><a href=\"#决定系数-R2\" class=\"headerlink\" title=\"决定系数 (R2)\"></a>决定系数 (R2)</h6><p>到目前为止，所有指标都比较预测值与实际值之间的差异，以评估模型。 然而，在现实中，模型考虑到了冰淇淋日销售额中的一些自然随机差异。 在线性回归模型中，训练算法拟合一条直线，使函数和已知标签值之间的平均方差最小化。 决定系数（通常称为 R2 或 R 平方）是一种指标，用于测量验证结果中可由模型解释的方差比例，而不是验证数据的某些异常方面（例如，由于当地节日，某一天的冰淇淋销售量非常不寻常）。</p>\n<p>R2 的计算比前面的指标更复杂。 它将预测标签和实际标签之间的平方差之和与实际标签值和实际标签值的平均值之间的平方差之和进行比较，如下所示：</p>\n<p>R2 &#x3D; 1- ∑(y-ŷ)2 ÷ ∑(y-ȳ)2</p>\n<p>如果这看起来很复杂，不要太担心；大多数机器学习工具都可以为你计算指标。 重要的一点是，结果是一个介于 0 和 1 之间的值，该值描述了模型所解释的方差的比例。 简单来说，此值越接近 1，模型就越拟合验证数据。 对于冰淇淋回归模型，根据验证数据计算的 R2 为 0.95。</p>\n<h3 id=\"第四部分\"><a href=\"#第四部分\" class=\"headerlink\" title=\"第四部分\"></a>第四部分</h3><h4 id=\"二元分类\"><a href=\"#二元分类\" class=\"headerlink\" title=\"二元分类\"></a>二元分类</h4><p>分类与回归一样，是一种受监督的机器学习技术，因此遵循相同的适用于训练、验证和评估模型的迭代过程。 用于训练分类模型的算法不是像回归模型那样计算数值，而是计算类分配的概率值以及用于评估模型性能的评估指标，将预测类与实际类进行比较。</p>\n<p>二元分类算法用于训练模型，该模型可预测单个类的两个可能标签之一。 本质上是预测 true 或 false。 在大多数实际方案中，用于训练和验证模型的数据观测值包含多个特征 (x) 值和一个为 1 或 0 的 y 值。</p>\n<h4 id=\"示例-二元分类\"><a href=\"#示例-二元分类\" class=\"headerlink\" title=\"示例 - 二元分类\"></a>示例 - 二元分类</h4><p>为了了解二元分类的工作原理，我们来看一个简化的示例，该示例使用单个特征 (x) 来预测标签 y 是 1 还是 0。 在此示例中，我们将使用患者的血糖水平来预测患者是否患有糖尿病。 下面是用于训练模型的数据：</p>\n<table>\n<thead>\n<tr>\n<th>血糖 (x)</th>\n<th><strong>糖尿病？ (y)</strong></th>\n</tr>\n</thead>\n<tbody><tr>\n<td>67</td>\n<td>0</td>\n</tr>\n<tr>\n<td>103</td>\n<td>1</td>\n</tr>\n<tr>\n<td>114</td>\n<td>1</td>\n</tr>\n<tr>\n<td>72</td>\n<td>0</td>\n</tr>\n<tr>\n<td>116</td>\n<td>1</td>\n</tr>\n<tr>\n<td>65</td>\n<td>0</td>\n</tr>\n</tbody></table>\n<h5 id=\"训练二元分类模型\"><a href=\"#训练二元分类模型\" class=\"headerlink\" title=\"训练二元分类模型\"></a>训练二元分类模型</h5><p>为了训练模型，我们将使用一种算法将训练数据拟合为一个函数，该函数计算类标签为 true（换句话说，患者有糖尿病）的概率。 概率以某个 0.0 到 1.0 之间的值来度量，使得所有可能的类的总概率为 1.0。 例如，如果一名患者患糖尿病的概率为 0.7，那么该患者未患糖尿病的相应概率为 0.3。</p>\n<p>有许多可用于二元分类的算法，例如逻辑回归，它会导出值在 0.0 到 1.0 之间的 sigmoid（S 形）函数，如下所示：</p>\n<img src=\"/2025/02/25/ai-900-exam-preparation-2/sigmoid-plot.png\" class=\"\" title=\"sigmoid plot\">\n\n<blockquote>\n<p>尽管名称如此，但在机器学习中，逻辑回归用于分类，而不是用于回归。 重点是它生成的函数的逻辑性质，该函数描述了下限值和上限值（用于二元分类时为 0.0 和 1.0）之间的 S 形曲线。</p>\n</blockquote>\n<p>该算法生成的函数描述了 x 为给定值时 y 为 true (y&#x3D;1) 的概率。 从数学上来说，可以这样表达该函数：</p>\n<p>f(x) &#x3D; P(y&#x3D;1 | x)</p>\n<p>就训练数据中六个观测值中的三个来说，我们知道 y 肯定为 true，因此就这些观测值来说，y&#x3D;1 的概率为 1.0；就其他三个来说，我们知道 y 肯定为 false，因此 y&#x3D;1 的概率为 0.0。 S 形曲线描绘了概率分布情况，因此在曲线上标出 x 的值就可以确定 y 为 1 的相应概率。</p>\n<p>该图还包含一条水平线，指示基于此函数的模型将预测 true (1) 或 false (0) 的阈值。 阈值位于 y (P(y) &#x3D; 0.5) 的中间点。 对于此点或高于此点的任何值，模型会预测 true (1)；而对于低于此点的任何值，模型会预测 false (0)。 例如，对于血糖水平为 90 的患者，该函数将得出的概率值为 0.9。 由于 0.9 高于阈值 0.5，因此模型会预测 true (1) - 换句话说，预测患者患有糖尿病。</p>\n<h5 id=\"评估二元分类模型\"><a href=\"#评估二元分类模型\" class=\"headerlink\" title=\"评估二元分类模型\"></a>评估二元分类模型</h5><p>与回归一样，在训练二元分类模型时，我们会保留一个随机数据子集来验证训练后的模型。 假设我们保留以下数据来验证糖尿病分类器：</p>\n<table>\n<thead>\n<tr>\n<th>血糖 (x)</th>\n<th>糖尿病？ (y)</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>66</td>\n<td>0</td>\n</tr>\n<tr>\n<td>107</td>\n<td>1</td>\n</tr>\n<tr>\n<td>112</td>\n<td>1</td>\n</tr>\n<tr>\n<td>71</td>\n<td>0</td>\n</tr>\n<tr>\n<td>87</td>\n<td>1</td>\n</tr>\n<tr>\n<td>89</td>\n<td>1</td>\n</tr>\n</tbody></table>\n<p>将我们之前派生的逻辑函数应用于 x 值会生成下图。</p>\n<img src=\"/2025/02/25/ai-900-exam-preparation-2/classification-predictions.png\" class=\"\" title=\"classification predictions\">\n\n<p>模型为每个观测值生成预测标签 1 或 0，具体取决于函数计算出的概率是高于阈值还是低于阈值。 然后，我们可以将预测的类标签 (ŷ) 与实际的类标签 (y) 进行比较，如下所示：</p>\n<table>\n<thead>\n<tr>\n<th>血糖 (x)</th>\n<th>实际的糖尿病诊断 (y)</th>\n<th>预测的糖尿病诊断 (ŷ)</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>66</td>\n<td>0</td>\n<td>0</td>\n</tr>\n<tr>\n<td>107</td>\n<td>1</td>\n<td>1</td>\n</tr>\n<tr>\n<td>112</td>\n<td>1</td>\n<td>1</td>\n</tr>\n<tr>\n<td>71</td>\n<td>0</td>\n<td>0</td>\n</tr>\n<tr>\n<td>87</td>\n<td>1</td>\n<td>0</td>\n</tr>\n<tr>\n<td>89</td>\n<td>1</td>\n<td>1</td>\n</tr>\n</tbody></table>\n<h5 id=\"二元分类评估指标\"><a href=\"#二元分类评估指标\" class=\"headerlink\" title=\"二元分类评估指标\"></a>二元分类评估指标</h5><p>计算二元分类模型的评估指标的第一步通常是为每个可能的类标签创建正确预测和错误预测的数量矩阵：</p>\n<img src=\"/2025/02/25/ai-900-exam-preparation-2/binary-confusion-matrix.png\" class=\"\" title=\"binary confusion matrix\">\n\n<p>此可视化效果称为混淆矩阵，它显示预测总计，其中：</p>\n<ul>\n<li>ŷ&#x3D;0 且 y&#x3D;0：真阴性 (TN)</li>\n<li>ŷ&#x3D;1 且 y&#x3D;0：假阳性 (FP)</li>\n<li>ŷ&#x3D;0 且 y&#x3D;1：假阴性 (FN)</li>\n<li>ŷ&#x3D;1 且 y&#x3D;1：真阳性 (TP)</li>\n</ul>\n<p>混淆矩阵的排列是这样的：正确 (true) 预测显示在从左上角到右下角的对角线上。 通常情况下，颜色强度用于指示每个单元格中的预测数量，因此快速浏览一下预测良好的模型应该就会看出深阴影对角线趋势。</p>\n<h6 id=\"精确度\"><a href=\"#精确度\" class=\"headerlink\" title=\"精确度\"></a>精确度</h6><p>可以根据混淆矩阵计算出的最简单指标是准确度 - 模型正确预测的比例。 准确度的计算方式如下：</p>\n<p>(TN+TP) ÷ (TN+FN+FP+TP)</p>\n<p>在我们的糖尿病示例中，计算如下：</p>\n<p>(2+3) ÷ (2+1+0+3)</p>\n<p>&#x3D; 5 ÷ 6</p>\n<p>&#x3D; <strong>0.83</strong></p>\n<p>因此，就我们的验证数据来说，糖尿病分类模型在 83% 的情况下产生正确的预测。</p>\n<p>准确度一开始似乎是评估模型的一个很好的指标，但请考虑这一点。 假设 11% 的人口患有糖尿病。 可以创建一个始终预测 0 的模型，即使在没有真正尝试通过评估患者的特征来区分患者的情况下，其准确率仍可达到 89%。 我们真正需要的是更深入地了解模型在预测 1（代表阳性病例）和 0（代表阴性病例）时的表现。</p>\n<h6 id=\"召回率\"><a href=\"#召回率\" class=\"headerlink\" title=\"召回率\"></a>召回率</h6><p>召回率是度量此模型正确识别的阳性病例比例的指标。 换句话说，与确实患有糖尿病的患者人数相比，此模型预测有多少人患有糖尿病？</p>\n<p>召回率的公式为：</p>\n<p>TP ÷ (TP+FN)</p>\n<p>就我们的糖尿病示例来说：</p>\n<p>3 ÷ (3+1)</p>\n<p>&#x3D; 3 ÷ 4</p>\n<p>&#x3D; <strong>0.75</strong></p>\n<p>因此，我们的模型正确地将 75% 的糖尿病患者识别为糖尿病患者。</p>\n<h6 id=\"精度\"><a href=\"#精度\" class=\"headerlink\" title=\"精度\"></a>精度</h6><p>精准率是与召回率类似的指标，但度量的是预测为阳性病例且真实标签实际上也为阳性的比例。 换句话说，在模型预测患有糖尿病的患者中，实际患有糖尿病的患者的比例是多少？</p>\n<p>精准率公式为：</p>\n<p>TP ÷ (TP+FP)</p>\n<p>就我们的糖尿病示例来说：</p>\n<p>3 ÷ (3+0)</p>\n<p>&#x3D; 3 ÷ 3</p>\n<p>&#x3D; <strong>1.0</strong></p>\n<p>因此，在我们的模型预测的患有糖尿病的患者中，100% 的人确实患有糖尿病。</p>\n<h6 id=\"F1-分数\"><a href=\"#F1-分数\" class=\"headerlink\" title=\"F1 分数\"></a>F1 分数</h6><p>F1 分数是一个结合了召回率和精准率的总体指标。 F1 分数的公式为：</p>\n<p>(2 x 精准率 x 召回率) ÷ (精准率 + 召回率)</p>\n<p>就我们的糖尿病示例来说：</p>\n<p>(2 x 1.0 x 0.75) ÷ (1.0 + 0.75)</p>\n<p>&#x3D; 1.5 ÷ 1.75</p>\n<p><strong>&#x3D; 0.86</strong></p>\n<h6 id=\"曲线下面积-AUC\"><a href=\"#曲线下面积-AUC\" class=\"headerlink\" title=\"曲线下面积 (AUC)\"></a>曲线下面积 (AUC)</h6><p>召回率的另一个名称是真阳性率 (TPR)。此外还有一个称为假阳性率 (FPR) 的等效指标，其计算公式为 FP÷(FP+TN)。 我们已经知道，在使用阈值 0.5 时，我们的模型的 TPR 为 0.75。我们可以使用 FPR 的公式计算出 0÷2 的值为 0。</p>\n<p>当然，如果我们更改模型预测 true (1) 的阈值，则会影响阳性和阴性预测的数量，因此会更改 TPR 和 FPR 指标。 这些指标通常用于通过绘制接收方操作特征 (ROC) 曲线来评估模型，该曲线会比较 0.0 到 1.0 之间的每个可能阈值的 TPR 和 FPR：</p>\n<img src=\"/2025/02/25/ai-900-exam-preparation-2/roc-chart.png\" class=\"\" title=\"roc chart\">\n\n<p>完美模型的 ROC 曲线会沿左侧的 TPR 轴直线上升，然后穿过顶部的 FPR 轴。 由于曲线的绘图面积为 1x1，因此该完美曲线下的面积将为 1.0（这意味着模型始终是正确的）。 相比之下，从左下角到右上角的对角线表示通过随机猜测二进制标签获得的结果；产生的曲线下面积为 0.5。 换句话说，给定两个可能的类标签，你可以合理预期猜对的概率为 50%。</p>\n<p>就我们的糖尿病模型来说，会生成上面的曲线，曲线下面积 (AUC) 指标为 0.875。 由于 AUC 高于 0.5，因此我们可以得出结论：该模型在预测患者是否患有糖尿病方面比随机猜测的表现更好。</p>\n","excerpt":"","more":"<h2 id=\"Microsoft-Azure-AI-基础\"><a href=\"#Microsoft-Azure-AI-基础\" class=\"headerlink\" title=\"Microsoft Azure AI 基础\"></a>Microsoft Azure AI 基础</h2><h3 id=\"第一部分\"><a href=\"#第一部分\" class=\"headerlink\" title=\"第一部分\"></a>第一部分</h3><h4 id=\"什么是机器学习\"><a href=\"#什么是机器学习\" class=\"headerlink\" title=\"什么是机器学习\"></a>什么是机器学习</h4><p>机器学习起源于数据的统计和数学建模。 机器学习的基本理念是使用过去观测到的数据来预测未知的结果或值。 例如：</p>\n<ul>\n<li>冰淇淋店的老板可能会使用某个应用，结合历史销售和天气记录，根据天气预报来预测他们在某一天可能会售出多少个冰淇淋。</li>\n<li>医生可能会使用以往患者的临床数据来运行自动测试，以根据体重、血糖水平和其他测量值等因素来预测新患者是否有患糖尿病的风险。</li>\n<li>南极研究人员可能会利用过去的观测值，根据鸟类脚蹼、喙和其他物理属性的测量，自动识别不同的企鹅物种（例如阿德利企鹅、白眉企鹅或帽带企鹅）。</li>\n</ul>\n<h4 id=\"机器学习作为一种函数\"><a href=\"#机器学习作为一种函数\" class=\"headerlink\" title=\"机器学习作为一种函数\"></a>机器学习作为一种函数</h4><p>由于机器学习基于数学和统计学，因此通常会使用数学术语来思考机器学习模型。 从根本上讲，机器学习模型是一种软件应用程序，它封装一个函数用于根据一个或多个输入值计算输出值。 定义该函数的过程称为训练。 定义函数后，可以使用它在称为“推理”的过程中预测新值。</p>\n<p>让我们探讨一下训练和推理所涉及的步骤。</p>\n<img src=\"/2025/02/25/ai-900-exam-preparation-2/machine-learning.png\" class=\"\" title=\"machine learn\">\n\n<ol>\n<li><p>训练数据由过去的观测值组成。 在大多数情况下，观测值包括观测到的事物的属性或特征，以及要训练模型来预测的事物的已知值（称为标签）。<br> 在数学术语中，你经常会看到使用速记变量名称 x 引用的特征，以及使用 y 引用的标签。 通常，观测值由多个特征值组成，因此 x 实际上是一个向量（包含多个值的数组），如下所示：[x1,x2,x3,…]。<br> 为了澄清这一点，让我们分析前面所述的示例：</p>\n<ul>\n<li>在冰淇淋销售场景中，我们的目标是训练一个可以根据天气预测冰淇淋销售数量的模型。 当天的天气测量值（温度、降雨量、风速等）是特征 (x)，每日售出的冰淇淋数量是标签 (y)。</li>\n<li>在医疗场景中，目标是根据患者的临床测量值预测患者是否有患糖尿病的风险。 患者的测量值（体重、血糖水平等）是特征 (x)，患糖尿病的可能性（例如，1 表示有风险，0 表示没有风险）是标签 (y)。</li>\n<li>在南极研究场景中，我们希望根据企鹅的物理属性来预测其物种。 企鹅的关键测量值（脚蹼的长度、喙的宽度等）是特征 (x)，物种（例如，0 表示阿德利企鹅，1 表示白眉企鹅，2 表示帽带企鹅）是标签 (y)。</li>\n</ul>\n</li>\n<li><p>将对数据应用某种算法，以尝试确定特征与标签之间的关系，然后泛化这种关系，以便针对 x 执行计算来计算 y。 使用的具体算法取决于要解决的预测问题的类型（稍后会详细介绍），但基本原 则是尝试将一个函数拟合到数据，其中的特征值可用于计算标签</p>\n</li>\n<li><p>算法的结果是一个模型，该模型将算法派生的计算封装为函数 - 我们称之为 f。 采用数学表示法：</p>\n</li>\n</ol>\n<p>y &#x3D; f(x)</p>\n<ol start=\"4\">\n<li>完成训练阶段后，训练的模型可用于推理。 模型本质上是一个软件程序，可以封装训练过程生成的函数。 你可以输入一组特征值，并接收相应标签的预测结果作为输出。 由于模型的输出是函数计算的预测值而不是观测值，因此你经常会看到函数的输出显示为 ŷ（戏称为“y-hat”）</li>\n</ol>\n<h3 id=\"第二部分\"><a href=\"#第二部分\" class=\"headerlink\" title=\"第二部分\"></a>第二部分</h3><h4 id=\"机器学习类型\"><a href=\"#机器学习类型\" class=\"headerlink\" title=\"机器学习类型\"></a>机器学习类型</h4><p>机器学习有多种类型，必须根据尝试预测的内容应用适当的类型。 下图显示了常见机器学习类型的细目。</p>\n<img src=\"/2025/02/25/ai-900-exam-preparation-2/machine-learning-types.png\" class=\"\" title=\"machine learn type\">\n\n<h5 id=\"监督式机器学习\"><a href=\"#监督式机器学习\" class=\"headerlink\" title=\"监督式机器学习\"></a>监督式机器学习</h5><p>监督式机器学习是机器学习算法的一个通用术语，其中训练数据包括特征值和已知标签值。 监督式机器学习用于通过确定过去观测值中特征与标签之间的关系来训练模型，以便将来可以预测特征的未知标签。</p>\n<h6 id=\"回归\"><a href=\"#回归\" class=\"headerlink\" title=\"回归\"></a>回归</h6><p>回归是监督式机器学习的一种形式，其中模型预测的标签是数值。 例如：</p>\n<ul>\n<li>给定一天销售的冰淇淋数量，基于温度、降雨量和风速。</li>\n<li>物业的销售价格，基于物业大小（以平方英尺为单位）、所含卧室数量及所在位置的社会经济指标。</li>\n<li>汽车燃油效率（以英里&#x2F;加仑为单位），基于发动机大小、重量、宽度、高度和长度。</li>\n</ul>\n<h6 id=\"分类\"><a href=\"#分类\" class=\"headerlink\" title=\"分类\"></a>分类</h6><p>分类是监督式机器学习的一种形式，其中标签表示一个分类或类。 有两种常见的分类场景。</p>\n<p><strong>二元分类</strong><br>在二元分类中，标签确定观察到的项是（或不是）特定类的实例。 换句话说，二元分类模型预测两个互斥结果中的一个。 例如：</p>\n<ul>\n<li>基于体重、年龄、血糖水平等临床指标，患者是否有患糖尿病的风险。</li>\n<li>基于收入、信用记录、年龄和其他因素，银行客户是否会拖欠贷款。</li>\n<li>基于人口统计属性和过去的购买情况，邮寄列表客户是否会对营销产品&#x2F;服务做出积极响应。</li>\n</ul>\n<p>在所有这些示例中，模型为单个可能类预测二进制 true&#x2F;false 或积极&#x2F;消极预测。</p>\n<p><strong>多类分类</strong></p>\n<p>多类分类扩展了二元分类，以预测表示多个可能类之一的标签。 例如，</p>\n<ul>\n<li>企鹅的物种（阿德利企鹅、巴布亚企鹅或帽带企鹅），基于身体测量。</li>\n<li>电影的流派（喜剧、恐怖、爱情、冒险或科幻），基于演员、导演和预算。</li>\n</ul>\n<p>在涉及一组已知多个类的场景中，多类分类用于预测互斥标签。 例如，一只企鹅不能同时是巴布亚企鹅和阿德利企鹅。 但是，还可以使用一些算法来训练多标签分类模型，其中对于单个观测值可能有多个有效标签。 例如，一部电影可能同时被归类为科幻和喜剧。</p>\n<h5 id=\"非监督式机器学习\"><a href=\"#非监督式机器学习\" class=\"headerlink\" title=\"非监督式机器学习\"></a>非监督式机器学习</h5><p>非监督式机器学习涉及使用仅包含特征值且没有任何已知标签的数据来训练模型。 非监督式机器学习算法确定训练数据中观测值的特征之间的关系。</p>\n<h6 id=\"群集-聚类分析\"><a href=\"#群集-聚类分析\" class=\"headerlink\" title=\"群集&#x2F;聚类分析\"></a>群集&#x2F;聚类分析</h6><p>非监督式机器学习最常见的形式是聚类分析。 聚类分析算法基于观测值的特征识别观测值之间的相似性，并将它们分组到离散群集中。 例如：</p>\n<ul>\n<li>根据花的大小、叶数和花瓣数量，对类似的花进行分组。</li>\n<li>根据人口统计属性和购买行为，确定类似客户的组。</li>\n</ul>\n<p>在某些方面，聚类分析类似于多类分类；因为它将观侧值分类为离散组。 区别在于，使用分类时，你已经知道训练数据中的观测值所属的类；因此，该算法的工作原理是确定特征与已知分类标签之间的关系。 在聚类分析中，没有以前已知的分类标签，算法完全基于特征的相似性对数据观测值进行分组。</p>\n<p>在某些情况下，聚类分析用于确定在训练分类模型之前存在的类集。 例如，可以使用聚类分析将客户细分到多个组，然后对这些组进行分析，以识别不同的客户类并对其进行分类（高价值 - 低交易量、经常购买小额产品等）。 然后，可以使用分类来标记聚类分析结果中的观测值，并使用标记的数据来训练预测新客户可能属于哪个客户类别的分类模型。</p>\n<h3 id=\"第三部分\"><a href=\"#第三部分\" class=\"headerlink\" title=\"第三部分\"></a>第三部分</h3><h4 id=\"回归-1\"><a href=\"#回归-1\" class=\"headerlink\" title=\"回归\"></a>回归</h4><p>回归模型经过训练，基于包括特征和已知标签的训练数据来预测数值标签值。 训练回归模型（或者实际上，任何监督式机器学习模型）的过程涉及多次迭代，在这些迭代中，你使用适当的算法（通常带有一些参数化设置）来训练模型，评估模型的预测性能，并通过使用不同的算法和参数重复训练过程来优化模型，直到达到可接受的预测准确性级别。</p>\n<img src=\"/2025/02/25/ai-900-exam-preparation-2/supervised-training.png\" class=\"\" title=\"supervised training\">\n\n<p>此图显示了监督式机器学习模型的训练过程的四个关键元素：</p>\n<ul>\n<li>拆分训练数据（随机）以创建用于训练模型的数据集，同时保留要用于验证已训练模型的一部分数据。</li>\n<li>使用算法以将训练数据拟合到模型。 对于回归模型，使用回归算法，例如线性回归。</li>\n<li>使用保留的验证数据，通过预测特征的标签来测试模型。</li>\n<li>将验证数据集中的已知实际标签与模型预测的标签进行比较。 然后，聚合预测的标签值和实际的标签值之间的差异以计算一个指标，该指标指示模型对验证数据的预测准确度。</li>\n</ul>\n<p>每次训练、验证和评估迭代后，可以使用不同的算法和参数重复该过程，直到达到可接受的评估指标。</p>\n<h4 id=\"示例-回归\"><a href=\"#示例-回归\" class=\"headerlink\" title=\"示例 - 回归\"></a>示例 - 回归</h4><p>让我们通过一个简化的示例来探索回归，在该示例中，我们将训练一个模型以基于单个特征值 (x) 预测数值标签 (y)。 大多数实际场景涉及多个特征值，这增加了一些复杂性；但原理是相同的。</p>\n<p>对于示例，让我们继续使用之前讨论过的冰淇淋销售场景。 对于特征，我们将考虑温度（假设该值是给定日期的最高温度），我们希望训练模型以预测的标签是当天售出的冰淇淋数量。 我们将从一些历史数据开始，其中包括每日温度 (x) 和冰淇淋销售额 (y) 的记录：</p>\n<table>\n<thead>\n<tr>\n<th>温度 (x)</th>\n<th>冰淇淋销售额 (y)</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>51</td>\n<td>1</td>\n</tr>\n<tr>\n<td>52</td>\n<td>0</td>\n</tr>\n<tr>\n<td>67</td>\n<td>14</td>\n</tr>\n<tr>\n<td>65</td>\n<td>14</td>\n</tr>\n<tr>\n<td>70</td>\n<td>23</td>\n</tr>\n<tr>\n<td>69</td>\n<td>20</td>\n</tr>\n<tr>\n<td>72</td>\n<td>23</td>\n</tr>\n<tr>\n<td>75</td>\n<td>26</td>\n</tr>\n<tr>\n<td>73</td>\n<td>22</td>\n</tr>\n<tr>\n<td>81</td>\n<td>30</td>\n</tr>\n<tr>\n<td>78</td>\n<td>26</td>\n</tr>\n<tr>\n<td>83</td>\n<td>36</td>\n</tr>\n</tbody></table>\n<h5 id=\"训练回归模型\"><a href=\"#训练回归模型\" class=\"headerlink\" title=\"训练回归模型\"></a>训练回归模型</h5><p>首先，我们将拆分数据，并使用其中一部分数据来训练模型。 下面是训练数据集：</p>\n<table>\n<thead>\n<tr>\n<th>温度 (x)</th>\n<th>冰淇淋销售额 (y)</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>51</td>\n<td>1</td>\n</tr>\n<tr>\n<td>65</td>\n<td>14</td>\n</tr>\n<tr>\n<td>69</td>\n<td>20</td>\n</tr>\n<tr>\n<td>72</td>\n<td>23</td>\n</tr>\n<tr>\n<td>75</td>\n<td>26</td>\n</tr>\n<tr>\n<td>81</td>\n<td>30</td>\n</tr>\n</tbody></table>\n<p>若要深入了解这些 x 和 y 值如何相互关联，我们可以将它们绘制为沿两个轴的坐标，如下所示：</p>\n<img src=\"/2025/02/25/ai-900-exam-preparation-2/scatter-plot.png\" class=\"\" title=\"scatter plot\">\n\n<p>现在，我们已准备好将算法应用于训练数据，并将其拟合到将运算应用于 x 以计算 y 的函数。 其中一种算法是线性回归，它的工作原理是派生一个函数，该函数通过 x 和 y 值的交点生成一条直线，同时最小化直线和绘制点之间的平均距离，如下所示：</p>\n<img src=\"/2025/02/25/ai-900-exam-preparation-2/regression-line.png\" class=\"\" title=\"regression line\">\n\n<p>这条直线是函数的可视表示形式，其中直线的斜率描述了如何针对给定的 x 值计算 y 值。 这条直线在 50 处与 x 轴相交，因此当 x 为 50 时，y 为 0。 从绘图中的轴标记可以看出，直线倾斜，使得沿 x 轴每增加 5，沿 y 轴就会增加 5；因此当 x 为 55 时，y 为 5；当 x 为60时，y 为 10，依此类推。 若要针对给定的 x 值计算 y 值，函数只需减去 50；换句话说，函数可以如下表示：</p>\n<p>f(x) &#x3D; x-50</p>\n<p>可以使用此函数来预测任何给定温度下一天售出的冰淇淋数量。 例如，假设天气预报告诉我们，明天将是 77 度。 我们可以应用模型来计算 77-50，并预测我们明天将销售 27 个冰淇淋。</p>\n<p>但是我们的模型有多准确呢？</p>\n<h5 id=\"评估回归模型\"><a href=\"#评估回归模型\" class=\"headerlink\" title=\"评估回归模型\"></a>评估回归模型</h5><p>为了验证模型并评估其预测效果，我们保留了一些已知标签 (y) 值的数据。 下面是我们保留的数据：</p>\n<table>\n<thead>\n<tr>\n<th>温度 (x)</th>\n<th>冰淇淋销售额 (y)</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>52</td>\n<td>0</td>\n</tr>\n<tr>\n<td>67</td>\n<td>14</td>\n</tr>\n<tr>\n<td>70</td>\n<td>23</td>\n</tr>\n<tr>\n<td>73</td>\n<td>22</td>\n</tr>\n<tr>\n<td>78</td>\n<td>26</td>\n</tr>\n<tr>\n<td>83</td>\n<td>36</td>\n</tr>\n</tbody></table>\n<p>可以使用模型根据特征 (x) 值来预测此数据集中每个观测值的标签；然后，将预测的标签 (ŷ) 与已知的实际标签值 (y) 进行比较。</p>\n<p>使用前面训练的模型（该模型封装函数 f(x) &#x3D; x-50），可生成以下预测：</p>\n<table>\n<thead>\n<tr>\n<th>温度 (x)</th>\n<th>实际销售额 (y)</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>52</td>\n<td>0</td>\n</tr>\n<tr>\n<td>67</td>\n<td>14</td>\n</tr>\n<tr>\n<td>70</td>\n<td>23</td>\n</tr>\n<tr>\n<td>73</td>\n<td>22</td>\n</tr>\n<tr>\n<td>78</td>\n<td>26</td>\n</tr>\n<tr>\n<td>83</td>\n<td>36</td>\n</tr>\n</tbody></table>\n<p>我们可以针对特征值绘制预测标签和实际标签，如下所示：</p>\n\n\n<p>预测标签由模型计算，因此它们位于函数线上，但是由函数计算的 ŷ 值与来自验证数据集的实际 y 值之间存在一些差异；这在绘图上表示为 ŷ 值和 y 值之间的线，显示预测值与实际值的差距。</p>\n<h5 id=\"回归评估指标\"><a href=\"#回归评估指标\" class=\"headerlink\" title=\"回归评估指标\"></a>回归评估指标</h5><p>根据预测值和实际值之间的差异，可以计算用于评估回归模型的一些常见指标。</p>\n<p>平均绝对误差 (MAE)</p>\n<p>此示例中的方差指示每个预测错误的冰淇淋数量。 预测是高于还是低于实际值无关紧要（例如，-3 和 +3 都表示方差为 3）。 此指标被称为每个预测的绝对误差，并且可以被总结为整个验证集的平均绝对误差 (MAE)。</p>\n<p>在冰淇淋示例中，绝对误差（2、3、3、1、2 和 3）的平均值为 2.33。</p>\n<h6 id=\"均方误差-MSE\"><a href=\"#均方误差-MSE\" class=\"headerlink\" title=\"均方误差 (MSE)\"></a>均方误差 (MSE)</h6><p>平均绝对误差指标同等地考虑预测标签和实际标签之间的所有差异。 然而，相比误差较少但较大的模型，一个始终误差较小的模型可能更可取。 生成“放大”较大误差的指标的一种方法是对单个误差求平方，并计算平方值的平均值。 此指标被称为均方误差 (MSE)。</p>\n<p>在我们的冰淇淋示例中，绝对值平方（4、9、9、1、4 和 9）的平均值为 6。</p>\n<h6 id=\"均方根误差-RMSE\"><a href=\"#均方根误差-RMSE\" class=\"headerlink\" title=\"均方根误差 (RMSE)\"></a>均方根误差 (RMSE)</h6><p>均方误差有助于考虑误差的幅度，但是因为它对误差值进行平方，所以得到的指标不再代表标签测量的量。 换句话说，我们可以说模型的 MSE 为 6，但这并不能衡量它在被错误预测的冰淇淋数量方面的准确性；6 只是一个数字分数，表示验证预测中的错误级别。</p>\n<p>如果要根据冰淇淋的数量来衡量误差，我们需要计算 MSE 的平方根；不出所料，这生成了一个名为均方根误差的指标。 在本例中，为 √6，即 2.45（冰淇淋）。</p>\n<h6 id=\"决定系数-R2\"><a href=\"#决定系数-R2\" class=\"headerlink\" title=\"决定系数 (R2)\"></a>决定系数 (R2)</h6><p>到目前为止，所有指标都比较预测值与实际值之间的差异，以评估模型。 然而，在现实中，模型考虑到了冰淇淋日销售额中的一些自然随机差异。 在线性回归模型中，训练算法拟合一条直线，使函数和已知标签值之间的平均方差最小化。 决定系数（通常称为 R2 或 R 平方）是一种指标，用于测量验证结果中可由模型解释的方差比例，而不是验证数据的某些异常方面（例如，由于当地节日，某一天的冰淇淋销售量非常不寻常）。</p>\n<p>R2 的计算比前面的指标更复杂。 它将预测标签和实际标签之间的平方差之和与实际标签值和实际标签值的平均值之间的平方差之和进行比较，如下所示：</p>\n<p>R2 &#x3D; 1- ∑(y-ŷ)2 ÷ ∑(y-ȳ)2</p>\n<p>如果这看起来很复杂，不要太担心；大多数机器学习工具都可以为你计算指标。 重要的一点是，结果是一个介于 0 和 1 之间的值，该值描述了模型所解释的方差的比例。 简单来说，此值越接近 1，模型就越拟合验证数据。 对于冰淇淋回归模型，根据验证数据计算的 R2 为 0.95。</p>\n<h3 id=\"第四部分\"><a href=\"#第四部分\" class=\"headerlink\" title=\"第四部分\"></a>第四部分</h3><h4 id=\"二元分类\"><a href=\"#二元分类\" class=\"headerlink\" title=\"二元分类\"></a>二元分类</h4><p>分类与回归一样，是一种受监督的机器学习技术，因此遵循相同的适用于训练、验证和评估模型的迭代过程。 用于训练分类模型的算法不是像回归模型那样计算数值，而是计算类分配的概率值以及用于评估模型性能的评估指标，将预测类与实际类进行比较。</p>\n<p>二元分类算法用于训练模型，该模型可预测单个类的两个可能标签之一。 本质上是预测 true 或 false。 在大多数实际方案中，用于训练和验证模型的数据观测值包含多个特征 (x) 值和一个为 1 或 0 的 y 值。</p>\n<h4 id=\"示例-二元分类\"><a href=\"#示例-二元分类\" class=\"headerlink\" title=\"示例 - 二元分类\"></a>示例 - 二元分类</h4><p>为了了解二元分类的工作原理，我们来看一个简化的示例，该示例使用单个特征 (x) 来预测标签 y 是 1 还是 0。 在此示例中，我们将使用患者的血糖水平来预测患者是否患有糖尿病。 下面是用于训练模型的数据：</p>\n<table>\n<thead>\n<tr>\n<th>血糖 (x)</th>\n<th><strong>糖尿病？ (y)</strong></th>\n</tr>\n</thead>\n<tbody><tr>\n<td>67</td>\n<td>0</td>\n</tr>\n<tr>\n<td>103</td>\n<td>1</td>\n</tr>\n<tr>\n<td>114</td>\n<td>1</td>\n</tr>\n<tr>\n<td>72</td>\n<td>0</td>\n</tr>\n<tr>\n<td>116</td>\n<td>1</td>\n</tr>\n<tr>\n<td>65</td>\n<td>0</td>\n</tr>\n</tbody></table>\n<h5 id=\"训练二元分类模型\"><a href=\"#训练二元分类模型\" class=\"headerlink\" title=\"训练二元分类模型\"></a>训练二元分类模型</h5><p>为了训练模型，我们将使用一种算法将训练数据拟合为一个函数，该函数计算类标签为 true（换句话说，患者有糖尿病）的概率。 概率以某个 0.0 到 1.0 之间的值来度量，使得所有可能的类的总概率为 1.0。 例如，如果一名患者患糖尿病的概率为 0.7，那么该患者未患糖尿病的相应概率为 0.3。</p>\n<p>有许多可用于二元分类的算法，例如逻辑回归，它会导出值在 0.0 到 1.0 之间的 sigmoid（S 形）函数，如下所示：</p>\n<img src=\"/2025/02/25/ai-900-exam-preparation-2/sigmoid-plot.png\" class=\"\" title=\"sigmoid plot\">\n\n<blockquote>\n<p>尽管名称如此，但在机器学习中，逻辑回归用于分类，而不是用于回归。 重点是它生成的函数的逻辑性质，该函数描述了下限值和上限值（用于二元分类时为 0.0 和 1.0）之间的 S 形曲线。</p>\n</blockquote>\n<p>该算法生成的函数描述了 x 为给定值时 y 为 true (y&#x3D;1) 的概率。 从数学上来说，可以这样表达该函数：</p>\n<p>f(x) &#x3D; P(y&#x3D;1 | x)</p>\n<p>就训练数据中六个观测值中的三个来说，我们知道 y 肯定为 true，因此就这些观测值来说，y&#x3D;1 的概率为 1.0；就其他三个来说，我们知道 y 肯定为 false，因此 y&#x3D;1 的概率为 0.0。 S 形曲线描绘了概率分布情况，因此在曲线上标出 x 的值就可以确定 y 为 1 的相应概率。</p>\n<p>该图还包含一条水平线，指示基于此函数的模型将预测 true (1) 或 false (0) 的阈值。 阈值位于 y (P(y) &#x3D; 0.5) 的中间点。 对于此点或高于此点的任何值，模型会预测 true (1)；而对于低于此点的任何值，模型会预测 false (0)。 例如，对于血糖水平为 90 的患者，该函数将得出的概率值为 0.9。 由于 0.9 高于阈值 0.5，因此模型会预测 true (1) - 换句话说，预测患者患有糖尿病。</p>\n<h5 id=\"评估二元分类模型\"><a href=\"#评估二元分类模型\" class=\"headerlink\" title=\"评估二元分类模型\"></a>评估二元分类模型</h5><p>与回归一样，在训练二元分类模型时，我们会保留一个随机数据子集来验证训练后的模型。 假设我们保留以下数据来验证糖尿病分类器：</p>\n<table>\n<thead>\n<tr>\n<th>血糖 (x)</th>\n<th>糖尿病？ (y)</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>66</td>\n<td>0</td>\n</tr>\n<tr>\n<td>107</td>\n<td>1</td>\n</tr>\n<tr>\n<td>112</td>\n<td>1</td>\n</tr>\n<tr>\n<td>71</td>\n<td>0</td>\n</tr>\n<tr>\n<td>87</td>\n<td>1</td>\n</tr>\n<tr>\n<td>89</td>\n<td>1</td>\n</tr>\n</tbody></table>\n<p>将我们之前派生的逻辑函数应用于 x 值会生成下图。</p>\n<img src=\"/2025/02/25/ai-900-exam-preparation-2/classification-predictions.png\" class=\"\" title=\"classification predictions\">\n\n<p>模型为每个观测值生成预测标签 1 或 0，具体取决于函数计算出的概率是高于阈值还是低于阈值。 然后，我们可以将预测的类标签 (ŷ) 与实际的类标签 (y) 进行比较，如下所示：</p>\n<table>\n<thead>\n<tr>\n<th>血糖 (x)</th>\n<th>实际的糖尿病诊断 (y)</th>\n<th>预测的糖尿病诊断 (ŷ)</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>66</td>\n<td>0</td>\n<td>0</td>\n</tr>\n<tr>\n<td>107</td>\n<td>1</td>\n<td>1</td>\n</tr>\n<tr>\n<td>112</td>\n<td>1</td>\n<td>1</td>\n</tr>\n<tr>\n<td>71</td>\n<td>0</td>\n<td>0</td>\n</tr>\n<tr>\n<td>87</td>\n<td>1</td>\n<td>0</td>\n</tr>\n<tr>\n<td>89</td>\n<td>1</td>\n<td>1</td>\n</tr>\n</tbody></table>\n<h5 id=\"二元分类评估指标\"><a href=\"#二元分类评估指标\" class=\"headerlink\" title=\"二元分类评估指标\"></a>二元分类评估指标</h5><p>计算二元分类模型的评估指标的第一步通常是为每个可能的类标签创建正确预测和错误预测的数量矩阵：</p>\n<img src=\"/2025/02/25/ai-900-exam-preparation-2/binary-confusion-matrix.png\" class=\"\" title=\"binary confusion matrix\">\n\n<p>此可视化效果称为混淆矩阵，它显示预测总计，其中：</p>\n<ul>\n<li>ŷ&#x3D;0 且 y&#x3D;0：真阴性 (TN)</li>\n<li>ŷ&#x3D;1 且 y&#x3D;0：假阳性 (FP)</li>\n<li>ŷ&#x3D;0 且 y&#x3D;1：假阴性 (FN)</li>\n<li>ŷ&#x3D;1 且 y&#x3D;1：真阳性 (TP)</li>\n</ul>\n<p>混淆矩阵的排列是这样的：正确 (true) 预测显示在从左上角到右下角的对角线上。 通常情况下，颜色强度用于指示每个单元格中的预测数量，因此快速浏览一下预测良好的模型应该就会看出深阴影对角线趋势。</p>\n<h6 id=\"精确度\"><a href=\"#精确度\" class=\"headerlink\" title=\"精确度\"></a>精确度</h6><p>可以根据混淆矩阵计算出的最简单指标是准确度 - 模型正确预测的比例。 准确度的计算方式如下：</p>\n<p>(TN+TP) ÷ (TN+FN+FP+TP)</p>\n<p>在我们的糖尿病示例中，计算如下：</p>\n<p>(2+3) ÷ (2+1+0+3)</p>\n<p>&#x3D; 5 ÷ 6</p>\n<p>&#x3D; <strong>0.83</strong></p>\n<p>因此，就我们的验证数据来说，糖尿病分类模型在 83% 的情况下产生正确的预测。</p>\n<p>准确度一开始似乎是评估模型的一个很好的指标，但请考虑这一点。 假设 11% 的人口患有糖尿病。 可以创建一个始终预测 0 的模型，即使在没有真正尝试通过评估患者的特征来区分患者的情况下，其准确率仍可达到 89%。 我们真正需要的是更深入地了解模型在预测 1（代表阳性病例）和 0（代表阴性病例）时的表现。</p>\n<h6 id=\"召回率\"><a href=\"#召回率\" class=\"headerlink\" title=\"召回率\"></a>召回率</h6><p>召回率是度量此模型正确识别的阳性病例比例的指标。 换句话说，与确实患有糖尿病的患者人数相比，此模型预测有多少人患有糖尿病？</p>\n<p>召回率的公式为：</p>\n<p>TP ÷ (TP+FN)</p>\n<p>就我们的糖尿病示例来说：</p>\n<p>3 ÷ (3+1)</p>\n<p>&#x3D; 3 ÷ 4</p>\n<p>&#x3D; <strong>0.75</strong></p>\n<p>因此，我们的模型正确地将 75% 的糖尿病患者识别为糖尿病患者。</p>\n<h6 id=\"精度\"><a href=\"#精度\" class=\"headerlink\" title=\"精度\"></a>精度</h6><p>精准率是与召回率类似的指标，但度量的是预测为阳性病例且真实标签实际上也为阳性的比例。 换句话说，在模型预测患有糖尿病的患者中，实际患有糖尿病的患者的比例是多少？</p>\n<p>精准率公式为：</p>\n<p>TP ÷ (TP+FP)</p>\n<p>就我们的糖尿病示例来说：</p>\n<p>3 ÷ (3+0)</p>\n<p>&#x3D; 3 ÷ 3</p>\n<p>&#x3D; <strong>1.0</strong></p>\n<p>因此，在我们的模型预测的患有糖尿病的患者中，100% 的人确实患有糖尿病。</p>\n<h6 id=\"F1-分数\"><a href=\"#F1-分数\" class=\"headerlink\" title=\"F1 分数\"></a>F1 分数</h6><p>F1 分数是一个结合了召回率和精准率的总体指标。 F1 分数的公式为：</p>\n<p>(2 x 精准率 x 召回率) ÷ (精准率 + 召回率)</p>\n<p>就我们的糖尿病示例来说：</p>\n<p>(2 x 1.0 x 0.75) ÷ (1.0 + 0.75)</p>\n<p>&#x3D; 1.5 ÷ 1.75</p>\n<p><strong>&#x3D; 0.86</strong></p>\n<h6 id=\"曲线下面积-AUC\"><a href=\"#曲线下面积-AUC\" class=\"headerlink\" title=\"曲线下面积 (AUC)\"></a>曲线下面积 (AUC)</h6><p>召回率的另一个名称是真阳性率 (TPR)。此外还有一个称为假阳性率 (FPR) 的等效指标，其计算公式为 FP÷(FP+TN)。 我们已经知道，在使用阈值 0.5 时，我们的模型的 TPR 为 0.75。我们可以使用 FPR 的公式计算出 0÷2 的值为 0。</p>\n<p>当然，如果我们更改模型预测 true (1) 的阈值，则会影响阳性和阴性预测的数量，因此会更改 TPR 和 FPR 指标。 这些指标通常用于通过绘制接收方操作特征 (ROC) 曲线来评估模型，该曲线会比较 0.0 到 1.0 之间的每个可能阈值的 TPR 和 FPR：</p>\n<img src=\"/2025/02/25/ai-900-exam-preparation-2/roc-chart.png\" class=\"\" title=\"roc chart\">\n\n<p>完美模型的 ROC 曲线会沿左侧的 TPR 轴直线上升，然后穿过顶部的 FPR 轴。 由于曲线的绘图面积为 1x1，因此该完美曲线下的面积将为 1.0（这意味着模型始终是正确的）。 相比之下，从左下角到右上角的对角线表示通过随机猜测二进制标签获得的结果；产生的曲线下面积为 0.5。 换句话说，给定两个可能的类标签，你可以合理预期猜对的概率为 50%。</p>\n<p>就我们的糖尿病模型来说，会生成上面的曲线，曲线下面积 (AUC) 指标为 0.875。 由于 AUC 高于 0.5，因此我们可以得出结论：该模型在预测患者是否患有糖尿病方面比随机猜测的表现更好。</p>\n"},{"title":"Flask Overview","comments":1,"date":"2025-01-07T11:22:34.000Z","description":"Flask Overview","_content":"\n# Flask Overview\n\n## Python Install\n\nPlease install the python on your computer based on [Python](https://www.python.org/).\nIf the system has some environmental path error when using the python order, please read [How to add to the PYTHONPATH in Windows](https://stackoverflow.com/questions/3701646/how-to-add-to-the-pythonpath-in-windows-so-it-finds-my-modules-packages).\n\n### Virtual environments\n\nUse a virtual environment to manage the dependencies for your project, both in development and in production.\n\nWhat problem does a virtual environment solve? The more Python projects you have, the more likely it is that you need to work with different versions of Python libraries, or even Python itself. Newer versions of libraries for one project can break compatibility in another project.\n\nVirtual environments are independent groups of Python libraries, one for each project. Packages installed for one project will not affect other projects or the operating system’s packages.\n\n1. Create an environment.\n\n```powershell\nmkdir myproject\ncd myproject\npy -3 -m venv .venv\n```\n\n2. Active the environment.\n\n```powershell\n.venv\\Scripts\\activate\n```\n\n## Install Flask\n\n```powershell\npip install Flask\n```\n\n## Quickstart\n\n### A Minimal Application\n\n```python\nfrom flask import Flask\n\napp = Flask(__name__)\n\n@app.route(\"/\")\ndef hello_world():\n    return \"<p>Hello, World!</p>\"\n```\n\nTo run the application, use the `flask` command or `python -m flask`. You need to tell the Flask where your application is with the `--app` option.\n\n```powershell\nflask --app hello run\n```\n\n![Flask Running](ai-plateform-flask/image.png)\n\n> As a shortcut, if the file is named app.py or wsgi.py, you don’t have to use --app. See Command Line Interface for more details.\n\n#### Debug Mode\n\nTo enable debug mode, use the `--debug` option.\n\n```powershell\nflask --app hello run --debug\n```\n\n#### HTML Escaping\n\nWhen returning HTML (the default response type in Flask), any user-provided values rendered in the output must be escaped to protect from injection attacks. HTML templates rendered with Jinja, introduced later, will do this automatically.\n\n**escape()**, shown here, can be used manually. It is omitted in most examples for brevity, but you should always be aware of how you’re using untrusted data.\n\n```python\nfrom flask import Flask\nfrom markupsafe import escape\n\napp = Flask(__name__)\n\n@app.route(\"/\")\ndef hello_world():\n    return \"<p>Hello, World!</p>\"\n\n@app.route(\"/<name>\")\ndef hello(name):\n    return f\"Hello, {escape(name)}!\";\n```\n\n#### Routing\n\nModern web applications use meaningful URLs to help users. Users are more likely to like a page and come back if the page uses a meaningful URL they can remember and use to directly visit a page.\n\nUse the **route()** decorator to bind a function to a URL.\n\n```python\n@app.route('/')\ndef index():\n    return 'Index Page'\n\n@app.route('/hello')\ndef hello():\n    return 'Hello, World'\n```\n\n#### Variable Rules\n\nYou can add variable sections to a URL by marking sections with `<variable_name>`. Your function then receives the `<variable_name>` as a keyword argument. Optionally, you can use a converter to specify the type of the argument like `<converter:variable_name>`.\n\n```python\nfrom markupsafe import escape\n\n@app.route('/user/<username>')\ndef show_user_profile(username):\n    # show the user profile for that user\n    return f'User {escape(username)}'\n\n@app.route('/post/<int:post_id>')\ndef show_post(post_id):\n    # show the post with the given id, the id is an integer\n    return f'Post {post_id}'\n\n@app.route('/path/<path:subpath>')\ndef show_subpath(subpath):\n    # show the subpath after /path/\n    return f'Subpath {escape(subpath)}'\n```\n\n|type|description|\n|-|-|\n|string|(default) accepts any text without a slash|\n|int|accepts positive integers|\n|float|accepts positive floating point values|\n|path|like string but also accepts slashes|\n|uuid|accepts UUID strings|\n\n#### Unique URLs / Redirection Behavior\n\nThe following two rules differ in their use of a trailing slash.\n\n```python\n@app.route('/projects/')\ndef projects():\n    return 'The project page'\n\n@app.route('/about')\ndef about():\n    return 'The about page'\n```\n\nThe canonical URL for the projects endpoint has a trailing slash. It’s similar to a folder in a file system. If you access the URL without a trailing slash (/projects), Flask redirects you to the canonical URL with the trailing slash (/projects/).\n\nThe canonical URL for the about endpoint does not have a trailing slash. It’s similar to the pathname of a file. Accessing the URL with a trailing slash (/about/) produces a 404 “Not Found” error. This helps keep URLs unique for these resources, which helps search engines avoid indexing the same page twice.\n\n#### HTTP Methods\n\nWeb applications use different HTTP methods when accessing URLs. You should familiarize yourself with the HTTP methods as you work with Flask. By default, a route only answers to `GET` requests. You can use the `methods` argument of the **route()** decorator to handle different HTTP methods.\n\n```python\nfrom flask import request\n\n@app.route('/login', methods=['GET', 'POST'])\ndef login():\n    if request.method == 'POST':\n        return do_the_login()\n    else:\n        return show_the_login_form()\n```\n\nThe example above keeps all methods for the route within one function, which can be useful if each part uses some common data.\n\nYou can also separate views for different methods into different functions. Flask provides a shortcut for decorating such routes with **get(), post()**, etc. for each common HTTP method.\n\n```python\n@app.get('/login')\ndef login_get():\n    return show_the_login_form()\n\n@app.post('/login')\ndef login_post():\n    return do_the_login()\n```\n\nIf GET is present, Flask automatically adds support for the HEAD method and handles HEAD requests according to the HTTP RFC. Likewise, OPTIONS is automatically implemented for you.\n\n#### Static Files\n\nDynamic web applications also need static files. That’s usually where the CSS and JavaScript files are coming from. Ideally your web server is configured to serve them for you, but during development Flask can do that as well. Just create a folder called static in your package or next to your module and it will be available at /static on the application.\n\nTo generate URLs for static files, use the special 'static' endpoint name:\n\n```python\nurl_for('static', filename='style.css')\n```\n\nThe file has to be stored on the filesystem as static/style.css.\n\n#### Rendering Templates\n\nGenerating HTML from within Python is not fun, and actually pretty cumbersome because you have to do the HTML escaping on your own to keep the application secure. Because of that Flask configures the Jinja2 template engine for you automatically.\n\nTemplates can be used to generate any type of text file. For web applications, you’ll primarily be generating HTML pages, but you can also generate markdown, plain text for emails, and anything else.\n\nFor a reference to HTML, CSS, and other web APIs, use the MDN Web Docs.\n\nTo render a template you can use the render_template() method. All you have to do is provide the name of the template and the variables you want to pass to the template engine as keyword arguments. Here’s a simple example of how to render a template:\n\n```python\nfrom flask import render_template\n\n@app.route('/hello/')\n@app.route('/hello/<name>')\ndef hello(name=None):\n    return render_template('hello.html', person=name)\nFlask will look for templates in the templates folder. So if your application is a module, this folder is next to that module, if it’s a package it’s actually inside your package:\n```\n\nCase 1: a module:\n\n```text\n/application.py\n/templates\n    /hello.html\n```\n\nCase 2: a package:\n\n```text\n/application\n    /__init__.py\n    /templates\n        /hello.html\n```\n\nFor templates you can use the full power of Jinja2 templates. Head over to the official Jinja2 Template Documentation for more information.\n\nHere is an example template:\n\n```html\n<!doctype html>\n<title>Hello from Flask</title>\n{% if person %}\n  <h1>Hello {{ person }}!</h1>\n{% else %}\n  <h1>Hello, World!</h1>\n{% endif %}\n```\n\n#### Accessing Request Data\n\nFor web applications it’s crucial to react to the data a client sends to the server. In Flask this information is provided by the global **request** object. If you have some experience with Python you might be wondering how that object can be global and how Flask manages to still be threadsafe. The answer is context locals:\n\nSo what does this mean to you? Basically you can completely ignore that this is the case unless you are doing something like unit testing. You will notice that code which depends on a request object will suddenly break because there is no request object. The solution is creating a request object yourself and binding it to the context. The easiest solution for unit testing is to use the **test_request_context()** context manager. In combination with the with statement it will bind a test request so that you can interact with it. Here is an example:\n\n```python\nfrom flask import request\n\nwith app.test_request_context('/hello', method='POST'):\n    # now you can do something with the request until the\n    # end of the with block, such as basic assertions:\n    assert request.path == '/hello'\n    assert request.method == 'POST'\n```","source":"_posts/ai-plateform-flask.md","raw":"---\ntitle: Flask Overview\ncategories:\n - flask\ncomments: true\ndate: 2025-01-07 19:22:34\ndescription: Flask Overview\n---\n\n# Flask Overview\n\n## Python Install\n\nPlease install the python on your computer based on [Python](https://www.python.org/).\nIf the system has some environmental path error when using the python order, please read [How to add to the PYTHONPATH in Windows](https://stackoverflow.com/questions/3701646/how-to-add-to-the-pythonpath-in-windows-so-it-finds-my-modules-packages).\n\n### Virtual environments\n\nUse a virtual environment to manage the dependencies for your project, both in development and in production.\n\nWhat problem does a virtual environment solve? The more Python projects you have, the more likely it is that you need to work with different versions of Python libraries, or even Python itself. Newer versions of libraries for one project can break compatibility in another project.\n\nVirtual environments are independent groups of Python libraries, one for each project. Packages installed for one project will not affect other projects or the operating system’s packages.\n\n1. Create an environment.\n\n```powershell\nmkdir myproject\ncd myproject\npy -3 -m venv .venv\n```\n\n2. Active the environment.\n\n```powershell\n.venv\\Scripts\\activate\n```\n\n## Install Flask\n\n```powershell\npip install Flask\n```\n\n## Quickstart\n\n### A Minimal Application\n\n```python\nfrom flask import Flask\n\napp = Flask(__name__)\n\n@app.route(\"/\")\ndef hello_world():\n    return \"<p>Hello, World!</p>\"\n```\n\nTo run the application, use the `flask` command or `python -m flask`. You need to tell the Flask where your application is with the `--app` option.\n\n```powershell\nflask --app hello run\n```\n\n![Flask Running](ai-plateform-flask/image.png)\n\n> As a shortcut, if the file is named app.py or wsgi.py, you don’t have to use --app. See Command Line Interface for more details.\n\n#### Debug Mode\n\nTo enable debug mode, use the `--debug` option.\n\n```powershell\nflask --app hello run --debug\n```\n\n#### HTML Escaping\n\nWhen returning HTML (the default response type in Flask), any user-provided values rendered in the output must be escaped to protect from injection attacks. HTML templates rendered with Jinja, introduced later, will do this automatically.\n\n**escape()**, shown here, can be used manually. It is omitted in most examples for brevity, but you should always be aware of how you’re using untrusted data.\n\n```python\nfrom flask import Flask\nfrom markupsafe import escape\n\napp = Flask(__name__)\n\n@app.route(\"/\")\ndef hello_world():\n    return \"<p>Hello, World!</p>\"\n\n@app.route(\"/<name>\")\ndef hello(name):\n    return f\"Hello, {escape(name)}!\";\n```\n\n#### Routing\n\nModern web applications use meaningful URLs to help users. Users are more likely to like a page and come back if the page uses a meaningful URL they can remember and use to directly visit a page.\n\nUse the **route()** decorator to bind a function to a URL.\n\n```python\n@app.route('/')\ndef index():\n    return 'Index Page'\n\n@app.route('/hello')\ndef hello():\n    return 'Hello, World'\n```\n\n#### Variable Rules\n\nYou can add variable sections to a URL by marking sections with `<variable_name>`. Your function then receives the `<variable_name>` as a keyword argument. Optionally, you can use a converter to specify the type of the argument like `<converter:variable_name>`.\n\n```python\nfrom markupsafe import escape\n\n@app.route('/user/<username>')\ndef show_user_profile(username):\n    # show the user profile for that user\n    return f'User {escape(username)}'\n\n@app.route('/post/<int:post_id>')\ndef show_post(post_id):\n    # show the post with the given id, the id is an integer\n    return f'Post {post_id}'\n\n@app.route('/path/<path:subpath>')\ndef show_subpath(subpath):\n    # show the subpath after /path/\n    return f'Subpath {escape(subpath)}'\n```\n\n|type|description|\n|-|-|\n|string|(default) accepts any text without a slash|\n|int|accepts positive integers|\n|float|accepts positive floating point values|\n|path|like string but also accepts slashes|\n|uuid|accepts UUID strings|\n\n#### Unique URLs / Redirection Behavior\n\nThe following two rules differ in their use of a trailing slash.\n\n```python\n@app.route('/projects/')\ndef projects():\n    return 'The project page'\n\n@app.route('/about')\ndef about():\n    return 'The about page'\n```\n\nThe canonical URL for the projects endpoint has a trailing slash. It’s similar to a folder in a file system. If you access the URL without a trailing slash (/projects), Flask redirects you to the canonical URL with the trailing slash (/projects/).\n\nThe canonical URL for the about endpoint does not have a trailing slash. It’s similar to the pathname of a file. Accessing the URL with a trailing slash (/about/) produces a 404 “Not Found” error. This helps keep URLs unique for these resources, which helps search engines avoid indexing the same page twice.\n\n#### HTTP Methods\n\nWeb applications use different HTTP methods when accessing URLs. You should familiarize yourself with the HTTP methods as you work with Flask. By default, a route only answers to `GET` requests. You can use the `methods` argument of the **route()** decorator to handle different HTTP methods.\n\n```python\nfrom flask import request\n\n@app.route('/login', methods=['GET', 'POST'])\ndef login():\n    if request.method == 'POST':\n        return do_the_login()\n    else:\n        return show_the_login_form()\n```\n\nThe example above keeps all methods for the route within one function, which can be useful if each part uses some common data.\n\nYou can also separate views for different methods into different functions. Flask provides a shortcut for decorating such routes with **get(), post()**, etc. for each common HTTP method.\n\n```python\n@app.get('/login')\ndef login_get():\n    return show_the_login_form()\n\n@app.post('/login')\ndef login_post():\n    return do_the_login()\n```\n\nIf GET is present, Flask automatically adds support for the HEAD method and handles HEAD requests according to the HTTP RFC. Likewise, OPTIONS is automatically implemented for you.\n\n#### Static Files\n\nDynamic web applications also need static files. That’s usually where the CSS and JavaScript files are coming from. Ideally your web server is configured to serve them for you, but during development Flask can do that as well. Just create a folder called static in your package or next to your module and it will be available at /static on the application.\n\nTo generate URLs for static files, use the special 'static' endpoint name:\n\n```python\nurl_for('static', filename='style.css')\n```\n\nThe file has to be stored on the filesystem as static/style.css.\n\n#### Rendering Templates\n\nGenerating HTML from within Python is not fun, and actually pretty cumbersome because you have to do the HTML escaping on your own to keep the application secure. Because of that Flask configures the Jinja2 template engine for you automatically.\n\nTemplates can be used to generate any type of text file. For web applications, you’ll primarily be generating HTML pages, but you can also generate markdown, plain text for emails, and anything else.\n\nFor a reference to HTML, CSS, and other web APIs, use the MDN Web Docs.\n\nTo render a template you can use the render_template() method. All you have to do is provide the name of the template and the variables you want to pass to the template engine as keyword arguments. Here’s a simple example of how to render a template:\n\n```python\nfrom flask import render_template\n\n@app.route('/hello/')\n@app.route('/hello/<name>')\ndef hello(name=None):\n    return render_template('hello.html', person=name)\nFlask will look for templates in the templates folder. So if your application is a module, this folder is next to that module, if it’s a package it’s actually inside your package:\n```\n\nCase 1: a module:\n\n```text\n/application.py\n/templates\n    /hello.html\n```\n\nCase 2: a package:\n\n```text\n/application\n    /__init__.py\n    /templates\n        /hello.html\n```\n\nFor templates you can use the full power of Jinja2 templates. Head over to the official Jinja2 Template Documentation for more information.\n\nHere is an example template:\n\n```html\n<!doctype html>\n<title>Hello from Flask</title>\n{% if person %}\n  <h1>Hello {{ person }}!</h1>\n{% else %}\n  <h1>Hello, World!</h1>\n{% endif %}\n```\n\n#### Accessing Request Data\n\nFor web applications it’s crucial to react to the data a client sends to the server. In Flask this information is provided by the global **request** object. If you have some experience with Python you might be wondering how that object can be global and how Flask manages to still be threadsafe. The answer is context locals:\n\nSo what does this mean to you? Basically you can completely ignore that this is the case unless you are doing something like unit testing. You will notice that code which depends on a request object will suddenly break because there is no request object. The solution is creating a request object yourself and binding it to the context. The easiest solution for unit testing is to use the **test_request_context()** context manager. In combination with the with statement it will bind a test request so that you can interact with it. Here is an example:\n\n```python\nfrom flask import request\n\nwith app.test_request_context('/hello', method='POST'):\n    # now you can do something with the request until the\n    # end of the with block, such as basic assertions:\n    assert request.path == '/hello'\n    assert request.method == 'POST'\n```","slug":"ai-plateform-flask","published":1,"updated":"2025-07-08T12:05:00.537Z","layout":"post","photos":[],"_id":"cmcvxsshm00093cug8y4a7fl9","content":"<h1 id=\"Flask-Overview\"><a href=\"#Flask-Overview\" class=\"headerlink\" title=\"Flask Overview\"></a>Flask Overview</h1><h2 id=\"Python-Install\"><a href=\"#Python-Install\" class=\"headerlink\" title=\"Python Install\"></a>Python Install</h2><p>Please install the python on your computer based on <a href=\"https://www.python.org/\">Python</a>.<br>If the system has some environmental path error when using the python order, please read <a href=\"https://stackoverflow.com/questions/3701646/how-to-add-to-the-pythonpath-in-windows-so-it-finds-my-modules-packages\">How to add to the PYTHONPATH in Windows</a>.</p>\n<h3 id=\"Virtual-environments\"><a href=\"#Virtual-environments\" class=\"headerlink\" title=\"Virtual environments\"></a>Virtual environments</h3><p>Use a virtual environment to manage the dependencies for your project, both in development and in production.</p>\n<p>What problem does a virtual environment solve? The more Python projects you have, the more likely it is that you need to work with different versions of Python libraries, or even Python itself. Newer versions of libraries for one project can break compatibility in another project.</p>\n<p>Virtual environments are independent groups of Python libraries, one for each project. Packages installed for one project will not affect other projects or the operating system’s packages.</p>\n<ol>\n<li>Create an environment.</li>\n</ol>\n<figure class=\"highlight powershell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir myproject</span><br><span class=\"line\"><span class=\"built_in\">cd</span> myproject</span><br><span class=\"line\">py <span class=\"literal\">-3</span> <span class=\"literal\">-m</span> venv .venv</span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>Active the environment.</li>\n</ol>\n<figure class=\"highlight powershell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">.venv\\Scripts\\activate</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Install-Flask\"><a href=\"#Install-Flask\" class=\"headerlink\" title=\"Install Flask\"></a>Install Flask</h2><figure class=\"highlight powershell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pip install Flask</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Quickstart\"><a href=\"#Quickstart\" class=\"headerlink\" title=\"Quickstart\"></a>Quickstart</h2><h3 id=\"A-Minimal-Application\"><a href=\"#A-Minimal-Application\" class=\"headerlink\" title=\"A Minimal Application\"></a>A Minimal Application</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> flask <span class=\"keyword\">import</span> Flask</span><br><span class=\"line\"></span><br><span class=\"line\">app = Flask(__name__)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.route(<span class=\"params\"><span class=\"string\">&quot;/&quot;</span></span>)</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">hello_world</span>():</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">&quot;&lt;p&gt;Hello, World!&lt;/p&gt;&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p>To run the application, use the <code>flask</code> command or <code>python -m flask</code>. You need to tell the Flask where your application is with the <code>--app</code> option.</p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">flask <span class=\"literal\">--app</span> hello run</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/ai-plateform-flask/image.png\" alt=\"Flask Running\"></p>\n<blockquote>\n<p>As a shortcut, if the file is named app.py or wsgi.py, you don’t have to use –app. See Command Line Interface for more details.</p>\n</blockquote>\n<h4 id=\"Debug-Mode\"><a href=\"#Debug-Mode\" class=\"headerlink\" title=\"Debug Mode\"></a>Debug Mode</h4><p>To enable debug mode, use the <code>--debug</code> option.</p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">flask <span class=\"literal\">--app</span> hello run <span class=\"literal\">--debug</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"HTML-Escaping\"><a href=\"#HTML-Escaping\" class=\"headerlink\" title=\"HTML Escaping\"></a>HTML Escaping</h4><p>When returning HTML (the default response type in Flask), any user-provided values rendered in the output must be escaped to protect from injection attacks. HTML templates rendered with Jinja, introduced later, will do this automatically.</p>\n<p><strong>escape()</strong>, shown here, can be used manually. It is omitted in most examples for brevity, but you should always be aware of how you’re using untrusted data.</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> flask <span class=\"keyword\">import</span> Flask</span><br><span class=\"line\"><span class=\"keyword\">from</span> markupsafe <span class=\"keyword\">import</span> escape</span><br><span class=\"line\"></span><br><span class=\"line\">app = Flask(__name__)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.route(<span class=\"params\"><span class=\"string\">&quot;/&quot;</span></span>)</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">hello_world</span>():</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">&quot;&lt;p&gt;Hello, World!&lt;/p&gt;&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.route(<span class=\"params\"><span class=\"string\">&quot;/&lt;name&gt;&quot;</span></span>)</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">hello</span>(<span class=\"params\">name</span>):</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">f&quot;Hello, <span class=\"subst\">&#123;escape(name)&#125;</span>!&quot;</span>;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"Routing\"><a href=\"#Routing\" class=\"headerlink\" title=\"Routing\"></a>Routing</h4><p>Modern web applications use meaningful URLs to help users. Users are more likely to like a page and come back if the page uses a meaningful URL they can remember and use to directly visit a page.</p>\n<p>Use the <strong>route()</strong> decorator to bind a function to a URL.</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@app.route(<span class=\"params\"><span class=\"string\">&#x27;/&#x27;</span></span>)</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">index</span>():</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">&#x27;Index Page&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.route(<span class=\"params\"><span class=\"string\">&#x27;/hello&#x27;</span></span>)</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">hello</span>():</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">&#x27;Hello, World&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"Variable-Rules\"><a href=\"#Variable-Rules\" class=\"headerlink\" title=\"Variable Rules\"></a>Variable Rules</h4><p>You can add variable sections to a URL by marking sections with <code>&lt;variable_name&gt;</code>. Your function then receives the <code>&lt;variable_name&gt;</code> as a keyword argument. Optionally, you can use a converter to specify the type of the argument like <code>&lt;converter:variable_name&gt;</code>.</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> markupsafe <span class=\"keyword\">import</span> escape</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.route(<span class=\"params\"><span class=\"string\">&#x27;/user/&lt;username&gt;&#x27;</span></span>)</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">show_user_profile</span>(<span class=\"params\">username</span>):</span><br><span class=\"line\">    <span class=\"comment\"># show the user profile for that user</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">f&#x27;User <span class=\"subst\">&#123;escape(username)&#125;</span>&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.route(<span class=\"params\"><span class=\"string\">&#x27;/post/&lt;int:post_id&gt;&#x27;</span></span>)</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">show_post</span>(<span class=\"params\">post_id</span>):</span><br><span class=\"line\">    <span class=\"comment\"># show the post with the given id, the id is an integer</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">f&#x27;Post <span class=\"subst\">&#123;post_id&#125;</span>&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.route(<span class=\"params\"><span class=\"string\">&#x27;/path/&lt;path:subpath&gt;&#x27;</span></span>)</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">show_subpath</span>(<span class=\"params\">subpath</span>):</span><br><span class=\"line\">    <span class=\"comment\"># show the subpath after /path/</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">f&#x27;Subpath <span class=\"subst\">&#123;escape(subpath)&#125;</span>&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<table>\n<thead>\n<tr>\n<th>type</th>\n<th>description</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>string</td>\n<td>(default) accepts any text without a slash</td>\n</tr>\n<tr>\n<td>int</td>\n<td>accepts positive integers</td>\n</tr>\n<tr>\n<td>float</td>\n<td>accepts positive floating point values</td>\n</tr>\n<tr>\n<td>path</td>\n<td>like string but also accepts slashes</td>\n</tr>\n<tr>\n<td>uuid</td>\n<td>accepts UUID strings</td>\n</tr>\n</tbody></table>\n<h4 id=\"Unique-URLs-Redirection-Behavior\"><a href=\"#Unique-URLs-Redirection-Behavior\" class=\"headerlink\" title=\"Unique URLs &#x2F; Redirection Behavior\"></a>Unique URLs &#x2F; Redirection Behavior</h4><p>The following two rules differ in their use of a trailing slash.</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@app.route(<span class=\"params\"><span class=\"string\">&#x27;/projects/&#x27;</span></span>)</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">projects</span>():</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">&#x27;The project page&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.route(<span class=\"params\"><span class=\"string\">&#x27;/about&#x27;</span></span>)</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">about</span>():</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">&#x27;The about page&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<p>The canonical URL for the projects endpoint has a trailing slash. It’s similar to a folder in a file system. If you access the URL without a trailing slash (&#x2F;projects), Flask redirects you to the canonical URL with the trailing slash (&#x2F;projects&#x2F;).</p>\n<p>The canonical URL for the about endpoint does not have a trailing slash. It’s similar to the pathname of a file. Accessing the URL with a trailing slash (&#x2F;about&#x2F;) produces a 404 “Not Found” error. This helps keep URLs unique for these resources, which helps search engines avoid indexing the same page twice.</p>\n<h4 id=\"HTTP-Methods\"><a href=\"#HTTP-Methods\" class=\"headerlink\" title=\"HTTP Methods\"></a>HTTP Methods</h4><p>Web applications use different HTTP methods when accessing URLs. You should familiarize yourself with the HTTP methods as you work with Flask. By default, a route only answers to <code>GET</code> requests. You can use the <code>methods</code> argument of the <strong>route()</strong> decorator to handle different HTTP methods.</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> flask <span class=\"keyword\">import</span> request</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.route(<span class=\"params\"><span class=\"string\">&#x27;/login&#x27;</span>, methods=[<span class=\"string\">&#x27;GET&#x27;</span>, <span class=\"string\">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">login</span>():</span><br><span class=\"line\">    <span class=\"keyword\">if</span> request.method == <span class=\"string\">&#x27;POST&#x27;</span>:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> do_the_login()</span><br><span class=\"line\">    <span class=\"keyword\">else</span>:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> show_the_login_form()</span><br></pre></td></tr></table></figure>\n\n<p>The example above keeps all methods for the route within one function, which can be useful if each part uses some common data.</p>\n<p>You can also separate views for different methods into different functions. Flask provides a shortcut for decorating such routes with <strong>get(), post()</strong>, etc. for each common HTTP method.</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@app.get(<span class=\"params\"><span class=\"string\">&#x27;/login&#x27;</span></span>)</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">login_get</span>():</span><br><span class=\"line\">    <span class=\"keyword\">return</span> show_the_login_form()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.post(<span class=\"params\"><span class=\"string\">&#x27;/login&#x27;</span></span>)</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">login_post</span>():</span><br><span class=\"line\">    <span class=\"keyword\">return</span> do_the_login()</span><br></pre></td></tr></table></figure>\n\n<p>If GET is present, Flask automatically adds support for the HEAD method and handles HEAD requests according to the HTTP RFC. Likewise, OPTIONS is automatically implemented for you.</p>\n<h4 id=\"Static-Files\"><a href=\"#Static-Files\" class=\"headerlink\" title=\"Static Files\"></a>Static Files</h4><p>Dynamic web applications also need static files. That’s usually where the CSS and JavaScript files are coming from. Ideally your web server is configured to serve them for you, but during development Flask can do that as well. Just create a folder called static in your package or next to your module and it will be available at &#x2F;static on the application.</p>\n<p>To generate URLs for static files, use the special ‘static’ endpoint name:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">url_for(<span class=\"string\">&#x27;static&#x27;</span>, filename=<span class=\"string\">&#x27;style.css&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>The file has to be stored on the filesystem as static&#x2F;style.css.</p>\n<h4 id=\"Rendering-Templates\"><a href=\"#Rendering-Templates\" class=\"headerlink\" title=\"Rendering Templates\"></a>Rendering Templates</h4><p>Generating HTML from within Python is not fun, and actually pretty cumbersome because you have to do the HTML escaping on your own to keep the application secure. Because of that Flask configures the Jinja2 template engine for you automatically.</p>\n<p>Templates can be used to generate any type of text file. For web applications, you’ll primarily be generating HTML pages, but you can also generate markdown, plain text for emails, and anything else.</p>\n<p>For a reference to HTML, CSS, and other web APIs, use the MDN Web Docs.</p>\n<p>To render a template you can use the render_template() method. All you have to do is provide the name of the template and the variables you want to pass to the template engine as keyword arguments. Here’s a simple example of how to render a template:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> flask <span class=\"keyword\">import</span> render_template</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.route(<span class=\"params\"><span class=\"string\">&#x27;/hello/&#x27;</span></span>)</span></span><br><span class=\"line\"><span class=\"meta\">@app.route(<span class=\"params\"><span class=\"string\">&#x27;/hello/&lt;name&gt;&#x27;</span></span>)</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">hello</span>(<span class=\"params\">name=<span class=\"literal\">None</span></span>):</span><br><span class=\"line\">    <span class=\"keyword\">return</span> render_template(<span class=\"string\">&#x27;hello.html&#x27;</span>, person=name)</span><br><span class=\"line\">Flask will look <span class=\"keyword\">for</span> templates <span class=\"keyword\">in</span> the templates folder. So <span class=\"keyword\">if</span> your application <span class=\"keyword\">is</span> a module, this folder <span class=\"keyword\">is</span> <span class=\"built_in\">next</span> to that module, <span class=\"keyword\">if</span> it’s a package it’s actually inside your package:</span><br></pre></td></tr></table></figure>\n\n<p>Case 1: a module:</p>\n<figure class=\"highlight text\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/application.py</span><br><span class=\"line\">/templates</span><br><span class=\"line\">    /hello.html</span><br></pre></td></tr></table></figure>\n\n<p>Case 2: a package:</p>\n<figure class=\"highlight text\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/application</span><br><span class=\"line\">    /__init__.py</span><br><span class=\"line\">    /templates</span><br><span class=\"line\">        /hello.html</span><br></pre></td></tr></table></figure>\n\n<p>For templates you can use the full power of Jinja2 templates. Head over to the official Jinja2 Template Documentation for more information.</p>\n<p>Here is an example template:</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!doctype <span class=\"keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Hello from Flask<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">&#123;% if person %&#125;</span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span>Hello &#123;&#123; person &#125;&#125;!<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span><br><span class=\"line\">&#123;% else %&#125;</span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span>Hello, World!<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span><br><span class=\"line\">&#123;% endif %&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"Accessing-Request-Data\"><a href=\"#Accessing-Request-Data\" class=\"headerlink\" title=\"Accessing Request Data\"></a>Accessing Request Data</h4><p>For web applications it’s crucial to react to the data a client sends to the server. In Flask this information is provided by the global <strong>request</strong> object. If you have some experience with Python you might be wondering how that object can be global and how Flask manages to still be threadsafe. The answer is context locals:</p>\n<p>So what does this mean to you? Basically you can completely ignore that this is the case unless you are doing something like unit testing. You will notice that code which depends on a request object will suddenly break because there is no request object. The solution is creating a request object yourself and binding it to the context. The easiest solution for unit testing is to use the <strong>test_request_context()</strong> context manager. In combination with the with statement it will bind a test request so that you can interact with it. Here is an example:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> flask <span class=\"keyword\">import</span> request</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">with</span> app.test_request_context(<span class=\"string\">&#x27;/hello&#x27;</span>, method=<span class=\"string\">&#x27;POST&#x27;</span>):</span><br><span class=\"line\">    <span class=\"comment\"># now you can do something with the request until the</span></span><br><span class=\"line\">    <span class=\"comment\"># end of the with block, such as basic assertions:</span></span><br><span class=\"line\">    <span class=\"keyword\">assert</span> request.path == <span class=\"string\">&#x27;/hello&#x27;</span></span><br><span class=\"line\">    <span class=\"keyword\">assert</span> request.method == <span class=\"string\">&#x27;POST&#x27;</span></span><br></pre></td></tr></table></figure>","excerpt":"","more":"<h1 id=\"Flask-Overview\"><a href=\"#Flask-Overview\" class=\"headerlink\" title=\"Flask Overview\"></a>Flask Overview</h1><h2 id=\"Python-Install\"><a href=\"#Python-Install\" class=\"headerlink\" title=\"Python Install\"></a>Python Install</h2><p>Please install the python on your computer based on <a href=\"https://www.python.org/\">Python</a>.<br>If the system has some environmental path error when using the python order, please read <a href=\"https://stackoverflow.com/questions/3701646/how-to-add-to-the-pythonpath-in-windows-so-it-finds-my-modules-packages\">How to add to the PYTHONPATH in Windows</a>.</p>\n<h3 id=\"Virtual-environments\"><a href=\"#Virtual-environments\" class=\"headerlink\" title=\"Virtual environments\"></a>Virtual environments</h3><p>Use a virtual environment to manage the dependencies for your project, both in development and in production.</p>\n<p>What problem does a virtual environment solve? The more Python projects you have, the more likely it is that you need to work with different versions of Python libraries, or even Python itself. Newer versions of libraries for one project can break compatibility in another project.</p>\n<p>Virtual environments are independent groups of Python libraries, one for each project. Packages installed for one project will not affect other projects or the operating system’s packages.</p>\n<ol>\n<li>Create an environment.</li>\n</ol>\n<figure class=\"highlight powershell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir myproject</span><br><span class=\"line\"><span class=\"built_in\">cd</span> myproject</span><br><span class=\"line\">py <span class=\"literal\">-3</span> <span class=\"literal\">-m</span> venv .venv</span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>Active the environment.</li>\n</ol>\n<figure class=\"highlight powershell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">.venv\\Scripts\\activate</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Install-Flask\"><a href=\"#Install-Flask\" class=\"headerlink\" title=\"Install Flask\"></a>Install Flask</h2><figure class=\"highlight powershell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pip install Flask</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Quickstart\"><a href=\"#Quickstart\" class=\"headerlink\" title=\"Quickstart\"></a>Quickstart</h2><h3 id=\"A-Minimal-Application\"><a href=\"#A-Minimal-Application\" class=\"headerlink\" title=\"A Minimal Application\"></a>A Minimal Application</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> flask <span class=\"keyword\">import</span> Flask</span><br><span class=\"line\"></span><br><span class=\"line\">app = Flask(__name__)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.route(<span class=\"params\"><span class=\"string\">&quot;/&quot;</span></span>)</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">hello_world</span>():</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">&quot;&lt;p&gt;Hello, World!&lt;/p&gt;&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p>To run the application, use the <code>flask</code> command or <code>python -m flask</code>. You need to tell the Flask where your application is with the <code>--app</code> option.</p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">flask <span class=\"literal\">--app</span> hello run</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/ai-plateform-flask/image.png\" alt=\"Flask Running\"></p>\n<blockquote>\n<p>As a shortcut, if the file is named app.py or wsgi.py, you don’t have to use –app. See Command Line Interface for more details.</p>\n</blockquote>\n<h4 id=\"Debug-Mode\"><a href=\"#Debug-Mode\" class=\"headerlink\" title=\"Debug Mode\"></a>Debug Mode</h4><p>To enable debug mode, use the <code>--debug</code> option.</p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">flask <span class=\"literal\">--app</span> hello run <span class=\"literal\">--debug</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"HTML-Escaping\"><a href=\"#HTML-Escaping\" class=\"headerlink\" title=\"HTML Escaping\"></a>HTML Escaping</h4><p>When returning HTML (the default response type in Flask), any user-provided values rendered in the output must be escaped to protect from injection attacks. HTML templates rendered with Jinja, introduced later, will do this automatically.</p>\n<p><strong>escape()</strong>, shown here, can be used manually. It is omitted in most examples for brevity, but you should always be aware of how you’re using untrusted data.</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> flask <span class=\"keyword\">import</span> Flask</span><br><span class=\"line\"><span class=\"keyword\">from</span> markupsafe <span class=\"keyword\">import</span> escape</span><br><span class=\"line\"></span><br><span class=\"line\">app = Flask(__name__)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.route(<span class=\"params\"><span class=\"string\">&quot;/&quot;</span></span>)</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">hello_world</span>():</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">&quot;&lt;p&gt;Hello, World!&lt;/p&gt;&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.route(<span class=\"params\"><span class=\"string\">&quot;/&lt;name&gt;&quot;</span></span>)</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">hello</span>(<span class=\"params\">name</span>):</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">f&quot;Hello, <span class=\"subst\">&#123;escape(name)&#125;</span>!&quot;</span>;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"Routing\"><a href=\"#Routing\" class=\"headerlink\" title=\"Routing\"></a>Routing</h4><p>Modern web applications use meaningful URLs to help users. Users are more likely to like a page and come back if the page uses a meaningful URL they can remember and use to directly visit a page.</p>\n<p>Use the <strong>route()</strong> decorator to bind a function to a URL.</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@app.route(<span class=\"params\"><span class=\"string\">&#x27;/&#x27;</span></span>)</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">index</span>():</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">&#x27;Index Page&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.route(<span class=\"params\"><span class=\"string\">&#x27;/hello&#x27;</span></span>)</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">hello</span>():</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">&#x27;Hello, World&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"Variable-Rules\"><a href=\"#Variable-Rules\" class=\"headerlink\" title=\"Variable Rules\"></a>Variable Rules</h4><p>You can add variable sections to a URL by marking sections with <code>&lt;variable_name&gt;</code>. Your function then receives the <code>&lt;variable_name&gt;</code> as a keyword argument. Optionally, you can use a converter to specify the type of the argument like <code>&lt;converter:variable_name&gt;</code>.</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> markupsafe <span class=\"keyword\">import</span> escape</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.route(<span class=\"params\"><span class=\"string\">&#x27;/user/&lt;username&gt;&#x27;</span></span>)</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">show_user_profile</span>(<span class=\"params\">username</span>):</span><br><span class=\"line\">    <span class=\"comment\"># show the user profile for that user</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">f&#x27;User <span class=\"subst\">&#123;escape(username)&#125;</span>&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.route(<span class=\"params\"><span class=\"string\">&#x27;/post/&lt;int:post_id&gt;&#x27;</span></span>)</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">show_post</span>(<span class=\"params\">post_id</span>):</span><br><span class=\"line\">    <span class=\"comment\"># show the post with the given id, the id is an integer</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">f&#x27;Post <span class=\"subst\">&#123;post_id&#125;</span>&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.route(<span class=\"params\"><span class=\"string\">&#x27;/path/&lt;path:subpath&gt;&#x27;</span></span>)</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">show_subpath</span>(<span class=\"params\">subpath</span>):</span><br><span class=\"line\">    <span class=\"comment\"># show the subpath after /path/</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">f&#x27;Subpath <span class=\"subst\">&#123;escape(subpath)&#125;</span>&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<table>\n<thead>\n<tr>\n<th>type</th>\n<th>description</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>string</td>\n<td>(default) accepts any text without a slash</td>\n</tr>\n<tr>\n<td>int</td>\n<td>accepts positive integers</td>\n</tr>\n<tr>\n<td>float</td>\n<td>accepts positive floating point values</td>\n</tr>\n<tr>\n<td>path</td>\n<td>like string but also accepts slashes</td>\n</tr>\n<tr>\n<td>uuid</td>\n<td>accepts UUID strings</td>\n</tr>\n</tbody></table>\n<h4 id=\"Unique-URLs-Redirection-Behavior\"><a href=\"#Unique-URLs-Redirection-Behavior\" class=\"headerlink\" title=\"Unique URLs &#x2F; Redirection Behavior\"></a>Unique URLs &#x2F; Redirection Behavior</h4><p>The following two rules differ in their use of a trailing slash.</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@app.route(<span class=\"params\"><span class=\"string\">&#x27;/projects/&#x27;</span></span>)</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">projects</span>():</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">&#x27;The project page&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.route(<span class=\"params\"><span class=\"string\">&#x27;/about&#x27;</span></span>)</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">about</span>():</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">&#x27;The about page&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<p>The canonical URL for the projects endpoint has a trailing slash. It’s similar to a folder in a file system. If you access the URL without a trailing slash (&#x2F;projects), Flask redirects you to the canonical URL with the trailing slash (&#x2F;projects&#x2F;).</p>\n<p>The canonical URL for the about endpoint does not have a trailing slash. It’s similar to the pathname of a file. Accessing the URL with a trailing slash (&#x2F;about&#x2F;) produces a 404 “Not Found” error. This helps keep URLs unique for these resources, which helps search engines avoid indexing the same page twice.</p>\n<h4 id=\"HTTP-Methods\"><a href=\"#HTTP-Methods\" class=\"headerlink\" title=\"HTTP Methods\"></a>HTTP Methods</h4><p>Web applications use different HTTP methods when accessing URLs. You should familiarize yourself with the HTTP methods as you work with Flask. By default, a route only answers to <code>GET</code> requests. You can use the <code>methods</code> argument of the <strong>route()</strong> decorator to handle different HTTP methods.</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> flask <span class=\"keyword\">import</span> request</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.route(<span class=\"params\"><span class=\"string\">&#x27;/login&#x27;</span>, methods=[<span class=\"string\">&#x27;GET&#x27;</span>, <span class=\"string\">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">login</span>():</span><br><span class=\"line\">    <span class=\"keyword\">if</span> request.method == <span class=\"string\">&#x27;POST&#x27;</span>:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> do_the_login()</span><br><span class=\"line\">    <span class=\"keyword\">else</span>:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> show_the_login_form()</span><br></pre></td></tr></table></figure>\n\n<p>The example above keeps all methods for the route within one function, which can be useful if each part uses some common data.</p>\n<p>You can also separate views for different methods into different functions. Flask provides a shortcut for decorating such routes with <strong>get(), post()</strong>, etc. for each common HTTP method.</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@app.get(<span class=\"params\"><span class=\"string\">&#x27;/login&#x27;</span></span>)</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">login_get</span>():</span><br><span class=\"line\">    <span class=\"keyword\">return</span> show_the_login_form()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.post(<span class=\"params\"><span class=\"string\">&#x27;/login&#x27;</span></span>)</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">login_post</span>():</span><br><span class=\"line\">    <span class=\"keyword\">return</span> do_the_login()</span><br></pre></td></tr></table></figure>\n\n<p>If GET is present, Flask automatically adds support for the HEAD method and handles HEAD requests according to the HTTP RFC. Likewise, OPTIONS is automatically implemented for you.</p>\n<h4 id=\"Static-Files\"><a href=\"#Static-Files\" class=\"headerlink\" title=\"Static Files\"></a>Static Files</h4><p>Dynamic web applications also need static files. That’s usually where the CSS and JavaScript files are coming from. Ideally your web server is configured to serve them for you, but during development Flask can do that as well. Just create a folder called static in your package or next to your module and it will be available at &#x2F;static on the application.</p>\n<p>To generate URLs for static files, use the special ‘static’ endpoint name:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">url_for(<span class=\"string\">&#x27;static&#x27;</span>, filename=<span class=\"string\">&#x27;style.css&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>The file has to be stored on the filesystem as static&#x2F;style.css.</p>\n<h4 id=\"Rendering-Templates\"><a href=\"#Rendering-Templates\" class=\"headerlink\" title=\"Rendering Templates\"></a>Rendering Templates</h4><p>Generating HTML from within Python is not fun, and actually pretty cumbersome because you have to do the HTML escaping on your own to keep the application secure. Because of that Flask configures the Jinja2 template engine for you automatically.</p>\n<p>Templates can be used to generate any type of text file. For web applications, you’ll primarily be generating HTML pages, but you can also generate markdown, plain text for emails, and anything else.</p>\n<p>For a reference to HTML, CSS, and other web APIs, use the MDN Web Docs.</p>\n<p>To render a template you can use the render_template() method. All you have to do is provide the name of the template and the variables you want to pass to the template engine as keyword arguments. Here’s a simple example of how to render a template:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> flask <span class=\"keyword\">import</span> render_template</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.route(<span class=\"params\"><span class=\"string\">&#x27;/hello/&#x27;</span></span>)</span></span><br><span class=\"line\"><span class=\"meta\">@app.route(<span class=\"params\"><span class=\"string\">&#x27;/hello/&lt;name&gt;&#x27;</span></span>)</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">hello</span>(<span class=\"params\">name=<span class=\"literal\">None</span></span>):</span><br><span class=\"line\">    <span class=\"keyword\">return</span> render_template(<span class=\"string\">&#x27;hello.html&#x27;</span>, person=name)</span><br><span class=\"line\">Flask will look <span class=\"keyword\">for</span> templates <span class=\"keyword\">in</span> the templates folder. So <span class=\"keyword\">if</span> your application <span class=\"keyword\">is</span> a module, this folder <span class=\"keyword\">is</span> <span class=\"built_in\">next</span> to that module, <span class=\"keyword\">if</span> it’s a package it’s actually inside your package:</span><br></pre></td></tr></table></figure>\n\n<p>Case 1: a module:</p>\n<figure class=\"highlight text\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/application.py</span><br><span class=\"line\">/templates</span><br><span class=\"line\">    /hello.html</span><br></pre></td></tr></table></figure>\n\n<p>Case 2: a package:</p>\n<figure class=\"highlight text\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/application</span><br><span class=\"line\">    /__init__.py</span><br><span class=\"line\">    /templates</span><br><span class=\"line\">        /hello.html</span><br></pre></td></tr></table></figure>\n\n<p>For templates you can use the full power of Jinja2 templates. Head over to the official Jinja2 Template Documentation for more information.</p>\n<p>Here is an example template:</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!doctype <span class=\"keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Hello from Flask<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">&#123;% if person %&#125;</span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span>Hello &#123;&#123; person &#125;&#125;!<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span><br><span class=\"line\">&#123;% else %&#125;</span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span>Hello, World!<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span><br><span class=\"line\">&#123;% endif %&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"Accessing-Request-Data\"><a href=\"#Accessing-Request-Data\" class=\"headerlink\" title=\"Accessing Request Data\"></a>Accessing Request Data</h4><p>For web applications it’s crucial to react to the data a client sends to the server. In Flask this information is provided by the global <strong>request</strong> object. If you have some experience with Python you might be wondering how that object can be global and how Flask manages to still be threadsafe. The answer is context locals:</p>\n<p>So what does this mean to you? Basically you can completely ignore that this is the case unless you are doing something like unit testing. You will notice that code which depends on a request object will suddenly break because there is no request object. The solution is creating a request object yourself and binding it to the context. The easiest solution for unit testing is to use the <strong>test_request_context()</strong> context manager. In combination with the with statement it will bind a test request so that you can interact with it. Here is an example:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> flask <span class=\"keyword\">import</span> request</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">with</span> app.test_request_context(<span class=\"string\">&#x27;/hello&#x27;</span>, method=<span class=\"string\">&#x27;POST&#x27;</span>):</span><br><span class=\"line\">    <span class=\"comment\"># now you can do something with the request until the</span></span><br><span class=\"line\">    <span class=\"comment\"># end of the with block, such as basic assertions:</span></span><br><span class=\"line\">    <span class=\"keyword\">assert</span> request.path == <span class=\"string\">&#x27;/hello&#x27;</span></span><br><span class=\"line\">    <span class=\"keyword\">assert</span> request.method == <span class=\"string\">&#x27;POST&#x27;</span></span><br></pre></td></tr></table></figure>"},{"title":"Cache","date":"2024-12-22T04:42:02.000Z","comments":1,"description":"Retail Cache","_content":"\nPOS 前后端通信通常需要使用 `extension properties`；`extension properties` 存在于 **Cart**、**CartLine**、**SalesTransaction** 和 **SalesLine** 等；但某些场景，无法编辑 `extension properties`，所以无法通信；可以按照以下 **Cache** 构建新的通信机制；（谨慎使用，影响性能）\n\n{% asset_img \"commerce-cache-example.png\" \"cache example\" %}\n\n### Cache.cs 代码示例\n\n```c#\nusing Microsoft.Extensions.Caching.Memory;\nusing System;\n\nnamespace LMS.Cache\n{\n    public class LMSCache\n    {\n        private static readonly Lazy<MemoryCache> lazy = new Lazy<MemoryCache>(()\n            => new MemoryCache(new MemoryCacheOptions()));\n        private static MemoryCache cache\n        {\n            get\n            {\n                return lazy.Value;\n            }\n        }\n\n        public T Get<T>(string key)\n        {\n            if (!cache.TryGetValue<T>(key, out T cacheItem))\n            {\n                return default;\n            }\n            else\n            {\n                return cacheItem;\n            }\n        }\n\n        public void Put<T>(string key, T value, int cacheLifeInSeconds = 500)\n        {\n            if (value == null)\n            {\n                if (cache.Get(key) != null)\n                {\n                    cache.Remove(key);\n                }\n            }\n            else\n            {\n                cache.Set<T>(key, value, DateTimeOffset.Now.AddSeconds(cacheLifeInSeconds));\n            }\n        }\n    }\n}\n```\n\n### 使用示例\n\n```c#\n(new LMSCache()).Get<string>(key); // Get the value by key\n(new LMSCache()).Put<string, string>(key, value); // Put the key value mapping\n```","source":"_posts/commerce-cache.md","raw":"---\ntitle: Cache\ndate: 2024-12-22 12:42:02\ncategories: \n - commerce\ncomments: true\ndescription: Retail Cache\n---\n\nPOS 前后端通信通常需要使用 `extension properties`；`extension properties` 存在于 **Cart**、**CartLine**、**SalesTransaction** 和 **SalesLine** 等；但某些场景，无法编辑 `extension properties`，所以无法通信；可以按照以下 **Cache** 构建新的通信机制；（谨慎使用，影响性能）\n\n{% asset_img \"commerce-cache-example.png\" \"cache example\" %}\n\n### Cache.cs 代码示例\n\n```c#\nusing Microsoft.Extensions.Caching.Memory;\nusing System;\n\nnamespace LMS.Cache\n{\n    public class LMSCache\n    {\n        private static readonly Lazy<MemoryCache> lazy = new Lazy<MemoryCache>(()\n            => new MemoryCache(new MemoryCacheOptions()));\n        private static MemoryCache cache\n        {\n            get\n            {\n                return lazy.Value;\n            }\n        }\n\n        public T Get<T>(string key)\n        {\n            if (!cache.TryGetValue<T>(key, out T cacheItem))\n            {\n                return default;\n            }\n            else\n            {\n                return cacheItem;\n            }\n        }\n\n        public void Put<T>(string key, T value, int cacheLifeInSeconds = 500)\n        {\n            if (value == null)\n            {\n                if (cache.Get(key) != null)\n                {\n                    cache.Remove(key);\n                }\n            }\n            else\n            {\n                cache.Set<T>(key, value, DateTimeOffset.Now.AddSeconds(cacheLifeInSeconds));\n            }\n        }\n    }\n}\n```\n\n### 使用示例\n\n```c#\n(new LMSCache()).Get<string>(key); // Get the value by key\n(new LMSCache()).Put<string, string>(key, value); // Put the key value mapping\n```","slug":"commerce-cache","published":1,"updated":"2025-07-08T12:05:00.538Z","layout":"post","photos":[],"_id":"cmcvxsshm000a3cugf1gxfr0t","content":"<p>POS 前后端通信通常需要使用 <code>extension properties</code>；<code>extension properties</code> 存在于 <strong>Cart</strong>、<strong>CartLine</strong>、<strong>SalesTransaction</strong> 和 <strong>SalesLine</strong> 等；但某些场景，无法编辑 <code>extension properties</code>，所以无法通信；可以按照以下 <strong>Cache</strong> 构建新的通信机制；（谨慎使用，影响性能）</p>\n<img src=\"/2024/12/22/commerce-cache/commerce-cache-example.png\" class=\"\" title=\"cache example\">\n\n<h3 id=\"Cache-cs-代码示例\"><a href=\"#Cache-cs-代码示例\" class=\"headerlink\" title=\"Cache.cs 代码示例\"></a>Cache.cs 代码示例</h3><figure class=\"highlight c#\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">using</span> Microsoft.Extensions.Caching.Memory;</span><br><span class=\"line\"><span class=\"keyword\">using</span> System;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">namespace</span> <span class=\"title\">LMS.Cache</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title\">LMSCache</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">readonly</span> Lazy&lt;MemoryCache&gt; lazy = <span class=\"keyword\">new</span> Lazy&lt;MemoryCache&gt;(()</span><br><span class=\"line\">            =&gt; <span class=\"keyword\">new</span> MemoryCache(<span class=\"keyword\">new</span> MemoryCacheOptions()));</span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> MemoryCache cache</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">get</span></span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> lazy.Value;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> T <span class=\"title\">Get</span>&lt;<span class=\"title\">T</span>&gt;(<span class=\"params\"><span class=\"built_in\">string</span> key</span>)</span></span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (!cache.TryGetValue&lt;T&gt;(key, <span class=\"keyword\">out</span> T cacheItem))</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"literal\">default</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">else</span></span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> cacheItem;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">Put</span>&lt;<span class=\"title\">T</span>&gt;(<span class=\"params\"><span class=\"built_in\">string</span> key, T <span class=\"keyword\">value</span>, <span class=\"built_in\">int</span> cacheLifeInSeconds = <span class=\"number\">500</span></span>)</span></span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (<span class=\"keyword\">value</span> == <span class=\"literal\">null</span>)</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (cache.Get(key) != <span class=\"literal\">null</span>)</span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    cache.Remove(key);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">else</span></span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                cache.Set&lt;T&gt;(key, <span class=\"keyword\">value</span>, DateTimeOffset.Now.AddSeconds(cacheLifeInSeconds));</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"使用示例\"><a href=\"#使用示例\" class=\"headerlink\" title=\"使用示例\"></a>使用示例</h3><figure class=\"highlight c#\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">(<span class=\"keyword\">new</span> LMSCache()).Get&lt;<span class=\"built_in\">string</span>&gt;(key); <span class=\"comment\">// Get the value by key</span></span><br><span class=\"line\">(<span class=\"keyword\">new</span> LMSCache()).Put&lt;<span class=\"built_in\">string</span>, <span class=\"built_in\">string</span>&gt;(key, <span class=\"keyword\">value</span>); <span class=\"comment\">// Put the key value mapping</span></span><br></pre></td></tr></table></figure>","excerpt":"","more":"<p>POS 前后端通信通常需要使用 <code>extension properties</code>；<code>extension properties</code> 存在于 <strong>Cart</strong>、<strong>CartLine</strong>、<strong>SalesTransaction</strong> 和 <strong>SalesLine</strong> 等；但某些场景，无法编辑 <code>extension properties</code>，所以无法通信；可以按照以下 <strong>Cache</strong> 构建新的通信机制；（谨慎使用，影响性能）</p>\n<img src=\"/2024/12/22/commerce-cache/commerce-cache-example.png\" class=\"\" title=\"cache example\">\n\n<h3 id=\"Cache-cs-代码示例\"><a href=\"#Cache-cs-代码示例\" class=\"headerlink\" title=\"Cache.cs 代码示例\"></a>Cache.cs 代码示例</h3><figure class=\"highlight c#\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">using</span> Microsoft.Extensions.Caching.Memory;</span><br><span class=\"line\"><span class=\"keyword\">using</span> System;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">namespace</span> <span class=\"title\">LMS.Cache</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title\">LMSCache</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">readonly</span> Lazy&lt;MemoryCache&gt; lazy = <span class=\"keyword\">new</span> Lazy&lt;MemoryCache&gt;(()</span><br><span class=\"line\">            =&gt; <span class=\"keyword\">new</span> MemoryCache(<span class=\"keyword\">new</span> MemoryCacheOptions()));</span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> MemoryCache cache</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">get</span></span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> lazy.Value;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> T <span class=\"title\">Get</span>&lt;<span class=\"title\">T</span>&gt;(<span class=\"params\"><span class=\"built_in\">string</span> key</span>)</span></span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (!cache.TryGetValue&lt;T&gt;(key, <span class=\"keyword\">out</span> T cacheItem))</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"literal\">default</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">else</span></span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> cacheItem;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">Put</span>&lt;<span class=\"title\">T</span>&gt;(<span class=\"params\"><span class=\"built_in\">string</span> key, T <span class=\"keyword\">value</span>, <span class=\"built_in\">int</span> cacheLifeInSeconds = <span class=\"number\">500</span></span>)</span></span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (<span class=\"keyword\">value</span> == <span class=\"literal\">null</span>)</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (cache.Get(key) != <span class=\"literal\">null</span>)</span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    cache.Remove(key);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">else</span></span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                cache.Set&lt;T&gt;(key, <span class=\"keyword\">value</span>, DateTimeOffset.Now.AddSeconds(cacheLifeInSeconds));</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"使用示例\"><a href=\"#使用示例\" class=\"headerlink\" title=\"使用示例\"></a>使用示例</h3><figure class=\"highlight c#\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">(<span class=\"keyword\">new</span> LMSCache()).Get&lt;<span class=\"built_in\">string</span>&gt;(key); <span class=\"comment\">// Get the value by key</span></span><br><span class=\"line\">(<span class=\"keyword\">new</span> LMSCache()).Put&lt;<span class=\"built_in\">string</span>, <span class=\"built_in\">string</span>&gt;(key, <span class=\"keyword\">value</span>); <span class=\"comment\">// Put the key value mapping</span></span><br></pre></td></tr></table></figure>"},{"title":"How to Print the Amount Based on the Language Id","date":"2024-12-23T06:56:52.000Z","comments":1,"description":"This article shows you the way that got the amount based on the language id.","_content":"\n### How to get the Language Id\n\n```c#\nstring languageText = string.Empty;\n\nif (request.RequestContext.LanguageId != null && request.RequestContext.LanguageId != \"\") // Get the LanguageId from request context\n{\n    languageText = request.RequestContext.LanguageId;\n}\nelse\n{\n    languageText = \"en-us\";\n}\n\nCultureInfo culture = new CultureInfo(languageText); // Get the culture based on LanguageId\n```\n\n### Format the amount based on culture\n\nThe `decimal.ToString()` included two parameters, for example:\n\n```c#\ndl.EffectiveAmount.ToString(\"C2\", culture); // The first parameter means the currency code should be something, the second parameter means the amount value should be format based on some culture rules.​\n```","source":"_posts/commerce-use-languageId.md","raw":"---\ntitle: How to Print the Amount Based on the Language Id\ndate: 2024-12-23 14:56:52\ncategories: \n - commerce\ncomments: true\ndescription: This article shows you the way that got the amount based on the language id.\n---\n\n### How to get the Language Id\n\n```c#\nstring languageText = string.Empty;\n\nif (request.RequestContext.LanguageId != null && request.RequestContext.LanguageId != \"\") // Get the LanguageId from request context\n{\n    languageText = request.RequestContext.LanguageId;\n}\nelse\n{\n    languageText = \"en-us\";\n}\n\nCultureInfo culture = new CultureInfo(languageText); // Get the culture based on LanguageId\n```\n\n### Format the amount based on culture\n\nThe `decimal.ToString()` included two parameters, for example:\n\n```c#\ndl.EffectiveAmount.ToString(\"C2\", culture); // The first parameter means the currency code should be something, the second parameter means the amount value should be format based on some culture rules.​\n```","slug":"commerce-use-languageId","published":1,"updated":"2025-07-08T12:05:00.538Z","layout":"post","photos":[],"_id":"cmcvxsshn000c3cughzgc21l2","content":"<h3 id=\"How-to-get-the-Language-Id\"><a href=\"#How-to-get-the-Language-Id\" class=\"headerlink\" title=\"How to get the Language Id\"></a>How to get the Language Id</h3><figure class=\"highlight c#\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">string</span> languageText = <span class=\"built_in\">string</span>.Empty;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> (request.RequestContext.LanguageId != <span class=\"literal\">null</span> &amp;&amp; request.RequestContext.LanguageId != <span class=\"string\">&quot;&quot;</span>) <span class=\"comment\">// Get the LanguageId from request context</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    languageText = request.RequestContext.LanguageId;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">else</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    languageText = <span class=\"string\">&quot;en-us&quot;</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">CultureInfo culture = <span class=\"keyword\">new</span> CultureInfo(languageText); <span class=\"comment\">// Get the culture based on LanguageId</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Format-the-amount-based-on-culture\"><a href=\"#Format-the-amount-based-on-culture\" class=\"headerlink\" title=\"Format the amount based on culture\"></a>Format the amount based on culture</h3><p>The <code>decimal.ToString()</code> included two parameters, for example:</p>\n<figure class=\"highlight c#\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dl.EffectiveAmount.ToString(<span class=\"string\">&quot;C2&quot;</span>, culture); <span class=\"comment\">// The first parameter means the currency code should be something, the second parameter means the amount value should be format based on some culture rules.​</span></span><br></pre></td></tr></table></figure>","excerpt":"","more":"<h3 id=\"How-to-get-the-Language-Id\"><a href=\"#How-to-get-the-Language-Id\" class=\"headerlink\" title=\"How to get the Language Id\"></a>How to get the Language Id</h3><figure class=\"highlight c#\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">string</span> languageText = <span class=\"built_in\">string</span>.Empty;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> (request.RequestContext.LanguageId != <span class=\"literal\">null</span> &amp;&amp; request.RequestContext.LanguageId != <span class=\"string\">&quot;&quot;</span>) <span class=\"comment\">// Get the LanguageId from request context</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    languageText = request.RequestContext.LanguageId;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">else</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    languageText = <span class=\"string\">&quot;en-us&quot;</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">CultureInfo culture = <span class=\"keyword\">new</span> CultureInfo(languageText); <span class=\"comment\">// Get the culture based on LanguageId</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Format-the-amount-based-on-culture\"><a href=\"#Format-the-amount-based-on-culture\" class=\"headerlink\" title=\"Format the amount based on culture\"></a>Format the amount based on culture</h3><p>The <code>decimal.ToString()</code> included two parameters, for example:</p>\n<figure class=\"highlight c#\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dl.EffectiveAmount.ToString(<span class=\"string\">&quot;C2&quot;</span>, culture); <span class=\"comment\">// The first parameter means the currency code should be something, the second parameter means the amount value should be format based on some culture rules.​</span></span><br></pre></td></tr></table></figure>"},{"title":"Document Routing Agent in D365 F&O","comments":1,"date":"2025-07-08T12:33:46.000Z","description":"Document Routing Agent in D365 F&O","_content":"\n> Reprinted from: https://mohitrampal.com/2023/03/20/document-routing-agent-in-d365-fo/\n\n> You can also watch video: https://www.youtube.com/watch?v=oG6n2PA-Phs\n\n> Chinese version: https://www.cnblogs.com/lingdanglfw/p/14141545.html\n\n> Official documentation: https://learn.microsoft.com/en-us/dynamics365/fin-ops-core/dev-itpro/analytics/er-design-zpl-labels\n\n> ZPL View: https://labelary.com/viewer.html\n\nThe Document Routing Agent (DRA) is an application that resides on the Customer’s network, to act as a bridge between the internet-hosted Dynamics 365 (D365 F&O) system and Customer’s network printers.\n\n{% asset_img \"image-25.png\" \"image-25\" %}\n\nDRA tool is Supported on Windows 8.1, Windows 10, Microsoft Windows Server 2012 R2, Microsoft Windows Server 2016, or Microsoft Windows Server 2019.\n\nDRA run as either a desktop application or a Microsoft Windows service.\n\nDRA as a Service can be configured to start automatically after a computer restart, so no user intervention is required. However, When the Document Routing Agent runs as a Windows service, document reports, such as checks, that require custom margins can’t be printed directly to network printers. Instead, the Document Routing Agent automatically routes those documents to a target folder.\n\nDRA as a desktop application uses Adobe Reader to spool the document to the shared printer device chosen in finance and operations. Microsoft recommends installing the Document Routing Agent in several places to manage situations when documents with custom margins need to be printed. The printers for those documents should thus only be installed on Document Routing Agents that will operate in desktop application mode. As an alternative, you can pick up the files in the target directory and guide them in the right direction using a post-execution process.\n\n## Steps to Install & Configure DRA\n\nSign in to D365 F&O environment which you want to configure in the DRA tool.\n\n1. Go to Organization Administration–>Setup–>Network Printers\n2. Click on Download Document Routing Agent Installer.\n\n{% asset_img \"image-26.png\" \"image-26\" %}\n\n3. Ensure that you are logged in as Admin user. Run the downloaded file and complete the setup.\n4. Open the DRA tool and sign in with Admin account.\n\n{% asset_img \"image-27.png\" \"image-27\" %}\n\n5. Click on Settings Button and enter values in all the fields.\n\n{% asset_img \"image-28.png\" \"image-28\" %}\n\n6. If Run as Windows Service checkbox is checked, then DRA will run as a Service. To run as service, window service should be set up and running.\n\nRight click on the highlighted Service and click on Properties.\n\n{% asset_img \"image-29.png\" \"image-29\" %}\n\nClick on Log On tab and add your Admin/Service account.\n\n{% asset_img \"image-30.png\" \"image-30\" %}\n\nPlease note that step 6 is not required if running as an Application (Run as a window service checkbox is unchecked).\n\n7. Start the service and go back to step 5 and Click on Printers.\n\nOnly printers which are registered will be visible in D365 F&O.\n\n{% asset_img \"image-31.png\" \"image-31\" %}\n\n8. After registering a printer, go to D365 F&O (Organization Administration–>Setup–>Network Printers) and activate the printer.\n\n{% asset_img \"image-32.png\" \"image-32\" %}\n\n9. Now, you can test it in your reports by using Network Printer as shown below (after printing to screen), or setting up the print management.\n\n{% asset_img \"image-33.png\" \"image-33\" %}\n\nI had a requirement to test multiple network printers based on specific values, like if department is A the document should route to PrinterA, if department is B, it should go to PrinterB etc. This configuration was done in print management of report and I tested with dummy Printers and OneNote.\n\nYou can setup a dummy printer by going to Printers & Scanners.\n\n- Click on Add a Printer or Scanner button.\n\n{% asset_img \"image-34.png\" \"image-34\" %}\n\n- Click on ‘The printer that I want isn’t listed.’\n\n{% asset_img \"image-35.png\" \"image-35\" %}\n\n- Select last option as below screenshot and click Next.\n\n{% asset_img \"image-36.png\" \"image-36\" %}\n\n - Select Nul port and click Next.\n\n{% asset_img \"image-37.png\" \"image-37\" %}\n\n - Select Microsoft Print to PDF and click Next\n\n{% asset_img \"image-38.png\" \"image-38\" %}\n\n{% asset_img \"image-39.png\" \"image-39\" %}\n\n- Specify printer name and click Next.\n\n{% asset_img \"image-40.png\" \"image-40\" %}\n\n{% asset_img \"image-41.png\" \"image-41\" %}\n\n- Click on Open Queue of Printer and Pause Printing.\n\n{% asset_img \"image-42.png\" \"image-42\" %}\n\n- As mentioned earlier, you need to register the printer.\n\n{% asset_img \"image-43.png\" \"image-43\" %}\n\n- After registering the printer, it will be visible in D365 F&O. Activate the printer.\n\n{% asset_img \"image-44.png\" \"image-44\" %}\n\n{% asset_img \"image-45.png\" \"image-45\" %}\n\n- As you can see, After report is printed on screen, I can select my new printer.\n\n{% asset_img \"image-46.png\" \"image-46\" %}\n\n{% asset_img \"image-47.png\" \"image-47\" %}\n\n- The document will be visible in print queue.\n\n{% asset_img \"image-48.png\" \"image-48\" %}\n\n## Note\n\n- DRA is legal entity specific, so you have to setup the printers in all required legal entities.\n- If you already have DRA tool, you might get below error for different versions.\nTo resolve this, you have to uninstall the DRA and install again.\n\n{% asset_img \"image-49.png\" \"image-49\" %}","source":"_posts/d365-documentroutingconfiguration.md","raw":"---\ntitle: Document Routing Agent in D365 F&O\ncomments: true\ndate: 2025-07-08 20:33:46\ntags:\ncategories:\n - d365\ndescription: Document Routing Agent in D365 F&O\n---\n\n> Reprinted from: https://mohitrampal.com/2023/03/20/document-routing-agent-in-d365-fo/\n\n> You can also watch video: https://www.youtube.com/watch?v=oG6n2PA-Phs\n\n> Chinese version: https://www.cnblogs.com/lingdanglfw/p/14141545.html\n\n> Official documentation: https://learn.microsoft.com/en-us/dynamics365/fin-ops-core/dev-itpro/analytics/er-design-zpl-labels\n\n> ZPL View: https://labelary.com/viewer.html\n\nThe Document Routing Agent (DRA) is an application that resides on the Customer’s network, to act as a bridge between the internet-hosted Dynamics 365 (D365 F&O) system and Customer’s network printers.\n\n{% asset_img \"image-25.png\" \"image-25\" %}\n\nDRA tool is Supported on Windows 8.1, Windows 10, Microsoft Windows Server 2012 R2, Microsoft Windows Server 2016, or Microsoft Windows Server 2019.\n\nDRA run as either a desktop application or a Microsoft Windows service.\n\nDRA as a Service can be configured to start automatically after a computer restart, so no user intervention is required. However, When the Document Routing Agent runs as a Windows service, document reports, such as checks, that require custom margins can’t be printed directly to network printers. Instead, the Document Routing Agent automatically routes those documents to a target folder.\n\nDRA as a desktop application uses Adobe Reader to spool the document to the shared printer device chosen in finance and operations. Microsoft recommends installing the Document Routing Agent in several places to manage situations when documents with custom margins need to be printed. The printers for those documents should thus only be installed on Document Routing Agents that will operate in desktop application mode. As an alternative, you can pick up the files in the target directory and guide them in the right direction using a post-execution process.\n\n## Steps to Install & Configure DRA\n\nSign in to D365 F&O environment which you want to configure in the DRA tool.\n\n1. Go to Organization Administration–>Setup–>Network Printers\n2. Click on Download Document Routing Agent Installer.\n\n{% asset_img \"image-26.png\" \"image-26\" %}\n\n3. Ensure that you are logged in as Admin user. Run the downloaded file and complete the setup.\n4. Open the DRA tool and sign in with Admin account.\n\n{% asset_img \"image-27.png\" \"image-27\" %}\n\n5. Click on Settings Button and enter values in all the fields.\n\n{% asset_img \"image-28.png\" \"image-28\" %}\n\n6. If Run as Windows Service checkbox is checked, then DRA will run as a Service. To run as service, window service should be set up and running.\n\nRight click on the highlighted Service and click on Properties.\n\n{% asset_img \"image-29.png\" \"image-29\" %}\n\nClick on Log On tab and add your Admin/Service account.\n\n{% asset_img \"image-30.png\" \"image-30\" %}\n\nPlease note that step 6 is not required if running as an Application (Run as a window service checkbox is unchecked).\n\n7. Start the service and go back to step 5 and Click on Printers.\n\nOnly printers which are registered will be visible in D365 F&O.\n\n{% asset_img \"image-31.png\" \"image-31\" %}\n\n8. After registering a printer, go to D365 F&O (Organization Administration–>Setup–>Network Printers) and activate the printer.\n\n{% asset_img \"image-32.png\" \"image-32\" %}\n\n9. Now, you can test it in your reports by using Network Printer as shown below (after printing to screen), or setting up the print management.\n\n{% asset_img \"image-33.png\" \"image-33\" %}\n\nI had a requirement to test multiple network printers based on specific values, like if department is A the document should route to PrinterA, if department is B, it should go to PrinterB etc. This configuration was done in print management of report and I tested with dummy Printers and OneNote.\n\nYou can setup a dummy printer by going to Printers & Scanners.\n\n- Click on Add a Printer or Scanner button.\n\n{% asset_img \"image-34.png\" \"image-34\" %}\n\n- Click on ‘The printer that I want isn’t listed.’\n\n{% asset_img \"image-35.png\" \"image-35\" %}\n\n- Select last option as below screenshot and click Next.\n\n{% asset_img \"image-36.png\" \"image-36\" %}\n\n - Select Nul port and click Next.\n\n{% asset_img \"image-37.png\" \"image-37\" %}\n\n - Select Microsoft Print to PDF and click Next\n\n{% asset_img \"image-38.png\" \"image-38\" %}\n\n{% asset_img \"image-39.png\" \"image-39\" %}\n\n- Specify printer name and click Next.\n\n{% asset_img \"image-40.png\" \"image-40\" %}\n\n{% asset_img \"image-41.png\" \"image-41\" %}\n\n- Click on Open Queue of Printer and Pause Printing.\n\n{% asset_img \"image-42.png\" \"image-42\" %}\n\n- As mentioned earlier, you need to register the printer.\n\n{% asset_img \"image-43.png\" \"image-43\" %}\n\n- After registering the printer, it will be visible in D365 F&O. Activate the printer.\n\n{% asset_img \"image-44.png\" \"image-44\" %}\n\n{% asset_img \"image-45.png\" \"image-45\" %}\n\n- As you can see, After report is printed on screen, I can select my new printer.\n\n{% asset_img \"image-46.png\" \"image-46\" %}\n\n{% asset_img \"image-47.png\" \"image-47\" %}\n\n- The document will be visible in print queue.\n\n{% asset_img \"image-48.png\" \"image-48\" %}\n\n## Note\n\n- DRA is legal entity specific, so you have to setup the printers in all required legal entities.\n- If you already have DRA tool, you might get below error for different versions.\nTo resolve this, you have to uninstall the DRA and install again.\n\n{% asset_img \"image-49.png\" \"image-49\" %}","slug":"d365-documentroutingconfiguration","published":1,"updated":"2025-07-08T12:54:29.985Z","layout":"post","photos":[],"_id":"cmcvxsshn000d3cugcf64fa5c","content":"<blockquote>\n<p>Reprinted from: <a href=\"https://mohitrampal.com/2023/03/20/document-routing-agent-in-d365-fo/\">https://mohitrampal.com/2023/03/20/document-routing-agent-in-d365-fo/</a></p>\n</blockquote>\n<blockquote>\n<p>You can also watch video: <a href=\"https://www.youtube.com/watch?v=oG6n2PA-Phs\">https://www.youtube.com/watch?v=oG6n2PA-Phs</a></p>\n</blockquote>\n<blockquote>\n<p>Chinese version: <a href=\"https://www.cnblogs.com/lingdanglfw/p/14141545.html\">https://www.cnblogs.com/lingdanglfw/p/14141545.html</a></p>\n</blockquote>\n<blockquote>\n<p>Official documentation: <a href=\"https://learn.microsoft.com/en-us/dynamics365/fin-ops-core/dev-itpro/analytics/er-design-zpl-labels\">https://learn.microsoft.com/en-us/dynamics365/fin-ops-core/dev-itpro/analytics/er-design-zpl-labels</a></p>\n</blockquote>\n<blockquote>\n<p>ZPL View: <a href=\"https://labelary.com/viewer.html\">https://labelary.com/viewer.html</a></p>\n</blockquote>\n<p>The Document Routing Agent (DRA) is an application that resides on the Customer’s network, to act as a bridge between the internet-hosted Dynamics 365 (D365 F&amp;O) system and Customer’s network printers.</p>\n<img src=\"/2025/07/08/d365-documentroutingconfiguration/image-25.png\" class=\"\" title=\"image-25\">\n\n<p>DRA tool is Supported on Windows 8.1, Windows 10, Microsoft Windows Server 2012 R2, Microsoft Windows Server 2016, or Microsoft Windows Server 2019.</p>\n<p>DRA run as either a desktop application or a Microsoft Windows service.</p>\n<p>DRA as a Service can be configured to start automatically after a computer restart, so no user intervention is required. However, When the Document Routing Agent runs as a Windows service, document reports, such as checks, that require custom margins can’t be printed directly to network printers. Instead, the Document Routing Agent automatically routes those documents to a target folder.</p>\n<p>DRA as a desktop application uses Adobe Reader to spool the document to the shared printer device chosen in finance and operations. Microsoft recommends installing the Document Routing Agent in several places to manage situations when documents with custom margins need to be printed. The printers for those documents should thus only be installed on Document Routing Agents that will operate in desktop application mode. As an alternative, you can pick up the files in the target directory and guide them in the right direction using a post-execution process.</p>\n<h2 id=\"Steps-to-Install-Configure-DRA\"><a href=\"#Steps-to-Install-Configure-DRA\" class=\"headerlink\" title=\"Steps to Install &amp; Configure DRA\"></a>Steps to Install &amp; Configure DRA</h2><p>Sign in to D365 F&amp;O environment which you want to configure in the DRA tool.</p>\n<ol>\n<li>Go to Organization Administration–&gt;Setup–&gt;Network Printers</li>\n<li>Click on Download Document Routing Agent Installer.</li>\n</ol>\n<img src=\"/2025/07/08/d365-documentroutingconfiguration/image-26.png\" class=\"\" title=\"image-26\">\n\n<ol start=\"3\">\n<li>Ensure that you are logged in as Admin user. Run the downloaded file and complete the setup.</li>\n<li>Open the DRA tool and sign in with Admin account.</li>\n</ol>\n<img src=\"/2025/07/08/d365-documentroutingconfiguration/image-27.png\" class=\"\" title=\"image-27\">\n\n<ol start=\"5\">\n<li>Click on Settings Button and enter values in all the fields.</li>\n</ol>\n<img src=\"/2025/07/08/d365-documentroutingconfiguration/image-28.png\" class=\"\" title=\"image-28\">\n\n<ol start=\"6\">\n<li>If Run as Windows Service checkbox is checked, then DRA will run as a Service. To run as service, window service should be set up and running.</li>\n</ol>\n<p>Right click on the highlighted Service and click on Properties.</p>\n<img src=\"/2025/07/08/d365-documentroutingconfiguration/image-29.png\" class=\"\" title=\"image-29\">\n\n<p>Click on Log On tab and add your Admin&#x2F;Service account.</p>\n<img src=\"/2025/07/08/d365-documentroutingconfiguration/image-30.png\" class=\"\" title=\"image-30\">\n\n<p>Please note that step 6 is not required if running as an Application (Run as a window service checkbox is unchecked).</p>\n<ol start=\"7\">\n<li>Start the service and go back to step 5 and Click on Printers.</li>\n</ol>\n<p>Only printers which are registered will be visible in D365 F&amp;O.</p>\n<img src=\"/2025/07/08/d365-documentroutingconfiguration/image-31.png\" class=\"\" title=\"image-31\">\n\n<ol start=\"8\">\n<li>After registering a printer, go to D365 F&amp;O (Organization Administration–&gt;Setup–&gt;Network Printers) and activate the printer.</li>\n</ol>\n<img src=\"/2025/07/08/d365-documentroutingconfiguration/image-32.png\" class=\"\" title=\"image-32\">\n\n<ol start=\"9\">\n<li>Now, you can test it in your reports by using Network Printer as shown below (after printing to screen), or setting up the print management.</li>\n</ol>\n<img src=\"/2025/07/08/d365-documentroutingconfiguration/image-33.png\" class=\"\" title=\"image-33\">\n\n<p>I had a requirement to test multiple network printers based on specific values, like if department is A the document should route to PrinterA, if department is B, it should go to PrinterB etc. This configuration was done in print management of report and I tested with dummy Printers and OneNote.</p>\n<p>You can setup a dummy printer by going to Printers &amp; Scanners.</p>\n<ul>\n<li>Click on Add a Printer or Scanner button.</li>\n</ul>\n<img src=\"/2025/07/08/d365-documentroutingconfiguration/image-34.png\" class=\"\" title=\"image-34\">\n\n<ul>\n<li>Click on ‘The printer that I want isn’t listed.’</li>\n</ul>\n<img src=\"/2025/07/08/d365-documentroutingconfiguration/image-35.png\" class=\"\" title=\"image-35\">\n\n<ul>\n<li>Select last option as below screenshot and click Next.</li>\n</ul>\n<img src=\"/2025/07/08/d365-documentroutingconfiguration/image-36.png\" class=\"\" title=\"image-36\">\n\n<ul>\n<li>Select Nul port and click Next.</li>\n</ul>\n<img src=\"/2025/07/08/d365-documentroutingconfiguration/image-37.png\" class=\"\" title=\"image-37\">\n\n<ul>\n<li>Select Microsoft Print to PDF and click Next</li>\n</ul>\n<img src=\"/2025/07/08/d365-documentroutingconfiguration/image-38.png\" class=\"\" title=\"image-38\">\n\n<img src=\"/2025/07/08/d365-documentroutingconfiguration/image-39.png\" class=\"\" title=\"image-39\">\n\n<ul>\n<li>Specify printer name and click Next.</li>\n</ul>\n<img src=\"/2025/07/08/d365-documentroutingconfiguration/image-40.png\" class=\"\" title=\"image-40\">\n\n<img src=\"/2025/07/08/d365-documentroutingconfiguration/image-41.png\" class=\"\" title=\"image-41\">\n\n<ul>\n<li>Click on Open Queue of Printer and Pause Printing.</li>\n</ul>\n<img src=\"/2025/07/08/d365-documentroutingconfiguration/image-42.png\" class=\"\" title=\"image-42\">\n\n<ul>\n<li>As mentioned earlier, you need to register the printer.</li>\n</ul>\n<img src=\"/2025/07/08/d365-documentroutingconfiguration/image-43.png\" class=\"\" title=\"image-43\">\n\n<ul>\n<li>After registering the printer, it will be visible in D365 F&amp;O. Activate the printer.</li>\n</ul>\n\n\n<img src=\"/2025/07/08/d365-documentroutingconfiguration/image-45.png\" class=\"\" title=\"image-45\">\n\n<ul>\n<li>As you can see, After report is printed on screen, I can select my new printer.</li>\n</ul>\n<img src=\"/2025/07/08/d365-documentroutingconfiguration/image-46.png\" class=\"\" title=\"image-46\">\n\n<img src=\"/2025/07/08/d365-documentroutingconfiguration/image-47.png\" class=\"\" title=\"image-47\">\n\n<ul>\n<li>The document will be visible in print queue.</li>\n</ul>\n<img src=\"/2025/07/08/d365-documentroutingconfiguration/image-48.png\" class=\"\" title=\"image-48\">\n\n<h2 id=\"Note\"><a href=\"#Note\" class=\"headerlink\" title=\"Note\"></a>Note</h2><ul>\n<li>DRA is legal entity specific, so you have to setup the printers in all required legal entities.</li>\n<li>If you already have DRA tool, you might get below error for different versions.<br>To resolve this, you have to uninstall the DRA and install again.</li>\n</ul>\n<img src=\"/2025/07/08/d365-documentroutingconfiguration/image-49.png\" class=\"\" title=\"image-49\">","excerpt":"","more":"<blockquote>\n<p>Reprinted from: <a href=\"https://mohitrampal.com/2023/03/20/document-routing-agent-in-d365-fo/\">https://mohitrampal.com/2023/03/20/document-routing-agent-in-d365-fo/</a></p>\n</blockquote>\n<blockquote>\n<p>You can also watch video: <a href=\"https://www.youtube.com/watch?v=oG6n2PA-Phs\">https://www.youtube.com/watch?v=oG6n2PA-Phs</a></p>\n</blockquote>\n<blockquote>\n<p>Chinese version: <a href=\"https://www.cnblogs.com/lingdanglfw/p/14141545.html\">https://www.cnblogs.com/lingdanglfw/p/14141545.html</a></p>\n</blockquote>\n<blockquote>\n<p>Official documentation: <a href=\"https://learn.microsoft.com/en-us/dynamics365/fin-ops-core/dev-itpro/analytics/er-design-zpl-labels\">https://learn.microsoft.com/en-us/dynamics365/fin-ops-core/dev-itpro/analytics/er-design-zpl-labels</a></p>\n</blockquote>\n<blockquote>\n<p>ZPL View: <a href=\"https://labelary.com/viewer.html\">https://labelary.com/viewer.html</a></p>\n</blockquote>\n<p>The Document Routing Agent (DRA) is an application that resides on the Customer’s network, to act as a bridge between the internet-hosted Dynamics 365 (D365 F&amp;O) system and Customer’s network printers.</p>\n<img src=\"/2025/07/08/d365-documentroutingconfiguration/image-25.png\" class=\"\" title=\"image-25\">\n\n<p>DRA tool is Supported on Windows 8.1, Windows 10, Microsoft Windows Server 2012 R2, Microsoft Windows Server 2016, or Microsoft Windows Server 2019.</p>\n<p>DRA run as either a desktop application or a Microsoft Windows service.</p>\n<p>DRA as a Service can be configured to start automatically after a computer restart, so no user intervention is required. However, When the Document Routing Agent runs as a Windows service, document reports, such as checks, that require custom margins can’t be printed directly to network printers. Instead, the Document Routing Agent automatically routes those documents to a target folder.</p>\n<p>DRA as a desktop application uses Adobe Reader to spool the document to the shared printer device chosen in finance and operations. Microsoft recommends installing the Document Routing Agent in several places to manage situations when documents with custom margins need to be printed. The printers for those documents should thus only be installed on Document Routing Agents that will operate in desktop application mode. As an alternative, you can pick up the files in the target directory and guide them in the right direction using a post-execution process.</p>\n<h2 id=\"Steps-to-Install-Configure-DRA\"><a href=\"#Steps-to-Install-Configure-DRA\" class=\"headerlink\" title=\"Steps to Install &amp; Configure DRA\"></a>Steps to Install &amp; Configure DRA</h2><p>Sign in to D365 F&amp;O environment which you want to configure in the DRA tool.</p>\n<ol>\n<li>Go to Organization Administration–&gt;Setup–&gt;Network Printers</li>\n<li>Click on Download Document Routing Agent Installer.</li>\n</ol>\n<img src=\"/2025/07/08/d365-documentroutingconfiguration/image-26.png\" class=\"\" title=\"image-26\">\n\n<ol start=\"3\">\n<li>Ensure that you are logged in as Admin user. Run the downloaded file and complete the setup.</li>\n<li>Open the DRA tool and sign in with Admin account.</li>\n</ol>\n<img src=\"/2025/07/08/d365-documentroutingconfiguration/image-27.png\" class=\"\" title=\"image-27\">\n\n<ol start=\"5\">\n<li>Click on Settings Button and enter values in all the fields.</li>\n</ol>\n<img src=\"/2025/07/08/d365-documentroutingconfiguration/image-28.png\" class=\"\" title=\"image-28\">\n\n<ol start=\"6\">\n<li>If Run as Windows Service checkbox is checked, then DRA will run as a Service. To run as service, window service should be set up and running.</li>\n</ol>\n<p>Right click on the highlighted Service and click on Properties.</p>\n<img src=\"/2025/07/08/d365-documentroutingconfiguration/image-29.png\" class=\"\" title=\"image-29\">\n\n<p>Click on Log On tab and add your Admin&#x2F;Service account.</p>\n<img src=\"/2025/07/08/d365-documentroutingconfiguration/image-30.png\" class=\"\" title=\"image-30\">\n\n<p>Please note that step 6 is not required if running as an Application (Run as a window service checkbox is unchecked).</p>\n<ol start=\"7\">\n<li>Start the service and go back to step 5 and Click on Printers.</li>\n</ol>\n<p>Only printers which are registered will be visible in D365 F&amp;O.</p>\n<img src=\"/2025/07/08/d365-documentroutingconfiguration/image-31.png\" class=\"\" title=\"image-31\">\n\n<ol start=\"8\">\n<li>After registering a printer, go to D365 F&amp;O (Organization Administration–&gt;Setup–&gt;Network Printers) and activate the printer.</li>\n</ol>\n<img src=\"/2025/07/08/d365-documentroutingconfiguration/image-32.png\" class=\"\" title=\"image-32\">\n\n<ol start=\"9\">\n<li>Now, you can test it in your reports by using Network Printer as shown below (after printing to screen), or setting up the print management.</li>\n</ol>\n<img src=\"/2025/07/08/d365-documentroutingconfiguration/image-33.png\" class=\"\" title=\"image-33\">\n\n<p>I had a requirement to test multiple network printers based on specific values, like if department is A the document should route to PrinterA, if department is B, it should go to PrinterB etc. This configuration was done in print management of report and I tested with dummy Printers and OneNote.</p>\n<p>You can setup a dummy printer by going to Printers &amp; Scanners.</p>\n<ul>\n<li>Click on Add a Printer or Scanner button.</li>\n</ul>\n<img src=\"/2025/07/08/d365-documentroutingconfiguration/image-34.png\" class=\"\" title=\"image-34\">\n\n<ul>\n<li>Click on ‘The printer that I want isn’t listed.’</li>\n</ul>\n<img src=\"/2025/07/08/d365-documentroutingconfiguration/image-35.png\" class=\"\" title=\"image-35\">\n\n<ul>\n<li>Select last option as below screenshot and click Next.</li>\n</ul>\n<img src=\"/2025/07/08/d365-documentroutingconfiguration/image-36.png\" class=\"\" title=\"image-36\">\n\n<ul>\n<li>Select Nul port and click Next.</li>\n</ul>\n<img src=\"/2025/07/08/d365-documentroutingconfiguration/image-37.png\" class=\"\" title=\"image-37\">\n\n<ul>\n<li>Select Microsoft Print to PDF and click Next</li>\n</ul>\n<img src=\"/2025/07/08/d365-documentroutingconfiguration/image-38.png\" class=\"\" title=\"image-38\">\n\n<img src=\"/2025/07/08/d365-documentroutingconfiguration/image-39.png\" class=\"\" title=\"image-39\">\n\n<ul>\n<li>Specify printer name and click Next.</li>\n</ul>\n<img src=\"/2025/07/08/d365-documentroutingconfiguration/image-40.png\" class=\"\" title=\"image-40\">\n\n<img src=\"/2025/07/08/d365-documentroutingconfiguration/image-41.png\" class=\"\" title=\"image-41\">\n\n<ul>\n<li>Click on Open Queue of Printer and Pause Printing.</li>\n</ul>\n<img src=\"/2025/07/08/d365-documentroutingconfiguration/image-42.png\" class=\"\" title=\"image-42\">\n\n<ul>\n<li>As mentioned earlier, you need to register the printer.</li>\n</ul>\n<img src=\"/2025/07/08/d365-documentroutingconfiguration/image-43.png\" class=\"\" title=\"image-43\">\n\n<ul>\n<li>After registering the printer, it will be visible in D365 F&amp;O. Activate the printer.</li>\n</ul>\n\n\n<img src=\"/2025/07/08/d365-documentroutingconfiguration/image-45.png\" class=\"\" title=\"image-45\">\n\n<ul>\n<li>As you can see, After report is printed on screen, I can select my new printer.</li>\n</ul>\n<img src=\"/2025/07/08/d365-documentroutingconfiguration/image-46.png\" class=\"\" title=\"image-46\">\n\n<img src=\"/2025/07/08/d365-documentroutingconfiguration/image-47.png\" class=\"\" title=\"image-47\">\n\n<ul>\n<li>The document will be visible in print queue.</li>\n</ul>\n<img src=\"/2025/07/08/d365-documentroutingconfiguration/image-48.png\" class=\"\" title=\"image-48\">\n\n<h2 id=\"Note\"><a href=\"#Note\" class=\"headerlink\" title=\"Note\"></a>Note</h2><ul>\n<li>DRA is legal entity specific, so you have to setup the printers in all required legal entities.</li>\n<li>If you already have DRA tool, you might get below error for different versions.<br>To resolve this, you have to uninstall the DRA and install again.</li>\n</ul>\n<img src=\"/2025/07/08/d365-documentroutingconfiguration/image-49.png\" class=\"\" title=\"image-49\">"},{"title":"Difference Between Transfer Journal and Transfer Order D365 F&O","comments":1,"date":"2025-07-08T12:17:26.000Z","description":"Difference Between Transfer Journal and Transfer Order D365 F&O","_content":"\nIn Dynamics 365 Finance and Operations (D365 F&O), knowing the difference between a transfer journal and a Transfer Order is crucial when handling inventories. Although they seem to be related, these two features serve separate purposes and meet different needs.\n\nThis write-up explores the nuances of transfer journals and transfer orders, explaining their differences and uses inside D365 F&O.\n\n## Overview of Dynamics 365 Finance and Operations\nDesigned to maximize business processes, Dynamics 365 Finance and Operations is a complete enterprise resource planning (ERP) tool. Among its many capabilities are supply chain management, inventory control, and financial management. Within the field of inventory control, the correct and effective movement of products is mostly dependent on Transfer Journals and Transfer Orders.\n\nLet’s learn about them, one by one.\n\n## What is a Transfer Journal?\nOne simple tool for internal inventory movement in D365 Finance and Operations is a transfer journal. It lets organizations move goods between several sites inside the same warehouse or between closely spaced warehouses without including thorough tracking or shipping documents.\n\nTransfer journals are perfect for regular inventory changes and internal relocations because of their simplicity.\n\n### Scenarios for Transfer Journals:\n- **Internal Reorganization**: Transfer Journals allow an organization to shift goods from one bin location to another inside the same warehouse when it needs to rearrange its warehouse layout. This simplifies the maintenance of an accurate record of inventory locations free from the complexity of shipping documentation.\n- **Correcting Mistakes**: A Transfer Journal allows one to rapidly rectify mistakes in items received with erroneous tracking numbers or at the wrong location. Businesses can keep exact traceability by moving goods between tracking dimensions, such as batch or serial numbers.\n- **Close Proximity Transfers**: Transfer Journals help to streamline the process while goods are being moved between two geographically close warehouses. This simplifies the transfer procedure by removing the necessity for thorough tracking and documentation for delivery.\n\n### How to Create and Process a Transfer Journal?\nCreating and processing a Transfer Journal in D365 Finance and Operations involves a few straightforward steps:\n\n- Navigate to Inventory Management > Journal entries > Items > Transfer.\n- Create a new journal by clicking \"New\". Add the required information including the journal name, description, site, and warehouse.\n- Enter the item number, quantity, from site, to site, from warehouse, and to warehouse to add the items you wish to transfer.\n- Validate the journal to look for mistakes. Post the journal once validated to complete the transfer. This will change the levels of inventory in the designated sites.\n- Navigate to Inventory management > Inquiries and reports > Journals > Item transactions to review the transfer specifics. To read the specifics, choose the journal you posted and click \"Transactions\".\n> Get Dynamics 365 Finance and Operations implemented by a top Microsoft Gold partner in the USA—Dynamics Square. Schedule a free consultation now!\n\n## What is a Transfer Order?\nA transfer order in D365 Finance and Operations is designed as a completed tool for moving stocks between warehouses or sites where thorough tracking and shipping paperwork are needed.\n\nTransfer orders are appropriate for circumstances whereby objects must be tracked throughout travel since they offer more control and visibility over the transfer process.\n\n### Scenarios for Transfer Orders:\n- **Long-Distance Transfers**: Transfer Orders guarantee that goods are being traced all through the transportation process when goods are being moved between warehouses that are far apart. Maintaining inventory accuracy depends on tracking, shipping, and receiving documents, hence this covers all aspects.\n- **Shipping Documentation**: Transfer orders are utilized when shipment documentation is needed to go along with the items. This is crucial for giving customers comprehensive shipment data and following shipping laws.\n- **Warehouse Management Processes**: Transfer Orders fit very well in settings where warehouse staff members handle picking, packing, shipping, and receiving items. They guarantee that every stage of the transfer process is recorded and tracked.\n\n### How to Create and Process a Transfer Order?\nCreating and processing a Transfer Order in D365 Finance and Operations involves several detailed steps:\n\n- Visit Inventory Management > Outbound orders > Transfer Order to navigate.\n- Click \"New\" to draft a fresh transfer order. Now go into the \"from\" and \"to\" warehouses.\n- Enter the item number and quantity to add the items you wish to move.\n- Go to Inventory management > Periodic > Release transfer order picking. Click \"OK,\" then enter the transfer order number. Should the \"Deduct released for picking\" checkbox be chosen, the system will automatically deduct the pertinent quantity from the on-hand inventory.\n- Go return to your transfer order and click \"Ship\" in the Action Pane. Check the quantity and product; then, click \"OK\" to post the shipment.\n- Go to Inventory management > Inbound orders > Transfer order. Choose the transfer order then click \"Receive\" on the Action Pane. Check the quantity and product; then, to finish the receipt, click \"OK.\"\n\n## Key Differences Between Transfer Journals and Transfer Orders\n\n### Complexity and Application\n- Transfer Journals: Simple and flexible, transfer journals fit for internal relocation, error correction, and close proximity transfers.\n- Transfer Orders: These are more complicated, suited for long-distance transfers, needing shipping documents, and interacting with warehouse management systems.\n\n### Tracking and Documentation\n- Transfer Journals: Minimal tracking and no need for shipping documentation. Ideal for internal transfers where detailed tracking is unnecessary.\n- Transfer Orders: Detailed tracking with shipping and receiving documentation. Ensures visibility and control over the transfer process.\n\n### Inventory Impact\nTransfer Journals: Inventory movements are recorded without offsetting costs. Suitable for internal adjustments and corrections.\nTransfer Orders: Inventory and its value are tracked throughout the transfer process, with potential impacts on costing methods like moving or weighted average.","source":"_posts/d365-transferjournalandtransferorder.md","raw":"---\ntitle: Difference Between Transfer Journal and Transfer Order D365 F&O\ncomments: true\ndate: 2025-07-08 20:17:26\ntags:\ncategories:\n - d365\ndescription: Difference Between Transfer Journal and Transfer Order D365 F&O\n---\n\nIn Dynamics 365 Finance and Operations (D365 F&O), knowing the difference between a transfer journal and a Transfer Order is crucial when handling inventories. Although they seem to be related, these two features serve separate purposes and meet different needs.\n\nThis write-up explores the nuances of transfer journals and transfer orders, explaining their differences and uses inside D365 F&O.\n\n## Overview of Dynamics 365 Finance and Operations\nDesigned to maximize business processes, Dynamics 365 Finance and Operations is a complete enterprise resource planning (ERP) tool. Among its many capabilities are supply chain management, inventory control, and financial management. Within the field of inventory control, the correct and effective movement of products is mostly dependent on Transfer Journals and Transfer Orders.\n\nLet’s learn about them, one by one.\n\n## What is a Transfer Journal?\nOne simple tool for internal inventory movement in D365 Finance and Operations is a transfer journal. It lets organizations move goods between several sites inside the same warehouse or between closely spaced warehouses without including thorough tracking or shipping documents.\n\nTransfer journals are perfect for regular inventory changes and internal relocations because of their simplicity.\n\n### Scenarios for Transfer Journals:\n- **Internal Reorganization**: Transfer Journals allow an organization to shift goods from one bin location to another inside the same warehouse when it needs to rearrange its warehouse layout. This simplifies the maintenance of an accurate record of inventory locations free from the complexity of shipping documentation.\n- **Correcting Mistakes**: A Transfer Journal allows one to rapidly rectify mistakes in items received with erroneous tracking numbers or at the wrong location. Businesses can keep exact traceability by moving goods between tracking dimensions, such as batch or serial numbers.\n- **Close Proximity Transfers**: Transfer Journals help to streamline the process while goods are being moved between two geographically close warehouses. This simplifies the transfer procedure by removing the necessity for thorough tracking and documentation for delivery.\n\n### How to Create and Process a Transfer Journal?\nCreating and processing a Transfer Journal in D365 Finance and Operations involves a few straightforward steps:\n\n- Navigate to Inventory Management > Journal entries > Items > Transfer.\n- Create a new journal by clicking \"New\". Add the required information including the journal name, description, site, and warehouse.\n- Enter the item number, quantity, from site, to site, from warehouse, and to warehouse to add the items you wish to transfer.\n- Validate the journal to look for mistakes. Post the journal once validated to complete the transfer. This will change the levels of inventory in the designated sites.\n- Navigate to Inventory management > Inquiries and reports > Journals > Item transactions to review the transfer specifics. To read the specifics, choose the journal you posted and click \"Transactions\".\n> Get Dynamics 365 Finance and Operations implemented by a top Microsoft Gold partner in the USA—Dynamics Square. Schedule a free consultation now!\n\n## What is a Transfer Order?\nA transfer order in D365 Finance and Operations is designed as a completed tool for moving stocks between warehouses or sites where thorough tracking and shipping paperwork are needed.\n\nTransfer orders are appropriate for circumstances whereby objects must be tracked throughout travel since they offer more control and visibility over the transfer process.\n\n### Scenarios for Transfer Orders:\n- **Long-Distance Transfers**: Transfer Orders guarantee that goods are being traced all through the transportation process when goods are being moved between warehouses that are far apart. Maintaining inventory accuracy depends on tracking, shipping, and receiving documents, hence this covers all aspects.\n- **Shipping Documentation**: Transfer orders are utilized when shipment documentation is needed to go along with the items. This is crucial for giving customers comprehensive shipment data and following shipping laws.\n- **Warehouse Management Processes**: Transfer Orders fit very well in settings where warehouse staff members handle picking, packing, shipping, and receiving items. They guarantee that every stage of the transfer process is recorded and tracked.\n\n### How to Create and Process a Transfer Order?\nCreating and processing a Transfer Order in D365 Finance and Operations involves several detailed steps:\n\n- Visit Inventory Management > Outbound orders > Transfer Order to navigate.\n- Click \"New\" to draft a fresh transfer order. Now go into the \"from\" and \"to\" warehouses.\n- Enter the item number and quantity to add the items you wish to move.\n- Go to Inventory management > Periodic > Release transfer order picking. Click \"OK,\" then enter the transfer order number. Should the \"Deduct released for picking\" checkbox be chosen, the system will automatically deduct the pertinent quantity from the on-hand inventory.\n- Go return to your transfer order and click \"Ship\" in the Action Pane. Check the quantity and product; then, click \"OK\" to post the shipment.\n- Go to Inventory management > Inbound orders > Transfer order. Choose the transfer order then click \"Receive\" on the Action Pane. Check the quantity and product; then, to finish the receipt, click \"OK.\"\n\n## Key Differences Between Transfer Journals and Transfer Orders\n\n### Complexity and Application\n- Transfer Journals: Simple and flexible, transfer journals fit for internal relocation, error correction, and close proximity transfers.\n- Transfer Orders: These are more complicated, suited for long-distance transfers, needing shipping documents, and interacting with warehouse management systems.\n\n### Tracking and Documentation\n- Transfer Journals: Minimal tracking and no need for shipping documentation. Ideal for internal transfers where detailed tracking is unnecessary.\n- Transfer Orders: Detailed tracking with shipping and receiving documentation. Ensures visibility and control over the transfer process.\n\n### Inventory Impact\nTransfer Journals: Inventory movements are recorded without offsetting costs. Suitable for internal adjustments and corrections.\nTransfer Orders: Inventory and its value are tracked throughout the transfer process, with potential impacts on costing methods like moving or weighted average.","slug":"d365-transferjournalandtransferorder","published":1,"updated":"2025-07-08T12:50:43.340Z","layout":"post","photos":[],"_id":"cmcvxssho000g3cug53ueb5k7","content":"<p>In Dynamics 365 Finance and Operations (D365 F&amp;O), knowing the difference between a transfer journal and a Transfer Order is crucial when handling inventories. Although they seem to be related, these two features serve separate purposes and meet different needs.</p>\n<p>This write-up explores the nuances of transfer journals and transfer orders, explaining their differences and uses inside D365 F&amp;O.</p>\n<h2 id=\"Overview-of-Dynamics-365-Finance-and-Operations\"><a href=\"#Overview-of-Dynamics-365-Finance-and-Operations\" class=\"headerlink\" title=\"Overview of Dynamics 365 Finance and Operations\"></a>Overview of Dynamics 365 Finance and Operations</h2><p>Designed to maximize business processes, Dynamics 365 Finance and Operations is a complete enterprise resource planning (ERP) tool. Among its many capabilities are supply chain management, inventory control, and financial management. Within the field of inventory control, the correct and effective movement of products is mostly dependent on Transfer Journals and Transfer Orders.</p>\n<p>Let’s learn about them, one by one.</p>\n<h2 id=\"What-is-a-Transfer-Journal\"><a href=\"#What-is-a-Transfer-Journal\" class=\"headerlink\" title=\"What is a Transfer Journal?\"></a>What is a Transfer Journal?</h2><p>One simple tool for internal inventory movement in D365 Finance and Operations is a transfer journal. It lets organizations move goods between several sites inside the same warehouse or between closely spaced warehouses without including thorough tracking or shipping documents.</p>\n<p>Transfer journals are perfect for regular inventory changes and internal relocations because of their simplicity.</p>\n<h3 id=\"Scenarios-for-Transfer-Journals\"><a href=\"#Scenarios-for-Transfer-Journals\" class=\"headerlink\" title=\"Scenarios for Transfer Journals:\"></a>Scenarios for Transfer Journals:</h3><ul>\n<li><strong>Internal Reorganization</strong>: Transfer Journals allow an organization to shift goods from one bin location to another inside the same warehouse when it needs to rearrange its warehouse layout. This simplifies the maintenance of an accurate record of inventory locations free from the complexity of shipping documentation.</li>\n<li><strong>Correcting Mistakes</strong>: A Transfer Journal allows one to rapidly rectify mistakes in items received with erroneous tracking numbers or at the wrong location. Businesses can keep exact traceability by moving goods between tracking dimensions, such as batch or serial numbers.</li>\n<li><strong>Close Proximity Transfers</strong>: Transfer Journals help to streamline the process while goods are being moved between two geographically close warehouses. This simplifies the transfer procedure by removing the necessity for thorough tracking and documentation for delivery.</li>\n</ul>\n<h3 id=\"How-to-Create-and-Process-a-Transfer-Journal\"><a href=\"#How-to-Create-and-Process-a-Transfer-Journal\" class=\"headerlink\" title=\"How to Create and Process a Transfer Journal?\"></a>How to Create and Process a Transfer Journal?</h3><p>Creating and processing a Transfer Journal in D365 Finance and Operations involves a few straightforward steps:</p>\n<ul>\n<li>Navigate to Inventory Management &gt; Journal entries &gt; Items &gt; Transfer.</li>\n<li>Create a new journal by clicking “New”. Add the required information including the journal name, description, site, and warehouse.</li>\n<li>Enter the item number, quantity, from site, to site, from warehouse, and to warehouse to add the items you wish to transfer.</li>\n<li>Validate the journal to look for mistakes. Post the journal once validated to complete the transfer. This will change the levels of inventory in the designated sites.</li>\n<li>Navigate to Inventory management &gt; Inquiries and reports &gt; Journals &gt; Item transactions to review the transfer specifics. To read the specifics, choose the journal you posted and click “Transactions”.<blockquote>\n<p>Get Dynamics 365 Finance and Operations implemented by a top Microsoft Gold partner in the USA—Dynamics Square. Schedule a free consultation now!</p>\n</blockquote>\n</li>\n</ul>\n<h2 id=\"What-is-a-Transfer-Order\"><a href=\"#What-is-a-Transfer-Order\" class=\"headerlink\" title=\"What is a Transfer Order?\"></a>What is a Transfer Order?</h2><p>A transfer order in D365 Finance and Operations is designed as a completed tool for moving stocks between warehouses or sites where thorough tracking and shipping paperwork are needed.</p>\n<p>Transfer orders are appropriate for circumstances whereby objects must be tracked throughout travel since they offer more control and visibility over the transfer process.</p>\n<h3 id=\"Scenarios-for-Transfer-Orders\"><a href=\"#Scenarios-for-Transfer-Orders\" class=\"headerlink\" title=\"Scenarios for Transfer Orders:\"></a>Scenarios for Transfer Orders:</h3><ul>\n<li><strong>Long-Distance Transfers</strong>: Transfer Orders guarantee that goods are being traced all through the transportation process when goods are being moved between warehouses that are far apart. Maintaining inventory accuracy depends on tracking, shipping, and receiving documents, hence this covers all aspects.</li>\n<li><strong>Shipping Documentation</strong>: Transfer orders are utilized when shipment documentation is needed to go along with the items. This is crucial for giving customers comprehensive shipment data and following shipping laws.</li>\n<li><strong>Warehouse Management Processes</strong>: Transfer Orders fit very well in settings where warehouse staff members handle picking, packing, shipping, and receiving items. They guarantee that every stage of the transfer process is recorded and tracked.</li>\n</ul>\n<h3 id=\"How-to-Create-and-Process-a-Transfer-Order\"><a href=\"#How-to-Create-and-Process-a-Transfer-Order\" class=\"headerlink\" title=\"How to Create and Process a Transfer Order?\"></a>How to Create and Process a Transfer Order?</h3><p>Creating and processing a Transfer Order in D365 Finance and Operations involves several detailed steps:</p>\n<ul>\n<li>Visit Inventory Management &gt; Outbound orders &gt; Transfer Order to navigate.</li>\n<li>Click “New” to draft a fresh transfer order. Now go into the “from” and “to” warehouses.</li>\n<li>Enter the item number and quantity to add the items you wish to move.</li>\n<li>Go to Inventory management &gt; Periodic &gt; Release transfer order picking. Click “OK,” then enter the transfer order number. Should the “Deduct released for picking” checkbox be chosen, the system will automatically deduct the pertinent quantity from the on-hand inventory.</li>\n<li>Go return to your transfer order and click “Ship” in the Action Pane. Check the quantity and product; then, click “OK” to post the shipment.</li>\n<li>Go to Inventory management &gt; Inbound orders &gt; Transfer order. Choose the transfer order then click “Receive” on the Action Pane. Check the quantity and product; then, to finish the receipt, click “OK.”</li>\n</ul>\n<h2 id=\"Key-Differences-Between-Transfer-Journals-and-Transfer-Orders\"><a href=\"#Key-Differences-Between-Transfer-Journals-and-Transfer-Orders\" class=\"headerlink\" title=\"Key Differences Between Transfer Journals and Transfer Orders\"></a>Key Differences Between Transfer Journals and Transfer Orders</h2><h3 id=\"Complexity-and-Application\"><a href=\"#Complexity-and-Application\" class=\"headerlink\" title=\"Complexity and Application\"></a>Complexity and Application</h3><ul>\n<li>Transfer Journals: Simple and flexible, transfer journals fit for internal relocation, error correction, and close proximity transfers.</li>\n<li>Transfer Orders: These are more complicated, suited for long-distance transfers, needing shipping documents, and interacting with warehouse management systems.</li>\n</ul>\n<h3 id=\"Tracking-and-Documentation\"><a href=\"#Tracking-and-Documentation\" class=\"headerlink\" title=\"Tracking and Documentation\"></a>Tracking and Documentation</h3><ul>\n<li>Transfer Journals: Minimal tracking and no need for shipping documentation. Ideal for internal transfers where detailed tracking is unnecessary.</li>\n<li>Transfer Orders: Detailed tracking with shipping and receiving documentation. Ensures visibility and control over the transfer process.</li>\n</ul>\n<h3 id=\"Inventory-Impact\"><a href=\"#Inventory-Impact\" class=\"headerlink\" title=\"Inventory Impact\"></a>Inventory Impact</h3><p>Transfer Journals: Inventory movements are recorded without offsetting costs. Suitable for internal adjustments and corrections.<br>Transfer Orders: Inventory and its value are tracked throughout the transfer process, with potential impacts on costing methods like moving or weighted average.</p>\n","excerpt":"","more":"<p>In Dynamics 365 Finance and Operations (D365 F&amp;O), knowing the difference between a transfer journal and a Transfer Order is crucial when handling inventories. Although they seem to be related, these two features serve separate purposes and meet different needs.</p>\n<p>This write-up explores the nuances of transfer journals and transfer orders, explaining their differences and uses inside D365 F&amp;O.</p>\n<h2 id=\"Overview-of-Dynamics-365-Finance-and-Operations\"><a href=\"#Overview-of-Dynamics-365-Finance-and-Operations\" class=\"headerlink\" title=\"Overview of Dynamics 365 Finance and Operations\"></a>Overview of Dynamics 365 Finance and Operations</h2><p>Designed to maximize business processes, Dynamics 365 Finance and Operations is a complete enterprise resource planning (ERP) tool. Among its many capabilities are supply chain management, inventory control, and financial management. Within the field of inventory control, the correct and effective movement of products is mostly dependent on Transfer Journals and Transfer Orders.</p>\n<p>Let’s learn about them, one by one.</p>\n<h2 id=\"What-is-a-Transfer-Journal\"><a href=\"#What-is-a-Transfer-Journal\" class=\"headerlink\" title=\"What is a Transfer Journal?\"></a>What is a Transfer Journal?</h2><p>One simple tool for internal inventory movement in D365 Finance and Operations is a transfer journal. It lets organizations move goods between several sites inside the same warehouse or between closely spaced warehouses without including thorough tracking or shipping documents.</p>\n<p>Transfer journals are perfect for regular inventory changes and internal relocations because of their simplicity.</p>\n<h3 id=\"Scenarios-for-Transfer-Journals\"><a href=\"#Scenarios-for-Transfer-Journals\" class=\"headerlink\" title=\"Scenarios for Transfer Journals:\"></a>Scenarios for Transfer Journals:</h3><ul>\n<li><strong>Internal Reorganization</strong>: Transfer Journals allow an organization to shift goods from one bin location to another inside the same warehouse when it needs to rearrange its warehouse layout. This simplifies the maintenance of an accurate record of inventory locations free from the complexity of shipping documentation.</li>\n<li><strong>Correcting Mistakes</strong>: A Transfer Journal allows one to rapidly rectify mistakes in items received with erroneous tracking numbers or at the wrong location. Businesses can keep exact traceability by moving goods between tracking dimensions, such as batch or serial numbers.</li>\n<li><strong>Close Proximity Transfers</strong>: Transfer Journals help to streamline the process while goods are being moved between two geographically close warehouses. This simplifies the transfer procedure by removing the necessity for thorough tracking and documentation for delivery.</li>\n</ul>\n<h3 id=\"How-to-Create-and-Process-a-Transfer-Journal\"><a href=\"#How-to-Create-and-Process-a-Transfer-Journal\" class=\"headerlink\" title=\"How to Create and Process a Transfer Journal?\"></a>How to Create and Process a Transfer Journal?</h3><p>Creating and processing a Transfer Journal in D365 Finance and Operations involves a few straightforward steps:</p>\n<ul>\n<li>Navigate to Inventory Management &gt; Journal entries &gt; Items &gt; Transfer.</li>\n<li>Create a new journal by clicking “New”. Add the required information including the journal name, description, site, and warehouse.</li>\n<li>Enter the item number, quantity, from site, to site, from warehouse, and to warehouse to add the items you wish to transfer.</li>\n<li>Validate the journal to look for mistakes. Post the journal once validated to complete the transfer. This will change the levels of inventory in the designated sites.</li>\n<li>Navigate to Inventory management &gt; Inquiries and reports &gt; Journals &gt; Item transactions to review the transfer specifics. To read the specifics, choose the journal you posted and click “Transactions”.<blockquote>\n<p>Get Dynamics 365 Finance and Operations implemented by a top Microsoft Gold partner in the USA—Dynamics Square. Schedule a free consultation now!</p>\n</blockquote>\n</li>\n</ul>\n<h2 id=\"What-is-a-Transfer-Order\"><a href=\"#What-is-a-Transfer-Order\" class=\"headerlink\" title=\"What is a Transfer Order?\"></a>What is a Transfer Order?</h2><p>A transfer order in D365 Finance and Operations is designed as a completed tool for moving stocks between warehouses or sites where thorough tracking and shipping paperwork are needed.</p>\n<p>Transfer orders are appropriate for circumstances whereby objects must be tracked throughout travel since they offer more control and visibility over the transfer process.</p>\n<h3 id=\"Scenarios-for-Transfer-Orders\"><a href=\"#Scenarios-for-Transfer-Orders\" class=\"headerlink\" title=\"Scenarios for Transfer Orders:\"></a>Scenarios for Transfer Orders:</h3><ul>\n<li><strong>Long-Distance Transfers</strong>: Transfer Orders guarantee that goods are being traced all through the transportation process when goods are being moved between warehouses that are far apart. Maintaining inventory accuracy depends on tracking, shipping, and receiving documents, hence this covers all aspects.</li>\n<li><strong>Shipping Documentation</strong>: Transfer orders are utilized when shipment documentation is needed to go along with the items. This is crucial for giving customers comprehensive shipment data and following shipping laws.</li>\n<li><strong>Warehouse Management Processes</strong>: Transfer Orders fit very well in settings where warehouse staff members handle picking, packing, shipping, and receiving items. They guarantee that every stage of the transfer process is recorded and tracked.</li>\n</ul>\n<h3 id=\"How-to-Create-and-Process-a-Transfer-Order\"><a href=\"#How-to-Create-and-Process-a-Transfer-Order\" class=\"headerlink\" title=\"How to Create and Process a Transfer Order?\"></a>How to Create and Process a Transfer Order?</h3><p>Creating and processing a Transfer Order in D365 Finance and Operations involves several detailed steps:</p>\n<ul>\n<li>Visit Inventory Management &gt; Outbound orders &gt; Transfer Order to navigate.</li>\n<li>Click “New” to draft a fresh transfer order. Now go into the “from” and “to” warehouses.</li>\n<li>Enter the item number and quantity to add the items you wish to move.</li>\n<li>Go to Inventory management &gt; Periodic &gt; Release transfer order picking. Click “OK,” then enter the transfer order number. Should the “Deduct released for picking” checkbox be chosen, the system will automatically deduct the pertinent quantity from the on-hand inventory.</li>\n<li>Go return to your transfer order and click “Ship” in the Action Pane. Check the quantity and product; then, click “OK” to post the shipment.</li>\n<li>Go to Inventory management &gt; Inbound orders &gt; Transfer order. Choose the transfer order then click “Receive” on the Action Pane. Check the quantity and product; then, to finish the receipt, click “OK.”</li>\n</ul>\n<h2 id=\"Key-Differences-Between-Transfer-Journals-and-Transfer-Orders\"><a href=\"#Key-Differences-Between-Transfer-Journals-and-Transfer-Orders\" class=\"headerlink\" title=\"Key Differences Between Transfer Journals and Transfer Orders\"></a>Key Differences Between Transfer Journals and Transfer Orders</h2><h3 id=\"Complexity-and-Application\"><a href=\"#Complexity-and-Application\" class=\"headerlink\" title=\"Complexity and Application\"></a>Complexity and Application</h3><ul>\n<li>Transfer Journals: Simple and flexible, transfer journals fit for internal relocation, error correction, and close proximity transfers.</li>\n<li>Transfer Orders: These are more complicated, suited for long-distance transfers, needing shipping documents, and interacting with warehouse management systems.</li>\n</ul>\n<h3 id=\"Tracking-and-Documentation\"><a href=\"#Tracking-and-Documentation\" class=\"headerlink\" title=\"Tracking and Documentation\"></a>Tracking and Documentation</h3><ul>\n<li>Transfer Journals: Minimal tracking and no need for shipping documentation. Ideal for internal transfers where detailed tracking is unnecessary.</li>\n<li>Transfer Orders: Detailed tracking with shipping and receiving documentation. Ensures visibility and control over the transfer process.</li>\n</ul>\n<h3 id=\"Inventory-Impact\"><a href=\"#Inventory-Impact\" class=\"headerlink\" title=\"Inventory Impact\"></a>Inventory Impact</h3><p>Transfer Journals: Inventory movements are recorded without offsetting costs. Suitable for internal adjustments and corrections.<br>Transfer Orders: Inventory and its value are tracked throughout the transfer process, with potential impacts on costing methods like moving or weighted average.</p>\n"},{"title":"Flask Turorial 2","comments":1,"date":"2025-01-09T12:19:16.000Z","description":"Flask Turorial 2th","_content":"\n\n# Flask Turorial 2\n\n## Blueprints and Views\n\n一个 view 函数是你写来响应请求的代码。Flask使用模式将传入的请求URL与应该处理它的视图进行匹配。视图返回数据，Flask将这些数据转换为输出响应。Flask也可以走另一个方向，根据视图的名称和参数生成一个URL。\n\n### Create a Blueprint\n\nBlueprint是一种组织一组相关视图和其他代码的方法。它们不是直接在应用程序中注册视图和其他代码，而是在蓝图中注册。然后，当蓝图在工厂功能中可用时，将其注册到应用程序中。\n\nFlaskr将有两个蓝图，一个用于身份验证功能，一个用于博客帖子功能。每个蓝图的代码将放在一个单独的模块中。由于博客需要了解身份验证，因此您将首先编写身份验证。\n\n> flaskr/auth.py\n\n```py\nimport functools\n\nfrom flask import (\n    Blueprint, flash, g, redirect, render_template, request, session, url_for\n)\nfrom werkzeug.security import check_password_hash, generate_password_hash\n\nfrom flaskr.db import get_db\n\nbp = Blueprint('auth', __name__, url_prefix = '/auth')\n```\n\n这将创建一个名为“auth”的蓝图。与应用程序对象一样，蓝图需要知道它的定义位置，因此__name__作为第二个参数传递。url_prefix将被添加到与蓝图关联的所有url之前。\n\n使用app.register_blueprint（）从工厂导入并注册蓝图。在返回应用程序之前，将新代码放在工厂函数的末尾。\n\n> flaskr/__init__.py\n\n```py\n    # Register the auth blueprint\n    from . import auth\n    app.register_blueprint(auth.bp)\n```\n\n身份验证蓝图将具有注册新用户以及登录和注销的视图。\n\n### The First View: Register\n\n当用户访问/auth/register URL时，注册视图将返回带有表单的HTML供他们填写。当他们提交表单时，它将验证他们的输入，并再次显示带有错误消息的表单，或者创建新用户并转到登录页面。\n\n现在您只需编写视图代码。在下一页中，您将编写模板来生成HTML表单。\n\n> flaskr/auth.py\n\n```py\n@bp.route('/register', methods=('GET', 'POST'))\ndef register():\n    if request.method == 'POST':\n        username = request.form['username']\n        password = request.form['password']\n        db = get_db()\n        error = None\n\n        if not username:\n            error = 'Username is required'\n        elif not password\n            error = 'Password is required'\n\n        if error is None:\n            try:\n                db.execute(\n                    \"INSERT INTO user (username, password) VALUES (?, ?)\",\n                    (username, generate_password_hash(password))\n                )\n                db.commit()\n            except db.IntegrityError:\n                error = f\"User {username} is already registered\"\n            else\n                return redirect(url_for('auth.login'))\n            \n        flash(error)\n\n    return render_template('auth/register.html')\n```\n\n以下是代码解析：\n\n1. `@bp。route`将URL `/register`与注册视图函数关联起来。当Flask接收到对`/auth/register`的请求时，它将调用register视图并使用返回值作为响应。\n\n2. 如果用户提交了表单，request.method 将是`POST`。在本例中，开始验证输入。\n\n3. `request.form`是一种特殊类型的映射提交表单键和值的字典。用户将输入他们的用户名和密码。\n\n4. 验证 username 和 password 不为空\n\n5. 如果验证成功，插入新的用户数据到数据库  \n    - db.execute 使用`?`用于任何用户输入的占位符，以及用于替换占位符的值元组。数据库库将负责转义这些值，这样您就不会受到SQL注入攻击。\n    - 为了安全起见，永远不要将密码直接存储在数据库中。相反，使用generate_password_hash（）安全地对密码进行散列，并存储该散列。由于该查询修改了数据，因此需要在之后调用db.commit（）来保存更改。\n    - 如果用户名已经存在，则会发生`sqlite3.IntegrityError`，这应该作为另一个验证错误显示给用户。\n\n6. 存储用户之后，它们被重定向到登录页面。`url_for（）`根据登录视图的名称为其生成URL。这比直接编写URL更可取，因为它允许您稍后更改URL，而无需更改链接到它的所有代码。`redirect（）`生成对生成的URL的重定向响应。\n\n7. 如果验证失败，错误将显示给用户。Flash（）存储可以在呈现模板时检索的消息。\n\n8. 当用户最初导航到认证/注册时，或者出现验证错误时，应该显示一个包含注册表单的HTML页面。`render_template（）`将呈现一个包含HTML的模板，该模板将在本教程的下一步中编写。\n\n### Login\n\n```py\n@bp.route('/login', methods = ('GET', 'POST'))\ndef login():\n    if request.method == 'POST':\n        username = request.form['username']\n        password = request.form['password']\n        db = get_db()\n        error = None\n        user = db.execute(\n            'SELECT * FROM user WHERE username = ?', (username)\n        ).fetchone()\n\n        if user is None:\n            error = 'Incorrect username.'\n        elif not check_password_hash(user['password', password]):\n            error = 'Incorrect password.'\n        \n        if error is None:\n            session.clear()\n            session['user_id'] = user['id']\n            return redirect(url_for('index'))\n        \n        flash(error)\n\n    return render_template('auth/login.html')\n```\n\nThere are a few differences from the register view:\n\n1. The user is queried first and stored in a variable for later use. `fetchone()` returns one row from the query. If the query returned no results, it returns None. Later, `fetchall()` will be used, which returns a list of all results.\n\n2. `check_password_hash()` hashes the submitted password in the same way as the stored hash and securely compares them. If they match, the password is valid.\n\n3. `session` is a `dict` that stores data across requests. When validation succeeds, the user’s id is stored in a new session. The data is stored in a cookie that is sent to the browser, and the browser then sends it back with subsequent requests. Flask securely signs the data so that it can’t be tampered with.\n\n```py\n@bp.before_app_request\ndef load_logged_in_user():\n    user_id = session.get('user_id')\n\n    if user_id is None:\n        g.user = None\n    else:\n        g.user = get_db().execute(\n            'SELECT * FROM user WHERE id = ?', (user_id)\n        ).fetchone()\n```\n\n`bp.before_app_request（）`注册一个在视图函数之前运行的函数，无论请求的URL是什么。`Load_logged_in_user`检查用户id是否存储在会话中，并从数据库中获取该用户的数据，将其存储在g.user上，该数据将持续请求的长度。如果没有用户id，或者用户id不存在，g.user将为None。\n\n### Logout\n\n要注销，需要从会话中删除用户id。那么`load_logged_in_user`将不会在后续请求中加载用户。\n\n```py\n@bp.route('/logout')\ndef logout():\n    session.clear()\n    return redirect(url_for('index'))\n```\n\n### Require Authentication in Other Views\n\n创建、编辑和删除博客文章需要用户登录。可以使用装饰器来检查它应用到的每个视图。\n\n```py\ndef login_required(view):\n    @functools.wraps(view)\n    def wrapped_view(**kwargs):\n        if g.user is None:\n            return redirect(url_for('auth.login'))\n        \n    return wrapped_view\n```\n\n这个装饰器返回一个新的视图函数，该函数包装了它所应用的原始视图。新函数检查用户是否已加载，否则将重定向到登录页面。如果用户被加载，则调用原始视图并正常继续。您将在编写博客视图时使用该装饰器。\n\n### Endpoints and URLs\n\n`url_for（）`函数根据名称和参数生成视图的URL。与视图关联的名称也称为端点，默认情况下，它与视图函数的名称相同。\n\n例如，在教程前面添加到应用程序工厂的`hello（）`视图的名称为‘hello’，可以使用url_for（'hello'）链接到它。如果它接受一个参数，稍后您将看到，它将被链接到使用url_for（'hello', who='World'）。\n\n当使用蓝图时，蓝图的名称被附加到函数的名称之前，因此您在上面编写的登录函数的端点是‘auth ’。Login ‘，因为您将它添加到’auth'蓝图中。\n\n## Templates\n\n模板是包含静态数据和动态数据占位符的文件。使用特定的数据呈现模板以生成最终文档。Flask使用Jinja模板库来呈现模板。\n\n在您的应用程序中，您将使用模板来呈现将显示在用户浏览器中的HTML。在Flask中，Jinja被配置为自动转义HTML模板中呈现的任何数据。这意味着呈现用户输入是安全的；他们输入的任何可能扰乱HTML的字符，如`<and>`，都将被转义为安全值，这些值在浏览器中看起来是一样的，但不会产生不必要的效果。\n\nJinja的外观和行为都很像Python。使用特殊分隔符将Jinja语法与模板中的静态数据区分开来。`{{and}}`之间的任何内容都是将输出到最终文档的表达式。`{%and%}`表示控制流语句，如if和for。与Python不同，块由开始和结束标记而不是缩进表示，因为块中的静态文本可能会改变缩进。\n\n### The Base Layout\n\n```html\n<!doctype html>\n<title>{% block title %}{% endblock %} - Flaskr</title>\n<link rel=\"stylesheet\" href=\"{{ url_for('static', filename='style.css') }}\">\n<nav>\n  <h1>Flaskr</h1>\n  <ul>\n    {% if g.user %}\n      <li><span>{{ g.user['username'] }}</span>\n      <li><a href=\"{{ url_for('auth.logout') }}\">Log Out</a>\n    {% else %}\n      <li><a href=\"{{ url_for('auth.register') }}\">Register</a>\n      <li><a href=\"{{ url_for('auth.login') }}\">Log In</a>\n    {% endif %}\n  </ul>\n</nav>\n<section class=\"content\">\n  <header>\n    {% block header %}{% endblock %}\n  </header>\n  {% for message in get_flashed_messages() %}\n    <div class=\"flash\">{{ message }}</div>\n  {% endfor %}\n  {% block content %}{% endblock %}\n</section>\n```\n\n### Register\n\n```html\n{% extends 'base.html' %}\n\n{% block header %}\n  <h1>{% block title %}Register{% endblock %}</h1>\n{% endblock %}\n\n{% block content %}\n  <form method=\"post\">\n    <label for=\"username\">Username</label>\n    <input name=\"username\" id=\"username\" required>\n    <label for=\"password\">Password</label>\n    <input type=\"password\" name=\"password\" id=\"password\" required>\n    <input type=\"submit\" value=\"Register\">\n  </form>\n{% endblock %}\n```\n\n### Log In\n\n```html\n{% extends 'base.html' %}\n\n{% block header %}\n  <h1>{% block title %}Log In{% endblock %}</h1>\n{% endblock %}\n\n{% block content %}\n  <form method=\"post\">\n    <label for=\"username\">Username</label>\n    <input name=\"username\" id=\"username\" required>\n    <label for=\"password\">Password</label>\n    <input type=\"password\" name=\"password\" id=\"password\" required>\n    <input type=\"submit\" value=\"Log In\">\n  </form>\n{% endblock %}\n```","source":"_posts/flask-tutorial-2.md","raw":"---\ntitle: Flask Turorial 2\ncategories:\n - flask\ncomments: true\ndate: 2025-01-09 20:19:16\ndescription: Flask Turorial 2th\n---\n\n\n# Flask Turorial 2\n\n## Blueprints and Views\n\n一个 view 函数是你写来响应请求的代码。Flask使用模式将传入的请求URL与应该处理它的视图进行匹配。视图返回数据，Flask将这些数据转换为输出响应。Flask也可以走另一个方向，根据视图的名称和参数生成一个URL。\n\n### Create a Blueprint\n\nBlueprint是一种组织一组相关视图和其他代码的方法。它们不是直接在应用程序中注册视图和其他代码，而是在蓝图中注册。然后，当蓝图在工厂功能中可用时，将其注册到应用程序中。\n\nFlaskr将有两个蓝图，一个用于身份验证功能，一个用于博客帖子功能。每个蓝图的代码将放在一个单独的模块中。由于博客需要了解身份验证，因此您将首先编写身份验证。\n\n> flaskr/auth.py\n\n```py\nimport functools\n\nfrom flask import (\n    Blueprint, flash, g, redirect, render_template, request, session, url_for\n)\nfrom werkzeug.security import check_password_hash, generate_password_hash\n\nfrom flaskr.db import get_db\n\nbp = Blueprint('auth', __name__, url_prefix = '/auth')\n```\n\n这将创建一个名为“auth”的蓝图。与应用程序对象一样，蓝图需要知道它的定义位置，因此__name__作为第二个参数传递。url_prefix将被添加到与蓝图关联的所有url之前。\n\n使用app.register_blueprint（）从工厂导入并注册蓝图。在返回应用程序之前，将新代码放在工厂函数的末尾。\n\n> flaskr/__init__.py\n\n```py\n    # Register the auth blueprint\n    from . import auth\n    app.register_blueprint(auth.bp)\n```\n\n身份验证蓝图将具有注册新用户以及登录和注销的视图。\n\n### The First View: Register\n\n当用户访问/auth/register URL时，注册视图将返回带有表单的HTML供他们填写。当他们提交表单时，它将验证他们的输入，并再次显示带有错误消息的表单，或者创建新用户并转到登录页面。\n\n现在您只需编写视图代码。在下一页中，您将编写模板来生成HTML表单。\n\n> flaskr/auth.py\n\n```py\n@bp.route('/register', methods=('GET', 'POST'))\ndef register():\n    if request.method == 'POST':\n        username = request.form['username']\n        password = request.form['password']\n        db = get_db()\n        error = None\n\n        if not username:\n            error = 'Username is required'\n        elif not password\n            error = 'Password is required'\n\n        if error is None:\n            try:\n                db.execute(\n                    \"INSERT INTO user (username, password) VALUES (?, ?)\",\n                    (username, generate_password_hash(password))\n                )\n                db.commit()\n            except db.IntegrityError:\n                error = f\"User {username} is already registered\"\n            else\n                return redirect(url_for('auth.login'))\n            \n        flash(error)\n\n    return render_template('auth/register.html')\n```\n\n以下是代码解析：\n\n1. `@bp。route`将URL `/register`与注册视图函数关联起来。当Flask接收到对`/auth/register`的请求时，它将调用register视图并使用返回值作为响应。\n\n2. 如果用户提交了表单，request.method 将是`POST`。在本例中，开始验证输入。\n\n3. `request.form`是一种特殊类型的映射提交表单键和值的字典。用户将输入他们的用户名和密码。\n\n4. 验证 username 和 password 不为空\n\n5. 如果验证成功，插入新的用户数据到数据库  \n    - db.execute 使用`?`用于任何用户输入的占位符，以及用于替换占位符的值元组。数据库库将负责转义这些值，这样您就不会受到SQL注入攻击。\n    - 为了安全起见，永远不要将密码直接存储在数据库中。相反，使用generate_password_hash（）安全地对密码进行散列，并存储该散列。由于该查询修改了数据，因此需要在之后调用db.commit（）来保存更改。\n    - 如果用户名已经存在，则会发生`sqlite3.IntegrityError`，这应该作为另一个验证错误显示给用户。\n\n6. 存储用户之后，它们被重定向到登录页面。`url_for（）`根据登录视图的名称为其生成URL。这比直接编写URL更可取，因为它允许您稍后更改URL，而无需更改链接到它的所有代码。`redirect（）`生成对生成的URL的重定向响应。\n\n7. 如果验证失败，错误将显示给用户。Flash（）存储可以在呈现模板时检索的消息。\n\n8. 当用户最初导航到认证/注册时，或者出现验证错误时，应该显示一个包含注册表单的HTML页面。`render_template（）`将呈现一个包含HTML的模板，该模板将在本教程的下一步中编写。\n\n### Login\n\n```py\n@bp.route('/login', methods = ('GET', 'POST'))\ndef login():\n    if request.method == 'POST':\n        username = request.form['username']\n        password = request.form['password']\n        db = get_db()\n        error = None\n        user = db.execute(\n            'SELECT * FROM user WHERE username = ?', (username)\n        ).fetchone()\n\n        if user is None:\n            error = 'Incorrect username.'\n        elif not check_password_hash(user['password', password]):\n            error = 'Incorrect password.'\n        \n        if error is None:\n            session.clear()\n            session['user_id'] = user['id']\n            return redirect(url_for('index'))\n        \n        flash(error)\n\n    return render_template('auth/login.html')\n```\n\nThere are a few differences from the register view:\n\n1. The user is queried first and stored in a variable for later use. `fetchone()` returns one row from the query. If the query returned no results, it returns None. Later, `fetchall()` will be used, which returns a list of all results.\n\n2. `check_password_hash()` hashes the submitted password in the same way as the stored hash and securely compares them. If they match, the password is valid.\n\n3. `session` is a `dict` that stores data across requests. When validation succeeds, the user’s id is stored in a new session. The data is stored in a cookie that is sent to the browser, and the browser then sends it back with subsequent requests. Flask securely signs the data so that it can’t be tampered with.\n\n```py\n@bp.before_app_request\ndef load_logged_in_user():\n    user_id = session.get('user_id')\n\n    if user_id is None:\n        g.user = None\n    else:\n        g.user = get_db().execute(\n            'SELECT * FROM user WHERE id = ?', (user_id)\n        ).fetchone()\n```\n\n`bp.before_app_request（）`注册一个在视图函数之前运行的函数，无论请求的URL是什么。`Load_logged_in_user`检查用户id是否存储在会话中，并从数据库中获取该用户的数据，将其存储在g.user上，该数据将持续请求的长度。如果没有用户id，或者用户id不存在，g.user将为None。\n\n### Logout\n\n要注销，需要从会话中删除用户id。那么`load_logged_in_user`将不会在后续请求中加载用户。\n\n```py\n@bp.route('/logout')\ndef logout():\n    session.clear()\n    return redirect(url_for('index'))\n```\n\n### Require Authentication in Other Views\n\n创建、编辑和删除博客文章需要用户登录。可以使用装饰器来检查它应用到的每个视图。\n\n```py\ndef login_required(view):\n    @functools.wraps(view)\n    def wrapped_view(**kwargs):\n        if g.user is None:\n            return redirect(url_for('auth.login'))\n        \n    return wrapped_view\n```\n\n这个装饰器返回一个新的视图函数，该函数包装了它所应用的原始视图。新函数检查用户是否已加载，否则将重定向到登录页面。如果用户被加载，则调用原始视图并正常继续。您将在编写博客视图时使用该装饰器。\n\n### Endpoints and URLs\n\n`url_for（）`函数根据名称和参数生成视图的URL。与视图关联的名称也称为端点，默认情况下，它与视图函数的名称相同。\n\n例如，在教程前面添加到应用程序工厂的`hello（）`视图的名称为‘hello’，可以使用url_for（'hello'）链接到它。如果它接受一个参数，稍后您将看到，它将被链接到使用url_for（'hello', who='World'）。\n\n当使用蓝图时，蓝图的名称被附加到函数的名称之前，因此您在上面编写的登录函数的端点是‘auth ’。Login ‘，因为您将它添加到’auth'蓝图中。\n\n## Templates\n\n模板是包含静态数据和动态数据占位符的文件。使用特定的数据呈现模板以生成最终文档。Flask使用Jinja模板库来呈现模板。\n\n在您的应用程序中，您将使用模板来呈现将显示在用户浏览器中的HTML。在Flask中，Jinja被配置为自动转义HTML模板中呈现的任何数据。这意味着呈现用户输入是安全的；他们输入的任何可能扰乱HTML的字符，如`<and>`，都将被转义为安全值，这些值在浏览器中看起来是一样的，但不会产生不必要的效果。\n\nJinja的外观和行为都很像Python。使用特殊分隔符将Jinja语法与模板中的静态数据区分开来。`{{and}}`之间的任何内容都是将输出到最终文档的表达式。`{%and%}`表示控制流语句，如if和for。与Python不同，块由开始和结束标记而不是缩进表示，因为块中的静态文本可能会改变缩进。\n\n### The Base Layout\n\n```html\n<!doctype html>\n<title>{% block title %}{% endblock %} - Flaskr</title>\n<link rel=\"stylesheet\" href=\"{{ url_for('static', filename='style.css') }}\">\n<nav>\n  <h1>Flaskr</h1>\n  <ul>\n    {% if g.user %}\n      <li><span>{{ g.user['username'] }}</span>\n      <li><a href=\"{{ url_for('auth.logout') }}\">Log Out</a>\n    {% else %}\n      <li><a href=\"{{ url_for('auth.register') }}\">Register</a>\n      <li><a href=\"{{ url_for('auth.login') }}\">Log In</a>\n    {% endif %}\n  </ul>\n</nav>\n<section class=\"content\">\n  <header>\n    {% block header %}{% endblock %}\n  </header>\n  {% for message in get_flashed_messages() %}\n    <div class=\"flash\">{{ message }}</div>\n  {% endfor %}\n  {% block content %}{% endblock %}\n</section>\n```\n\n### Register\n\n```html\n{% extends 'base.html' %}\n\n{% block header %}\n  <h1>{% block title %}Register{% endblock %}</h1>\n{% endblock %}\n\n{% block content %}\n  <form method=\"post\">\n    <label for=\"username\">Username</label>\n    <input name=\"username\" id=\"username\" required>\n    <label for=\"password\">Password</label>\n    <input type=\"password\" name=\"password\" id=\"password\" required>\n    <input type=\"submit\" value=\"Register\">\n  </form>\n{% endblock %}\n```\n\n### Log In\n\n```html\n{% extends 'base.html' %}\n\n{% block header %}\n  <h1>{% block title %}Log In{% endblock %}</h1>\n{% endblock %}\n\n{% block content %}\n  <form method=\"post\">\n    <label for=\"username\">Username</label>\n    <input name=\"username\" id=\"username\" required>\n    <label for=\"password\">Password</label>\n    <input type=\"password\" name=\"password\" id=\"password\" required>\n    <input type=\"submit\" value=\"Log In\">\n  </form>\n{% endblock %}\n```","slug":"flask-tutorial-2","published":1,"updated":"2025-07-08T12:05:00.538Z","layout":"post","photos":[],"_id":"cmcvxsshp000h3cugg20170su","content":"<h1 id=\"Flask-Turorial-2\"><a href=\"#Flask-Turorial-2\" class=\"headerlink\" title=\"Flask Turorial 2\"></a>Flask Turorial 2</h1><h2 id=\"Blueprints-and-Views\"><a href=\"#Blueprints-and-Views\" class=\"headerlink\" title=\"Blueprints and Views\"></a>Blueprints and Views</h2><p>一个 view 函数是你写来响应请求的代码。Flask使用模式将传入的请求URL与应该处理它的视图进行匹配。视图返回数据，Flask将这些数据转换为输出响应。Flask也可以走另一个方向，根据视图的名称和参数生成一个URL。</p>\n<h3 id=\"Create-a-Blueprint\"><a href=\"#Create-a-Blueprint\" class=\"headerlink\" title=\"Create a Blueprint\"></a>Create a Blueprint</h3><p>Blueprint是一种组织一组相关视图和其他代码的方法。它们不是直接在应用程序中注册视图和其他代码，而是在蓝图中注册。然后，当蓝图在工厂功能中可用时，将其注册到应用程序中。</p>\n<p>Flaskr将有两个蓝图，一个用于身份验证功能，一个用于博客帖子功能。每个蓝图的代码将放在一个单独的模块中。由于博客需要了解身份验证，因此您将首先编写身份验证。</p>\n<blockquote>\n<p>flaskr&#x2F;auth.py</p>\n</blockquote>\n<figure class=\"highlight py\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> functools</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">from</span> flask <span class=\"keyword\">import</span> (</span><br><span class=\"line\">    Blueprint, flash, g, redirect, render_template, request, session, url_for</span><br><span class=\"line\">)</span><br><span class=\"line\"><span class=\"keyword\">from</span> werkzeug.security <span class=\"keyword\">import</span> check_password_hash, generate_password_hash</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">from</span> flaskr.db <span class=\"keyword\">import</span> get_db</span><br><span class=\"line\"></span><br><span class=\"line\">bp = Blueprint(<span class=\"string\">&#x27;auth&#x27;</span>, __name__, url_prefix = <span class=\"string\">&#x27;/auth&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>这将创建一个名为“auth”的蓝图。与应用程序对象一样，蓝图需要知道它的定义位置，因此__name__作为第二个参数传递。url_prefix将被添加到与蓝图关联的所有url之前。</p>\n<p>使用app.register_blueprint（）从工厂导入并注册蓝图。在返回应用程序之前，将新代码放在工厂函数的末尾。</p>\n<blockquote>\n<p>flaskr&#x2F;<strong>init</strong>.py</p>\n</blockquote>\n<figure class=\"highlight py\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Register the auth blueprint</span></span><br><span class=\"line\"><span class=\"keyword\">from</span> . <span class=\"keyword\">import</span> auth</span><br><span class=\"line\">app.register_blueprint(auth.bp)</span><br></pre></td></tr></table></figure>\n\n<p>身份验证蓝图将具有注册新用户以及登录和注销的视图。</p>\n<h3 id=\"The-First-View-Register\"><a href=\"#The-First-View-Register\" class=\"headerlink\" title=\"The First View: Register\"></a>The First View: Register</h3><p>当用户访问&#x2F;auth&#x2F;register URL时，注册视图将返回带有表单的HTML供他们填写。当他们提交表单时，它将验证他们的输入，并再次显示带有错误消息的表单，或者创建新用户并转到登录页面。</p>\n<p>现在您只需编写视图代码。在下一页中，您将编写模板来生成HTML表单。</p>\n<blockquote>\n<p>flaskr&#x2F;auth.py</p>\n</blockquote>\n<figure class=\"highlight py\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@bp.route(<span class=\"params\"><span class=\"string\">&#x27;/register&#x27;</span>, methods=(<span class=\"params\"><span class=\"string\">&#x27;GET&#x27;</span>, <span class=\"string\">&#x27;POST&#x27;</span></span>)</span>)</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">register</span>():</span><br><span class=\"line\">    <span class=\"keyword\">if</span> request.method == <span class=\"string\">&#x27;POST&#x27;</span>:</span><br><span class=\"line\">        username = request.form[<span class=\"string\">&#x27;username&#x27;</span>]</span><br><span class=\"line\">        password = request.form[<span class=\"string\">&#x27;password&#x27;</span>]</span><br><span class=\"line\">        db = get_db()</span><br><span class=\"line\">        error = <span class=\"literal\">None</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> username:</span><br><span class=\"line\">            error = <span class=\"string\">&#x27;Username is required&#x27;</span></span><br><span class=\"line\">        <span class=\"keyword\">elif</span> <span class=\"keyword\">not</span> password</span><br><span class=\"line\">            error = <span class=\"string\">&#x27;Password is required&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> error <span class=\"keyword\">is</span> <span class=\"literal\">None</span>:</span><br><span class=\"line\">            <span class=\"keyword\">try</span>:</span><br><span class=\"line\">                db.execute(</span><br><span class=\"line\">                    <span class=\"string\">&quot;INSERT INTO user (username, password) VALUES (?, ?)&quot;</span>,</span><br><span class=\"line\">                    (username, generate_password_hash(password))</span><br><span class=\"line\">                )</span><br><span class=\"line\">                db.commit()</span><br><span class=\"line\">            <span class=\"keyword\">except</span> db.IntegrityError:</span><br><span class=\"line\">                error = <span class=\"string\">f&quot;User <span class=\"subst\">&#123;username&#125;</span> is already registered&quot;</span></span><br><span class=\"line\">            <span class=\"keyword\">else</span></span><br><span class=\"line\">                <span class=\"keyword\">return</span> redirect(url_for(<span class=\"string\">&#x27;auth.login&#x27;</span>))</span><br><span class=\"line\">            </span><br><span class=\"line\">        flash(error)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> render_template(<span class=\"string\">&#x27;auth/register.html&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>以下是代码解析：</p>\n<ol>\n<li><p><code>@bp。route</code>将URL <code>/register</code>与注册视图函数关联起来。当Flask接收到对<code>/auth/register</code>的请求时，它将调用register视图并使用返回值作为响应。</p>\n</li>\n<li><p>如果用户提交了表单，request.method 将是<code>POST</code>。在本例中，开始验证输入。</p>\n</li>\n<li><p><code>request.form</code>是一种特殊类型的映射提交表单键和值的字典。用户将输入他们的用户名和密码。</p>\n</li>\n<li><p>验证 username 和 password 不为空</p>\n</li>\n<li><p>如果验证成功，插入新的用户数据到数据库  </p>\n<ul>\n<li>db.execute 使用<code>?</code>用于任何用户输入的占位符，以及用于替换占位符的值元组。数据库库将负责转义这些值，这样您就不会受到SQL注入攻击。</li>\n<li>为了安全起见，永远不要将密码直接存储在数据库中。相反，使用generate_password_hash（）安全地对密码进行散列，并存储该散列。由于该查询修改了数据，因此需要在之后调用db.commit（）来保存更改。</li>\n<li>如果用户名已经存在，则会发生<code>sqlite3.IntegrityError</code>，这应该作为另一个验证错误显示给用户。</li>\n</ul>\n</li>\n<li><p>存储用户之后，它们被重定向到登录页面。<code>url_for（）</code>根据登录视图的名称为其生成URL。这比直接编写URL更可取，因为它允许您稍后更改URL，而无需更改链接到它的所有代码。<code>redirect（）</code>生成对生成的URL的重定向响应。</p>\n</li>\n<li><p>如果验证失败，错误将显示给用户。Flash（）存储可以在呈现模板时检索的消息。</p>\n</li>\n<li><p>当用户最初导航到认证&#x2F;注册时，或者出现验证错误时，应该显示一个包含注册表单的HTML页面。<code>render_template（）</code>将呈现一个包含HTML的模板，该模板将在本教程的下一步中编写。</p>\n</li>\n</ol>\n<h3 id=\"Login\"><a href=\"#Login\" class=\"headerlink\" title=\"Login\"></a>Login</h3><figure class=\"highlight py\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@bp.route(<span class=\"params\"><span class=\"string\">&#x27;/login&#x27;</span>, methods = (<span class=\"params\"><span class=\"string\">&#x27;GET&#x27;</span>, <span class=\"string\">&#x27;POST&#x27;</span></span>)</span>)</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">login</span>():</span><br><span class=\"line\">    <span class=\"keyword\">if</span> request.method == <span class=\"string\">&#x27;POST&#x27;</span>:</span><br><span class=\"line\">        username = request.form[<span class=\"string\">&#x27;username&#x27;</span>]</span><br><span class=\"line\">        password = request.form[<span class=\"string\">&#x27;password&#x27;</span>]</span><br><span class=\"line\">        db = get_db()</span><br><span class=\"line\">        error = <span class=\"literal\">None</span></span><br><span class=\"line\">        user = db.execute(</span><br><span class=\"line\">            <span class=\"string\">&#x27;SELECT * FROM user WHERE username = ?&#x27;</span>, (username)</span><br><span class=\"line\">        ).fetchone()</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> user <span class=\"keyword\">is</span> <span class=\"literal\">None</span>:</span><br><span class=\"line\">            error = <span class=\"string\">&#x27;Incorrect username.&#x27;</span></span><br><span class=\"line\">        <span class=\"keyword\">elif</span> <span class=\"keyword\">not</span> check_password_hash(user[<span class=\"string\">&#x27;password&#x27;</span>, password]):</span><br><span class=\"line\">            error = <span class=\"string\">&#x27;Incorrect password.&#x27;</span></span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">if</span> error <span class=\"keyword\">is</span> <span class=\"literal\">None</span>:</span><br><span class=\"line\">            session.clear()</span><br><span class=\"line\">            session[<span class=\"string\">&#x27;user_id&#x27;</span>] = user[<span class=\"string\">&#x27;id&#x27;</span>]</span><br><span class=\"line\">            <span class=\"keyword\">return</span> redirect(url_for(<span class=\"string\">&#x27;index&#x27;</span>))</span><br><span class=\"line\">        </span><br><span class=\"line\">        flash(error)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> render_template(<span class=\"string\">&#x27;auth/login.html&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>There are a few differences from the register view:</p>\n<ol>\n<li><p>The user is queried first and stored in a variable for later use. <code>fetchone()</code> returns one row from the query. If the query returned no results, it returns None. Later, <code>fetchall()</code> will be used, which returns a list of all results.</p>\n</li>\n<li><p><code>check_password_hash()</code> hashes the submitted password in the same way as the stored hash and securely compares them. If they match, the password is valid.</p>\n</li>\n<li><p><code>session</code> is a <code>dict</code> that stores data across requests. When validation succeeds, the user’s id is stored in a new session. The data is stored in a cookie that is sent to the browser, and the browser then sends it back with subsequent requests. Flask securely signs the data so that it can’t be tampered with.</p>\n</li>\n</ol>\n<figure class=\"highlight py\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@bp.before_app_request</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">load_logged_in_user</span>():</span><br><span class=\"line\">    user_id = session.get(<span class=\"string\">&#x27;user_id&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> user_id <span class=\"keyword\">is</span> <span class=\"literal\">None</span>:</span><br><span class=\"line\">        g.user = <span class=\"literal\">None</span></span><br><span class=\"line\">    <span class=\"keyword\">else</span>:</span><br><span class=\"line\">        g.user = get_db().execute(</span><br><span class=\"line\">            <span class=\"string\">&#x27;SELECT * FROM user WHERE id = ?&#x27;</span>, (user_id)</span><br><span class=\"line\">        ).fetchone()</span><br></pre></td></tr></table></figure>\n\n<p><code>bp.before_app_request（）</code>注册一个在视图函数之前运行的函数，无论请求的URL是什么。<code>Load_logged_in_user</code>检查用户id是否存储在会话中，并从数据库中获取该用户的数据，将其存储在g.user上，该数据将持续请求的长度。如果没有用户id，或者用户id不存在，g.user将为None。</p>\n<h3 id=\"Logout\"><a href=\"#Logout\" class=\"headerlink\" title=\"Logout\"></a>Logout</h3><p>要注销，需要从会话中删除用户id。那么<code>load_logged_in_user</code>将不会在后续请求中加载用户。</p>\n<figure class=\"highlight py\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@bp.route(<span class=\"params\"><span class=\"string\">&#x27;/logout&#x27;</span></span>)</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">logout</span>():</span><br><span class=\"line\">    session.clear()</span><br><span class=\"line\">    <span class=\"keyword\">return</span> redirect(url_for(<span class=\"string\">&#x27;index&#x27;</span>))</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Require-Authentication-in-Other-Views\"><a href=\"#Require-Authentication-in-Other-Views\" class=\"headerlink\" title=\"Require Authentication in Other Views\"></a>Require Authentication in Other Views</h3><p>创建、编辑和删除博客文章需要用户登录。可以使用装饰器来检查它应用到的每个视图。</p>\n<figure class=\"highlight py\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">login_required</span>(<span class=\"params\">view</span>):</span><br><span class=\"line\"><span class=\"meta\">    @functools.wraps(<span class=\"params\">view</span>)</span></span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">wrapped_view</span>(<span class=\"params\">**kwargs</span>):</span><br><span class=\"line\">        <span class=\"keyword\">if</span> g.user <span class=\"keyword\">is</span> <span class=\"literal\">None</span>:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> redirect(url_for(<span class=\"string\">&#x27;auth.login&#x27;</span>))</span><br><span class=\"line\">        </span><br><span class=\"line\">    <span class=\"keyword\">return</span> wrapped_view</span><br></pre></td></tr></table></figure>\n\n<p>这个装饰器返回一个新的视图函数，该函数包装了它所应用的原始视图。新函数检查用户是否已加载，否则将重定向到登录页面。如果用户被加载，则调用原始视图并正常继续。您将在编写博客视图时使用该装饰器。</p>\n<h3 id=\"Endpoints-and-URLs\"><a href=\"#Endpoints-and-URLs\" class=\"headerlink\" title=\"Endpoints and URLs\"></a>Endpoints and URLs</h3><p><code>url_for（）</code>函数根据名称和参数生成视图的URL。与视图关联的名称也称为端点，默认情况下，它与视图函数的名称相同。</p>\n<p>例如，在教程前面添加到应用程序工厂的<code>hello（）</code>视图的名称为‘hello’，可以使用url_for（’hello’）链接到它。如果它接受一个参数，稍后您将看到，它将被链接到使用url_for（’hello’, who&#x3D;’World’）。</p>\n<p>当使用蓝图时，蓝图的名称被附加到函数的名称之前，因此您在上面编写的登录函数的端点是‘auth ’。Login ‘，因为您将它添加到’auth’蓝图中。</p>\n<h2 id=\"Templates\"><a href=\"#Templates\" class=\"headerlink\" title=\"Templates\"></a>Templates</h2><p>模板是包含静态数据和动态数据占位符的文件。使用特定的数据呈现模板以生成最终文档。Flask使用Jinja模板库来呈现模板。</p>\n<p>在您的应用程序中，您将使用模板来呈现将显示在用户浏览器中的HTML。在Flask中，Jinja被配置为自动转义HTML模板中呈现的任何数据。这意味着呈现用户输入是安全的；他们输入的任何可能扰乱HTML的字符，如<code>&lt;and&gt;</code>，都将被转义为安全值，这些值在浏览器中看起来是一样的，但不会产生不必要的效果。</p>\n<p>Jinja的外观和行为都很像Python。使用特殊分隔符将Jinja语法与模板中的静态数据区分开来。<code>&#123;&#123;and&#125;&#125;</code>之间的任何内容都是将输出到最终文档的表达式。<code>&#123;%and%&#125;</code>表示控制流语句，如if和for。与Python不同，块由开始和结束标记而不是缩进表示，因为块中的静态文本可能会改变缩进。</p>\n<h3 id=\"The-Base-Layout\"><a href=\"#The-Base-Layout\" class=\"headerlink\" title=\"The Base Layout\"></a>The Base Layout</h3><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!doctype <span class=\"keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>&#123;% block title %&#125;&#123;% endblock %&#125; - Flaskr<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">link</span> <span class=\"attr\">rel</span>=<span class=\"string\">&quot;stylesheet&quot;</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;&#123;&#123; url_for(&#x27;static&#x27;, filename=&#x27;style.css&#x27;) &#125;&#125;&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">nav</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span>Flaskr<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">ul</span>&gt;</span></span><br><span class=\"line\">    &#123;% if g.user %&#125;</span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">li</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">span</span>&gt;</span>&#123;&#123; g.user[&#x27;username&#x27;] &#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">li</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;&#123;&#123; url_for(&#x27;auth.logout&#x27;) &#125;&#125;&quot;</span>&gt;</span>Log Out<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span><br><span class=\"line\">    &#123;% else %&#125;</span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">li</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;&#123;&#123; url_for(&#x27;auth.register&#x27;) &#125;&#125;&quot;</span>&gt;</span>Register<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">li</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;&#123;&#123; url_for(&#x27;auth.login&#x27;) &#125;&#125;&quot;</span>&gt;</span>Log In<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span><br><span class=\"line\">    &#123;% endif %&#125;</span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">ul</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">nav</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">section</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;content&quot;</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">header</span>&gt;</span></span><br><span class=\"line\">    &#123;% block header %&#125;&#123;% endblock %&#125;</span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">header</span>&gt;</span></span><br><span class=\"line\">  &#123;% for message in get_flashed_messages() %&#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;flash&quot;</span>&gt;</span>&#123;&#123; message &#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">  &#123;% endfor %&#125;</span><br><span class=\"line\">  &#123;% block content %&#125;&#123;% endblock %&#125;</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">section</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Register\"><a href=\"#Register\" class=\"headerlink\" title=\"Register\"></a>Register</h3><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;% extends &#x27;base.html&#x27; %&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;% block header %&#125;</span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span>&#123;% block title %&#125;Register&#123;% endblock %&#125;<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span><br><span class=\"line\">&#123;% endblock %&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;% block content %&#125;</span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">form</span> <span class=\"attr\">method</span>=<span class=\"string\">&quot;post&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">label</span> <span class=\"attr\">for</span>=<span class=\"string\">&quot;username&quot;</span>&gt;</span>Username<span class=\"tag\">&lt;/<span class=\"name\">label</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;username&quot;</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;username&quot;</span> <span class=\"attr\">required</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">label</span> <span class=\"attr\">for</span>=<span class=\"string\">&quot;password&quot;</span>&gt;</span>Password<span class=\"tag\">&lt;/<span class=\"name\">label</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;password&quot;</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;password&quot;</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;password&quot;</span> <span class=\"attr\">required</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;submit&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;Register&quot;</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">form</span>&gt;</span></span><br><span class=\"line\">&#123;% endblock %&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Log-In\"><a href=\"#Log-In\" class=\"headerlink\" title=\"Log In\"></a>Log In</h3><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;% extends &#x27;base.html&#x27; %&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;% block header %&#125;</span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span>&#123;% block title %&#125;Log In&#123;% endblock %&#125;<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span><br><span class=\"line\">&#123;% endblock %&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;% block content %&#125;</span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">form</span> <span class=\"attr\">method</span>=<span class=\"string\">&quot;post&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">label</span> <span class=\"attr\">for</span>=<span class=\"string\">&quot;username&quot;</span>&gt;</span>Username<span class=\"tag\">&lt;/<span class=\"name\">label</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;username&quot;</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;username&quot;</span> <span class=\"attr\">required</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">label</span> <span class=\"attr\">for</span>=<span class=\"string\">&quot;password&quot;</span>&gt;</span>Password<span class=\"tag\">&lt;/<span class=\"name\">label</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;password&quot;</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;password&quot;</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;password&quot;</span> <span class=\"attr\">required</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;submit&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;Log In&quot;</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">form</span>&gt;</span></span><br><span class=\"line\">&#123;% endblock %&#125;</span><br></pre></td></tr></table></figure>","excerpt":"","more":"<h1 id=\"Flask-Turorial-2\"><a href=\"#Flask-Turorial-2\" class=\"headerlink\" title=\"Flask Turorial 2\"></a>Flask Turorial 2</h1><h2 id=\"Blueprints-and-Views\"><a href=\"#Blueprints-and-Views\" class=\"headerlink\" title=\"Blueprints and Views\"></a>Blueprints and Views</h2><p>一个 view 函数是你写来响应请求的代码。Flask使用模式将传入的请求URL与应该处理它的视图进行匹配。视图返回数据，Flask将这些数据转换为输出响应。Flask也可以走另一个方向，根据视图的名称和参数生成一个URL。</p>\n<h3 id=\"Create-a-Blueprint\"><a href=\"#Create-a-Blueprint\" class=\"headerlink\" title=\"Create a Blueprint\"></a>Create a Blueprint</h3><p>Blueprint是一种组织一组相关视图和其他代码的方法。它们不是直接在应用程序中注册视图和其他代码，而是在蓝图中注册。然后，当蓝图在工厂功能中可用时，将其注册到应用程序中。</p>\n<p>Flaskr将有两个蓝图，一个用于身份验证功能，一个用于博客帖子功能。每个蓝图的代码将放在一个单独的模块中。由于博客需要了解身份验证，因此您将首先编写身份验证。</p>\n<blockquote>\n<p>flaskr&#x2F;auth.py</p>\n</blockquote>\n<figure class=\"highlight py\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> functools</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">from</span> flask <span class=\"keyword\">import</span> (</span><br><span class=\"line\">    Blueprint, flash, g, redirect, render_template, request, session, url_for</span><br><span class=\"line\">)</span><br><span class=\"line\"><span class=\"keyword\">from</span> werkzeug.security <span class=\"keyword\">import</span> check_password_hash, generate_password_hash</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">from</span> flaskr.db <span class=\"keyword\">import</span> get_db</span><br><span class=\"line\"></span><br><span class=\"line\">bp = Blueprint(<span class=\"string\">&#x27;auth&#x27;</span>, __name__, url_prefix = <span class=\"string\">&#x27;/auth&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>这将创建一个名为“auth”的蓝图。与应用程序对象一样，蓝图需要知道它的定义位置，因此__name__作为第二个参数传递。url_prefix将被添加到与蓝图关联的所有url之前。</p>\n<p>使用app.register_blueprint（）从工厂导入并注册蓝图。在返回应用程序之前，将新代码放在工厂函数的末尾。</p>\n<blockquote>\n<p>flaskr&#x2F;<strong>init</strong>.py</p>\n</blockquote>\n<figure class=\"highlight py\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Register the auth blueprint</span></span><br><span class=\"line\"><span class=\"keyword\">from</span> . <span class=\"keyword\">import</span> auth</span><br><span class=\"line\">app.register_blueprint(auth.bp)</span><br></pre></td></tr></table></figure>\n\n<p>身份验证蓝图将具有注册新用户以及登录和注销的视图。</p>\n<h3 id=\"The-First-View-Register\"><a href=\"#The-First-View-Register\" class=\"headerlink\" title=\"The First View: Register\"></a>The First View: Register</h3><p>当用户访问&#x2F;auth&#x2F;register URL时，注册视图将返回带有表单的HTML供他们填写。当他们提交表单时，它将验证他们的输入，并再次显示带有错误消息的表单，或者创建新用户并转到登录页面。</p>\n<p>现在您只需编写视图代码。在下一页中，您将编写模板来生成HTML表单。</p>\n<blockquote>\n<p>flaskr&#x2F;auth.py</p>\n</blockquote>\n<figure class=\"highlight py\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@bp.route(<span class=\"params\"><span class=\"string\">&#x27;/register&#x27;</span>, methods=(<span class=\"params\"><span class=\"string\">&#x27;GET&#x27;</span>, <span class=\"string\">&#x27;POST&#x27;</span></span>)</span>)</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">register</span>():</span><br><span class=\"line\">    <span class=\"keyword\">if</span> request.method == <span class=\"string\">&#x27;POST&#x27;</span>:</span><br><span class=\"line\">        username = request.form[<span class=\"string\">&#x27;username&#x27;</span>]</span><br><span class=\"line\">        password = request.form[<span class=\"string\">&#x27;password&#x27;</span>]</span><br><span class=\"line\">        db = get_db()</span><br><span class=\"line\">        error = <span class=\"literal\">None</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> username:</span><br><span class=\"line\">            error = <span class=\"string\">&#x27;Username is required&#x27;</span></span><br><span class=\"line\">        <span class=\"keyword\">elif</span> <span class=\"keyword\">not</span> password</span><br><span class=\"line\">            error = <span class=\"string\">&#x27;Password is required&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> error <span class=\"keyword\">is</span> <span class=\"literal\">None</span>:</span><br><span class=\"line\">            <span class=\"keyword\">try</span>:</span><br><span class=\"line\">                db.execute(</span><br><span class=\"line\">                    <span class=\"string\">&quot;INSERT INTO user (username, password) VALUES (?, ?)&quot;</span>,</span><br><span class=\"line\">                    (username, generate_password_hash(password))</span><br><span class=\"line\">                )</span><br><span class=\"line\">                db.commit()</span><br><span class=\"line\">            <span class=\"keyword\">except</span> db.IntegrityError:</span><br><span class=\"line\">                error = <span class=\"string\">f&quot;User <span class=\"subst\">&#123;username&#125;</span> is already registered&quot;</span></span><br><span class=\"line\">            <span class=\"keyword\">else</span></span><br><span class=\"line\">                <span class=\"keyword\">return</span> redirect(url_for(<span class=\"string\">&#x27;auth.login&#x27;</span>))</span><br><span class=\"line\">            </span><br><span class=\"line\">        flash(error)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> render_template(<span class=\"string\">&#x27;auth/register.html&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>以下是代码解析：</p>\n<ol>\n<li><p><code>@bp。route</code>将URL <code>/register</code>与注册视图函数关联起来。当Flask接收到对<code>/auth/register</code>的请求时，它将调用register视图并使用返回值作为响应。</p>\n</li>\n<li><p>如果用户提交了表单，request.method 将是<code>POST</code>。在本例中，开始验证输入。</p>\n</li>\n<li><p><code>request.form</code>是一种特殊类型的映射提交表单键和值的字典。用户将输入他们的用户名和密码。</p>\n</li>\n<li><p>验证 username 和 password 不为空</p>\n</li>\n<li><p>如果验证成功，插入新的用户数据到数据库  </p>\n<ul>\n<li>db.execute 使用<code>?</code>用于任何用户输入的占位符，以及用于替换占位符的值元组。数据库库将负责转义这些值，这样您就不会受到SQL注入攻击。</li>\n<li>为了安全起见，永远不要将密码直接存储在数据库中。相反，使用generate_password_hash（）安全地对密码进行散列，并存储该散列。由于该查询修改了数据，因此需要在之后调用db.commit（）来保存更改。</li>\n<li>如果用户名已经存在，则会发生<code>sqlite3.IntegrityError</code>，这应该作为另一个验证错误显示给用户。</li>\n</ul>\n</li>\n<li><p>存储用户之后，它们被重定向到登录页面。<code>url_for（）</code>根据登录视图的名称为其生成URL。这比直接编写URL更可取，因为它允许您稍后更改URL，而无需更改链接到它的所有代码。<code>redirect（）</code>生成对生成的URL的重定向响应。</p>\n</li>\n<li><p>如果验证失败，错误将显示给用户。Flash（）存储可以在呈现模板时检索的消息。</p>\n</li>\n<li><p>当用户最初导航到认证&#x2F;注册时，或者出现验证错误时，应该显示一个包含注册表单的HTML页面。<code>render_template（）</code>将呈现一个包含HTML的模板，该模板将在本教程的下一步中编写。</p>\n</li>\n</ol>\n<h3 id=\"Login\"><a href=\"#Login\" class=\"headerlink\" title=\"Login\"></a>Login</h3><figure class=\"highlight py\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@bp.route(<span class=\"params\"><span class=\"string\">&#x27;/login&#x27;</span>, methods = (<span class=\"params\"><span class=\"string\">&#x27;GET&#x27;</span>, <span class=\"string\">&#x27;POST&#x27;</span></span>)</span>)</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">login</span>():</span><br><span class=\"line\">    <span class=\"keyword\">if</span> request.method == <span class=\"string\">&#x27;POST&#x27;</span>:</span><br><span class=\"line\">        username = request.form[<span class=\"string\">&#x27;username&#x27;</span>]</span><br><span class=\"line\">        password = request.form[<span class=\"string\">&#x27;password&#x27;</span>]</span><br><span class=\"line\">        db = get_db()</span><br><span class=\"line\">        error = <span class=\"literal\">None</span></span><br><span class=\"line\">        user = db.execute(</span><br><span class=\"line\">            <span class=\"string\">&#x27;SELECT * FROM user WHERE username = ?&#x27;</span>, (username)</span><br><span class=\"line\">        ).fetchone()</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> user <span class=\"keyword\">is</span> <span class=\"literal\">None</span>:</span><br><span class=\"line\">            error = <span class=\"string\">&#x27;Incorrect username.&#x27;</span></span><br><span class=\"line\">        <span class=\"keyword\">elif</span> <span class=\"keyword\">not</span> check_password_hash(user[<span class=\"string\">&#x27;password&#x27;</span>, password]):</span><br><span class=\"line\">            error = <span class=\"string\">&#x27;Incorrect password.&#x27;</span></span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">if</span> error <span class=\"keyword\">is</span> <span class=\"literal\">None</span>:</span><br><span class=\"line\">            session.clear()</span><br><span class=\"line\">            session[<span class=\"string\">&#x27;user_id&#x27;</span>] = user[<span class=\"string\">&#x27;id&#x27;</span>]</span><br><span class=\"line\">            <span class=\"keyword\">return</span> redirect(url_for(<span class=\"string\">&#x27;index&#x27;</span>))</span><br><span class=\"line\">        </span><br><span class=\"line\">        flash(error)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> render_template(<span class=\"string\">&#x27;auth/login.html&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>There are a few differences from the register view:</p>\n<ol>\n<li><p>The user is queried first and stored in a variable for later use. <code>fetchone()</code> returns one row from the query. If the query returned no results, it returns None. Later, <code>fetchall()</code> will be used, which returns a list of all results.</p>\n</li>\n<li><p><code>check_password_hash()</code> hashes the submitted password in the same way as the stored hash and securely compares them. If they match, the password is valid.</p>\n</li>\n<li><p><code>session</code> is a <code>dict</code> that stores data across requests. When validation succeeds, the user’s id is stored in a new session. The data is stored in a cookie that is sent to the browser, and the browser then sends it back with subsequent requests. Flask securely signs the data so that it can’t be tampered with.</p>\n</li>\n</ol>\n<figure class=\"highlight py\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@bp.before_app_request</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">load_logged_in_user</span>():</span><br><span class=\"line\">    user_id = session.get(<span class=\"string\">&#x27;user_id&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> user_id <span class=\"keyword\">is</span> <span class=\"literal\">None</span>:</span><br><span class=\"line\">        g.user = <span class=\"literal\">None</span></span><br><span class=\"line\">    <span class=\"keyword\">else</span>:</span><br><span class=\"line\">        g.user = get_db().execute(</span><br><span class=\"line\">            <span class=\"string\">&#x27;SELECT * FROM user WHERE id = ?&#x27;</span>, (user_id)</span><br><span class=\"line\">        ).fetchone()</span><br></pre></td></tr></table></figure>\n\n<p><code>bp.before_app_request（）</code>注册一个在视图函数之前运行的函数，无论请求的URL是什么。<code>Load_logged_in_user</code>检查用户id是否存储在会话中，并从数据库中获取该用户的数据，将其存储在g.user上，该数据将持续请求的长度。如果没有用户id，或者用户id不存在，g.user将为None。</p>\n<h3 id=\"Logout\"><a href=\"#Logout\" class=\"headerlink\" title=\"Logout\"></a>Logout</h3><p>要注销，需要从会话中删除用户id。那么<code>load_logged_in_user</code>将不会在后续请求中加载用户。</p>\n<figure class=\"highlight py\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@bp.route(<span class=\"params\"><span class=\"string\">&#x27;/logout&#x27;</span></span>)</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">logout</span>():</span><br><span class=\"line\">    session.clear()</span><br><span class=\"line\">    <span class=\"keyword\">return</span> redirect(url_for(<span class=\"string\">&#x27;index&#x27;</span>))</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Require-Authentication-in-Other-Views\"><a href=\"#Require-Authentication-in-Other-Views\" class=\"headerlink\" title=\"Require Authentication in Other Views\"></a>Require Authentication in Other Views</h3><p>创建、编辑和删除博客文章需要用户登录。可以使用装饰器来检查它应用到的每个视图。</p>\n<figure class=\"highlight py\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">login_required</span>(<span class=\"params\">view</span>):</span><br><span class=\"line\"><span class=\"meta\">    @functools.wraps(<span class=\"params\">view</span>)</span></span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">wrapped_view</span>(<span class=\"params\">**kwargs</span>):</span><br><span class=\"line\">        <span class=\"keyword\">if</span> g.user <span class=\"keyword\">is</span> <span class=\"literal\">None</span>:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> redirect(url_for(<span class=\"string\">&#x27;auth.login&#x27;</span>))</span><br><span class=\"line\">        </span><br><span class=\"line\">    <span class=\"keyword\">return</span> wrapped_view</span><br></pre></td></tr></table></figure>\n\n<p>这个装饰器返回一个新的视图函数，该函数包装了它所应用的原始视图。新函数检查用户是否已加载，否则将重定向到登录页面。如果用户被加载，则调用原始视图并正常继续。您将在编写博客视图时使用该装饰器。</p>\n<h3 id=\"Endpoints-and-URLs\"><a href=\"#Endpoints-and-URLs\" class=\"headerlink\" title=\"Endpoints and URLs\"></a>Endpoints and URLs</h3><p><code>url_for（）</code>函数根据名称和参数生成视图的URL。与视图关联的名称也称为端点，默认情况下，它与视图函数的名称相同。</p>\n<p>例如，在教程前面添加到应用程序工厂的<code>hello（）</code>视图的名称为‘hello’，可以使用url_for（’hello’）链接到它。如果它接受一个参数，稍后您将看到，它将被链接到使用url_for（’hello’, who&#x3D;’World’）。</p>\n<p>当使用蓝图时，蓝图的名称被附加到函数的名称之前，因此您在上面编写的登录函数的端点是‘auth ’。Login ‘，因为您将它添加到’auth’蓝图中。</p>\n<h2 id=\"Templates\"><a href=\"#Templates\" class=\"headerlink\" title=\"Templates\"></a>Templates</h2><p>模板是包含静态数据和动态数据占位符的文件。使用特定的数据呈现模板以生成最终文档。Flask使用Jinja模板库来呈现模板。</p>\n<p>在您的应用程序中，您将使用模板来呈现将显示在用户浏览器中的HTML。在Flask中，Jinja被配置为自动转义HTML模板中呈现的任何数据。这意味着呈现用户输入是安全的；他们输入的任何可能扰乱HTML的字符，如<code>&lt;and&gt;</code>，都将被转义为安全值，这些值在浏览器中看起来是一样的，但不会产生不必要的效果。</p>\n<p>Jinja的外观和行为都很像Python。使用特殊分隔符将Jinja语法与模板中的静态数据区分开来。<code>&#123;&#123;and&#125;&#125;</code>之间的任何内容都是将输出到最终文档的表达式。<code>&#123;%and%&#125;</code>表示控制流语句，如if和for。与Python不同，块由开始和结束标记而不是缩进表示，因为块中的静态文本可能会改变缩进。</p>\n<h3 id=\"The-Base-Layout\"><a href=\"#The-Base-Layout\" class=\"headerlink\" title=\"The Base Layout\"></a>The Base Layout</h3><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!doctype <span class=\"keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>&#123;% block title %&#125;&#123;% endblock %&#125; - Flaskr<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">link</span> <span class=\"attr\">rel</span>=<span class=\"string\">&quot;stylesheet&quot;</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;&#123;&#123; url_for(&#x27;static&#x27;, filename=&#x27;style.css&#x27;) &#125;&#125;&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">nav</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span>Flaskr<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">ul</span>&gt;</span></span><br><span class=\"line\">    &#123;% if g.user %&#125;</span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">li</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">span</span>&gt;</span>&#123;&#123; g.user[&#x27;username&#x27;] &#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">li</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;&#123;&#123; url_for(&#x27;auth.logout&#x27;) &#125;&#125;&quot;</span>&gt;</span>Log Out<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span><br><span class=\"line\">    &#123;% else %&#125;</span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">li</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;&#123;&#123; url_for(&#x27;auth.register&#x27;) &#125;&#125;&quot;</span>&gt;</span>Register<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">li</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;&#123;&#123; url_for(&#x27;auth.login&#x27;) &#125;&#125;&quot;</span>&gt;</span>Log In<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span><br><span class=\"line\">    &#123;% endif %&#125;</span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">ul</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">nav</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">section</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;content&quot;</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">header</span>&gt;</span></span><br><span class=\"line\">    &#123;% block header %&#125;&#123;% endblock %&#125;</span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">header</span>&gt;</span></span><br><span class=\"line\">  &#123;% for message in get_flashed_messages() %&#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;flash&quot;</span>&gt;</span>&#123;&#123; message &#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">  &#123;% endfor %&#125;</span><br><span class=\"line\">  &#123;% block content %&#125;&#123;% endblock %&#125;</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">section</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Register\"><a href=\"#Register\" class=\"headerlink\" title=\"Register\"></a>Register</h3><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;% extends &#x27;base.html&#x27; %&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;% block header %&#125;</span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span>&#123;% block title %&#125;Register&#123;% endblock %&#125;<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span><br><span class=\"line\">&#123;% endblock %&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;% block content %&#125;</span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">form</span> <span class=\"attr\">method</span>=<span class=\"string\">&quot;post&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">label</span> <span class=\"attr\">for</span>=<span class=\"string\">&quot;username&quot;</span>&gt;</span>Username<span class=\"tag\">&lt;/<span class=\"name\">label</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;username&quot;</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;username&quot;</span> <span class=\"attr\">required</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">label</span> <span class=\"attr\">for</span>=<span class=\"string\">&quot;password&quot;</span>&gt;</span>Password<span class=\"tag\">&lt;/<span class=\"name\">label</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;password&quot;</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;password&quot;</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;password&quot;</span> <span class=\"attr\">required</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;submit&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;Register&quot;</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">form</span>&gt;</span></span><br><span class=\"line\">&#123;% endblock %&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Log-In\"><a href=\"#Log-In\" class=\"headerlink\" title=\"Log In\"></a>Log In</h3><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;% extends &#x27;base.html&#x27; %&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;% block header %&#125;</span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span>&#123;% block title %&#125;Log In&#123;% endblock %&#125;<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span><br><span class=\"line\">&#123;% endblock %&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;% block content %&#125;</span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">form</span> <span class=\"attr\">method</span>=<span class=\"string\">&quot;post&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">label</span> <span class=\"attr\">for</span>=<span class=\"string\">&quot;username&quot;</span>&gt;</span>Username<span class=\"tag\">&lt;/<span class=\"name\">label</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;username&quot;</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;username&quot;</span> <span class=\"attr\">required</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">label</span> <span class=\"attr\">for</span>=<span class=\"string\">&quot;password&quot;</span>&gt;</span>Password<span class=\"tag\">&lt;/<span class=\"name\">label</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;password&quot;</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;password&quot;</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;password&quot;</span> <span class=\"attr\">required</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;submit&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;Log In&quot;</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">form</span>&gt;</span></span><br><span class=\"line\">&#123;% endblock %&#125;</span><br></pre></td></tr></table></figure>"},{"title":"Flask Tutorial 1","comments":1,"date":"2025-01-08T11:23:28.000Z","description":"Flask Tutorial","_content":"\n\n# Flask Tutorial\n\n## Project Layout\n\n创建一个项目文件夹然后打开。\n\n```powershell\nmkdir flask-tutorial # 创建 flask 项目文件夹\ncd flask-tutorial\n```\n\n按照 [Flask Overview](https://1yaowei0.github.io/2025/01/07/ai-plateform-flask/) 设置项目目录。\n\n***\n\n一个大的**flask**项目，不可以将所有的代码放到一个文件。**Python**项目使用*package*将代码组织成多个模块，这些模块可以在需要的地方导入。\n\n这个项目应该包含：\n\n- `flaskr/`, 一个包含应用代码和文件的 python 包；\n- `tests/`, 一个包含测试模块的目录；\n- `.venv/`, 一个包含 flask 和其它已安装依赖的虚拟环境；\n- 一个告诉 python 如何安装项目的安装文件；\n- 版本控制配置，如 git。无论项目大小，你都应该养成对所有项目使用某种版本控制的习惯；\n- 如何可能在未来添加到项目的文件。\n\n最后，一个项目的结构应该如下：\n\n```txt\n/home/user/Projects/flask-tutorial\n├── flaskr/\n│   ├── __init__.py\n│   ├── db.py\n│   ├── schema.sql\n│   ├── auth.py\n│   ├── blog.py\n│   ├── templates/\n│   │   ├── base.html\n│   │   ├── auth/\n│   │   │   ├── login.html\n│   │   │   └── register.html\n│   │   └── blog/\n│   │       ├── create.html\n│   │       ├── index.html\n│   │       └── update.html\n│   └── static/\n│       └── style.css\n├── tests/\n│   ├── conftest.py\n│   ├── data.sql\n│   ├── test_factory.py\n│   ├── test_db.py\n│   ├── test_auth.py\n│   └── test_blog.py\n├── .venv/\n├── pyproject.toml\n└── MANIFEST.in\n```\n\n如果使用版本控制，可以如下设置。下列被指定的路径将会被版本控制忽略，即使它在项目的开发过程中被修改。\n\n```txt\n.gitignore\n.venv/\n\n*.pyc\n__pycache__/\n\ninstance/\n\n.pytest_cache/\n.coverage\nhtmlcov/\n\ndist/\nbuild/\n*.egg-info/\n```\n\n## Application Setup\n\n一个 Flask 应用是一个 Flask 类的实例。任何与该应用相关的配置，URLs 都会在这个类中被注册。\n\n创建 Flask 引用的最直截了当的方式是在你代码的目录顶部创建一个全局的 Flask 实例。\n\n你将在一个函数中创建它，而不是全局地创建 Flask 的引用（实例）。这个函数称为 *应用工厂*。任何配置，注册和其它应用所需的设置都需要在这个函数中发生，然后返回该应用。\n\n### The Application Factory\n\n在 flaskr 目录下添加 `__init__.py` 文件，它有双重的职责，它将包含应用工厂，以及它告诉 python 这个 flaskr 目录应该被当作一个包。\n\n```py\nimport os\n\nfrom flask import Flask\n\ndef create_app(test_config = None):\n    # Create and configue the app\n    app = Flask(__name__, instance_relative_config = True)\n    app.config.from_mapping(\n        SECRET_KEY = 'dev',\n        DATABASE = os.path.join(app.instance_path, 'flaskr.sqlite')\n    )\n\n    if test_config is None:\n        # Load the instance config, if it exists, when not testing\n        app.config.from_pyfile('config.py', silent = True)\n    else:\n        # Load the test config if passed in\n        app.config.from_mapping(test_config)\n\n    # ensure the instance folder exists\n    try:\n        os.makedirs(app.instance_path)\n    except OSError:\n        pass\n\n    # a simple page that says hello\n    @app.route('/hello')\n    def hello():\n        return 'Hello, World!'\n    \n    return app\n```\n\n`create_app` 是一个应用工厂函数。你将在教程后面添加它，但它已经做了很多事儿。\n\n1. `app = Flask(__name__, instance_relative_config = True)` 创建了 Flask 实例。\n    - `__name__` 是当前 python 模块的名字。这个 app 需要知道它的位置来设置一些路径。并且 `__name__` 是一种很方便告诉它的方式；\n    - `instance_relative_config` 告诉 app 配置文件是相对于实例文件夹的。实例文件夹位于flaskr包之外，可以保存不应该提交给版本控制的本地数据，例如配置秘密和数据库文件。\n\n2. `app.config.from_mapping()` 设置了 app 的一些默认配置：\n    - `SECRET_KEY` 被用来保证数据安全。它被设置为‘dev’，以便在开发期间提供一个方便的值，但在部署时应该使用随机值覆盖它；\n    - `DATABASE` 是 SQLite 数据库将被保存的位置。它在 `app.instance_path` 之下，这是Flask为实例文件夹选择的路径。\n\n3. `app.config.from_pyfile()` 使用从实例文件夹中的config.py文件（如果存在）获取的值覆盖默认配置。例如，在部署时，可以使用它来设置一个真正的SECRET_KEY。\n    - `Test_config` 也可以传递给工厂，并代替实例配置使用。\n\n4. `os.makedir` 确保 `app.instance_path` 存在，Flask 不会自动创建实例文件夹，但是它需要被创建因为当前的项目将创建数据库文件。\n\n5. `app.route` 创建了一个简单的路由，在深入后面教程之前我们可以看见应用是工作的。它创建了一个在 URL 和返回了响应的应用之间的连接。\n\n## Run The Application\n\n现在可以使用flask命令运行应用程序了。在终端中，告诉Flask在哪里可以找到您的应用程序，然后在调试模式下运行它。记住，您仍然应该在顶层的flask-tutorial目录中，而不是在flask包中。\n\n调试模式在页面引发异常时显示交互式调试器，并在更改代码时重新启动服务器。您可以让它继续运行，只要按照本教程重新加载浏览器页面即可。\n\n```powershell\nflask --app flaskr run --debug\n\n* Serving Flask app \"flaskr\"\n* Debug mode: on\n* Running on http://127.0.0.1:5000/ (Press CTRL+C to quit)\n* Restarting with stat\n* Debugger is active!\n* Debugger PIN: nnn-nnn-nnn\n```\n\n## Define and Access the Database\n\nSQLite 很方便因为它不需要设置一个独立的数据库服务，它是在 python 中编译的。但是，如果并发请求试图同时写入数据库，它们将会变慢，因为每次写入都是顺序进行的。小型应用程序不会注意到这一点。当您的企业规模扩大后，您可能希望切换到不同的数据库。\n\n### Connect to the Database\n\n使用 SQLite 数据库（以及大多数其他Python数据库库）时要做的第一件事是创建到它的连接。任何查询和操作都使用连接执行，该连接在工作完成后关闭。\n\n在 web 应用程序中，这种连接通常与请求绑定在一起。它是在处理请求时创建的，并在发送响应之前关闭。\n\n> flaskr/db.py\n\n```py\nimport sqlite3\nfrom datetime import datetime\n\nimport click\nfrom flask import current_app, g\n\n\ndef get_db():\n    if 'db' not in g:\n        g.db = sqlite3.connect(\n            current_app.config['DATABASE'],\n            detect_types=sqlite3.PARSE_DECLTYPES\n        )\n        g.db.row_factory = sqlite3.Row\n\n    return g.db\n\n\ndef close_db(e=None):\n    db = g.pop('db', None)\n\n    if db is not None:\n        db.close()\n```\n\n**g** 是一个对于每个请求都唯一的对象。它用于存储在请求期间可能被多个函数访问的数据。如果在同一请求中第二次调用get_db，则存储并重用该连接，而不是创建新连接。\n\n**current_app** 是另一个特殊对象，指向处理请求的Flask应用程序。由于使用了应用程序工厂，因此在编写其余代码时没有应用程序对象。Get_db将在创建应用程序并处理请求时调用，因此可以使用current_app。\n\n**sqlite3.connect()** 建立到DATABASE配置键所指向的文件的连接。这个文件并不一定要存在，直到稍后初始化数据库时才会存在。\n\n**sqlite3.Row** 告诉连接返回行为类似字典的行。这允许按名称访问列。\n\n**close_db** 通过检查是否设置了g.db来检查是否创建了连接。如果连接存在，则关闭该连接。接下来，您将告诉应用程序有关应用程序工厂中的close_db函数，以便在每次请求之后调用它。\n\n### Create the Tables\n\n```sql\nDROP TABLE IF EXISTS user;\nDROP TABLE IF EXISTS post;\n\nCREATE TABLE user (\n  id INTEGER PRIMARY KEY AUTOINCREMENT,\n  username TEXT UNIQUE NOT NULL,\n  password TEXT NOT NULL\n);\n\nCREATE TABLE post (\n  id INTEGER PRIMARY KEY AUTOINCREMENT,\n  author_id INTEGER NOT NULL,\n  created TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  title TEXT NOT NULL,\n  body TEXT NOT NULL,\n  FOREIGN KEY (author_id) REFERENCES user (id)\n);\n```\n\n往 `db.py` 放入 python 方法用于运行 SQL 命令。\n\n```py\ndef init_db():\n    db = get_db()\n\n    with current_app.open_resource('schema.sql') as f:\n        db.executescript(f.read().decode('utf8'))\n\n@click.command('init-db')\ndef init_db_command():\n    init_db()\n    click.echo('Initialized the database.')\n\nsqlite3.register_converter(\n    \"timestamp\", lambda v: datetime.fromisoformat(v.decode())\n)\n```\n\n`Open_resource（）`打开一个相对于flask包的文件，这很有用，因为在以后部署应用程序时，您不一定知道该位置在哪里。Get_db返回一个数据库连接，用于执行从文件中读取的命令。\n\n`command（）`定义了一个名为init-db的命令行命令，该命令调用init_db函数并向用户显示成功消息。您可以阅读命令行接口来了解更多关于编写命令的信息。\n\n调用`sqlite3.register_converter（）`告诉Python如何解释数据库中的时间戳值。我们将该值转换为datetime.datetime。\n\n### Register with the Application\n\n`close_db`和`init_db_command`函数需要在应用实例中注册；否则，它们将不会被应用程序使用。但是，由于使用的是工厂函数，因此在编写函数时该实例不可用。相反，应该编写一个函数，它接受一个应用程序并进行注册。\n\n```py\ndef init_app(app):\n    app.teardown_appcontext(close_db)\n    app.cli.add_command(init_db_command)\n```\n\n`app.teardown_appcontext（）`告诉Flask在返回响应后进行清理时调用该函数。\n\n`App.cli.add_command（）`添加了一个可以通过flask命令调用的新命令。\n\n从工厂导入并调用这个函数。在返回应用程序之前，将新代码放在工厂函数的末尾。\n\n```py\n    # a simple page that says hello\n    @app.route('/hello/')\n    def hello():\n        return 'Hello, World!'\n```\n\n### Initialize the Database File\n\n现在init-db已经注册到应用程序中，可以使用flask命令调用它，类似于上一页中的run命令。\n\n> 如果您仍在运行上一页中的服务器，您可以停止服务器，或者在新的终端中运行此命令。如果您使用一个新的终端，请记住切换到您的项目目录并激活env，如安装中所述。\n\n运行`init-db`命令：\n\n```powershell\nflask --app flaskr init-db\n```\n\n将会有一个 `flaskr.sqlite` 文件出现在项目的`instance`目录中","source":"_posts/flask-tutorial.md","raw":"---\ntitle: Flask Tutorial 1\ncategories:\n - flask\ncomments: true\ndate: 2025-01-08 19:23:28\ndescription: Flask Tutorial\n---\n\n\n# Flask Tutorial\n\n## Project Layout\n\n创建一个项目文件夹然后打开。\n\n```powershell\nmkdir flask-tutorial # 创建 flask 项目文件夹\ncd flask-tutorial\n```\n\n按照 [Flask Overview](https://1yaowei0.github.io/2025/01/07/ai-plateform-flask/) 设置项目目录。\n\n***\n\n一个大的**flask**项目，不可以将所有的代码放到一个文件。**Python**项目使用*package*将代码组织成多个模块，这些模块可以在需要的地方导入。\n\n这个项目应该包含：\n\n- `flaskr/`, 一个包含应用代码和文件的 python 包；\n- `tests/`, 一个包含测试模块的目录；\n- `.venv/`, 一个包含 flask 和其它已安装依赖的虚拟环境；\n- 一个告诉 python 如何安装项目的安装文件；\n- 版本控制配置，如 git。无论项目大小，你都应该养成对所有项目使用某种版本控制的习惯；\n- 如何可能在未来添加到项目的文件。\n\n最后，一个项目的结构应该如下：\n\n```txt\n/home/user/Projects/flask-tutorial\n├── flaskr/\n│   ├── __init__.py\n│   ├── db.py\n│   ├── schema.sql\n│   ├── auth.py\n│   ├── blog.py\n│   ├── templates/\n│   │   ├── base.html\n│   │   ├── auth/\n│   │   │   ├── login.html\n│   │   │   └── register.html\n│   │   └── blog/\n│   │       ├── create.html\n│   │       ├── index.html\n│   │       └── update.html\n│   └── static/\n│       └── style.css\n├── tests/\n│   ├── conftest.py\n│   ├── data.sql\n│   ├── test_factory.py\n│   ├── test_db.py\n│   ├── test_auth.py\n│   └── test_blog.py\n├── .venv/\n├── pyproject.toml\n└── MANIFEST.in\n```\n\n如果使用版本控制，可以如下设置。下列被指定的路径将会被版本控制忽略，即使它在项目的开发过程中被修改。\n\n```txt\n.gitignore\n.venv/\n\n*.pyc\n__pycache__/\n\ninstance/\n\n.pytest_cache/\n.coverage\nhtmlcov/\n\ndist/\nbuild/\n*.egg-info/\n```\n\n## Application Setup\n\n一个 Flask 应用是一个 Flask 类的实例。任何与该应用相关的配置，URLs 都会在这个类中被注册。\n\n创建 Flask 引用的最直截了当的方式是在你代码的目录顶部创建一个全局的 Flask 实例。\n\n你将在一个函数中创建它，而不是全局地创建 Flask 的引用（实例）。这个函数称为 *应用工厂*。任何配置，注册和其它应用所需的设置都需要在这个函数中发生，然后返回该应用。\n\n### The Application Factory\n\n在 flaskr 目录下添加 `__init__.py` 文件，它有双重的职责，它将包含应用工厂，以及它告诉 python 这个 flaskr 目录应该被当作一个包。\n\n```py\nimport os\n\nfrom flask import Flask\n\ndef create_app(test_config = None):\n    # Create and configue the app\n    app = Flask(__name__, instance_relative_config = True)\n    app.config.from_mapping(\n        SECRET_KEY = 'dev',\n        DATABASE = os.path.join(app.instance_path, 'flaskr.sqlite')\n    )\n\n    if test_config is None:\n        # Load the instance config, if it exists, when not testing\n        app.config.from_pyfile('config.py', silent = True)\n    else:\n        # Load the test config if passed in\n        app.config.from_mapping(test_config)\n\n    # ensure the instance folder exists\n    try:\n        os.makedirs(app.instance_path)\n    except OSError:\n        pass\n\n    # a simple page that says hello\n    @app.route('/hello')\n    def hello():\n        return 'Hello, World!'\n    \n    return app\n```\n\n`create_app` 是一个应用工厂函数。你将在教程后面添加它，但它已经做了很多事儿。\n\n1. `app = Flask(__name__, instance_relative_config = True)` 创建了 Flask 实例。\n    - `__name__` 是当前 python 模块的名字。这个 app 需要知道它的位置来设置一些路径。并且 `__name__` 是一种很方便告诉它的方式；\n    - `instance_relative_config` 告诉 app 配置文件是相对于实例文件夹的。实例文件夹位于flaskr包之外，可以保存不应该提交给版本控制的本地数据，例如配置秘密和数据库文件。\n\n2. `app.config.from_mapping()` 设置了 app 的一些默认配置：\n    - `SECRET_KEY` 被用来保证数据安全。它被设置为‘dev’，以便在开发期间提供一个方便的值，但在部署时应该使用随机值覆盖它；\n    - `DATABASE` 是 SQLite 数据库将被保存的位置。它在 `app.instance_path` 之下，这是Flask为实例文件夹选择的路径。\n\n3. `app.config.from_pyfile()` 使用从实例文件夹中的config.py文件（如果存在）获取的值覆盖默认配置。例如，在部署时，可以使用它来设置一个真正的SECRET_KEY。\n    - `Test_config` 也可以传递给工厂，并代替实例配置使用。\n\n4. `os.makedir` 确保 `app.instance_path` 存在，Flask 不会自动创建实例文件夹，但是它需要被创建因为当前的项目将创建数据库文件。\n\n5. `app.route` 创建了一个简单的路由，在深入后面教程之前我们可以看见应用是工作的。它创建了一个在 URL 和返回了响应的应用之间的连接。\n\n## Run The Application\n\n现在可以使用flask命令运行应用程序了。在终端中，告诉Flask在哪里可以找到您的应用程序，然后在调试模式下运行它。记住，您仍然应该在顶层的flask-tutorial目录中，而不是在flask包中。\n\n调试模式在页面引发异常时显示交互式调试器，并在更改代码时重新启动服务器。您可以让它继续运行，只要按照本教程重新加载浏览器页面即可。\n\n```powershell\nflask --app flaskr run --debug\n\n* Serving Flask app \"flaskr\"\n* Debug mode: on\n* Running on http://127.0.0.1:5000/ (Press CTRL+C to quit)\n* Restarting with stat\n* Debugger is active!\n* Debugger PIN: nnn-nnn-nnn\n```\n\n## Define and Access the Database\n\nSQLite 很方便因为它不需要设置一个独立的数据库服务，它是在 python 中编译的。但是，如果并发请求试图同时写入数据库，它们将会变慢，因为每次写入都是顺序进行的。小型应用程序不会注意到这一点。当您的企业规模扩大后，您可能希望切换到不同的数据库。\n\n### Connect to the Database\n\n使用 SQLite 数据库（以及大多数其他Python数据库库）时要做的第一件事是创建到它的连接。任何查询和操作都使用连接执行，该连接在工作完成后关闭。\n\n在 web 应用程序中，这种连接通常与请求绑定在一起。它是在处理请求时创建的，并在发送响应之前关闭。\n\n> flaskr/db.py\n\n```py\nimport sqlite3\nfrom datetime import datetime\n\nimport click\nfrom flask import current_app, g\n\n\ndef get_db():\n    if 'db' not in g:\n        g.db = sqlite3.connect(\n            current_app.config['DATABASE'],\n            detect_types=sqlite3.PARSE_DECLTYPES\n        )\n        g.db.row_factory = sqlite3.Row\n\n    return g.db\n\n\ndef close_db(e=None):\n    db = g.pop('db', None)\n\n    if db is not None:\n        db.close()\n```\n\n**g** 是一个对于每个请求都唯一的对象。它用于存储在请求期间可能被多个函数访问的数据。如果在同一请求中第二次调用get_db，则存储并重用该连接，而不是创建新连接。\n\n**current_app** 是另一个特殊对象，指向处理请求的Flask应用程序。由于使用了应用程序工厂，因此在编写其余代码时没有应用程序对象。Get_db将在创建应用程序并处理请求时调用，因此可以使用current_app。\n\n**sqlite3.connect()** 建立到DATABASE配置键所指向的文件的连接。这个文件并不一定要存在，直到稍后初始化数据库时才会存在。\n\n**sqlite3.Row** 告诉连接返回行为类似字典的行。这允许按名称访问列。\n\n**close_db** 通过检查是否设置了g.db来检查是否创建了连接。如果连接存在，则关闭该连接。接下来，您将告诉应用程序有关应用程序工厂中的close_db函数，以便在每次请求之后调用它。\n\n### Create the Tables\n\n```sql\nDROP TABLE IF EXISTS user;\nDROP TABLE IF EXISTS post;\n\nCREATE TABLE user (\n  id INTEGER PRIMARY KEY AUTOINCREMENT,\n  username TEXT UNIQUE NOT NULL,\n  password TEXT NOT NULL\n);\n\nCREATE TABLE post (\n  id INTEGER PRIMARY KEY AUTOINCREMENT,\n  author_id INTEGER NOT NULL,\n  created TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  title TEXT NOT NULL,\n  body TEXT NOT NULL,\n  FOREIGN KEY (author_id) REFERENCES user (id)\n);\n```\n\n往 `db.py` 放入 python 方法用于运行 SQL 命令。\n\n```py\ndef init_db():\n    db = get_db()\n\n    with current_app.open_resource('schema.sql') as f:\n        db.executescript(f.read().decode('utf8'))\n\n@click.command('init-db')\ndef init_db_command():\n    init_db()\n    click.echo('Initialized the database.')\n\nsqlite3.register_converter(\n    \"timestamp\", lambda v: datetime.fromisoformat(v.decode())\n)\n```\n\n`Open_resource（）`打开一个相对于flask包的文件，这很有用，因为在以后部署应用程序时，您不一定知道该位置在哪里。Get_db返回一个数据库连接，用于执行从文件中读取的命令。\n\n`command（）`定义了一个名为init-db的命令行命令，该命令调用init_db函数并向用户显示成功消息。您可以阅读命令行接口来了解更多关于编写命令的信息。\n\n调用`sqlite3.register_converter（）`告诉Python如何解释数据库中的时间戳值。我们将该值转换为datetime.datetime。\n\n### Register with the Application\n\n`close_db`和`init_db_command`函数需要在应用实例中注册；否则，它们将不会被应用程序使用。但是，由于使用的是工厂函数，因此在编写函数时该实例不可用。相反，应该编写一个函数，它接受一个应用程序并进行注册。\n\n```py\ndef init_app(app):\n    app.teardown_appcontext(close_db)\n    app.cli.add_command(init_db_command)\n```\n\n`app.teardown_appcontext（）`告诉Flask在返回响应后进行清理时调用该函数。\n\n`App.cli.add_command（）`添加了一个可以通过flask命令调用的新命令。\n\n从工厂导入并调用这个函数。在返回应用程序之前，将新代码放在工厂函数的末尾。\n\n```py\n    # a simple page that says hello\n    @app.route('/hello/')\n    def hello():\n        return 'Hello, World!'\n```\n\n### Initialize the Database File\n\n现在init-db已经注册到应用程序中，可以使用flask命令调用它，类似于上一页中的run命令。\n\n> 如果您仍在运行上一页中的服务器，您可以停止服务器，或者在新的终端中运行此命令。如果您使用一个新的终端，请记住切换到您的项目目录并激活env，如安装中所述。\n\n运行`init-db`命令：\n\n```powershell\nflask --app flaskr init-db\n```\n\n将会有一个 `flaskr.sqlite` 文件出现在项目的`instance`目录中","slug":"flask-tutorial","published":1,"updated":"2025-07-08T12:05:00.538Z","layout":"post","photos":[],"_id":"cmcvxsshp000k3cug11u9byh1","content":"<h1 id=\"Flask-Tutorial\"><a href=\"#Flask-Tutorial\" class=\"headerlink\" title=\"Flask Tutorial\"></a>Flask Tutorial</h1><h2 id=\"Project-Layout\"><a href=\"#Project-Layout\" class=\"headerlink\" title=\"Project Layout\"></a>Project Layout</h2><p>创建一个项目文件夹然后打开。</p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir flask<span class=\"literal\">-tutorial</span> <span class=\"comment\"># 创建 flask 项目文件夹</span></span><br><span class=\"line\"><span class=\"built_in\">cd</span> flask<span class=\"literal\">-tutorial</span></span><br></pre></td></tr></table></figure>\n\n<p>按照 <a href=\"https://1yaowei0.github.io/2025/01/07/ai-plateform-flask/\">Flask Overview</a> 设置项目目录。</p>\n<hr>\n<p>一个大的<strong>flask</strong>项目，不可以将所有的代码放到一个文件。<strong>Python</strong>项目使用<em>package</em>将代码组织成多个模块，这些模块可以在需要的地方导入。</p>\n<p>这个项目应该包含：</p>\n<ul>\n<li><code>flaskr/</code>, 一个包含应用代码和文件的 python 包；</li>\n<li><code>tests/</code>, 一个包含测试模块的目录；</li>\n<li><code>.venv/</code>, 一个包含 flask 和其它已安装依赖的虚拟环境；</li>\n<li>一个告诉 python 如何安装项目的安装文件；</li>\n<li>版本控制配置，如 git。无论项目大小，你都应该养成对所有项目使用某种版本控制的习惯；</li>\n<li>如何可能在未来添加到项目的文件。</li>\n</ul>\n<p>最后，一个项目的结构应该如下：</p>\n<figure class=\"highlight txt\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/home/user/Projects/flask-tutorial</span><br><span class=\"line\">├── flaskr/</span><br><span class=\"line\">│   ├── __init__.py</span><br><span class=\"line\">│   ├── db.py</span><br><span class=\"line\">│   ├── schema.sql</span><br><span class=\"line\">│   ├── auth.py</span><br><span class=\"line\">│   ├── blog.py</span><br><span class=\"line\">│   ├── templates/</span><br><span class=\"line\">│   │   ├── base.html</span><br><span class=\"line\">│   │   ├── auth/</span><br><span class=\"line\">│   │   │   ├── login.html</span><br><span class=\"line\">│   │   │   └── register.html</span><br><span class=\"line\">│   │   └── blog/</span><br><span class=\"line\">│   │       ├── create.html</span><br><span class=\"line\">│   │       ├── index.html</span><br><span class=\"line\">│   │       └── update.html</span><br><span class=\"line\">│   └── static/</span><br><span class=\"line\">│       └── style.css</span><br><span class=\"line\">├── tests/</span><br><span class=\"line\">│   ├── conftest.py</span><br><span class=\"line\">│   ├── data.sql</span><br><span class=\"line\">│   ├── test_factory.py</span><br><span class=\"line\">│   ├── test_db.py</span><br><span class=\"line\">│   ├── test_auth.py</span><br><span class=\"line\">│   └── test_blog.py</span><br><span class=\"line\">├── .venv/</span><br><span class=\"line\">├── pyproject.toml</span><br><span class=\"line\">└── MANIFEST.in</span><br></pre></td></tr></table></figure>\n\n<p>如果使用版本控制，可以如下设置。下列被指定的路径将会被版本控制忽略，即使它在项目的开发过程中被修改。</p>\n<figure class=\"highlight txt\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">.gitignore</span><br><span class=\"line\">.venv/</span><br><span class=\"line\"></span><br><span class=\"line\">*.pyc</span><br><span class=\"line\">__pycache__/</span><br><span class=\"line\"></span><br><span class=\"line\">instance/</span><br><span class=\"line\"></span><br><span class=\"line\">.pytest_cache/</span><br><span class=\"line\">.coverage</span><br><span class=\"line\">htmlcov/</span><br><span class=\"line\"></span><br><span class=\"line\">dist/</span><br><span class=\"line\">build/</span><br><span class=\"line\">*.egg-info/</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Application-Setup\"><a href=\"#Application-Setup\" class=\"headerlink\" title=\"Application Setup\"></a>Application Setup</h2><p>一个 Flask 应用是一个 Flask 类的实例。任何与该应用相关的配置，URLs 都会在这个类中被注册。</p>\n<p>创建 Flask 引用的最直截了当的方式是在你代码的目录顶部创建一个全局的 Flask 实例。</p>\n<p>你将在一个函数中创建它，而不是全局地创建 Flask 的引用（实例）。这个函数称为 <em>应用工厂</em>。任何配置，注册和其它应用所需的设置都需要在这个函数中发生，然后返回该应用。</p>\n<h3 id=\"The-Application-Factory\"><a href=\"#The-Application-Factory\" class=\"headerlink\" title=\"The Application Factory\"></a>The Application Factory</h3><p>在 flaskr 目录下添加 <code>__init__.py</code> 文件，它有双重的职责，它将包含应用工厂，以及它告诉 python 这个 flaskr 目录应该被当作一个包。</p>\n<figure class=\"highlight py\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> os</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">from</span> flask <span class=\"keyword\">import</span> Flask</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">create_app</span>(<span class=\"params\">test_config = <span class=\"literal\">None</span></span>):</span><br><span class=\"line\">    <span class=\"comment\"># Create and configue the app</span></span><br><span class=\"line\">    app = Flask(__name__, instance_relative_config = <span class=\"literal\">True</span>)</span><br><span class=\"line\">    app.config.from_mapping(</span><br><span class=\"line\">        SECRET_KEY = <span class=\"string\">&#x27;dev&#x27;</span>,</span><br><span class=\"line\">        DATABASE = os.path.join(app.instance_path, <span class=\"string\">&#x27;flaskr.sqlite&#x27;</span>)</span><br><span class=\"line\">    )</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> test_config <span class=\"keyword\">is</span> <span class=\"literal\">None</span>:</span><br><span class=\"line\">        <span class=\"comment\"># Load the instance config, if it exists, when not testing</span></span><br><span class=\"line\">        app.config.from_pyfile(<span class=\"string\">&#x27;config.py&#x27;</span>, silent = <span class=\"literal\">True</span>)</span><br><span class=\"line\">    <span class=\"keyword\">else</span>:</span><br><span class=\"line\">        <span class=\"comment\"># Load the test config if passed in</span></span><br><span class=\"line\">        app.config.from_mapping(test_config)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># ensure the instance folder exists</span></span><br><span class=\"line\">    <span class=\"keyword\">try</span>:</span><br><span class=\"line\">        os.makedirs(app.instance_path)</span><br><span class=\"line\">    <span class=\"keyword\">except</span> OSError:</span><br><span class=\"line\">        <span class=\"keyword\">pass</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># a simple page that says hello</span></span><br><span class=\"line\"><span class=\"meta\">    @app.route(<span class=\"params\"><span class=\"string\">&#x27;/hello&#x27;</span></span>)</span></span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">hello</span>():</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&#x27;Hello, World!&#x27;</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">return</span> app</span><br></pre></td></tr></table></figure>\n\n<p><code>create_app</code> 是一个应用工厂函数。你将在教程后面添加它，但它已经做了很多事儿。</p>\n<ol>\n<li><p><code>app = Flask(__name__, instance_relative_config = True)</code> 创建了 Flask 实例。</p>\n<ul>\n<li><code>__name__</code> 是当前 python 模块的名字。这个 app 需要知道它的位置来设置一些路径。并且 <code>__name__</code> 是一种很方便告诉它的方式；</li>\n<li><code>instance_relative_config</code> 告诉 app 配置文件是相对于实例文件夹的。实例文件夹位于flaskr包之外，可以保存不应该提交给版本控制的本地数据，例如配置秘密和数据库文件。</li>\n</ul>\n</li>\n<li><p><code>app.config.from_mapping()</code> 设置了 app 的一些默认配置：</p>\n<ul>\n<li><code>SECRET_KEY</code> 被用来保证数据安全。它被设置为‘dev’，以便在开发期间提供一个方便的值，但在部署时应该使用随机值覆盖它；</li>\n<li><code>DATABASE</code> 是 SQLite 数据库将被保存的位置。它在 <code>app.instance_path</code> 之下，这是Flask为实例文件夹选择的路径。</li>\n</ul>\n</li>\n<li><p><code>app.config.from_pyfile()</code> 使用从实例文件夹中的config.py文件（如果存在）获取的值覆盖默认配置。例如，在部署时，可以使用它来设置一个真正的SECRET_KEY。</p>\n<ul>\n<li><code>Test_config</code> 也可以传递给工厂，并代替实例配置使用。</li>\n</ul>\n</li>\n<li><p><code>os.makedir</code> 确保 <code>app.instance_path</code> 存在，Flask 不会自动创建实例文件夹，但是它需要被创建因为当前的项目将创建数据库文件。</p>\n</li>\n<li><p><code>app.route</code> 创建了一个简单的路由，在深入后面教程之前我们可以看见应用是工作的。它创建了一个在 URL 和返回了响应的应用之间的连接。</p>\n</li>\n</ol>\n<h2 id=\"Run-The-Application\"><a href=\"#Run-The-Application\" class=\"headerlink\" title=\"Run The Application\"></a>Run The Application</h2><p>现在可以使用flask命令运行应用程序了。在终端中，告诉Flask在哪里可以找到您的应用程序，然后在调试模式下运行它。记住，您仍然应该在顶层的flask-tutorial目录中，而不是在flask包中。</p>\n<p>调试模式在页面引发异常时显示交互式调试器，并在更改代码时重新启动服务器。您可以让它继续运行，只要按照本教程重新加载浏览器页面即可。</p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">flask <span class=\"literal\">--app</span> flaskr run <span class=\"literal\">--debug</span></span><br><span class=\"line\"></span><br><span class=\"line\">* Serving Flask app <span class=\"string\">&quot;flaskr&quot;</span></span><br><span class=\"line\">* Debug mode: on</span><br><span class=\"line\">* Running on http://<span class=\"number\">127.0</span>.<span class=\"number\">0.1</span>:<span class=\"number\">5000</span>/ (Press CTRL+C to quit)</span><br><span class=\"line\">* Restarting with stat</span><br><span class=\"line\">* Debugger is active!</span><br><span class=\"line\">* Debugger PIN: nnn<span class=\"literal\">-nnn-nnn</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Define-and-Access-the-Database\"><a href=\"#Define-and-Access-the-Database\" class=\"headerlink\" title=\"Define and Access the Database\"></a>Define and Access the Database</h2><p>SQLite 很方便因为它不需要设置一个独立的数据库服务，它是在 python 中编译的。但是，如果并发请求试图同时写入数据库，它们将会变慢，因为每次写入都是顺序进行的。小型应用程序不会注意到这一点。当您的企业规模扩大后，您可能希望切换到不同的数据库。</p>\n<h3 id=\"Connect-to-the-Database\"><a href=\"#Connect-to-the-Database\" class=\"headerlink\" title=\"Connect to the Database\"></a>Connect to the Database</h3><p>使用 SQLite 数据库（以及大多数其他Python数据库库）时要做的第一件事是创建到它的连接。任何查询和操作都使用连接执行，该连接在工作完成后关闭。</p>\n<p>在 web 应用程序中，这种连接通常与请求绑定在一起。它是在处理请求时创建的，并在发送响应之前关闭。</p>\n<blockquote>\n<p>flaskr&#x2F;db.py</p>\n</blockquote>\n<figure class=\"highlight py\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> sqlite3</span><br><span class=\"line\"><span class=\"keyword\">from</span> datetime <span class=\"keyword\">import</span> datetime</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> click</span><br><span class=\"line\"><span class=\"keyword\">from</span> flask <span class=\"keyword\">import</span> current_app, g</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">get_db</span>():</span><br><span class=\"line\">    <span class=\"keyword\">if</span> <span class=\"string\">&#x27;db&#x27;</span> <span class=\"keyword\">not</span> <span class=\"keyword\">in</span> g:</span><br><span class=\"line\">        g.db = sqlite3.connect(</span><br><span class=\"line\">            current_app.config[<span class=\"string\">&#x27;DATABASE&#x27;</span>],</span><br><span class=\"line\">            detect_types=sqlite3.PARSE_DECLTYPES</span><br><span class=\"line\">        )</span><br><span class=\"line\">        g.db.row_factory = sqlite3.Row</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> g.db</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">close_db</span>(<span class=\"params\">e=<span class=\"literal\">None</span></span>):</span><br><span class=\"line\">    db = g.pop(<span class=\"string\">&#x27;db&#x27;</span>, <span class=\"literal\">None</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> db <span class=\"keyword\">is</span> <span class=\"keyword\">not</span> <span class=\"literal\">None</span>:</span><br><span class=\"line\">        db.close()</span><br></pre></td></tr></table></figure>\n\n<p><strong>g</strong> 是一个对于每个请求都唯一的对象。它用于存储在请求期间可能被多个函数访问的数据。如果在同一请求中第二次调用get_db，则存储并重用该连接，而不是创建新连接。</p>\n<p><strong>current_app</strong> 是另一个特殊对象，指向处理请求的Flask应用程序。由于使用了应用程序工厂，因此在编写其余代码时没有应用程序对象。Get_db将在创建应用程序并处理请求时调用，因此可以使用current_app。</p>\n<p><strong>sqlite3.connect()</strong> 建立到DATABASE配置键所指向的文件的连接。这个文件并不一定要存在，直到稍后初始化数据库时才会存在。</p>\n<p><strong>sqlite3.Row</strong> 告诉连接返回行为类似字典的行。这允许按名称访问列。</p>\n<p><strong>close_db</strong> 通过检查是否设置了g.db来检查是否创建了连接。如果连接存在，则关闭该连接。接下来，您将告诉应用程序有关应用程序工厂中的close_db函数，以便在每次请求之后调用它。</p>\n<h3 id=\"Create-the-Tables\"><a href=\"#Create-the-Tables\" class=\"headerlink\" title=\"Create the Tables\"></a>Create the Tables</h3><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">DROP</span> <span class=\"keyword\">TABLE</span> IF <span class=\"keyword\">EXISTS</span> <span class=\"keyword\">user</span>;</span><br><span class=\"line\"><span class=\"keyword\">DROP</span> <span class=\"keyword\">TABLE</span> IF <span class=\"keyword\">EXISTS</span> post;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">CREATE TABLE</span> <span class=\"keyword\">user</span> (</span><br><span class=\"line\">  id <span class=\"type\">INTEGER</span> <span class=\"keyword\">PRIMARY KEY</span> AUTOINCREMENT,</span><br><span class=\"line\">  username TEXT <span class=\"keyword\">UNIQUE</span> <span class=\"keyword\">NOT NULL</span>,</span><br><span class=\"line\">  password TEXT <span class=\"keyword\">NOT NULL</span></span><br><span class=\"line\">);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">CREATE TABLE</span> post (</span><br><span class=\"line\">  id <span class=\"type\">INTEGER</span> <span class=\"keyword\">PRIMARY KEY</span> AUTOINCREMENT,</span><br><span class=\"line\">  author_id <span class=\"type\">INTEGER</span> <span class=\"keyword\">NOT NULL</span>,</span><br><span class=\"line\">  created <span class=\"type\">TIMESTAMP</span> <span class=\"keyword\">NOT NULL</span> <span class=\"keyword\">DEFAULT</span> <span class=\"built_in\">CURRENT_TIMESTAMP</span>,</span><br><span class=\"line\">  title TEXT <span class=\"keyword\">NOT NULL</span>,</span><br><span class=\"line\">  body TEXT <span class=\"keyword\">NOT NULL</span>,</span><br><span class=\"line\">  <span class=\"keyword\">FOREIGN KEY</span> (author_id) <span class=\"keyword\">REFERENCES</span> <span class=\"keyword\">user</span> (id)</span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure>\n\n<p>往 <code>db.py</code> 放入 python 方法用于运行 SQL 命令。</p>\n<figure class=\"highlight py\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">init_db</span>():</span><br><span class=\"line\">    db = get_db()</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">with</span> current_app.open_resource(<span class=\"string\">&#x27;schema.sql&#x27;</span>) <span class=\"keyword\">as</span> f:</span><br><span class=\"line\">        db.executescript(f.read().decode(<span class=\"string\">&#x27;utf8&#x27;</span>))</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@click.command(<span class=\"params\"><span class=\"string\">&#x27;init-db&#x27;</span></span>)</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">init_db_command</span>():</span><br><span class=\"line\">    init_db()</span><br><span class=\"line\">    click.echo(<span class=\"string\">&#x27;Initialized the database.&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">sqlite3.register_converter(</span><br><span class=\"line\">    <span class=\"string\">&quot;timestamp&quot;</span>, <span class=\"keyword\">lambda</span> v: datetime.fromisoformat(v.decode())</span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure>\n\n<p><code>Open_resource（）</code>打开一个相对于flask包的文件，这很有用，因为在以后部署应用程序时，您不一定知道该位置在哪里。Get_db返回一个数据库连接，用于执行从文件中读取的命令。</p>\n<p><code>command（）</code>定义了一个名为init-db的命令行命令，该命令调用init_db函数并向用户显示成功消息。您可以阅读命令行接口来了解更多关于编写命令的信息。</p>\n<p>调用<code>sqlite3.register_converter（）</code>告诉Python如何解释数据库中的时间戳值。我们将该值转换为datetime.datetime。</p>\n<h3 id=\"Register-with-the-Application\"><a href=\"#Register-with-the-Application\" class=\"headerlink\" title=\"Register with the Application\"></a>Register with the Application</h3><p><code>close_db</code>和<code>init_db_command</code>函数需要在应用实例中注册；否则，它们将不会被应用程序使用。但是，由于使用的是工厂函数，因此在编写函数时该实例不可用。相反，应该编写一个函数，它接受一个应用程序并进行注册。</p>\n<figure class=\"highlight py\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">init_app</span>(<span class=\"params\">app</span>):</span><br><span class=\"line\">    app.teardown_appcontext(close_db)</span><br><span class=\"line\">    app.cli.add_command(init_db_command)</span><br></pre></td></tr></table></figure>\n\n<p><code>app.teardown_appcontext（）</code>告诉Flask在返回响应后进行清理时调用该函数。</p>\n<p><code>App.cli.add_command（）</code>添加了一个可以通过flask命令调用的新命令。</p>\n<p>从工厂导入并调用这个函数。在返回应用程序之前，将新代码放在工厂函数的末尾。</p>\n<figure class=\"highlight py\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># a simple page that says hello</span></span><br><span class=\"line\"><span class=\"meta\">@app.route(<span class=\"params\"><span class=\"string\">&#x27;/hello/&#x27;</span></span>)</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">hello</span>():</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">&#x27;Hello, World!&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Initialize-the-Database-File\"><a href=\"#Initialize-the-Database-File\" class=\"headerlink\" title=\"Initialize the Database File\"></a>Initialize the Database File</h3><p>现在init-db已经注册到应用程序中，可以使用flask命令调用它，类似于上一页中的run命令。</p>\n<blockquote>\n<p>如果您仍在运行上一页中的服务器，您可以停止服务器，或者在新的终端中运行此命令。如果您使用一个新的终端，请记住切换到您的项目目录并激活env，如安装中所述。</p>\n</blockquote>\n<p>运行<code>init-db</code>命令：</p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">flask <span class=\"literal\">--app</span> flaskr init<span class=\"literal\">-db</span></span><br></pre></td></tr></table></figure>\n\n<p>将会有一个 <code>flaskr.sqlite</code> 文件出现在项目的<code>instance</code>目录中</p>\n","excerpt":"","more":"<h1 id=\"Flask-Tutorial\"><a href=\"#Flask-Tutorial\" class=\"headerlink\" title=\"Flask Tutorial\"></a>Flask Tutorial</h1><h2 id=\"Project-Layout\"><a href=\"#Project-Layout\" class=\"headerlink\" title=\"Project Layout\"></a>Project Layout</h2><p>创建一个项目文件夹然后打开。</p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir flask<span class=\"literal\">-tutorial</span> <span class=\"comment\"># 创建 flask 项目文件夹</span></span><br><span class=\"line\"><span class=\"built_in\">cd</span> flask<span class=\"literal\">-tutorial</span></span><br></pre></td></tr></table></figure>\n\n<p>按照 <a href=\"https://1yaowei0.github.io/2025/01/07/ai-plateform-flask/\">Flask Overview</a> 设置项目目录。</p>\n<hr>\n<p>一个大的<strong>flask</strong>项目，不可以将所有的代码放到一个文件。<strong>Python</strong>项目使用<em>package</em>将代码组织成多个模块，这些模块可以在需要的地方导入。</p>\n<p>这个项目应该包含：</p>\n<ul>\n<li><code>flaskr/</code>, 一个包含应用代码和文件的 python 包；</li>\n<li><code>tests/</code>, 一个包含测试模块的目录；</li>\n<li><code>.venv/</code>, 一个包含 flask 和其它已安装依赖的虚拟环境；</li>\n<li>一个告诉 python 如何安装项目的安装文件；</li>\n<li>版本控制配置，如 git。无论项目大小，你都应该养成对所有项目使用某种版本控制的习惯；</li>\n<li>如何可能在未来添加到项目的文件。</li>\n</ul>\n<p>最后，一个项目的结构应该如下：</p>\n<figure class=\"highlight txt\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/home/user/Projects/flask-tutorial</span><br><span class=\"line\">├── flaskr/</span><br><span class=\"line\">│   ├── __init__.py</span><br><span class=\"line\">│   ├── db.py</span><br><span class=\"line\">│   ├── schema.sql</span><br><span class=\"line\">│   ├── auth.py</span><br><span class=\"line\">│   ├── blog.py</span><br><span class=\"line\">│   ├── templates/</span><br><span class=\"line\">│   │   ├── base.html</span><br><span class=\"line\">│   │   ├── auth/</span><br><span class=\"line\">│   │   │   ├── login.html</span><br><span class=\"line\">│   │   │   └── register.html</span><br><span class=\"line\">│   │   └── blog/</span><br><span class=\"line\">│   │       ├── create.html</span><br><span class=\"line\">│   │       ├── index.html</span><br><span class=\"line\">│   │       └── update.html</span><br><span class=\"line\">│   └── static/</span><br><span class=\"line\">│       └── style.css</span><br><span class=\"line\">├── tests/</span><br><span class=\"line\">│   ├── conftest.py</span><br><span class=\"line\">│   ├── data.sql</span><br><span class=\"line\">│   ├── test_factory.py</span><br><span class=\"line\">│   ├── test_db.py</span><br><span class=\"line\">│   ├── test_auth.py</span><br><span class=\"line\">│   └── test_blog.py</span><br><span class=\"line\">├── .venv/</span><br><span class=\"line\">├── pyproject.toml</span><br><span class=\"line\">└── MANIFEST.in</span><br></pre></td></tr></table></figure>\n\n<p>如果使用版本控制，可以如下设置。下列被指定的路径将会被版本控制忽略，即使它在项目的开发过程中被修改。</p>\n<figure class=\"highlight txt\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">.gitignore</span><br><span class=\"line\">.venv/</span><br><span class=\"line\"></span><br><span class=\"line\">*.pyc</span><br><span class=\"line\">__pycache__/</span><br><span class=\"line\"></span><br><span class=\"line\">instance/</span><br><span class=\"line\"></span><br><span class=\"line\">.pytest_cache/</span><br><span class=\"line\">.coverage</span><br><span class=\"line\">htmlcov/</span><br><span class=\"line\"></span><br><span class=\"line\">dist/</span><br><span class=\"line\">build/</span><br><span class=\"line\">*.egg-info/</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Application-Setup\"><a href=\"#Application-Setup\" class=\"headerlink\" title=\"Application Setup\"></a>Application Setup</h2><p>一个 Flask 应用是一个 Flask 类的实例。任何与该应用相关的配置，URLs 都会在这个类中被注册。</p>\n<p>创建 Flask 引用的最直截了当的方式是在你代码的目录顶部创建一个全局的 Flask 实例。</p>\n<p>你将在一个函数中创建它，而不是全局地创建 Flask 的引用（实例）。这个函数称为 <em>应用工厂</em>。任何配置，注册和其它应用所需的设置都需要在这个函数中发生，然后返回该应用。</p>\n<h3 id=\"The-Application-Factory\"><a href=\"#The-Application-Factory\" class=\"headerlink\" title=\"The Application Factory\"></a>The Application Factory</h3><p>在 flaskr 目录下添加 <code>__init__.py</code> 文件，它有双重的职责，它将包含应用工厂，以及它告诉 python 这个 flaskr 目录应该被当作一个包。</p>\n<figure class=\"highlight py\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> os</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">from</span> flask <span class=\"keyword\">import</span> Flask</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">create_app</span>(<span class=\"params\">test_config = <span class=\"literal\">None</span></span>):</span><br><span class=\"line\">    <span class=\"comment\"># Create and configue the app</span></span><br><span class=\"line\">    app = Flask(__name__, instance_relative_config = <span class=\"literal\">True</span>)</span><br><span class=\"line\">    app.config.from_mapping(</span><br><span class=\"line\">        SECRET_KEY = <span class=\"string\">&#x27;dev&#x27;</span>,</span><br><span class=\"line\">        DATABASE = os.path.join(app.instance_path, <span class=\"string\">&#x27;flaskr.sqlite&#x27;</span>)</span><br><span class=\"line\">    )</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> test_config <span class=\"keyword\">is</span> <span class=\"literal\">None</span>:</span><br><span class=\"line\">        <span class=\"comment\"># Load the instance config, if it exists, when not testing</span></span><br><span class=\"line\">        app.config.from_pyfile(<span class=\"string\">&#x27;config.py&#x27;</span>, silent = <span class=\"literal\">True</span>)</span><br><span class=\"line\">    <span class=\"keyword\">else</span>:</span><br><span class=\"line\">        <span class=\"comment\"># Load the test config if passed in</span></span><br><span class=\"line\">        app.config.from_mapping(test_config)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># ensure the instance folder exists</span></span><br><span class=\"line\">    <span class=\"keyword\">try</span>:</span><br><span class=\"line\">        os.makedirs(app.instance_path)</span><br><span class=\"line\">    <span class=\"keyword\">except</span> OSError:</span><br><span class=\"line\">        <span class=\"keyword\">pass</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># a simple page that says hello</span></span><br><span class=\"line\"><span class=\"meta\">    @app.route(<span class=\"params\"><span class=\"string\">&#x27;/hello&#x27;</span></span>)</span></span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">hello</span>():</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&#x27;Hello, World!&#x27;</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">return</span> app</span><br></pre></td></tr></table></figure>\n\n<p><code>create_app</code> 是一个应用工厂函数。你将在教程后面添加它，但它已经做了很多事儿。</p>\n<ol>\n<li><p><code>app = Flask(__name__, instance_relative_config = True)</code> 创建了 Flask 实例。</p>\n<ul>\n<li><code>__name__</code> 是当前 python 模块的名字。这个 app 需要知道它的位置来设置一些路径。并且 <code>__name__</code> 是一种很方便告诉它的方式；</li>\n<li><code>instance_relative_config</code> 告诉 app 配置文件是相对于实例文件夹的。实例文件夹位于flaskr包之外，可以保存不应该提交给版本控制的本地数据，例如配置秘密和数据库文件。</li>\n</ul>\n</li>\n<li><p><code>app.config.from_mapping()</code> 设置了 app 的一些默认配置：</p>\n<ul>\n<li><code>SECRET_KEY</code> 被用来保证数据安全。它被设置为‘dev’，以便在开发期间提供一个方便的值，但在部署时应该使用随机值覆盖它；</li>\n<li><code>DATABASE</code> 是 SQLite 数据库将被保存的位置。它在 <code>app.instance_path</code> 之下，这是Flask为实例文件夹选择的路径。</li>\n</ul>\n</li>\n<li><p><code>app.config.from_pyfile()</code> 使用从实例文件夹中的config.py文件（如果存在）获取的值覆盖默认配置。例如，在部署时，可以使用它来设置一个真正的SECRET_KEY。</p>\n<ul>\n<li><code>Test_config</code> 也可以传递给工厂，并代替实例配置使用。</li>\n</ul>\n</li>\n<li><p><code>os.makedir</code> 确保 <code>app.instance_path</code> 存在，Flask 不会自动创建实例文件夹，但是它需要被创建因为当前的项目将创建数据库文件。</p>\n</li>\n<li><p><code>app.route</code> 创建了一个简单的路由，在深入后面教程之前我们可以看见应用是工作的。它创建了一个在 URL 和返回了响应的应用之间的连接。</p>\n</li>\n</ol>\n<h2 id=\"Run-The-Application\"><a href=\"#Run-The-Application\" class=\"headerlink\" title=\"Run The Application\"></a>Run The Application</h2><p>现在可以使用flask命令运行应用程序了。在终端中，告诉Flask在哪里可以找到您的应用程序，然后在调试模式下运行它。记住，您仍然应该在顶层的flask-tutorial目录中，而不是在flask包中。</p>\n<p>调试模式在页面引发异常时显示交互式调试器，并在更改代码时重新启动服务器。您可以让它继续运行，只要按照本教程重新加载浏览器页面即可。</p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">flask <span class=\"literal\">--app</span> flaskr run <span class=\"literal\">--debug</span></span><br><span class=\"line\"></span><br><span class=\"line\">* Serving Flask app <span class=\"string\">&quot;flaskr&quot;</span></span><br><span class=\"line\">* Debug mode: on</span><br><span class=\"line\">* Running on http://<span class=\"number\">127.0</span>.<span class=\"number\">0.1</span>:<span class=\"number\">5000</span>/ (Press CTRL+C to quit)</span><br><span class=\"line\">* Restarting with stat</span><br><span class=\"line\">* Debugger is active!</span><br><span class=\"line\">* Debugger PIN: nnn<span class=\"literal\">-nnn-nnn</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Define-and-Access-the-Database\"><a href=\"#Define-and-Access-the-Database\" class=\"headerlink\" title=\"Define and Access the Database\"></a>Define and Access the Database</h2><p>SQLite 很方便因为它不需要设置一个独立的数据库服务，它是在 python 中编译的。但是，如果并发请求试图同时写入数据库，它们将会变慢，因为每次写入都是顺序进行的。小型应用程序不会注意到这一点。当您的企业规模扩大后，您可能希望切换到不同的数据库。</p>\n<h3 id=\"Connect-to-the-Database\"><a href=\"#Connect-to-the-Database\" class=\"headerlink\" title=\"Connect to the Database\"></a>Connect to the Database</h3><p>使用 SQLite 数据库（以及大多数其他Python数据库库）时要做的第一件事是创建到它的连接。任何查询和操作都使用连接执行，该连接在工作完成后关闭。</p>\n<p>在 web 应用程序中，这种连接通常与请求绑定在一起。它是在处理请求时创建的，并在发送响应之前关闭。</p>\n<blockquote>\n<p>flaskr&#x2F;db.py</p>\n</blockquote>\n<figure class=\"highlight py\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> sqlite3</span><br><span class=\"line\"><span class=\"keyword\">from</span> datetime <span class=\"keyword\">import</span> datetime</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> click</span><br><span class=\"line\"><span class=\"keyword\">from</span> flask <span class=\"keyword\">import</span> current_app, g</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">get_db</span>():</span><br><span class=\"line\">    <span class=\"keyword\">if</span> <span class=\"string\">&#x27;db&#x27;</span> <span class=\"keyword\">not</span> <span class=\"keyword\">in</span> g:</span><br><span class=\"line\">        g.db = sqlite3.connect(</span><br><span class=\"line\">            current_app.config[<span class=\"string\">&#x27;DATABASE&#x27;</span>],</span><br><span class=\"line\">            detect_types=sqlite3.PARSE_DECLTYPES</span><br><span class=\"line\">        )</span><br><span class=\"line\">        g.db.row_factory = sqlite3.Row</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> g.db</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">close_db</span>(<span class=\"params\">e=<span class=\"literal\">None</span></span>):</span><br><span class=\"line\">    db = g.pop(<span class=\"string\">&#x27;db&#x27;</span>, <span class=\"literal\">None</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> db <span class=\"keyword\">is</span> <span class=\"keyword\">not</span> <span class=\"literal\">None</span>:</span><br><span class=\"line\">        db.close()</span><br></pre></td></tr></table></figure>\n\n<p><strong>g</strong> 是一个对于每个请求都唯一的对象。它用于存储在请求期间可能被多个函数访问的数据。如果在同一请求中第二次调用get_db，则存储并重用该连接，而不是创建新连接。</p>\n<p><strong>current_app</strong> 是另一个特殊对象，指向处理请求的Flask应用程序。由于使用了应用程序工厂，因此在编写其余代码时没有应用程序对象。Get_db将在创建应用程序并处理请求时调用，因此可以使用current_app。</p>\n<p><strong>sqlite3.connect()</strong> 建立到DATABASE配置键所指向的文件的连接。这个文件并不一定要存在，直到稍后初始化数据库时才会存在。</p>\n<p><strong>sqlite3.Row</strong> 告诉连接返回行为类似字典的行。这允许按名称访问列。</p>\n<p><strong>close_db</strong> 通过检查是否设置了g.db来检查是否创建了连接。如果连接存在，则关闭该连接。接下来，您将告诉应用程序有关应用程序工厂中的close_db函数，以便在每次请求之后调用它。</p>\n<h3 id=\"Create-the-Tables\"><a href=\"#Create-the-Tables\" class=\"headerlink\" title=\"Create the Tables\"></a>Create the Tables</h3><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">DROP</span> <span class=\"keyword\">TABLE</span> IF <span class=\"keyword\">EXISTS</span> <span class=\"keyword\">user</span>;</span><br><span class=\"line\"><span class=\"keyword\">DROP</span> <span class=\"keyword\">TABLE</span> IF <span class=\"keyword\">EXISTS</span> post;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">CREATE TABLE</span> <span class=\"keyword\">user</span> (</span><br><span class=\"line\">  id <span class=\"type\">INTEGER</span> <span class=\"keyword\">PRIMARY KEY</span> AUTOINCREMENT,</span><br><span class=\"line\">  username TEXT <span class=\"keyword\">UNIQUE</span> <span class=\"keyword\">NOT NULL</span>,</span><br><span class=\"line\">  password TEXT <span class=\"keyword\">NOT NULL</span></span><br><span class=\"line\">);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">CREATE TABLE</span> post (</span><br><span class=\"line\">  id <span class=\"type\">INTEGER</span> <span class=\"keyword\">PRIMARY KEY</span> AUTOINCREMENT,</span><br><span class=\"line\">  author_id <span class=\"type\">INTEGER</span> <span class=\"keyword\">NOT NULL</span>,</span><br><span class=\"line\">  created <span class=\"type\">TIMESTAMP</span> <span class=\"keyword\">NOT NULL</span> <span class=\"keyword\">DEFAULT</span> <span class=\"built_in\">CURRENT_TIMESTAMP</span>,</span><br><span class=\"line\">  title TEXT <span class=\"keyword\">NOT NULL</span>,</span><br><span class=\"line\">  body TEXT <span class=\"keyword\">NOT NULL</span>,</span><br><span class=\"line\">  <span class=\"keyword\">FOREIGN KEY</span> (author_id) <span class=\"keyword\">REFERENCES</span> <span class=\"keyword\">user</span> (id)</span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure>\n\n<p>往 <code>db.py</code> 放入 python 方法用于运行 SQL 命令。</p>\n<figure class=\"highlight py\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">init_db</span>():</span><br><span class=\"line\">    db = get_db()</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">with</span> current_app.open_resource(<span class=\"string\">&#x27;schema.sql&#x27;</span>) <span class=\"keyword\">as</span> f:</span><br><span class=\"line\">        db.executescript(f.read().decode(<span class=\"string\">&#x27;utf8&#x27;</span>))</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@click.command(<span class=\"params\"><span class=\"string\">&#x27;init-db&#x27;</span></span>)</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">init_db_command</span>():</span><br><span class=\"line\">    init_db()</span><br><span class=\"line\">    click.echo(<span class=\"string\">&#x27;Initialized the database.&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">sqlite3.register_converter(</span><br><span class=\"line\">    <span class=\"string\">&quot;timestamp&quot;</span>, <span class=\"keyword\">lambda</span> v: datetime.fromisoformat(v.decode())</span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure>\n\n<p><code>Open_resource（）</code>打开一个相对于flask包的文件，这很有用，因为在以后部署应用程序时，您不一定知道该位置在哪里。Get_db返回一个数据库连接，用于执行从文件中读取的命令。</p>\n<p><code>command（）</code>定义了一个名为init-db的命令行命令，该命令调用init_db函数并向用户显示成功消息。您可以阅读命令行接口来了解更多关于编写命令的信息。</p>\n<p>调用<code>sqlite3.register_converter（）</code>告诉Python如何解释数据库中的时间戳值。我们将该值转换为datetime.datetime。</p>\n<h3 id=\"Register-with-the-Application\"><a href=\"#Register-with-the-Application\" class=\"headerlink\" title=\"Register with the Application\"></a>Register with the Application</h3><p><code>close_db</code>和<code>init_db_command</code>函数需要在应用实例中注册；否则，它们将不会被应用程序使用。但是，由于使用的是工厂函数，因此在编写函数时该实例不可用。相反，应该编写一个函数，它接受一个应用程序并进行注册。</p>\n<figure class=\"highlight py\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">init_app</span>(<span class=\"params\">app</span>):</span><br><span class=\"line\">    app.teardown_appcontext(close_db)</span><br><span class=\"line\">    app.cli.add_command(init_db_command)</span><br></pre></td></tr></table></figure>\n\n<p><code>app.teardown_appcontext（）</code>告诉Flask在返回响应后进行清理时调用该函数。</p>\n<p><code>App.cli.add_command（）</code>添加了一个可以通过flask命令调用的新命令。</p>\n<p>从工厂导入并调用这个函数。在返回应用程序之前，将新代码放在工厂函数的末尾。</p>\n<figure class=\"highlight py\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># a simple page that says hello</span></span><br><span class=\"line\"><span class=\"meta\">@app.route(<span class=\"params\"><span class=\"string\">&#x27;/hello/&#x27;</span></span>)</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">hello</span>():</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">&#x27;Hello, World!&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Initialize-the-Database-File\"><a href=\"#Initialize-the-Database-File\" class=\"headerlink\" title=\"Initialize the Database File\"></a>Initialize the Database File</h3><p>现在init-db已经注册到应用程序中，可以使用flask命令调用它，类似于上一页中的run命令。</p>\n<blockquote>\n<p>如果您仍在运行上一页中的服务器，您可以停止服务器，或者在新的终端中运行此命令。如果您使用一个新的终端，请记住切换到您的项目目录并激活env，如安装中所述。</p>\n</blockquote>\n<p>运行<code>init-db</code>命令：</p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">flask <span class=\"literal\">--app</span> flaskr init<span class=\"literal\">-db</span></span><br></pre></td></tr></table></figure>\n\n<p>将会有一个 <code>flaskr.sqlite</code> 文件出现在项目的<code>instance</code>目录中</p>\n"},{"title":"Site building tutorial","description":"This is a hexo demo article hexo + github page","comments":1,"_content":"Welcome to [Hexo](https://hexo.io/)! This is your very first post. Check [documentation](https://hexo.io/docs/) for more info. If you get any problems when using Hexo, you can find the answer in [troubleshooting](https://hexo.io/docs/troubleshooting.html) or you can ask me on [GitHub](https://github.com/hexojs/hexo/issues).\n\n## Quick Start\n\n### Create a new post\n\n``` bash\n$ hexo new \"My New Post\"\n```\n\nMore info: [Writing](https://hexo.io/docs/writing.html)\n\n### Run server\n\n``` bash\n$ hexo server\n```\n\nMore info: [Server](https://hexo.io/docs/server.html)\n\n### Generate static files\n\n``` bash\n$ hexo generate\n```\n\nMore info: [Generating](https://hexo.io/docs/generating.html)\n\n### Deploy to remote sites\n\n``` bash\n$ hexo deploy\n```\n\nMore info: [Deployment](https://hexo.io/docs/one-command-deployment.html)\n\n### Enable comments for site\n\nWe can use the utterances for implementing comments function. More info: [utterances](https://utteranc.es/)\n\nAdd the following script in the theme config.yml\n\n```yml\nutteranc:\n  enable: true\n  repo: user_name/repo_name # Github repository owner and name\n  # Available values: pathname | url | title | og:title\n  issue_term: pathname\n  # Available values: github-light | github-dark | preferred-color-scheme | github-dark-orange | icy-dark | dark-blue | photon-dark | boxy-light\n  theme: github-dark\n```\n\n​Additionally, we must edit the following property like the following:​\n\n```yml\n# Multiple Comment System Support\ncomments:\n  # Available values: tabs | buttons\n  style: tabs\n  # Choose a comment system to be displayed by default.\n  # Available values: disqus | disqusjs | changyan | livere | gitalk | utterances\n  active: utterances\n  # Setting `true` means remembering the comment system selected by the visitor.\n  storage: true\n  # Lazyload all comment systems.\n  lazyload: false\n  # Modify texts or order for any naves, here are some examples.\n  nav:\n```","source":"_posts/hello-world.md","raw":"---\ntitle: Site building tutorial\ndescription: This is a hexo demo article hexo + github page\ncomments: true\n---\nWelcome to [Hexo](https://hexo.io/)! This is your very first post. Check [documentation](https://hexo.io/docs/) for more info. If you get any problems when using Hexo, you can find the answer in [troubleshooting](https://hexo.io/docs/troubleshooting.html) or you can ask me on [GitHub](https://github.com/hexojs/hexo/issues).\n\n## Quick Start\n\n### Create a new post\n\n``` bash\n$ hexo new \"My New Post\"\n```\n\nMore info: [Writing](https://hexo.io/docs/writing.html)\n\n### Run server\n\n``` bash\n$ hexo server\n```\n\nMore info: [Server](https://hexo.io/docs/server.html)\n\n### Generate static files\n\n``` bash\n$ hexo generate\n```\n\nMore info: [Generating](https://hexo.io/docs/generating.html)\n\n### Deploy to remote sites\n\n``` bash\n$ hexo deploy\n```\n\nMore info: [Deployment](https://hexo.io/docs/one-command-deployment.html)\n\n### Enable comments for site\n\nWe can use the utterances for implementing comments function. More info: [utterances](https://utteranc.es/)\n\nAdd the following script in the theme config.yml\n\n```yml\nutteranc:\n  enable: true\n  repo: user_name/repo_name # Github repository owner and name\n  # Available values: pathname | url | title | og:title\n  issue_term: pathname\n  # Available values: github-light | github-dark | preferred-color-scheme | github-dark-orange | icy-dark | dark-blue | photon-dark | boxy-light\n  theme: github-dark\n```\n\n​Additionally, we must edit the following property like the following:​\n\n```yml\n# Multiple Comment System Support\ncomments:\n  # Available values: tabs | buttons\n  style: tabs\n  # Choose a comment system to be displayed by default.\n  # Available values: disqus | disqusjs | changyan | livere | gitalk | utterances\n  active: utterances\n  # Setting `true` means remembering the comment system selected by the visitor.\n  storage: true\n  # Lazyload all comment systems.\n  lazyload: false\n  # Modify texts or order for any naves, here are some examples.\n  nav:\n```","slug":"hello-world","published":1,"date":"2025-07-08T12:05:00.538Z","updated":"2025-07-08T12:05:00.538Z","layout":"post","photos":[],"_id":"cmcvxsshp000l3cug17vc2p84","content":"<p>Welcome to <a href=\"https://hexo.io/\">Hexo</a>! This is your very first post. Check <a href=\"https://hexo.io/docs/\">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href=\"https://hexo.io/docs/troubleshooting.html\">troubleshooting</a> or you can ask me on <a href=\"https://github.com/hexojs/hexo/issues\">GitHub</a>.</p>\n<h2 id=\"Quick-Start\"><a href=\"#Quick-Start\" class=\"headerlink\" title=\"Quick Start\"></a>Quick Start</h2><h3 id=\"Create-a-new-post\"><a href=\"#Create-a-new-post\" class=\"headerlink\" title=\"Create a new post\"></a>Create a new post</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo new <span class=\"string\">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/writing.html\">Writing</a></p>\n<h3 id=\"Run-server\"><a href=\"#Run-server\" class=\"headerlink\" title=\"Run server\"></a>Run server</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo server</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/server.html\">Server</a></p>\n<h3 id=\"Generate-static-files\"><a href=\"#Generate-static-files\" class=\"headerlink\" title=\"Generate static files\"></a>Generate static files</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo generate</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/generating.html\">Generating</a></p>\n<h3 id=\"Deploy-to-remote-sites\"><a href=\"#Deploy-to-remote-sites\" class=\"headerlink\" title=\"Deploy to remote sites\"></a>Deploy to remote sites</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo deploy</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/one-command-deployment.html\">Deployment</a></p>\n<h3 id=\"Enable-comments-for-site\"><a href=\"#Enable-comments-for-site\" class=\"headerlink\" title=\"Enable comments for site\"></a>Enable comments for site</h3><p>We can use the utterances for implementing comments function. More info: <a href=\"https://utteranc.es/\">utterances</a></p>\n<p>Add the following script in the theme config.yml</p>\n<figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">utteranc:</span></span><br><span class=\"line\">  <span class=\"attr\">enable:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"attr\">repo:</span> <span class=\"string\">user_name/repo_name</span> <span class=\"comment\"># Github repository owner and name</span></span><br><span class=\"line\">  <span class=\"comment\"># Available values: pathname | url | title | og:title</span></span><br><span class=\"line\">  <span class=\"attr\">issue_term:</span> <span class=\"string\">pathname</span></span><br><span class=\"line\">  <span class=\"comment\"># Available values: github-light | github-dark | preferred-color-scheme | github-dark-orange | icy-dark | dark-blue | photon-dark | boxy-light</span></span><br><span class=\"line\">  <span class=\"attr\">theme:</span> <span class=\"string\">github-dark</span></span><br></pre></td></tr></table></figure>\n\n<p>​Additionally, we must edit the following property like the following:​</p>\n<figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Multiple Comment System Support</span></span><br><span class=\"line\"><span class=\"attr\">comments:</span></span><br><span class=\"line\">  <span class=\"comment\"># Available values: tabs | buttons</span></span><br><span class=\"line\">  <span class=\"attr\">style:</span> <span class=\"string\">tabs</span></span><br><span class=\"line\">  <span class=\"comment\"># Choose a comment system to be displayed by default.</span></span><br><span class=\"line\">  <span class=\"comment\"># Available values: disqus | disqusjs | changyan | livere | gitalk | utterances</span></span><br><span class=\"line\">  <span class=\"attr\">active:</span> <span class=\"string\">utterances</span></span><br><span class=\"line\">  <span class=\"comment\"># Setting `true` means remembering the comment system selected by the visitor.</span></span><br><span class=\"line\">  <span class=\"attr\">storage:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"comment\"># Lazyload all comment systems.</span></span><br><span class=\"line\">  <span class=\"attr\">lazyload:</span> <span class=\"literal\">false</span></span><br><span class=\"line\">  <span class=\"comment\"># Modify texts or order for any naves, here are some examples.</span></span><br><span class=\"line\">  <span class=\"attr\">nav:</span></span><br></pre></td></tr></table></figure>","excerpt":"","more":"<p>Welcome to <a href=\"https://hexo.io/\">Hexo</a>! This is your very first post. Check <a href=\"https://hexo.io/docs/\">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href=\"https://hexo.io/docs/troubleshooting.html\">troubleshooting</a> or you can ask me on <a href=\"https://github.com/hexojs/hexo/issues\">GitHub</a>.</p>\n<h2 id=\"Quick-Start\"><a href=\"#Quick-Start\" class=\"headerlink\" title=\"Quick Start\"></a>Quick Start</h2><h3 id=\"Create-a-new-post\"><a href=\"#Create-a-new-post\" class=\"headerlink\" title=\"Create a new post\"></a>Create a new post</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo new <span class=\"string\">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/writing.html\">Writing</a></p>\n<h3 id=\"Run-server\"><a href=\"#Run-server\" class=\"headerlink\" title=\"Run server\"></a>Run server</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo server</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/server.html\">Server</a></p>\n<h3 id=\"Generate-static-files\"><a href=\"#Generate-static-files\" class=\"headerlink\" title=\"Generate static files\"></a>Generate static files</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo generate</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/generating.html\">Generating</a></p>\n<h3 id=\"Deploy-to-remote-sites\"><a href=\"#Deploy-to-remote-sites\" class=\"headerlink\" title=\"Deploy to remote sites\"></a>Deploy to remote sites</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo deploy</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/one-command-deployment.html\">Deployment</a></p>\n<h3 id=\"Enable-comments-for-site\"><a href=\"#Enable-comments-for-site\" class=\"headerlink\" title=\"Enable comments for site\"></a>Enable comments for site</h3><p>We can use the utterances for implementing comments function. More info: <a href=\"https://utteranc.es/\">utterances</a></p>\n<p>Add the following script in the theme config.yml</p>\n<figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">utteranc:</span></span><br><span class=\"line\">  <span class=\"attr\">enable:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"attr\">repo:</span> <span class=\"string\">user_name/repo_name</span> <span class=\"comment\"># Github repository owner and name</span></span><br><span class=\"line\">  <span class=\"comment\"># Available values: pathname | url | title | og:title</span></span><br><span class=\"line\">  <span class=\"attr\">issue_term:</span> <span class=\"string\">pathname</span></span><br><span class=\"line\">  <span class=\"comment\"># Available values: github-light | github-dark | preferred-color-scheme | github-dark-orange | icy-dark | dark-blue | photon-dark | boxy-light</span></span><br><span class=\"line\">  <span class=\"attr\">theme:</span> <span class=\"string\">github-dark</span></span><br></pre></td></tr></table></figure>\n\n<p>​Additionally, we must edit the following property like the following:​</p>\n<figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Multiple Comment System Support</span></span><br><span class=\"line\"><span class=\"attr\">comments:</span></span><br><span class=\"line\">  <span class=\"comment\"># Available values: tabs | buttons</span></span><br><span class=\"line\">  <span class=\"attr\">style:</span> <span class=\"string\">tabs</span></span><br><span class=\"line\">  <span class=\"comment\"># Choose a comment system to be displayed by default.</span></span><br><span class=\"line\">  <span class=\"comment\"># Available values: disqus | disqusjs | changyan | livere | gitalk | utterances</span></span><br><span class=\"line\">  <span class=\"attr\">active:</span> <span class=\"string\">utterances</span></span><br><span class=\"line\">  <span class=\"comment\"># Setting `true` means remembering the comment system selected by the visitor.</span></span><br><span class=\"line\">  <span class=\"attr\">storage:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"comment\"># Lazyload all comment systems.</span></span><br><span class=\"line\">  <span class=\"attr\">lazyload:</span> <span class=\"literal\">false</span></span><br><span class=\"line\">  <span class=\"comment\"># Modify texts or order for any naves, here are some examples.</span></span><br><span class=\"line\">  <span class=\"attr\">nav:</span></span><br></pre></td></tr></table></figure>"},{"title":"The Way for Clearing the Log Disk","date":"2024-12-23T08:33:47.000Z","comments":1,"description":"This article shows you the sql scripts that cleared the sql log disk.​","_content":"\n{% asset_img \"mssql-clear-log.png\" \"clear mssql clear log example\" %}\n\nThe example SQL script code as shown below:\n\n```sql\nuse [AxDB]\n\nSELECT name FROM sys.database_files\n\nUSE [master]\nGO\nALTER DATABASE [AxDB] SET RECOVERY SIMPLE WITH NO_WAIT\nGO\n\nUSE [AxDB]\nGO\nDBCC SHRINKFILE (AxDB_Restore_log, 1024)\nGO\n\nUSE [master]\nGO\nALTER DATABASE [AxDB] SET RECOVERY FULL WITH NO_WAIT\nGO\n```","source":"_posts/mssql-clear-log.md","raw":"---\ntitle: The Way for Clearing the Log Disk\ndate: 2024-12-23 16:33:47\ncategories:\n - t-sql\ncomments: true\ndescription: This article shows you the sql scripts that cleared the sql log disk.​\n---\n\n{% asset_img \"mssql-clear-log.png\" \"clear mssql clear log example\" %}\n\nThe example SQL script code as shown below:\n\n```sql\nuse [AxDB]\n\nSELECT name FROM sys.database_files\n\nUSE [master]\nGO\nALTER DATABASE [AxDB] SET RECOVERY SIMPLE WITH NO_WAIT\nGO\n\nUSE [AxDB]\nGO\nDBCC SHRINKFILE (AxDB_Restore_log, 1024)\nGO\n\nUSE [master]\nGO\nALTER DATABASE [AxDB] SET RECOVERY FULL WITH NO_WAIT\nGO\n```","slug":"mssql-clear-log","published":1,"updated":"2025-07-08T12:05:00.539Z","layout":"post","photos":[],"_id":"cmcvxsshq000o3cug24x97s9i","content":"<img src=\"/2024/12/23/mssql-clear-log/mssql-clear-log.png\" class=\"\" title=\"clear mssql clear log example\">\n\n<p>The example SQL script code as shown below:</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">use [AxDB]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> name <span class=\"keyword\">FROM</span> sys.database_files</span><br><span class=\"line\"></span><br><span class=\"line\">USE [master]</span><br><span class=\"line\">GO</span><br><span class=\"line\"><span class=\"keyword\">ALTER</span> DATABASE [AxDB] <span class=\"keyword\">SET</span> RECOVERY SIMPLE <span class=\"keyword\">WITH</span> NO_WAIT</span><br><span class=\"line\">GO</span><br><span class=\"line\"></span><br><span class=\"line\">USE [AxDB]</span><br><span class=\"line\">GO</span><br><span class=\"line\">DBCC SHRINKFILE (AxDB_Restore_log, <span class=\"number\">1024</span>)</span><br><span class=\"line\">GO</span><br><span class=\"line\"></span><br><span class=\"line\">USE [master]</span><br><span class=\"line\">GO</span><br><span class=\"line\"><span class=\"keyword\">ALTER</span> DATABASE [AxDB] <span class=\"keyword\">SET</span> RECOVERY <span class=\"keyword\">FULL</span> <span class=\"keyword\">WITH</span> NO_WAIT</span><br><span class=\"line\">GO</span><br></pre></td></tr></table></figure>","excerpt":"","more":"<img src=\"/2024/12/23/mssql-clear-log/mssql-clear-log.png\" class=\"\" title=\"clear mssql clear log example\">\n\n<p>The example SQL script code as shown below:</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">use [AxDB]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> name <span class=\"keyword\">FROM</span> sys.database_files</span><br><span class=\"line\"></span><br><span class=\"line\">USE [master]</span><br><span class=\"line\">GO</span><br><span class=\"line\"><span class=\"keyword\">ALTER</span> DATABASE [AxDB] <span class=\"keyword\">SET</span> RECOVERY SIMPLE <span class=\"keyword\">WITH</span> NO_WAIT</span><br><span class=\"line\">GO</span><br><span class=\"line\"></span><br><span class=\"line\">USE [AxDB]</span><br><span class=\"line\">GO</span><br><span class=\"line\">DBCC SHRINKFILE (AxDB_Restore_log, <span class=\"number\">1024</span>)</span><br><span class=\"line\">GO</span><br><span class=\"line\"></span><br><span class=\"line\">USE [master]</span><br><span class=\"line\">GO</span><br><span class=\"line\"><span class=\"keyword\">ALTER</span> DATABASE [AxDB] <span class=\"keyword\">SET</span> RECOVERY <span class=\"keyword\">FULL</span> <span class=\"keyword\">WITH</span> NO_WAIT</span><br><span class=\"line\">GO</span><br></pre></td></tr></table></figure>"},{"title":"Create ledger journals in D365FO using X++","comments":1,"date":"2025-07-09T11:39:27.000Z","description":"Create ledger journals in D365FO using X++","_content":"\n> Reprinted from: https://denistrunin.com/xpptools-createledgerjournal/\n\nCreating LedgerJournalTrans using X++ is quite a common task, but sometimes I still see some mistakes(mostly related to fields initialization from account/offset account and voucher assignment). In this post, I'll try to describe possible options how to create ledger journals in D365FO.\n\n## Test scenario\n\nTo test different methods, I wrote a Runnable class DEVTutorialCreateLedgerJournal that creates a new journal based on the data from the existing source journal using different methods. The dialog looks like this\n\n{% asset_img \"CopyJournalDialog.png\" \"CopyJournalDialog\" %}\n\nLet's discuss possible copy options(Copy type parameter):\n\n## LedgerJournalEngine class\n\nThis method is using LedgerJournalEngine class - the same class that is used when the user creates a journal manually on the Journal lines form. This increases the chances that the resulting line will be the same as a manually created line.\n\n```c#\nwhile select ledgerJournalTransOrig\n    order by RecId\n            where ledgerJournalTransOrig.JournalNum == _ledgerJournalTableOrig.JournalNum\n{\n    numLines++;\n    if (!ledgerJournalTable.RecId)\n    {\n        //Often journal name from parameters is specified here\n        DEV::validateCursorField(ledgerJournalName, fieldNum(LedgerJournalName, JournalName));\n\n        ledgerJournalTable.clear();\n        ledgerJournalTable.initValue();\n        ledgerJournalTable.JournalName = ledgerJournalName.JournalName;\n        ledgerJournalTable.initFromLedgerJournalName();\n        ledgerJournalTable.JournalNum = JournalTableData::newTable(ledgerJournalTable).nextJournalId();\n        ledgerJournalTable.Name = strFmt(\"Copy of %1, Date %2\", _ledgerJournalTableOrig.JournalNum, DEV::systemdateget());\n        ledgerJournalTable.insert();\n\n        info(strFmt(\"Journal %1 created\", ledgerJournalTable.JournalNum));\n\n        ledgerJournalEngine = LedgerJournalEngine::construct(ledgerJournalTable.JournalType);\n        ledgerJournalEngine.newJournalActive(ledgerJournalTable);    }\n\n    ledgerJournalTrans.clear();\n    ledgerJournalTrans.initValue();\n    ledgerJournalEngine.initValue(ledgerJournalTrans);\n    ledgerJournalTrans.JournalNum           =   ledgerJournalTable.JournalNum;\n    ledgerJournalTrans.TransDate            =   DEV::systemdateget();\n    ledgerJournalTrans.AccountType          =   ledgerJournalTransOrig.AccountType;\n    ledgerJournalTrans.modifiedField(fieldNum(LedgerJournalTrans, AccountType));\n\n    ledgerJournalTrans.LedgerDimension = ledgerJournalTransOrig.LedgerDimension;\n    if (!ledgerJournalTrans.LedgerDimension)\n    {\n        throw error(\"Missing or invalid ledger dimension for journal process\");\n    }\n    ledgerJournalTrans.modifiedField(fieldNum(LedgerJournalTrans, LedgerDimension));\n    ledgerJournalEngine.accountModified(LedgerJournalTrans);\n    ledgerJournalTrans.OffsetAccountType = ledgerJournalTransOrig.OffsetAccountType;\n    ledgerJournalTrans.modifiedField(fieldNum(LedgerJournalTrans, OffsetAccountType));\n    ledgerJournalTrans.OffsetLedgerDimension = ledgerJournalTransOrig.OffsetLedgerDimension;\n    ledgerJournalTrans.modifiedField(fieldNum(LedgerJournalTrans, OffsetLedgerDimension));\n    ledgerJournalEngine.offsetAccountModified(ledgerJournalTrans);\n\n    //amounts\n    LedgerJournalTrans.CurrencyCode         =   ledgerJournalTransOrig.CurrencyCode;\n    ledgerJournalEngine.currencyModified(LedgerJournalTrans);\n    LedgerJournalTrans.AmountCurCredit      =   ledgerJournalTransOrig.AmountCurCredit;\n    LedgerJournalTrans.AmountCurDebit       =   ledgerJournalTransOrig.AmountCurDebit;\n\n    //additional fields\n    LedgerJournalTrans.Approver           = HcmWorker::userId2Worker(curuserid());\n    LedgerJournalTrans.Approved           = NoYes::Yes;\n    ledgerJournalTrans.Txt                = ledgerJournalTransOrig.Txt;\n    LedgerJournalTrans.SkipBlockedForManualEntryCheck = true;\n\n    DEV::validateWriteRecordCheck(ledgerJournalTrans);\n    ledgerJournalTrans.insert();\n    ledgerJournalEngine.write(ledgerJournalTrans);}\n```\n\nWhen you modify Account/Offset account fields in this example you need to call two methods(on ledgerJournalTrans and ledgerJournalEngine). This ensures that the line will be properly initialized from the Account/Offset account field.\n\n```c#\nledgerJournalTrans.modifiedField(fieldNum(LedgerJournalTrans, LedgerDimension));  \nledgerJournalEngine.accountModified(LedgerJournalTrans);\n```\n\nVoucher assignment here is processing in ledgerJournalEngine.write().\n\nAlso, an interesting flag here is LedgerJournalTrans.SkipBlockedForManualEntryCheck. It is useful when you don't want to allow users to create manually lines with the same accounts as in your procedure.\n\n## LedgerJournalTrans defaultRow() method\n\nThis is a new approach in D365FO and it uses a new defaultRow() table method. Data entities also call this method during the import process. Its idea is that we don't control the sequence of different modifiedField method calls, we just populate the fields that we know, all other logic happens in the defaultRow() method.\n\nCode for journal creation in this case:\n\n```c#\nwhile select ledgerJournalTransOrig\n    order by RecId\n    where ledgerJournalTransOrig.JournalNum == _ledgerJournalTableOrig.JournalNum\n{\n    numLines++;\n\n    if (!ledgerJournalTable.RecId)\n    {\n        ledgerJournalTable.clear();\n        ledgerJournalTable.initValue();\n        ledgerJournalTable.JournalName = _ledgerJournalTableOrig.JournalName;\n        ledgerJournalTable.initFromLedgerJournalName();\n        ledgerJournalTable.JournalNum = JournalTableData::newTable(ledgerJournalTable).nextJournalId();\n        ledgerJournalTable.Name = strFmt(\"Copy of %1, Date %2\", _ledgerJournalTableOrig.JournalNum, DEV::systemdateget());\n        ledgerJournalTable.insert();\n\n        info(strFmt(\"Journal %1 created\", ledgerJournalTable.JournalNum));\n    }\n\n    ledgerJournalTrans.clear();\n    ledgerJournalTrans.initValue();\n\n    ledgerJournalTrans.JournalNum             = ledgerJournalTable.JournalNum;\n    ledgerJournalTrans.TransDate              = DEV::systemdateget();\n    ledgerJournalTrans.AccountType            = ledgerJournalTransOrig.AccountType;\n    ledgerJournalTrans.LedgerDimension        = ledgerJournalTransOrig.LedgerDimension;\n    ledgerJournalTrans.DefaultDimension       = ledgerJournalTransOrig.DefaultDimension;\n\n    ledgerJournalTrans.OffsetAccountType      = ledgerJournalTransOrig.OffsetAccountType;\n    ledgerJournalTrans.OffsetLedgerDimension  = ledgerJournalTransOrig.OffsetLedgerDimension;\n    ledgerJournalTrans.OffsetDefaultDimension = ledgerJournalTransOrig.OffsetDefaultDimension;\n\n    ledgerJournalTrans.CurrencyCode           =   ledgerJournalTransOrig.CurrencyCode;\n    ledgerJournalTrans.AmountCurCredit        =   ledgerJournalTransOrig.AmountCurCredit;\n    ledgerJournalTrans.AmountCurDebit         =   ledgerJournalTransOrig.AmountCurDebit;\n\n    //addition fields\n    ledgerJournalTrans.Approver           = HcmWorker::userId2Worker(curuserid());\n    ledgerJournalTrans.Approved           = NoYes::Yes;\n    ledgerJournalTrans.Txt                = ledgerJournalTransOrig.Txt;\n    ledgerJournalTrans.SkipBlockedForManualEntryCheck = true;\n\n    ledgerJournalTrans.defaultRow();\n    DEV::validateWriteRecordCheck(ledgerJournalTrans);\n    ledgerJournalTrans.insert();\n}\n```\n\nYou can find an example of this approach in the MCRLedgerJournal class (and the usage is here)\n\n## Data entity\n\nWe can also use a data entity for journal creation. Technically it produces the same result as the previous method because a data entity at the end will call a table defaultRow() method.\n\n```c#\nwhile select ledgerJournalTransOrig\n    order by RecId\n    where ledgerJournalTransOrig.JournalNum == _ledgerJournalTableOrig.JournalNum\n{\n    numLines++;\n    select dimensionCombinationEntity\n        where dimensionCombinationEntity.RecId == ledgerJournalTransOrig.LedgerDimension;\n    select dimensionCombinationEntityOffset\n        where dimensionCombinationEntityOffset.RecId == ledgerJournalTransOrig.OffsetLedgerDimension;\n\n    ledgerJournalEntity.initValue();\n    ledgerJournalEntity.JournalBatchNumber     = journalNum;\n    ledgerJournalEntity.Description            = strFmt(\"Copy of %1, Date %2\", _ledgerJournalTableOrig.JournalNum, DEV::systemdateget());\n    ledgerJournalEntity.JournalName            = _ledgerJournalTableOrig.JournalName;\n    ledgerJournalEntity.LineNumber++;\n\n    //if you have string and want to convert to ID - DimensionDefaultResolver::newResolver(_dimensionDisplayValue).resolve();\n    //AX > General ledge > Chart of accounts > Dimensions > Financial dimension configuration for integrating applications\n    ledgerJournalEntity.AccountType                 = ledgerJournalTransOrig.AccountType;\n    ledgerJournalEntity.AccountDisplayValue         = dimensionCombinationEntity.DisplayValue;\n\n    ledgerJournalEntity.OffsetAccountType           = ledgerJournalTransOrig.OffsetAccountType;\n    ledgerJournalEntity.OffsetAccountDisplayValue   = dimensionCombinationEntityOffset.DisplayValue;\n\n    ledgerJournalEntity.CreditAmount                = ledgerJournalTransOrig.AmountCurCredit;\n    ledgerJournalEntity.DebitAmount                 = ledgerJournalTransOrig.AmountCurDebit;\n    ledgerJournalEntity.CurrencyCode                = ledgerJournalTransOrig.CurrencyCode;\n    ledgerJournalEntity.TEXT                        = ledgerJournalTransOrig.Txt;\n    ledgerJournalEntity.TRANSDATE                   = ledgerJournalTransOrig.TransDate;\n\n    ledgerJournalEntity.defaultRow();\n    DEV::validateWriteRecordCheck(ledgerJournalEntity);\n    ledgerJournalEntity.insert();\n\n    journalNum = ledgerJournalEntity.JournalBatchNumber;\n}\n```\n\nAs you see this method requires less code: we don't even need to write code for the journal header creation, it is all handled by the data entity insert() method. Dimensions can be also specified as strings. However there are some limitations: sometimes data entity doesn't contain all the table fields and it doesn't support all account types.\n\n## Performance testing\n\nLet's test the performance. First I created a test journal with the 1000 lines(**createByCombination method**) and then copied it using these 3 different methods. I got the following results:\n\n|Method|Time to create 1000 lines(sec)|\n|-|-|\n|Using ledgerJournalEngine|30.54|\n|Using DataEntity|33.09|\n|Using Table defaultRow method|15.18|\n\nThere are some differences between the copy speed in my example, but it is caused by a different logic for the dimension creation, so the result is that all methods are almost equal and quite fast. In a real-life scenario, you can expect an insert speed 10-30 lines per second.\n\n## Choosing the right method and things to avoid\n\nIn general, you have 2 options - to create a journal similar to the manual user entry or create it similar to the import procedure(for the second scenario choice between entity and table mostly depends on what input data you have and whether the entity supports all the required fields). So the choice between these two should be made by answering the question: if the user wants to create the same journal manually, does he use manual entry or data import? Use [createJournalUsingLedgerJournalEngine](https://github.com/TrudAX/XppTools/blob/3d69455f4b8157bc28bfc9560e9f70c8bacd634a/DEVTutorial/DEVTutorial/AxClass/DEVTutorialCreateLedgerJournal.xml#L196) as default, as it is more flexible.\n\nProbably in D365FO it is better to avoid creation using JournalTransData classes or when you simply populate ledgerJournalTrans fields and call insert(). This initially can work, but later users may complain - e.g. \"*Why when I create a journal manually and specify a vendor account the Due date field is calculated, but your procedure doesn't fill it*\".\n\n## Summary\n\nYou can download this class using the following link [createJournalUsingLedgerJournalEngine](https://github.com/TrudAX/XppTools/blob/master/DEVTutorial/DEVTutorial/AxClass/DEVTutorialCreateLedgerJournal.xml). The idea is that you can use this code as a template when you have a task to create(or post) a ledger journal using X++. Comments are welcome.","source":"_posts/xpp-createledgerjournals.md","raw":"---\ntitle: Create ledger journals in D365FO using X++\ncomments: true\ndate: 2025-07-09 19:39:27\ntags:\n - LedgerJournalTrans\ncategories:\n - x++\ndescription: Create ledger journals in D365FO using X++\n---\n\n> Reprinted from: https://denistrunin.com/xpptools-createledgerjournal/\n\nCreating LedgerJournalTrans using X++ is quite a common task, but sometimes I still see some mistakes(mostly related to fields initialization from account/offset account and voucher assignment). In this post, I'll try to describe possible options how to create ledger journals in D365FO.\n\n## Test scenario\n\nTo test different methods, I wrote a Runnable class DEVTutorialCreateLedgerJournal that creates a new journal based on the data from the existing source journal using different methods. The dialog looks like this\n\n{% asset_img \"CopyJournalDialog.png\" \"CopyJournalDialog\" %}\n\nLet's discuss possible copy options(Copy type parameter):\n\n## LedgerJournalEngine class\n\nThis method is using LedgerJournalEngine class - the same class that is used when the user creates a journal manually on the Journal lines form. This increases the chances that the resulting line will be the same as a manually created line.\n\n```c#\nwhile select ledgerJournalTransOrig\n    order by RecId\n            where ledgerJournalTransOrig.JournalNum == _ledgerJournalTableOrig.JournalNum\n{\n    numLines++;\n    if (!ledgerJournalTable.RecId)\n    {\n        //Often journal name from parameters is specified here\n        DEV::validateCursorField(ledgerJournalName, fieldNum(LedgerJournalName, JournalName));\n\n        ledgerJournalTable.clear();\n        ledgerJournalTable.initValue();\n        ledgerJournalTable.JournalName = ledgerJournalName.JournalName;\n        ledgerJournalTable.initFromLedgerJournalName();\n        ledgerJournalTable.JournalNum = JournalTableData::newTable(ledgerJournalTable).nextJournalId();\n        ledgerJournalTable.Name = strFmt(\"Copy of %1, Date %2\", _ledgerJournalTableOrig.JournalNum, DEV::systemdateget());\n        ledgerJournalTable.insert();\n\n        info(strFmt(\"Journal %1 created\", ledgerJournalTable.JournalNum));\n\n        ledgerJournalEngine = LedgerJournalEngine::construct(ledgerJournalTable.JournalType);\n        ledgerJournalEngine.newJournalActive(ledgerJournalTable);    }\n\n    ledgerJournalTrans.clear();\n    ledgerJournalTrans.initValue();\n    ledgerJournalEngine.initValue(ledgerJournalTrans);\n    ledgerJournalTrans.JournalNum           =   ledgerJournalTable.JournalNum;\n    ledgerJournalTrans.TransDate            =   DEV::systemdateget();\n    ledgerJournalTrans.AccountType          =   ledgerJournalTransOrig.AccountType;\n    ledgerJournalTrans.modifiedField(fieldNum(LedgerJournalTrans, AccountType));\n\n    ledgerJournalTrans.LedgerDimension = ledgerJournalTransOrig.LedgerDimension;\n    if (!ledgerJournalTrans.LedgerDimension)\n    {\n        throw error(\"Missing or invalid ledger dimension for journal process\");\n    }\n    ledgerJournalTrans.modifiedField(fieldNum(LedgerJournalTrans, LedgerDimension));\n    ledgerJournalEngine.accountModified(LedgerJournalTrans);\n    ledgerJournalTrans.OffsetAccountType = ledgerJournalTransOrig.OffsetAccountType;\n    ledgerJournalTrans.modifiedField(fieldNum(LedgerJournalTrans, OffsetAccountType));\n    ledgerJournalTrans.OffsetLedgerDimension = ledgerJournalTransOrig.OffsetLedgerDimension;\n    ledgerJournalTrans.modifiedField(fieldNum(LedgerJournalTrans, OffsetLedgerDimension));\n    ledgerJournalEngine.offsetAccountModified(ledgerJournalTrans);\n\n    //amounts\n    LedgerJournalTrans.CurrencyCode         =   ledgerJournalTransOrig.CurrencyCode;\n    ledgerJournalEngine.currencyModified(LedgerJournalTrans);\n    LedgerJournalTrans.AmountCurCredit      =   ledgerJournalTransOrig.AmountCurCredit;\n    LedgerJournalTrans.AmountCurDebit       =   ledgerJournalTransOrig.AmountCurDebit;\n\n    //additional fields\n    LedgerJournalTrans.Approver           = HcmWorker::userId2Worker(curuserid());\n    LedgerJournalTrans.Approved           = NoYes::Yes;\n    ledgerJournalTrans.Txt                = ledgerJournalTransOrig.Txt;\n    LedgerJournalTrans.SkipBlockedForManualEntryCheck = true;\n\n    DEV::validateWriteRecordCheck(ledgerJournalTrans);\n    ledgerJournalTrans.insert();\n    ledgerJournalEngine.write(ledgerJournalTrans);}\n```\n\nWhen you modify Account/Offset account fields in this example you need to call two methods(on ledgerJournalTrans and ledgerJournalEngine). This ensures that the line will be properly initialized from the Account/Offset account field.\n\n```c#\nledgerJournalTrans.modifiedField(fieldNum(LedgerJournalTrans, LedgerDimension));  \nledgerJournalEngine.accountModified(LedgerJournalTrans);\n```\n\nVoucher assignment here is processing in ledgerJournalEngine.write().\n\nAlso, an interesting flag here is LedgerJournalTrans.SkipBlockedForManualEntryCheck. It is useful when you don't want to allow users to create manually lines with the same accounts as in your procedure.\n\n## LedgerJournalTrans defaultRow() method\n\nThis is a new approach in D365FO and it uses a new defaultRow() table method. Data entities also call this method during the import process. Its idea is that we don't control the sequence of different modifiedField method calls, we just populate the fields that we know, all other logic happens in the defaultRow() method.\n\nCode for journal creation in this case:\n\n```c#\nwhile select ledgerJournalTransOrig\n    order by RecId\n    where ledgerJournalTransOrig.JournalNum == _ledgerJournalTableOrig.JournalNum\n{\n    numLines++;\n\n    if (!ledgerJournalTable.RecId)\n    {\n        ledgerJournalTable.clear();\n        ledgerJournalTable.initValue();\n        ledgerJournalTable.JournalName = _ledgerJournalTableOrig.JournalName;\n        ledgerJournalTable.initFromLedgerJournalName();\n        ledgerJournalTable.JournalNum = JournalTableData::newTable(ledgerJournalTable).nextJournalId();\n        ledgerJournalTable.Name = strFmt(\"Copy of %1, Date %2\", _ledgerJournalTableOrig.JournalNum, DEV::systemdateget());\n        ledgerJournalTable.insert();\n\n        info(strFmt(\"Journal %1 created\", ledgerJournalTable.JournalNum));\n    }\n\n    ledgerJournalTrans.clear();\n    ledgerJournalTrans.initValue();\n\n    ledgerJournalTrans.JournalNum             = ledgerJournalTable.JournalNum;\n    ledgerJournalTrans.TransDate              = DEV::systemdateget();\n    ledgerJournalTrans.AccountType            = ledgerJournalTransOrig.AccountType;\n    ledgerJournalTrans.LedgerDimension        = ledgerJournalTransOrig.LedgerDimension;\n    ledgerJournalTrans.DefaultDimension       = ledgerJournalTransOrig.DefaultDimension;\n\n    ledgerJournalTrans.OffsetAccountType      = ledgerJournalTransOrig.OffsetAccountType;\n    ledgerJournalTrans.OffsetLedgerDimension  = ledgerJournalTransOrig.OffsetLedgerDimension;\n    ledgerJournalTrans.OffsetDefaultDimension = ledgerJournalTransOrig.OffsetDefaultDimension;\n\n    ledgerJournalTrans.CurrencyCode           =   ledgerJournalTransOrig.CurrencyCode;\n    ledgerJournalTrans.AmountCurCredit        =   ledgerJournalTransOrig.AmountCurCredit;\n    ledgerJournalTrans.AmountCurDebit         =   ledgerJournalTransOrig.AmountCurDebit;\n\n    //addition fields\n    ledgerJournalTrans.Approver           = HcmWorker::userId2Worker(curuserid());\n    ledgerJournalTrans.Approved           = NoYes::Yes;\n    ledgerJournalTrans.Txt                = ledgerJournalTransOrig.Txt;\n    ledgerJournalTrans.SkipBlockedForManualEntryCheck = true;\n\n    ledgerJournalTrans.defaultRow();\n    DEV::validateWriteRecordCheck(ledgerJournalTrans);\n    ledgerJournalTrans.insert();\n}\n```\n\nYou can find an example of this approach in the MCRLedgerJournal class (and the usage is here)\n\n## Data entity\n\nWe can also use a data entity for journal creation. Technically it produces the same result as the previous method because a data entity at the end will call a table defaultRow() method.\n\n```c#\nwhile select ledgerJournalTransOrig\n    order by RecId\n    where ledgerJournalTransOrig.JournalNum == _ledgerJournalTableOrig.JournalNum\n{\n    numLines++;\n    select dimensionCombinationEntity\n        where dimensionCombinationEntity.RecId == ledgerJournalTransOrig.LedgerDimension;\n    select dimensionCombinationEntityOffset\n        where dimensionCombinationEntityOffset.RecId == ledgerJournalTransOrig.OffsetLedgerDimension;\n\n    ledgerJournalEntity.initValue();\n    ledgerJournalEntity.JournalBatchNumber     = journalNum;\n    ledgerJournalEntity.Description            = strFmt(\"Copy of %1, Date %2\", _ledgerJournalTableOrig.JournalNum, DEV::systemdateget());\n    ledgerJournalEntity.JournalName            = _ledgerJournalTableOrig.JournalName;\n    ledgerJournalEntity.LineNumber++;\n\n    //if you have string and want to convert to ID - DimensionDefaultResolver::newResolver(_dimensionDisplayValue).resolve();\n    //AX > General ledge > Chart of accounts > Dimensions > Financial dimension configuration for integrating applications\n    ledgerJournalEntity.AccountType                 = ledgerJournalTransOrig.AccountType;\n    ledgerJournalEntity.AccountDisplayValue         = dimensionCombinationEntity.DisplayValue;\n\n    ledgerJournalEntity.OffsetAccountType           = ledgerJournalTransOrig.OffsetAccountType;\n    ledgerJournalEntity.OffsetAccountDisplayValue   = dimensionCombinationEntityOffset.DisplayValue;\n\n    ledgerJournalEntity.CreditAmount                = ledgerJournalTransOrig.AmountCurCredit;\n    ledgerJournalEntity.DebitAmount                 = ledgerJournalTransOrig.AmountCurDebit;\n    ledgerJournalEntity.CurrencyCode                = ledgerJournalTransOrig.CurrencyCode;\n    ledgerJournalEntity.TEXT                        = ledgerJournalTransOrig.Txt;\n    ledgerJournalEntity.TRANSDATE                   = ledgerJournalTransOrig.TransDate;\n\n    ledgerJournalEntity.defaultRow();\n    DEV::validateWriteRecordCheck(ledgerJournalEntity);\n    ledgerJournalEntity.insert();\n\n    journalNum = ledgerJournalEntity.JournalBatchNumber;\n}\n```\n\nAs you see this method requires less code: we don't even need to write code for the journal header creation, it is all handled by the data entity insert() method. Dimensions can be also specified as strings. However there are some limitations: sometimes data entity doesn't contain all the table fields and it doesn't support all account types.\n\n## Performance testing\n\nLet's test the performance. First I created a test journal with the 1000 lines(**createByCombination method**) and then copied it using these 3 different methods. I got the following results:\n\n|Method|Time to create 1000 lines(sec)|\n|-|-|\n|Using ledgerJournalEngine|30.54|\n|Using DataEntity|33.09|\n|Using Table defaultRow method|15.18|\n\nThere are some differences between the copy speed in my example, but it is caused by a different logic for the dimension creation, so the result is that all methods are almost equal and quite fast. In a real-life scenario, you can expect an insert speed 10-30 lines per second.\n\n## Choosing the right method and things to avoid\n\nIn general, you have 2 options - to create a journal similar to the manual user entry or create it similar to the import procedure(for the second scenario choice between entity and table mostly depends on what input data you have and whether the entity supports all the required fields). So the choice between these two should be made by answering the question: if the user wants to create the same journal manually, does he use manual entry or data import? Use [createJournalUsingLedgerJournalEngine](https://github.com/TrudAX/XppTools/blob/3d69455f4b8157bc28bfc9560e9f70c8bacd634a/DEVTutorial/DEVTutorial/AxClass/DEVTutorialCreateLedgerJournal.xml#L196) as default, as it is more flexible.\n\nProbably in D365FO it is better to avoid creation using JournalTransData classes or when you simply populate ledgerJournalTrans fields and call insert(). This initially can work, but later users may complain - e.g. \"*Why when I create a journal manually and specify a vendor account the Due date field is calculated, but your procedure doesn't fill it*\".\n\n## Summary\n\nYou can download this class using the following link [createJournalUsingLedgerJournalEngine](https://github.com/TrudAX/XppTools/blob/master/DEVTutorial/DEVTutorial/AxClass/DEVTutorialCreateLedgerJournal.xml). The idea is that you can use this code as a template when you have a task to create(or post) a ledger journal using X++. Comments are welcome.","slug":"xpp-createledgerjournals","published":1,"updated":"2025-07-09T12:08:41.439Z","layout":"post","photos":[],"_id":"cmcvxsshq000p3cug0wg33dj8","content":"<blockquote>\n<p>Reprinted from: <a href=\"https://denistrunin.com/xpptools-createledgerjournal/\">https://denistrunin.com/xpptools-createledgerjournal/</a></p>\n</blockquote>\n<p>Creating LedgerJournalTrans using X++ is quite a common task, but sometimes I still see some mistakes(mostly related to fields initialization from account&#x2F;offset account and voucher assignment). In this post, I’ll try to describe possible options how to create ledger journals in D365FO.</p>\n<h2 id=\"Test-scenario\"><a href=\"#Test-scenario\" class=\"headerlink\" title=\"Test scenario\"></a>Test scenario</h2><p>To test different methods, I wrote a Runnable class DEVTutorialCreateLedgerJournal that creates a new journal based on the data from the existing source journal using different methods. The dialog looks like this</p>\n<img src=\"/2025/07/09/xpp-createledgerjournals/CopyJournalDialog.png\" class=\"\" title=\"CopyJournalDialog\">\n\n<p>Let’s discuss possible copy options(Copy type parameter):</p>\n<h2 id=\"LedgerJournalEngine-class\"><a href=\"#LedgerJournalEngine-class\" class=\"headerlink\" title=\"LedgerJournalEngine class\"></a>LedgerJournalEngine class</h2><p>This method is using LedgerJournalEngine class - the same class that is used when the user creates a journal manually on the Journal lines form. This increases the chances that the resulting line will be the same as a manually created line.</p>\n<figure class=\"highlight c#\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">while</span> <span class=\"keyword\">select</span> ledgerJournalTransOrig</span><br><span class=\"line\">    order <span class=\"keyword\">by</span> RecId</span><br><span class=\"line\">            <span class=\"keyword\">where</span> ledgerJournalTransOrig.JournalNum == _ledgerJournalTableOrig.JournalNum</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    numLines++;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!ledgerJournalTable.RecId)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"comment\">//Often journal name from parameters is specified here</span></span><br><span class=\"line\">        DEV::validateCursorField(ledgerJournalName, fieldNum(LedgerJournalName, JournalName));</span><br><span class=\"line\"></span><br><span class=\"line\">        ledgerJournalTable.clear();</span><br><span class=\"line\">        ledgerJournalTable.initValue();</span><br><span class=\"line\">        ledgerJournalTable.JournalName = ledgerJournalName.JournalName;</span><br><span class=\"line\">        ledgerJournalTable.initFromLedgerJournalName();</span><br><span class=\"line\">        ledgerJournalTable.JournalNum = JournalTableData::newTable(ledgerJournalTable).nextJournalId();</span><br><span class=\"line\">        ledgerJournalTable.Name = strFmt(<span class=\"string\">&quot;Copy of %1, Date %2&quot;</span>, _ledgerJournalTableOrig.JournalNum, DEV::systemdateget());</span><br><span class=\"line\">        ledgerJournalTable.insert();</span><br><span class=\"line\"></span><br><span class=\"line\">        info(strFmt(<span class=\"string\">&quot;Journal %1 created&quot;</span>, ledgerJournalTable.JournalNum));</span><br><span class=\"line\"></span><br><span class=\"line\">        ledgerJournalEngine = LedgerJournalEngine::construct(ledgerJournalTable.JournalType);</span><br><span class=\"line\">        ledgerJournalEngine.newJournalActive(ledgerJournalTable);    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    ledgerJournalTrans.clear();</span><br><span class=\"line\">    ledgerJournalTrans.initValue();</span><br><span class=\"line\">    ledgerJournalEngine.initValue(ledgerJournalTrans);</span><br><span class=\"line\">    ledgerJournalTrans.JournalNum           =   ledgerJournalTable.JournalNum;</span><br><span class=\"line\">    ledgerJournalTrans.TransDate            =   DEV::systemdateget();</span><br><span class=\"line\">    ledgerJournalTrans.AccountType          =   ledgerJournalTransOrig.AccountType;</span><br><span class=\"line\">    ledgerJournalTrans.modifiedField(fieldNum(LedgerJournalTrans, AccountType));</span><br><span class=\"line\"></span><br><span class=\"line\">    ledgerJournalTrans.LedgerDimension = ledgerJournalTransOrig.LedgerDimension;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!ledgerJournalTrans.LedgerDimension)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> error(<span class=\"string\">&quot;Missing or invalid ledger dimension for journal process&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    ledgerJournalTrans.modifiedField(fieldNum(LedgerJournalTrans, LedgerDimension));</span><br><span class=\"line\">    ledgerJournalEngine.accountModified(LedgerJournalTrans);</span><br><span class=\"line\">    ledgerJournalTrans.OffsetAccountType = ledgerJournalTransOrig.OffsetAccountType;</span><br><span class=\"line\">    ledgerJournalTrans.modifiedField(fieldNum(LedgerJournalTrans, OffsetAccountType));</span><br><span class=\"line\">    ledgerJournalTrans.OffsetLedgerDimension = ledgerJournalTransOrig.OffsetLedgerDimension;</span><br><span class=\"line\">    ledgerJournalTrans.modifiedField(fieldNum(LedgerJournalTrans, OffsetLedgerDimension));</span><br><span class=\"line\">    ledgerJournalEngine.offsetAccountModified(ledgerJournalTrans);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//amounts</span></span><br><span class=\"line\">    LedgerJournalTrans.CurrencyCode         =   ledgerJournalTransOrig.CurrencyCode;</span><br><span class=\"line\">    ledgerJournalEngine.currencyModified(LedgerJournalTrans);</span><br><span class=\"line\">    LedgerJournalTrans.AmountCurCredit      =   ledgerJournalTransOrig.AmountCurCredit;</span><br><span class=\"line\">    LedgerJournalTrans.AmountCurDebit       =   ledgerJournalTransOrig.AmountCurDebit;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//additional fields</span></span><br><span class=\"line\">    LedgerJournalTrans.Approver           = HcmWorker::userId2Worker(curuserid());</span><br><span class=\"line\">    LedgerJournalTrans.Approved           = NoYes::Yes;</span><br><span class=\"line\">    ledgerJournalTrans.Txt                = ledgerJournalTransOrig.Txt;</span><br><span class=\"line\">    LedgerJournalTrans.SkipBlockedForManualEntryCheck = <span class=\"literal\">true</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    DEV::validateWriteRecordCheck(ledgerJournalTrans);</span><br><span class=\"line\">    ledgerJournalTrans.insert();</span><br><span class=\"line\">    ledgerJournalEngine.write(ledgerJournalTrans);&#125;</span><br></pre></td></tr></table></figure>\n\n<p>When you modify Account&#x2F;Offset account fields in this example you need to call two methods(on ledgerJournalTrans and ledgerJournalEngine). This ensures that the line will be properly initialized from the Account&#x2F;Offset account field.</p>\n<figure class=\"highlight c#\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ledgerJournalTrans.modifiedField(fieldNum(LedgerJournalTrans, LedgerDimension));  </span><br><span class=\"line\">ledgerJournalEngine.accountModified(LedgerJournalTrans);</span><br></pre></td></tr></table></figure>\n\n<p>Voucher assignment here is processing in ledgerJournalEngine.write().</p>\n<p>Also, an interesting flag here is LedgerJournalTrans.SkipBlockedForManualEntryCheck. It is useful when you don’t want to allow users to create manually lines with the same accounts as in your procedure.</p>\n<h2 id=\"LedgerJournalTrans-defaultRow-method\"><a href=\"#LedgerJournalTrans-defaultRow-method\" class=\"headerlink\" title=\"LedgerJournalTrans defaultRow() method\"></a>LedgerJournalTrans defaultRow() method</h2><p>This is a new approach in D365FO and it uses a new defaultRow() table method. Data entities also call this method during the import process. Its idea is that we don’t control the sequence of different modifiedField method calls, we just populate the fields that we know, all other logic happens in the defaultRow() method.</p>\n<p>Code for journal creation in this case:</p>\n<figure class=\"highlight c#\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">while</span> <span class=\"keyword\">select</span> ledgerJournalTransOrig</span><br><span class=\"line\">    order <span class=\"keyword\">by</span> RecId</span><br><span class=\"line\">    <span class=\"keyword\">where</span> ledgerJournalTransOrig.JournalNum == _ledgerJournalTableOrig.JournalNum</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    numLines++;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!ledgerJournalTable.RecId)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        ledgerJournalTable.clear();</span><br><span class=\"line\">        ledgerJournalTable.initValue();</span><br><span class=\"line\">        ledgerJournalTable.JournalName = _ledgerJournalTableOrig.JournalName;</span><br><span class=\"line\">        ledgerJournalTable.initFromLedgerJournalName();</span><br><span class=\"line\">        ledgerJournalTable.JournalNum = JournalTableData::newTable(ledgerJournalTable).nextJournalId();</span><br><span class=\"line\">        ledgerJournalTable.Name = strFmt(<span class=\"string\">&quot;Copy of %1, Date %2&quot;</span>, _ledgerJournalTableOrig.JournalNum, DEV::systemdateget());</span><br><span class=\"line\">        ledgerJournalTable.insert();</span><br><span class=\"line\"></span><br><span class=\"line\">        info(strFmt(<span class=\"string\">&quot;Journal %1 created&quot;</span>, ledgerJournalTable.JournalNum));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    ledgerJournalTrans.clear();</span><br><span class=\"line\">    ledgerJournalTrans.initValue();</span><br><span class=\"line\"></span><br><span class=\"line\">    ledgerJournalTrans.JournalNum             = ledgerJournalTable.JournalNum;</span><br><span class=\"line\">    ledgerJournalTrans.TransDate              = DEV::systemdateget();</span><br><span class=\"line\">    ledgerJournalTrans.AccountType            = ledgerJournalTransOrig.AccountType;</span><br><span class=\"line\">    ledgerJournalTrans.LedgerDimension        = ledgerJournalTransOrig.LedgerDimension;</span><br><span class=\"line\">    ledgerJournalTrans.DefaultDimension       = ledgerJournalTransOrig.DefaultDimension;</span><br><span class=\"line\"></span><br><span class=\"line\">    ledgerJournalTrans.OffsetAccountType      = ledgerJournalTransOrig.OffsetAccountType;</span><br><span class=\"line\">    ledgerJournalTrans.OffsetLedgerDimension  = ledgerJournalTransOrig.OffsetLedgerDimension;</span><br><span class=\"line\">    ledgerJournalTrans.OffsetDefaultDimension = ledgerJournalTransOrig.OffsetDefaultDimension;</span><br><span class=\"line\"></span><br><span class=\"line\">    ledgerJournalTrans.CurrencyCode           =   ledgerJournalTransOrig.CurrencyCode;</span><br><span class=\"line\">    ledgerJournalTrans.AmountCurCredit        =   ledgerJournalTransOrig.AmountCurCredit;</span><br><span class=\"line\">    ledgerJournalTrans.AmountCurDebit         =   ledgerJournalTransOrig.AmountCurDebit;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//addition fields</span></span><br><span class=\"line\">    ledgerJournalTrans.Approver           = HcmWorker::userId2Worker(curuserid());</span><br><span class=\"line\">    ledgerJournalTrans.Approved           = NoYes::Yes;</span><br><span class=\"line\">    ledgerJournalTrans.Txt                = ledgerJournalTransOrig.Txt;</span><br><span class=\"line\">    ledgerJournalTrans.SkipBlockedForManualEntryCheck = <span class=\"literal\">true</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    ledgerJournalTrans.defaultRow();</span><br><span class=\"line\">    DEV::validateWriteRecordCheck(ledgerJournalTrans);</span><br><span class=\"line\">    ledgerJournalTrans.insert();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>You can find an example of this approach in the MCRLedgerJournal class (and the usage is here)</p>\n<h2 id=\"Data-entity\"><a href=\"#Data-entity\" class=\"headerlink\" title=\"Data entity\"></a>Data entity</h2><p>We can also use a data entity for journal creation. Technically it produces the same result as the previous method because a data entity at the end will call a table defaultRow() method.</p>\n<figure class=\"highlight c#\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">while</span> <span class=\"keyword\">select</span> ledgerJournalTransOrig</span><br><span class=\"line\">    order <span class=\"keyword\">by</span> RecId</span><br><span class=\"line\">    <span class=\"keyword\">where</span> ledgerJournalTransOrig.JournalNum == _ledgerJournalTableOrig.JournalNum</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    numLines++;</span><br><span class=\"line\">    <span class=\"keyword\">select</span> dimensionCombinationEntity</span><br><span class=\"line\">        <span class=\"keyword\">where</span> dimensionCombinationEntity.RecId == ledgerJournalTransOrig.LedgerDimension;</span><br><span class=\"line\">    <span class=\"keyword\">select</span> dimensionCombinationEntityOffset</span><br><span class=\"line\">        <span class=\"keyword\">where</span> dimensionCombinationEntityOffset.RecId == ledgerJournalTransOrig.OffsetLedgerDimension;</span><br><span class=\"line\"></span><br><span class=\"line\">    ledgerJournalEntity.initValue();</span><br><span class=\"line\">    ledgerJournalEntity.JournalBatchNumber     = journalNum;</span><br><span class=\"line\">    ledgerJournalEntity.Description            = strFmt(<span class=\"string\">&quot;Copy of %1, Date %2&quot;</span>, _ledgerJournalTableOrig.JournalNum, DEV::systemdateget());</span><br><span class=\"line\">    ledgerJournalEntity.JournalName            = _ledgerJournalTableOrig.JournalName;</span><br><span class=\"line\">    ledgerJournalEntity.LineNumber++;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//if you have string and want to convert to ID - DimensionDefaultResolver::newResolver(_dimensionDisplayValue).resolve();</span></span><br><span class=\"line\">    <span class=\"comment\">//AX &gt; General ledge &gt; Chart of accounts &gt; Dimensions &gt; Financial dimension configuration for integrating applications</span></span><br><span class=\"line\">    ledgerJournalEntity.AccountType                 = ledgerJournalTransOrig.AccountType;</span><br><span class=\"line\">    ledgerJournalEntity.AccountDisplayValue         = dimensionCombinationEntity.DisplayValue;</span><br><span class=\"line\"></span><br><span class=\"line\">    ledgerJournalEntity.OffsetAccountType           = ledgerJournalTransOrig.OffsetAccountType;</span><br><span class=\"line\">    ledgerJournalEntity.OffsetAccountDisplayValue   = dimensionCombinationEntityOffset.DisplayValue;</span><br><span class=\"line\"></span><br><span class=\"line\">    ledgerJournalEntity.CreditAmount                = ledgerJournalTransOrig.AmountCurCredit;</span><br><span class=\"line\">    ledgerJournalEntity.DebitAmount                 = ledgerJournalTransOrig.AmountCurDebit;</span><br><span class=\"line\">    ledgerJournalEntity.CurrencyCode                = ledgerJournalTransOrig.CurrencyCode;</span><br><span class=\"line\">    ledgerJournalEntity.TEXT                        = ledgerJournalTransOrig.Txt;</span><br><span class=\"line\">    ledgerJournalEntity.TRANSDATE                   = ledgerJournalTransOrig.TransDate;</span><br><span class=\"line\"></span><br><span class=\"line\">    ledgerJournalEntity.defaultRow();</span><br><span class=\"line\">    DEV::validateWriteRecordCheck(ledgerJournalEntity);</span><br><span class=\"line\">    ledgerJournalEntity.insert();</span><br><span class=\"line\"></span><br><span class=\"line\">    journalNum = ledgerJournalEntity.JournalBatchNumber;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>As you see this method requires less code: we don’t even need to write code for the journal header creation, it is all handled by the data entity insert() method. Dimensions can be also specified as strings. However there are some limitations: sometimes data entity doesn’t contain all the table fields and it doesn’t support all account types.</p>\n<h2 id=\"Performance-testing\"><a href=\"#Performance-testing\" class=\"headerlink\" title=\"Performance testing\"></a>Performance testing</h2><p>Let’s test the performance. First I created a test journal with the 1000 lines(<strong>createByCombination method</strong>) and then copied it using these 3 different methods. I got the following results:</p>\n<table>\n<thead>\n<tr>\n<th>Method</th>\n<th>Time to create 1000 lines(sec)</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>Using ledgerJournalEngine</td>\n<td>30.54</td>\n</tr>\n<tr>\n<td>Using DataEntity</td>\n<td>33.09</td>\n</tr>\n<tr>\n<td>Using Table defaultRow method</td>\n<td>15.18</td>\n</tr>\n</tbody></table>\n<p>There are some differences between the copy speed in my example, but it is caused by a different logic for the dimension creation, so the result is that all methods are almost equal and quite fast. In a real-life scenario, you can expect an insert speed 10-30 lines per second.</p>\n<h2 id=\"Choosing-the-right-method-and-things-to-avoid\"><a href=\"#Choosing-the-right-method-and-things-to-avoid\" class=\"headerlink\" title=\"Choosing the right method and things to avoid\"></a>Choosing the right method and things to avoid</h2><p>In general, you have 2 options - to create a journal similar to the manual user entry or create it similar to the import procedure(for the second scenario choice between entity and table mostly depends on what input data you have and whether the entity supports all the required fields). So the choice between these two should be made by answering the question: if the user wants to create the same journal manually, does he use manual entry or data import? Use <a href=\"https://github.com/TrudAX/XppTools/blob/3d69455f4b8157bc28bfc9560e9f70c8bacd634a/DEVTutorial/DEVTutorial/AxClass/DEVTutorialCreateLedgerJournal.xml#L196\">createJournalUsingLedgerJournalEngine</a> as default, as it is more flexible.</p>\n<p>Probably in D365FO it is better to avoid creation using JournalTransData classes or when you simply populate ledgerJournalTrans fields and call insert(). This initially can work, but later users may complain - e.g. “<em>Why when I create a journal manually and specify a vendor account the Due date field is calculated, but your procedure doesn’t fill it</em>“.</p>\n<h2 id=\"Summary\"><a href=\"#Summary\" class=\"headerlink\" title=\"Summary\"></a>Summary</h2><p>You can download this class using the following link <a href=\"https://github.com/TrudAX/XppTools/blob/master/DEVTutorial/DEVTutorial/AxClass/DEVTutorialCreateLedgerJournal.xml\">createJournalUsingLedgerJournalEngine</a>. The idea is that you can use this code as a template when you have a task to create(or post) a ledger journal using X++. Comments are welcome.</p>\n","excerpt":"","more":"<blockquote>\n<p>Reprinted from: <a href=\"https://denistrunin.com/xpptools-createledgerjournal/\">https://denistrunin.com/xpptools-createledgerjournal/</a></p>\n</blockquote>\n<p>Creating LedgerJournalTrans using X++ is quite a common task, but sometimes I still see some mistakes(mostly related to fields initialization from account&#x2F;offset account and voucher assignment). In this post, I’ll try to describe possible options how to create ledger journals in D365FO.</p>\n<h2 id=\"Test-scenario\"><a href=\"#Test-scenario\" class=\"headerlink\" title=\"Test scenario\"></a>Test scenario</h2><p>To test different methods, I wrote a Runnable class DEVTutorialCreateLedgerJournal that creates a new journal based on the data from the existing source journal using different methods. The dialog looks like this</p>\n<img src=\"/2025/07/09/xpp-createledgerjournals/CopyJournalDialog.png\" class=\"\" title=\"CopyJournalDialog\">\n\n<p>Let’s discuss possible copy options(Copy type parameter):</p>\n<h2 id=\"LedgerJournalEngine-class\"><a href=\"#LedgerJournalEngine-class\" class=\"headerlink\" title=\"LedgerJournalEngine class\"></a>LedgerJournalEngine class</h2><p>This method is using LedgerJournalEngine class - the same class that is used when the user creates a journal manually on the Journal lines form. This increases the chances that the resulting line will be the same as a manually created line.</p>\n<figure class=\"highlight c#\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">while</span> <span class=\"keyword\">select</span> ledgerJournalTransOrig</span><br><span class=\"line\">    order <span class=\"keyword\">by</span> RecId</span><br><span class=\"line\">            <span class=\"keyword\">where</span> ledgerJournalTransOrig.JournalNum == _ledgerJournalTableOrig.JournalNum</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    numLines++;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!ledgerJournalTable.RecId)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"comment\">//Often journal name from parameters is specified here</span></span><br><span class=\"line\">        DEV::validateCursorField(ledgerJournalName, fieldNum(LedgerJournalName, JournalName));</span><br><span class=\"line\"></span><br><span class=\"line\">        ledgerJournalTable.clear();</span><br><span class=\"line\">        ledgerJournalTable.initValue();</span><br><span class=\"line\">        ledgerJournalTable.JournalName = ledgerJournalName.JournalName;</span><br><span class=\"line\">        ledgerJournalTable.initFromLedgerJournalName();</span><br><span class=\"line\">        ledgerJournalTable.JournalNum = JournalTableData::newTable(ledgerJournalTable).nextJournalId();</span><br><span class=\"line\">        ledgerJournalTable.Name = strFmt(<span class=\"string\">&quot;Copy of %1, Date %2&quot;</span>, _ledgerJournalTableOrig.JournalNum, DEV::systemdateget());</span><br><span class=\"line\">        ledgerJournalTable.insert();</span><br><span class=\"line\"></span><br><span class=\"line\">        info(strFmt(<span class=\"string\">&quot;Journal %1 created&quot;</span>, ledgerJournalTable.JournalNum));</span><br><span class=\"line\"></span><br><span class=\"line\">        ledgerJournalEngine = LedgerJournalEngine::construct(ledgerJournalTable.JournalType);</span><br><span class=\"line\">        ledgerJournalEngine.newJournalActive(ledgerJournalTable);    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    ledgerJournalTrans.clear();</span><br><span class=\"line\">    ledgerJournalTrans.initValue();</span><br><span class=\"line\">    ledgerJournalEngine.initValue(ledgerJournalTrans);</span><br><span class=\"line\">    ledgerJournalTrans.JournalNum           =   ledgerJournalTable.JournalNum;</span><br><span class=\"line\">    ledgerJournalTrans.TransDate            =   DEV::systemdateget();</span><br><span class=\"line\">    ledgerJournalTrans.AccountType          =   ledgerJournalTransOrig.AccountType;</span><br><span class=\"line\">    ledgerJournalTrans.modifiedField(fieldNum(LedgerJournalTrans, AccountType));</span><br><span class=\"line\"></span><br><span class=\"line\">    ledgerJournalTrans.LedgerDimension = ledgerJournalTransOrig.LedgerDimension;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!ledgerJournalTrans.LedgerDimension)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> error(<span class=\"string\">&quot;Missing or invalid ledger dimension for journal process&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    ledgerJournalTrans.modifiedField(fieldNum(LedgerJournalTrans, LedgerDimension));</span><br><span class=\"line\">    ledgerJournalEngine.accountModified(LedgerJournalTrans);</span><br><span class=\"line\">    ledgerJournalTrans.OffsetAccountType = ledgerJournalTransOrig.OffsetAccountType;</span><br><span class=\"line\">    ledgerJournalTrans.modifiedField(fieldNum(LedgerJournalTrans, OffsetAccountType));</span><br><span class=\"line\">    ledgerJournalTrans.OffsetLedgerDimension = ledgerJournalTransOrig.OffsetLedgerDimension;</span><br><span class=\"line\">    ledgerJournalTrans.modifiedField(fieldNum(LedgerJournalTrans, OffsetLedgerDimension));</span><br><span class=\"line\">    ledgerJournalEngine.offsetAccountModified(ledgerJournalTrans);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//amounts</span></span><br><span class=\"line\">    LedgerJournalTrans.CurrencyCode         =   ledgerJournalTransOrig.CurrencyCode;</span><br><span class=\"line\">    ledgerJournalEngine.currencyModified(LedgerJournalTrans);</span><br><span class=\"line\">    LedgerJournalTrans.AmountCurCredit      =   ledgerJournalTransOrig.AmountCurCredit;</span><br><span class=\"line\">    LedgerJournalTrans.AmountCurDebit       =   ledgerJournalTransOrig.AmountCurDebit;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//additional fields</span></span><br><span class=\"line\">    LedgerJournalTrans.Approver           = HcmWorker::userId2Worker(curuserid());</span><br><span class=\"line\">    LedgerJournalTrans.Approved           = NoYes::Yes;</span><br><span class=\"line\">    ledgerJournalTrans.Txt                = ledgerJournalTransOrig.Txt;</span><br><span class=\"line\">    LedgerJournalTrans.SkipBlockedForManualEntryCheck = <span class=\"literal\">true</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    DEV::validateWriteRecordCheck(ledgerJournalTrans);</span><br><span class=\"line\">    ledgerJournalTrans.insert();</span><br><span class=\"line\">    ledgerJournalEngine.write(ledgerJournalTrans);&#125;</span><br></pre></td></tr></table></figure>\n\n<p>When you modify Account&#x2F;Offset account fields in this example you need to call two methods(on ledgerJournalTrans and ledgerJournalEngine). This ensures that the line will be properly initialized from the Account&#x2F;Offset account field.</p>\n<figure class=\"highlight c#\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ledgerJournalTrans.modifiedField(fieldNum(LedgerJournalTrans, LedgerDimension));  </span><br><span class=\"line\">ledgerJournalEngine.accountModified(LedgerJournalTrans);</span><br></pre></td></tr></table></figure>\n\n<p>Voucher assignment here is processing in ledgerJournalEngine.write().</p>\n<p>Also, an interesting flag here is LedgerJournalTrans.SkipBlockedForManualEntryCheck. It is useful when you don’t want to allow users to create manually lines with the same accounts as in your procedure.</p>\n<h2 id=\"LedgerJournalTrans-defaultRow-method\"><a href=\"#LedgerJournalTrans-defaultRow-method\" class=\"headerlink\" title=\"LedgerJournalTrans defaultRow() method\"></a>LedgerJournalTrans defaultRow() method</h2><p>This is a new approach in D365FO and it uses a new defaultRow() table method. Data entities also call this method during the import process. Its idea is that we don’t control the sequence of different modifiedField method calls, we just populate the fields that we know, all other logic happens in the defaultRow() method.</p>\n<p>Code for journal creation in this case:</p>\n<figure class=\"highlight c#\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">while</span> <span class=\"keyword\">select</span> ledgerJournalTransOrig</span><br><span class=\"line\">    order <span class=\"keyword\">by</span> RecId</span><br><span class=\"line\">    <span class=\"keyword\">where</span> ledgerJournalTransOrig.JournalNum == _ledgerJournalTableOrig.JournalNum</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    numLines++;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!ledgerJournalTable.RecId)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        ledgerJournalTable.clear();</span><br><span class=\"line\">        ledgerJournalTable.initValue();</span><br><span class=\"line\">        ledgerJournalTable.JournalName = _ledgerJournalTableOrig.JournalName;</span><br><span class=\"line\">        ledgerJournalTable.initFromLedgerJournalName();</span><br><span class=\"line\">        ledgerJournalTable.JournalNum = JournalTableData::newTable(ledgerJournalTable).nextJournalId();</span><br><span class=\"line\">        ledgerJournalTable.Name = strFmt(<span class=\"string\">&quot;Copy of %1, Date %2&quot;</span>, _ledgerJournalTableOrig.JournalNum, DEV::systemdateget());</span><br><span class=\"line\">        ledgerJournalTable.insert();</span><br><span class=\"line\"></span><br><span class=\"line\">        info(strFmt(<span class=\"string\">&quot;Journal %1 created&quot;</span>, ledgerJournalTable.JournalNum));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    ledgerJournalTrans.clear();</span><br><span class=\"line\">    ledgerJournalTrans.initValue();</span><br><span class=\"line\"></span><br><span class=\"line\">    ledgerJournalTrans.JournalNum             = ledgerJournalTable.JournalNum;</span><br><span class=\"line\">    ledgerJournalTrans.TransDate              = DEV::systemdateget();</span><br><span class=\"line\">    ledgerJournalTrans.AccountType            = ledgerJournalTransOrig.AccountType;</span><br><span class=\"line\">    ledgerJournalTrans.LedgerDimension        = ledgerJournalTransOrig.LedgerDimension;</span><br><span class=\"line\">    ledgerJournalTrans.DefaultDimension       = ledgerJournalTransOrig.DefaultDimension;</span><br><span class=\"line\"></span><br><span class=\"line\">    ledgerJournalTrans.OffsetAccountType      = ledgerJournalTransOrig.OffsetAccountType;</span><br><span class=\"line\">    ledgerJournalTrans.OffsetLedgerDimension  = ledgerJournalTransOrig.OffsetLedgerDimension;</span><br><span class=\"line\">    ledgerJournalTrans.OffsetDefaultDimension = ledgerJournalTransOrig.OffsetDefaultDimension;</span><br><span class=\"line\"></span><br><span class=\"line\">    ledgerJournalTrans.CurrencyCode           =   ledgerJournalTransOrig.CurrencyCode;</span><br><span class=\"line\">    ledgerJournalTrans.AmountCurCredit        =   ledgerJournalTransOrig.AmountCurCredit;</span><br><span class=\"line\">    ledgerJournalTrans.AmountCurDebit         =   ledgerJournalTransOrig.AmountCurDebit;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//addition fields</span></span><br><span class=\"line\">    ledgerJournalTrans.Approver           = HcmWorker::userId2Worker(curuserid());</span><br><span class=\"line\">    ledgerJournalTrans.Approved           = NoYes::Yes;</span><br><span class=\"line\">    ledgerJournalTrans.Txt                = ledgerJournalTransOrig.Txt;</span><br><span class=\"line\">    ledgerJournalTrans.SkipBlockedForManualEntryCheck = <span class=\"literal\">true</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    ledgerJournalTrans.defaultRow();</span><br><span class=\"line\">    DEV::validateWriteRecordCheck(ledgerJournalTrans);</span><br><span class=\"line\">    ledgerJournalTrans.insert();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>You can find an example of this approach in the MCRLedgerJournal class (and the usage is here)</p>\n<h2 id=\"Data-entity\"><a href=\"#Data-entity\" class=\"headerlink\" title=\"Data entity\"></a>Data entity</h2><p>We can also use a data entity for journal creation. Technically it produces the same result as the previous method because a data entity at the end will call a table defaultRow() method.</p>\n<figure class=\"highlight c#\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">while</span> <span class=\"keyword\">select</span> ledgerJournalTransOrig</span><br><span class=\"line\">    order <span class=\"keyword\">by</span> RecId</span><br><span class=\"line\">    <span class=\"keyword\">where</span> ledgerJournalTransOrig.JournalNum == _ledgerJournalTableOrig.JournalNum</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    numLines++;</span><br><span class=\"line\">    <span class=\"keyword\">select</span> dimensionCombinationEntity</span><br><span class=\"line\">        <span class=\"keyword\">where</span> dimensionCombinationEntity.RecId == ledgerJournalTransOrig.LedgerDimension;</span><br><span class=\"line\">    <span class=\"keyword\">select</span> dimensionCombinationEntityOffset</span><br><span class=\"line\">        <span class=\"keyword\">where</span> dimensionCombinationEntityOffset.RecId == ledgerJournalTransOrig.OffsetLedgerDimension;</span><br><span class=\"line\"></span><br><span class=\"line\">    ledgerJournalEntity.initValue();</span><br><span class=\"line\">    ledgerJournalEntity.JournalBatchNumber     = journalNum;</span><br><span class=\"line\">    ledgerJournalEntity.Description            = strFmt(<span class=\"string\">&quot;Copy of %1, Date %2&quot;</span>, _ledgerJournalTableOrig.JournalNum, DEV::systemdateget());</span><br><span class=\"line\">    ledgerJournalEntity.JournalName            = _ledgerJournalTableOrig.JournalName;</span><br><span class=\"line\">    ledgerJournalEntity.LineNumber++;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//if you have string and want to convert to ID - DimensionDefaultResolver::newResolver(_dimensionDisplayValue).resolve();</span></span><br><span class=\"line\">    <span class=\"comment\">//AX &gt; General ledge &gt; Chart of accounts &gt; Dimensions &gt; Financial dimension configuration for integrating applications</span></span><br><span class=\"line\">    ledgerJournalEntity.AccountType                 = ledgerJournalTransOrig.AccountType;</span><br><span class=\"line\">    ledgerJournalEntity.AccountDisplayValue         = dimensionCombinationEntity.DisplayValue;</span><br><span class=\"line\"></span><br><span class=\"line\">    ledgerJournalEntity.OffsetAccountType           = ledgerJournalTransOrig.OffsetAccountType;</span><br><span class=\"line\">    ledgerJournalEntity.OffsetAccountDisplayValue   = dimensionCombinationEntityOffset.DisplayValue;</span><br><span class=\"line\"></span><br><span class=\"line\">    ledgerJournalEntity.CreditAmount                = ledgerJournalTransOrig.AmountCurCredit;</span><br><span class=\"line\">    ledgerJournalEntity.DebitAmount                 = ledgerJournalTransOrig.AmountCurDebit;</span><br><span class=\"line\">    ledgerJournalEntity.CurrencyCode                = ledgerJournalTransOrig.CurrencyCode;</span><br><span class=\"line\">    ledgerJournalEntity.TEXT                        = ledgerJournalTransOrig.Txt;</span><br><span class=\"line\">    ledgerJournalEntity.TRANSDATE                   = ledgerJournalTransOrig.TransDate;</span><br><span class=\"line\"></span><br><span class=\"line\">    ledgerJournalEntity.defaultRow();</span><br><span class=\"line\">    DEV::validateWriteRecordCheck(ledgerJournalEntity);</span><br><span class=\"line\">    ledgerJournalEntity.insert();</span><br><span class=\"line\"></span><br><span class=\"line\">    journalNum = ledgerJournalEntity.JournalBatchNumber;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>As you see this method requires less code: we don’t even need to write code for the journal header creation, it is all handled by the data entity insert() method. Dimensions can be also specified as strings. However there are some limitations: sometimes data entity doesn’t contain all the table fields and it doesn’t support all account types.</p>\n<h2 id=\"Performance-testing\"><a href=\"#Performance-testing\" class=\"headerlink\" title=\"Performance testing\"></a>Performance testing</h2><p>Let’s test the performance. First I created a test journal with the 1000 lines(<strong>createByCombination method</strong>) and then copied it using these 3 different methods. I got the following results:</p>\n<table>\n<thead>\n<tr>\n<th>Method</th>\n<th>Time to create 1000 lines(sec)</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>Using ledgerJournalEngine</td>\n<td>30.54</td>\n</tr>\n<tr>\n<td>Using DataEntity</td>\n<td>33.09</td>\n</tr>\n<tr>\n<td>Using Table defaultRow method</td>\n<td>15.18</td>\n</tr>\n</tbody></table>\n<p>There are some differences between the copy speed in my example, but it is caused by a different logic for the dimension creation, so the result is that all methods are almost equal and quite fast. In a real-life scenario, you can expect an insert speed 10-30 lines per second.</p>\n<h2 id=\"Choosing-the-right-method-and-things-to-avoid\"><a href=\"#Choosing-the-right-method-and-things-to-avoid\" class=\"headerlink\" title=\"Choosing the right method and things to avoid\"></a>Choosing the right method and things to avoid</h2><p>In general, you have 2 options - to create a journal similar to the manual user entry or create it similar to the import procedure(for the second scenario choice between entity and table mostly depends on what input data you have and whether the entity supports all the required fields). So the choice between these two should be made by answering the question: if the user wants to create the same journal manually, does he use manual entry or data import? Use <a href=\"https://github.com/TrudAX/XppTools/blob/3d69455f4b8157bc28bfc9560e9f70c8bacd634a/DEVTutorial/DEVTutorial/AxClass/DEVTutorialCreateLedgerJournal.xml#L196\">createJournalUsingLedgerJournalEngine</a> as default, as it is more flexible.</p>\n<p>Probably in D365FO it is better to avoid creation using JournalTransData classes or when you simply populate ledgerJournalTrans fields and call insert(). This initially can work, but later users may complain - e.g. “<em>Why when I create a journal manually and specify a vendor account the Due date field is calculated, but your procedure doesn’t fill it</em>“.</p>\n<h2 id=\"Summary\"><a href=\"#Summary\" class=\"headerlink\" title=\"Summary\"></a>Summary</h2><p>You can download this class using the following link <a href=\"https://github.com/TrudAX/XppTools/blob/master/DEVTutorial/DEVTutorial/AxClass/DEVTutorialCreateLedgerJournal.xml\">createJournalUsingLedgerJournalEngine</a>. The idea is that you can use this code as a template when you have a task to create(or post) a ledger journal using X++. Comments are welcome.</p>\n"},{"title":"X++ api list","date":"2024-12-23T07:41:59.000Z","comments":1,"description":"X++ Api List","_content":"\n### FileIOPermission\n\n`FileIOPermission`类用于设置文件的访问权限。`assert()`方法用于验证`FileIOPermission`类设置权限是否成功，如果错误，便会抛出错误，效果类似`try catch`程序块。\n\n### RecordInsertList\n\n用于批量插入的工具类，示例代码如下：\n\n{% asset_img \"xpp-api-list-recordinsertlist.png\" \"RecordInsertList example\" %}","source":"_posts/xpp-api-list.md","raw":"---\ntitle: X++ api list\ndate: 2024-12-23 15:41:59\ncategories:\n - x++\ncomments: true\ndescription: X++ Api List\n---\n\n### FileIOPermission\n\n`FileIOPermission`类用于设置文件的访问权限。`assert()`方法用于验证`FileIOPermission`类设置权限是否成功，如果错误，便会抛出错误，效果类似`try catch`程序块。\n\n### RecordInsertList\n\n用于批量插入的工具类，示例代码如下：\n\n{% asset_img \"xpp-api-list-recordinsertlist.png\" \"RecordInsertList example\" %}","slug":"xpp-api-list","published":1,"updated":"2025-07-08T12:05:00.539Z","layout":"post","photos":[],"_id":"cmcvxsshr000s3cuga6psfnwb","content":"<h3 id=\"FileIOPermission\"><a href=\"#FileIOPermission\" class=\"headerlink\" title=\"FileIOPermission\"></a>FileIOPermission</h3><p><code>FileIOPermission</code>类用于设置文件的访问权限。<code>assert()</code>方法用于验证<code>FileIOPermission</code>类设置权限是否成功，如果错误，便会抛出错误，效果类似<code>try catch</code>程序块。</p>\n<h3 id=\"RecordInsertList\"><a href=\"#RecordInsertList\" class=\"headerlink\" title=\"RecordInsertList\"></a>RecordInsertList</h3><p>用于批量插入的工具类，示例代码如下：</p>\n<img src=\"/2024/12/23/xpp-api-list/xpp-api-list-recordinsertlist.png\" class=\"\" title=\"RecordInsertList example\">","excerpt":"","more":"<h3 id=\"FileIOPermission\"><a href=\"#FileIOPermission\" class=\"headerlink\" title=\"FileIOPermission\"></a>FileIOPermission</h3><p><code>FileIOPermission</code>类用于设置文件的访问权限。<code>assert()</code>方法用于验证<code>FileIOPermission</code>类设置权限是否成功，如果错误，便会抛出错误，效果类似<code>try catch</code>程序块。</p>\n<h3 id=\"RecordInsertList\"><a href=\"#RecordInsertList\" class=\"headerlink\" title=\"RecordInsertList\"></a>RecordInsertList</h3><p>用于批量插入的工具类，示例代码如下：</p>\n<img src=\"/2024/12/23/xpp-api-list/xpp-api-list-recordinsertlist.png\" class=\"\" title=\"RecordInsertList example\">"},{"title":"Dynamics 365 Debugging Configuration","comments":1,"date":"2025-02-23T12:37:45.000Z","description":"Dynamics 365 debugging configuration","_content":"\n> 当无法 debug 系统标准的代码时，可以按照本文的步骤配置\n\n导航 Tools > Options，在 Dynamics 365 > Debugging tab 页面配置 debug 相关属性，如下图，在 Included Packages 中选择，在 debug 中需要 load 的 model。\n\n{% asset_img \"xpp-debug-configuration.png\" \"D365 Debugging Configuration\" %}","source":"_posts/xpp-debug-configuration.md","raw":"---\ntitle: Dynamics 365 Debugging Configuration\ncomments: true\ndate: 2025-02-23 20:37:45\ncategories:\n - x++\ndescription: Dynamics 365 debugging configuration\n---\n\n> 当无法 debug 系统标准的代码时，可以按照本文的步骤配置\n\n导航 Tools > Options，在 Dynamics 365 > Debugging tab 页面配置 debug 相关属性，如下图，在 Included Packages 中选择，在 debug 中需要 load 的 model。\n\n{% asset_img \"xpp-debug-configuration.png\" \"D365 Debugging Configuration\" %}","slug":"xpp-debug-configuration","published":1,"updated":"2025-07-08T12:05:00.540Z","layout":"post","photos":[],"_id":"cmcvxsshr000v3cug39drfyzv","content":"<blockquote>\n<p>当无法 debug 系统标准的代码时，可以按照本文的步骤配置</p>\n</blockquote>\n<p>导航 Tools &gt; Options，在 Dynamics 365 &gt; Debugging tab 页面配置 debug 相关属性，如下图，在 Included Packages 中选择，在 debug 中需要 load 的 model。</p>\n<img src=\"/2025/02/23/xpp-debug-configuration/xpp-debug-configuration.png\" class=\"\" title=\"D365 Debugging Configuration\">","excerpt":"","more":"<blockquote>\n<p>当无法 debug 系统标准的代码时，可以按照本文的步骤配置</p>\n</blockquote>\n<p>导航 Tools &gt; Options，在 Dynamics 365 &gt; Debugging tab 页面配置 debug 相关属性，如下图，在 Included Packages 中选择，在 debug 中需要 load 的 model。</p>\n<img src=\"/2025/02/23/xpp-debug-configuration/xpp-debug-configuration.png\" class=\"\" title=\"D365 Debugging Configuration\">"},{"title":"Extend CustTrans and VendTrans","comments":1,"date":"2025-07-09T11:48:50.000Z","description":"Extend CustTrans and VendTrans","_content":"\n> Just recorded how to extend the feature regards the CustTrans and VendTrans.\n\n## Bring the customized fields of LedgerJournalTrans to CustTrans or VendTrans\n\nIf the requirement wants to create the new fields on CustTrans/VendTrans and LedgerJournalTrans, and want to sync the customized fields to Transaction record after posting the customer journal or vendor journal. You can extend the CustVoucherJournal/VendVoucherJournal as follows:\n\n```c#\n/// <summary>\n/// Willie Yao - 07/08/2025\n/// </summary>\n[ExtensionOf(classstr(CustVoucherJournal))]\nfinal class HMClass_CustVoucherJournal_Extension\n{\n    /// <summary>\n    /// Willie Yao - 07/08/2025\n    /// </summary>\n    /// <param name = \"custVendTrans\">CustVendTrans</param>\n    /// <param name = \"_ledgerPostingJournal\">LedgerVoucher</param>\n    /// <param name = \"_useSubLedger\">UseSubLedger</param>\n    protected void initCustVendTrans(\n        CustVendTrans   custVendTrans, \n        LedgerVoucher   _ledgerPostingJournal, \n        boolean         _useSubLedger)\n    {\n        next initCustVendTrans(custVendTrans, _ledgerPostingJournal, _useSubLedger);\n        \n        LedgerJournalTrans ledgerJournalTrans;\n\n        if (common.TableId == tablenum(LedgerJournalTrans))\n        {\n            ledgerJournalTrans = common;\n\n            if (custVendTrans.TableId == tableNum(CustTrans))\n            {\n                CustTrans custTrans  = custVendTrans;\n                custTrans.HMField1   = ledgerJournalTrans.HMField1;\n                custTrans.HMField2   = ledgerJournalTrans.HMField2;\n                custVendTrans        = custTrans;\n            }\n\n        }\n    }\n}\n\n/// <summary>\n/// Willie Yao - 07/08/2025\n/// </summary>\n[ExtensionOf(classstr(VendVoucherJournal))]\nfinal class HMClass_VendVoucherJournal_Extension\n{\n    /// <summary>\n    /// Willie Yao - 07/08/2025\n    /// </summary>\n    /// <param name = \"custVendTrans\">CustVendTrans</param>\n    /// <param name = \"_ledgerPostingJournal\">LedgerVoucher</param>\n    /// <param name = \"_useSubLedger\">UseSubLedger</param>\n    protected void initCustVendTrans(\n        CustVendTrans   custVendTrans, \n        LedgerVoucher   _ledgerPostingJournal, \n        boolean         _useSubLedger)\n    {\n        next initCustVendTrans(custVendTrans, _ledgerPostingJournal, _useSubLedger);\n\n        LedgerJournalTrans ledgerJournalTrans;\n\n        if (common.TableId == tablenum(LedgerJournalTrans))\n        {\n            ledgerJournalTrans = common;\n\n            if (custVendTrans.TableId == tableNum(VendTrans))\n            {\n                VendTrans vendTrans  = custVendTrans;\n                vendTrans.HMField1   = ledgerJournalTrans.HMField1;\n                custVendTrans        = vendTrans;\n            }\n\n        }\n    }\n\n}\n```\n\n## Add new validation logic when posted LedgerJournalTrans\n\nPlease coc the validation logic of LedgerJournalCheckPost class if developer wants to add new validation logic for LedgerJournalTrans post operation.\n\n```c#\n/// <summary>\n/// Willie Yao - 07/08/2025\n/// </summary>\n[ExtensionOf(classstr(LedgerJournalCheckPost))]\nfinal class HMClass_LedgerJournalCheckPost_Extension\n{\n    /// <summary>\n    /// Willie Yao - 07/08/2025\n    /// </summary>\n    /// <param name = \"_calledFrom\">CalledFrom</param>\n    /// <returns>True if validate right</returns>\n    public boolean validate(Object _calledFrom)\n    {\n        boolean ret = next validate(_calledFrom);\n\n        ret = this.newValidation() && ret;\n\n        return ret;\n    }\n\n    /// <summary>\n    /// Willie Yao - 07/08/2025\n    /// </summary>\n    /// <returns>True if validate right</returns>\n    internal boolean newValidation()\n    {\n        LedgerJournalTrans  ledgerJournalTrans;\n        boolean             ok = true;\n\n        ok = this.newValidationLogic(ledgerJournalTrans) && ok;\n\n        return ok;    \n    }\n}\n```\n\n## Extend CustTrans/VendTrans Reversal Logic\n\nDevelopers must coc the reversal method and write the customized logic after the next invoke method.\n\n```c#\n/// <summary>\n/// Willie Yao - 07/08/2025\n/// </summary>\n[ExtensionOf(classstr(TransactionReversal_Cust))]\nfinal class HMClass_TransactionReversal_Cust_Extension\n{ \n    /// <summary>\n    /// Willie Yao - 07/08/2025\n    /// </summary>\n    /// <param name = \"args\">Args</param>\n    void reversal(Args args)\n    {\n        next reversal(args);\n\n        // New Logic\n    }    \n}\n\n/// <summary>\n/// Willie Yao - 07/08/2025\n/// </summary>\n[ExtensionOf(classstr(TransactionReversal_Vend))]\nfinal class HMClass_TransactionReversal_Vend_Extension\n{\n    /// <summary>\n    /// Willie Yao - 07/08/2025\n    /// </summary>\n    /// <param name = \"args\">Args</param>\n    void reversal(Args args)\n    {\n        next reversal(args);\n\n        // New Logic\n    }  \n}\n```\n\n> More expansion points will be updated successively in the future","source":"_posts/xpp-extendedvendtransandcusttrans.md","raw":"---\ntitle: Extend CustTrans and VendTrans\ncomments: true\ndate: 2025-07-09 19:48:50\ntags:\n - CustTrans\n - VendTrans\n - Reversal\n - LedgerJournalTrans\ncategories:\n - x++\ndescription: Extend CustTrans and VendTrans\n---\n\n> Just recorded how to extend the feature regards the CustTrans and VendTrans.\n\n## Bring the customized fields of LedgerJournalTrans to CustTrans or VendTrans\n\nIf the requirement wants to create the new fields on CustTrans/VendTrans and LedgerJournalTrans, and want to sync the customized fields to Transaction record after posting the customer journal or vendor journal. You can extend the CustVoucherJournal/VendVoucherJournal as follows:\n\n```c#\n/// <summary>\n/// Willie Yao - 07/08/2025\n/// </summary>\n[ExtensionOf(classstr(CustVoucherJournal))]\nfinal class HMClass_CustVoucherJournal_Extension\n{\n    /// <summary>\n    /// Willie Yao - 07/08/2025\n    /// </summary>\n    /// <param name = \"custVendTrans\">CustVendTrans</param>\n    /// <param name = \"_ledgerPostingJournal\">LedgerVoucher</param>\n    /// <param name = \"_useSubLedger\">UseSubLedger</param>\n    protected void initCustVendTrans(\n        CustVendTrans   custVendTrans, \n        LedgerVoucher   _ledgerPostingJournal, \n        boolean         _useSubLedger)\n    {\n        next initCustVendTrans(custVendTrans, _ledgerPostingJournal, _useSubLedger);\n        \n        LedgerJournalTrans ledgerJournalTrans;\n\n        if (common.TableId == tablenum(LedgerJournalTrans))\n        {\n            ledgerJournalTrans = common;\n\n            if (custVendTrans.TableId == tableNum(CustTrans))\n            {\n                CustTrans custTrans  = custVendTrans;\n                custTrans.HMField1   = ledgerJournalTrans.HMField1;\n                custTrans.HMField2   = ledgerJournalTrans.HMField2;\n                custVendTrans        = custTrans;\n            }\n\n        }\n    }\n}\n\n/// <summary>\n/// Willie Yao - 07/08/2025\n/// </summary>\n[ExtensionOf(classstr(VendVoucherJournal))]\nfinal class HMClass_VendVoucherJournal_Extension\n{\n    /// <summary>\n    /// Willie Yao - 07/08/2025\n    /// </summary>\n    /// <param name = \"custVendTrans\">CustVendTrans</param>\n    /// <param name = \"_ledgerPostingJournal\">LedgerVoucher</param>\n    /// <param name = \"_useSubLedger\">UseSubLedger</param>\n    protected void initCustVendTrans(\n        CustVendTrans   custVendTrans, \n        LedgerVoucher   _ledgerPostingJournal, \n        boolean         _useSubLedger)\n    {\n        next initCustVendTrans(custVendTrans, _ledgerPostingJournal, _useSubLedger);\n\n        LedgerJournalTrans ledgerJournalTrans;\n\n        if (common.TableId == tablenum(LedgerJournalTrans))\n        {\n            ledgerJournalTrans = common;\n\n            if (custVendTrans.TableId == tableNum(VendTrans))\n            {\n                VendTrans vendTrans  = custVendTrans;\n                vendTrans.HMField1   = ledgerJournalTrans.HMField1;\n                custVendTrans        = vendTrans;\n            }\n\n        }\n    }\n\n}\n```\n\n## Add new validation logic when posted LedgerJournalTrans\n\nPlease coc the validation logic of LedgerJournalCheckPost class if developer wants to add new validation logic for LedgerJournalTrans post operation.\n\n```c#\n/// <summary>\n/// Willie Yao - 07/08/2025\n/// </summary>\n[ExtensionOf(classstr(LedgerJournalCheckPost))]\nfinal class HMClass_LedgerJournalCheckPost_Extension\n{\n    /// <summary>\n    /// Willie Yao - 07/08/2025\n    /// </summary>\n    /// <param name = \"_calledFrom\">CalledFrom</param>\n    /// <returns>True if validate right</returns>\n    public boolean validate(Object _calledFrom)\n    {\n        boolean ret = next validate(_calledFrom);\n\n        ret = this.newValidation() && ret;\n\n        return ret;\n    }\n\n    /// <summary>\n    /// Willie Yao - 07/08/2025\n    /// </summary>\n    /// <returns>True if validate right</returns>\n    internal boolean newValidation()\n    {\n        LedgerJournalTrans  ledgerJournalTrans;\n        boolean             ok = true;\n\n        ok = this.newValidationLogic(ledgerJournalTrans) && ok;\n\n        return ok;    \n    }\n}\n```\n\n## Extend CustTrans/VendTrans Reversal Logic\n\nDevelopers must coc the reversal method and write the customized logic after the next invoke method.\n\n```c#\n/// <summary>\n/// Willie Yao - 07/08/2025\n/// </summary>\n[ExtensionOf(classstr(TransactionReversal_Cust))]\nfinal class HMClass_TransactionReversal_Cust_Extension\n{ \n    /// <summary>\n    /// Willie Yao - 07/08/2025\n    /// </summary>\n    /// <param name = \"args\">Args</param>\n    void reversal(Args args)\n    {\n        next reversal(args);\n\n        // New Logic\n    }    \n}\n\n/// <summary>\n/// Willie Yao - 07/08/2025\n/// </summary>\n[ExtensionOf(classstr(TransactionReversal_Vend))]\nfinal class HMClass_TransactionReversal_Vend_Extension\n{\n    /// <summary>\n    /// Willie Yao - 07/08/2025\n    /// </summary>\n    /// <param name = \"args\">Args</param>\n    void reversal(Args args)\n    {\n        next reversal(args);\n\n        // New Logic\n    }  \n}\n```\n\n> More expansion points will be updated successively in the future","slug":"xpp-extendedvendtransandcusttrans","published":1,"updated":"2025-07-09T12:05:59.968Z","layout":"post","photos":[],"_id":"cmcvxsshs000y3cug0vd4a3uk","content":"<blockquote>\n<p>Just recorded how to extend the feature regards the CustTrans and VendTrans.</p>\n</blockquote>\n<h2 id=\"Bring-the-customized-fields-of-LedgerJournalTrans-to-CustTrans-or-VendTrans\"><a href=\"#Bring-the-customized-fields-of-LedgerJournalTrans-to-CustTrans-or-VendTrans\" class=\"headerlink\" title=\"Bring the customized fields of LedgerJournalTrans to CustTrans or VendTrans\"></a>Bring the customized fields of LedgerJournalTrans to CustTrans or VendTrans</h2><p>If the requirement wants to create the new fields on CustTrans&#x2F;VendTrans and LedgerJournalTrans, and want to sync the customized fields to Transaction record after posting the customer journal or vendor journal. You can extend the CustVoucherJournal&#x2F;VendVoucherJournal as follows:</p>\n<figure class=\"highlight c#\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;summary&gt;</span></span></span><br><span class=\"line\"><span class=\"comment\"><span class=\"doctag\">///</span> Willie Yao - 07/08/2025</span></span><br><span class=\"line\"><span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;/summary&gt;</span></span></span><br><span class=\"line\">[<span class=\"meta\">ExtensionOf(classstr(CustVoucherJournal))</span>]</span><br><span class=\"line\">final <span class=\"keyword\">class</span> <span class=\"title\">HMClass_CustVoucherJournal_Extension</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> Willie Yao - 07/08/2025</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;/summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;param name = &quot;custVendTrans&quot;&gt;</span>CustVendTrans<span class=\"doctag\">&lt;/param&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;param name = &quot;_ledgerPostingJournal&quot;&gt;</span>LedgerVoucher<span class=\"doctag\">&lt;/param&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;param name = &quot;_useSubLedger&quot;&gt;</span>UseSubLedger<span class=\"doctag\">&lt;/param&gt;</span></span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">initCustVendTrans</span>(<span class=\"params\"></span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">        CustVendTrans   custVendTrans, </span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">        LedgerVoucher   _ledgerPostingJournal, </span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">        boolean         _useSubLedger</span>)</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"function\">next <span class=\"title\">initCustVendTrans</span>(<span class=\"params\">custVendTrans, _ledgerPostingJournal, _useSubLedger</span>)</span>;</span><br><span class=\"line\">        </span><br><span class=\"line\">        LedgerJournalTrans ledgerJournalTrans;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (common.TableId == tablenum(LedgerJournalTrans))</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            ledgerJournalTrans = common;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (custVendTrans.TableId == tableNum(CustTrans))</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                CustTrans custTrans  = custVendTrans;</span><br><span class=\"line\">                custTrans.HMField1   = ledgerJournalTrans.HMField1;</span><br><span class=\"line\">                custTrans.HMField2   = ledgerJournalTrans.HMField2;</span><br><span class=\"line\">                custVendTrans        = custTrans;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;summary&gt;</span></span></span><br><span class=\"line\"><span class=\"comment\"><span class=\"doctag\">///</span> Willie Yao - 07/08/2025</span></span><br><span class=\"line\"><span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;/summary&gt;</span></span></span><br><span class=\"line\">[<span class=\"meta\">ExtensionOf(classstr(VendVoucherJournal))</span>]</span><br><span class=\"line\">final <span class=\"keyword\">class</span> <span class=\"title\">HMClass_VendVoucherJournal_Extension</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> Willie Yao - 07/08/2025</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;/summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;param name = &quot;custVendTrans&quot;&gt;</span>CustVendTrans<span class=\"doctag\">&lt;/param&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;param name = &quot;_ledgerPostingJournal&quot;&gt;</span>LedgerVoucher<span class=\"doctag\">&lt;/param&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;param name = &quot;_useSubLedger&quot;&gt;</span>UseSubLedger<span class=\"doctag\">&lt;/param&gt;</span></span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">initCustVendTrans</span>(<span class=\"params\"></span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">        CustVendTrans   custVendTrans, </span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">        LedgerVoucher   _ledgerPostingJournal, </span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">        boolean         _useSubLedger</span>)</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"function\">next <span class=\"title\">initCustVendTrans</span>(<span class=\"params\">custVendTrans, _ledgerPostingJournal, _useSubLedger</span>)</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        LedgerJournalTrans ledgerJournalTrans;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (common.TableId == tablenum(LedgerJournalTrans))</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            ledgerJournalTrans = common;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (custVendTrans.TableId == tableNum(VendTrans))</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                VendTrans vendTrans  = custVendTrans;</span><br><span class=\"line\">                vendTrans.HMField1   = ledgerJournalTrans.HMField1;</span><br><span class=\"line\">                custVendTrans        = vendTrans;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Add-new-validation-logic-when-posted-LedgerJournalTrans\"><a href=\"#Add-new-validation-logic-when-posted-LedgerJournalTrans\" class=\"headerlink\" title=\"Add new validation logic when posted LedgerJournalTrans\"></a>Add new validation logic when posted LedgerJournalTrans</h2><p>Please coc the validation logic of LedgerJournalCheckPost class if developer wants to add new validation logic for LedgerJournalTrans post operation.</p>\n<figure class=\"highlight c#\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;summary&gt;</span></span></span><br><span class=\"line\"><span class=\"comment\"><span class=\"doctag\">///</span> Willie Yao - 07/08/2025</span></span><br><span class=\"line\"><span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;/summary&gt;</span></span></span><br><span class=\"line\">[<span class=\"meta\">ExtensionOf(classstr(LedgerJournalCheckPost))</span>]</span><br><span class=\"line\">final <span class=\"keyword\">class</span> <span class=\"title\">HMClass_LedgerJournalCheckPost_Extension</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> Willie Yao - 07/08/2025</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;/summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;param name = &quot;_calledFrom&quot;&gt;</span>CalledFrom<span class=\"doctag\">&lt;/param&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;returns&gt;</span>True if validate right<span class=\"doctag\">&lt;/returns&gt;</span></span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> boolean <span class=\"title\">validate</span>(<span class=\"params\">Object _calledFrom</span>)</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        boolean ret = <span class=\"function\">next <span class=\"title\">validate</span>(<span class=\"params\">_calledFrom</span>)</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        ret = <span class=\"keyword\">this</span>.newValidation() &amp;&amp; ret;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> ret;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> Willie Yao - 07/08/2025</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;/summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;returns&gt;</span>True if validate right<span class=\"doctag\">&lt;/returns&gt;</span></span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">internal</span> boolean <span class=\"title\">newValidation</span>()</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        LedgerJournalTrans  ledgerJournalTrans;</span><br><span class=\"line\">        boolean             ok = <span class=\"literal\">true</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        ok = <span class=\"keyword\">this</span>.newValidationLogic(ledgerJournalTrans) &amp;&amp; ok;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> ok;    </span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Extend-CustTrans-VendTrans-Reversal-Logic\"><a href=\"#Extend-CustTrans-VendTrans-Reversal-Logic\" class=\"headerlink\" title=\"Extend CustTrans&#x2F;VendTrans Reversal Logic\"></a>Extend CustTrans&#x2F;VendTrans Reversal Logic</h2><p>Developers must coc the reversal method and write the customized logic after the next invoke method.</p>\n<figure class=\"highlight c#\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;summary&gt;</span></span></span><br><span class=\"line\"><span class=\"comment\"><span class=\"doctag\">///</span> Willie Yao - 07/08/2025</span></span><br><span class=\"line\"><span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;/summary&gt;</span></span></span><br><span class=\"line\">[<span class=\"meta\">ExtensionOf(classstr(TransactionReversal_Cust))</span>]</span><br><span class=\"line\">final <span class=\"keyword\">class</span> <span class=\"title\">HMClass_TransactionReversal_Cust_Extension</span></span><br><span class=\"line\">&#123; </span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> Willie Yao - 07/08/2025</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;/summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;param name = &quot;args&quot;&gt;</span>Args<span class=\"doctag\">&lt;/param&gt;</span></span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">reversal</span>(<span class=\"params\">Args <span class=\"keyword\">args</span></span>)</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"function\">next <span class=\"title\">reversal</span>(<span class=\"params\"><span class=\"keyword\">args</span></span>)</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// New Logic</span></span><br><span class=\"line\">    &#125;    </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;summary&gt;</span></span></span><br><span class=\"line\"><span class=\"comment\"><span class=\"doctag\">///</span> Willie Yao - 07/08/2025</span></span><br><span class=\"line\"><span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;/summary&gt;</span></span></span><br><span class=\"line\">[<span class=\"meta\">ExtensionOf(classstr(TransactionReversal_Vend))</span>]</span><br><span class=\"line\">final <span class=\"keyword\">class</span> <span class=\"title\">HMClass_TransactionReversal_Vend_Extension</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> Willie Yao - 07/08/2025</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;/summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;param name = &quot;args&quot;&gt;</span>Args<span class=\"doctag\">&lt;/param&gt;</span></span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">reversal</span>(<span class=\"params\">Args <span class=\"keyword\">args</span></span>)</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"function\">next <span class=\"title\">reversal</span>(<span class=\"params\"><span class=\"keyword\">args</span></span>)</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// New Logic</span></span><br><span class=\"line\">    &#125;  </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>More expansion points will be updated successively in the future</p>\n</blockquote>\n","excerpt":"","more":"<blockquote>\n<p>Just recorded how to extend the feature regards the CustTrans and VendTrans.</p>\n</blockquote>\n<h2 id=\"Bring-the-customized-fields-of-LedgerJournalTrans-to-CustTrans-or-VendTrans\"><a href=\"#Bring-the-customized-fields-of-LedgerJournalTrans-to-CustTrans-or-VendTrans\" class=\"headerlink\" title=\"Bring the customized fields of LedgerJournalTrans to CustTrans or VendTrans\"></a>Bring the customized fields of LedgerJournalTrans to CustTrans or VendTrans</h2><p>If the requirement wants to create the new fields on CustTrans&#x2F;VendTrans and LedgerJournalTrans, and want to sync the customized fields to Transaction record after posting the customer journal or vendor journal. You can extend the CustVoucherJournal&#x2F;VendVoucherJournal as follows:</p>\n<figure class=\"highlight c#\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;summary&gt;</span></span></span><br><span class=\"line\"><span class=\"comment\"><span class=\"doctag\">///</span> Willie Yao - 07/08/2025</span></span><br><span class=\"line\"><span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;/summary&gt;</span></span></span><br><span class=\"line\">[<span class=\"meta\">ExtensionOf(classstr(CustVoucherJournal))</span>]</span><br><span class=\"line\">final <span class=\"keyword\">class</span> <span class=\"title\">HMClass_CustVoucherJournal_Extension</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> Willie Yao - 07/08/2025</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;/summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;param name = &quot;custVendTrans&quot;&gt;</span>CustVendTrans<span class=\"doctag\">&lt;/param&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;param name = &quot;_ledgerPostingJournal&quot;&gt;</span>LedgerVoucher<span class=\"doctag\">&lt;/param&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;param name = &quot;_useSubLedger&quot;&gt;</span>UseSubLedger<span class=\"doctag\">&lt;/param&gt;</span></span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">initCustVendTrans</span>(<span class=\"params\"></span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">        CustVendTrans   custVendTrans, </span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">        LedgerVoucher   _ledgerPostingJournal, </span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">        boolean         _useSubLedger</span>)</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"function\">next <span class=\"title\">initCustVendTrans</span>(<span class=\"params\">custVendTrans, _ledgerPostingJournal, _useSubLedger</span>)</span>;</span><br><span class=\"line\">        </span><br><span class=\"line\">        LedgerJournalTrans ledgerJournalTrans;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (common.TableId == tablenum(LedgerJournalTrans))</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            ledgerJournalTrans = common;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (custVendTrans.TableId == tableNum(CustTrans))</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                CustTrans custTrans  = custVendTrans;</span><br><span class=\"line\">                custTrans.HMField1   = ledgerJournalTrans.HMField1;</span><br><span class=\"line\">                custTrans.HMField2   = ledgerJournalTrans.HMField2;</span><br><span class=\"line\">                custVendTrans        = custTrans;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;summary&gt;</span></span></span><br><span class=\"line\"><span class=\"comment\"><span class=\"doctag\">///</span> Willie Yao - 07/08/2025</span></span><br><span class=\"line\"><span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;/summary&gt;</span></span></span><br><span class=\"line\">[<span class=\"meta\">ExtensionOf(classstr(VendVoucherJournal))</span>]</span><br><span class=\"line\">final <span class=\"keyword\">class</span> <span class=\"title\">HMClass_VendVoucherJournal_Extension</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> Willie Yao - 07/08/2025</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;/summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;param name = &quot;custVendTrans&quot;&gt;</span>CustVendTrans<span class=\"doctag\">&lt;/param&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;param name = &quot;_ledgerPostingJournal&quot;&gt;</span>LedgerVoucher<span class=\"doctag\">&lt;/param&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;param name = &quot;_useSubLedger&quot;&gt;</span>UseSubLedger<span class=\"doctag\">&lt;/param&gt;</span></span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">initCustVendTrans</span>(<span class=\"params\"></span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">        CustVendTrans   custVendTrans, </span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">        LedgerVoucher   _ledgerPostingJournal, </span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">        boolean         _useSubLedger</span>)</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"function\">next <span class=\"title\">initCustVendTrans</span>(<span class=\"params\">custVendTrans, _ledgerPostingJournal, _useSubLedger</span>)</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        LedgerJournalTrans ledgerJournalTrans;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (common.TableId == tablenum(LedgerJournalTrans))</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            ledgerJournalTrans = common;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (custVendTrans.TableId == tableNum(VendTrans))</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                VendTrans vendTrans  = custVendTrans;</span><br><span class=\"line\">                vendTrans.HMField1   = ledgerJournalTrans.HMField1;</span><br><span class=\"line\">                custVendTrans        = vendTrans;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Add-new-validation-logic-when-posted-LedgerJournalTrans\"><a href=\"#Add-new-validation-logic-when-posted-LedgerJournalTrans\" class=\"headerlink\" title=\"Add new validation logic when posted LedgerJournalTrans\"></a>Add new validation logic when posted LedgerJournalTrans</h2><p>Please coc the validation logic of LedgerJournalCheckPost class if developer wants to add new validation logic for LedgerJournalTrans post operation.</p>\n<figure class=\"highlight c#\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;summary&gt;</span></span></span><br><span class=\"line\"><span class=\"comment\"><span class=\"doctag\">///</span> Willie Yao - 07/08/2025</span></span><br><span class=\"line\"><span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;/summary&gt;</span></span></span><br><span class=\"line\">[<span class=\"meta\">ExtensionOf(classstr(LedgerJournalCheckPost))</span>]</span><br><span class=\"line\">final <span class=\"keyword\">class</span> <span class=\"title\">HMClass_LedgerJournalCheckPost_Extension</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> Willie Yao - 07/08/2025</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;/summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;param name = &quot;_calledFrom&quot;&gt;</span>CalledFrom<span class=\"doctag\">&lt;/param&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;returns&gt;</span>True if validate right<span class=\"doctag\">&lt;/returns&gt;</span></span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> boolean <span class=\"title\">validate</span>(<span class=\"params\">Object _calledFrom</span>)</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        boolean ret = <span class=\"function\">next <span class=\"title\">validate</span>(<span class=\"params\">_calledFrom</span>)</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        ret = <span class=\"keyword\">this</span>.newValidation() &amp;&amp; ret;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> ret;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> Willie Yao - 07/08/2025</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;/summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;returns&gt;</span>True if validate right<span class=\"doctag\">&lt;/returns&gt;</span></span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">internal</span> boolean <span class=\"title\">newValidation</span>()</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        LedgerJournalTrans  ledgerJournalTrans;</span><br><span class=\"line\">        boolean             ok = <span class=\"literal\">true</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        ok = <span class=\"keyword\">this</span>.newValidationLogic(ledgerJournalTrans) &amp;&amp; ok;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> ok;    </span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Extend-CustTrans-VendTrans-Reversal-Logic\"><a href=\"#Extend-CustTrans-VendTrans-Reversal-Logic\" class=\"headerlink\" title=\"Extend CustTrans&#x2F;VendTrans Reversal Logic\"></a>Extend CustTrans&#x2F;VendTrans Reversal Logic</h2><p>Developers must coc the reversal method and write the customized logic after the next invoke method.</p>\n<figure class=\"highlight c#\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;summary&gt;</span></span></span><br><span class=\"line\"><span class=\"comment\"><span class=\"doctag\">///</span> Willie Yao - 07/08/2025</span></span><br><span class=\"line\"><span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;/summary&gt;</span></span></span><br><span class=\"line\">[<span class=\"meta\">ExtensionOf(classstr(TransactionReversal_Cust))</span>]</span><br><span class=\"line\">final <span class=\"keyword\">class</span> <span class=\"title\">HMClass_TransactionReversal_Cust_Extension</span></span><br><span class=\"line\">&#123; </span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> Willie Yao - 07/08/2025</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;/summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;param name = &quot;args&quot;&gt;</span>Args<span class=\"doctag\">&lt;/param&gt;</span></span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">reversal</span>(<span class=\"params\">Args <span class=\"keyword\">args</span></span>)</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"function\">next <span class=\"title\">reversal</span>(<span class=\"params\"><span class=\"keyword\">args</span></span>)</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// New Logic</span></span><br><span class=\"line\">    &#125;    </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;summary&gt;</span></span></span><br><span class=\"line\"><span class=\"comment\"><span class=\"doctag\">///</span> Willie Yao - 07/08/2025</span></span><br><span class=\"line\"><span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;/summary&gt;</span></span></span><br><span class=\"line\">[<span class=\"meta\">ExtensionOf(classstr(TransactionReversal_Vend))</span>]</span><br><span class=\"line\">final <span class=\"keyword\">class</span> <span class=\"title\">HMClass_TransactionReversal_Vend_Extension</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> Willie Yao - 07/08/2025</span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;/summary&gt;</span></span></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"doctag\">///</span> <span class=\"doctag\">&lt;param name = &quot;args&quot;&gt;</span>Args<span class=\"doctag\">&lt;/param&gt;</span></span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">reversal</span>(<span class=\"params\">Args <span class=\"keyword\">args</span></span>)</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"function\">next <span class=\"title\">reversal</span>(<span class=\"params\"><span class=\"keyword\">args</span></span>)</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// New Logic</span></span><br><span class=\"line\">    &#125;  </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>More expansion points will be updated successively in the future</p>\n</blockquote>\n"},{"title":"How to create a new design for a Sales Invoice report in D365FO","comments":1,"date":"2025-07-09T12:14:45.000Z","description":"How to create a new design for a Sales Invoice report in D365FO","_content":"\n> Reprinted from: https://denistrunin.com/xpptools-createledgerjournal/\n\nCreating a new Sales Invoice report design using SSRS and X++ is quite a common task. In this post, I'll try to describe how you can do this in Dynamics 365 Finance and Operations.\n\n## Sales Invoice report development\n\nI will use \"DEVTutorial\" prefix for new elements\n\n## Data provided class\n\nLet's start with a data provider. We should create a new class and extend it from the standard **SalesInvoiceDP**. In this case, we can add additional fields that are relevant only for our report.\n\n```c#\n[SRSReportParameterAttribute(classStr(SalesInvoiceContract))]\nclass DEVTutorialSalesInvoiceDP  extends SalesInvoiceDP\n{\n    protected void populateSalesInvoiceTmp(CustInvoiceJour _custInvoiceJour,\n            CustInvoiceTrans _custInvoiceTrans,\n            TaxSpec _taxSpec,\n            CustPaymSchedLine _custPaymSchedLine,\n            CustTrans _prepaymentCustTrans,\n            TaxTrans _prepaymentTaxTrans)\n    {\n        super(_custInvoiceJour, _custInvoiceTrans, _taxSpec, _custPaymSchedLine, _prepaymentCustTrans, _prepaymentTaxTrans);\n        //populate additional fields in salesInvoiceTmp here\n        //salesInvoiceTmp.MyField = '';\n        //this method is called for main lines and also for all linked tables\n        //please note, that it will not be called if there are already some data exist in salesInvoiceTmp table for the selected Sales order, you need to delete existing records   \n    }\n\n    protected void populateSalesInvoiceHeaderFooterTmp(CustInvoiceJour _custInvoiceJour, CompanyInfo _companyInfo)\n    {\n        super(_custInvoiceJour, _companyInfo);\n        //populate additional fields in salesInvoiceTmp here\n        //salesInvoiceHeaderFooterTmp.MyField = '';\n    } \n}\n```\n\n## Report design\n\nThen add a new SSRS report to our project\n\n{% asset_img \"CreateNewReport.png\" \"CreateNewReport\" %}\n\nWe need to add Datasets for this report. In the standard system we have 4 sales invoice datasets, let's add them all.\n\n|Dataset name|Query|\n|-|-|\n|SalesInvoiceDS|SELECT * FROM DEVTutorialSalesInvoiceDP.SalesInvoiceTmp|\n|SalesInvoiceHeaderFooterDS|SELECT * FROM DEVTutorialSalesInvoiceDP.SalesInvoiceHeaderFooterTmp|\n|SalesInvoiceLocalizationDS|SELECT * FROM DEVTutorialSalesInvoiceDP.SalesInvoiceLocalizationTmp|\n|DocuBrandDetailsDS|SELECT * FROM DEVTutorialSalesInvoiceDP.SysDocuBrandDetailsRegular|\n\nAt the end you should have something like that:\n\n{% asset_img \"ReportDatasets.png\" \"ReportDatasets\" %}\n\n## Report Design\n\nThen let's add a new Precision Design(Report)\n\nModify its properties: Size to standard A4 210x297mm and all Margins to 0.\n\n{% asset_img \"ReportProperties.png\" \"ReportProperties\" %}\n\nAdd the following sections\n\n## Header section\n\nFor the header, let's add a logo from Document branding\n\n```vb\n=First(Fields!Image1.Value, \"DocuBrandDetailsDS\")\n```\n\nand some client information\n\n```vb\n=First(Fields!SalesId.Value, \"SalesInvoiceHeaderFooterDS\")   & vbcrlf &  \nFirst(Fields!InvoiceDate.Value, \"SalesInvoiceHeaderFooterDS\")  & vbcrlf &\nFirst(Fields!InvoicingAddress.Value, \"SalesInvoiceHeaderFooterDS\")\n```\n\n## Line section\n\nAdd a new Tablix control with **SalesInvoiceDS** dataset\n\n{% asset_img \"LineTablix.png\" \"LineTablix\" %}\n\nAdjust Row visibility to the following formula \"=IIF(Fields!ItemId.Value = \"\", true, false)\" as SalesInvoiceDS may contain data from linked tables(like payment schedule)\n\n{% asset_img \"RowVisibility.png\" \"RowVisibility\" %}\n\nLet's also add a totals section. The resulting design should look like this.\n\n{% asset_img \"ReportResulting.png\" \"ReportResulting\" %}\n\n## Connect a new report to Print management\n\nA sales invoice can be used in a Print management module. In order to connect our report to this module, we need to subscribe to two events(create 2 new classes):\n\nUpdate 25/11/2021. A more detailed description can be found in the following blog [How to Add New Report Format to Print Management](https://ax.docentric.com/how-to-add-new-report-format-to-print-management/)\n\n```c#\n[ExtensionOf(classstr(PrintMgmtReportFormatPopulator))]\nfinal class PrintMgmtReportFormatPopulatorDEVTutorial_Extension{   protected void addDocuments()\n    {\n        this.addStandard(PrintMgmtDocumentType::SalesOrderInvoice);\n        next addDocuments();\n    } }\n\nfinal static class PrintMgmtDocTypeDEVTutorial_EventHandler{     [SubscribesTo(classstr(PrintMgmtDocType), delegatestr(PrintMgmtDocType, getDefaultReportFormatDelegate))]\n    public static void getDefaultReportFormatDelegate(PrintMgmtDocumentType _docType, EventHandlerResult _result)\n    {   switch (_docType)\n        {\n            case PrintMgmtDocumentType::SalesOrderInvoice:\n                _result.result(ssrsReportStr(DEVTutorialSalesInvoice, Report));\n                break;\n        }  } }\n```\n\n## Test Sales invoice report\n\nThat is all. It is time to test our report.\n\nBuild and deploy the report. Then, before the test, you need to add it to the print management settings. In order to do this - run the following job\n\n```c#\nclass DEVTutorialPopulateReports\n{   public static void main(Args _args)\n    {\n        PrintMgmtReportFormatPopulator::construct().populate();\n    }}\n```\n\nNext step is to add a logo to our report. Go to the **Document images** form and upload the image. Then go to the **Branding details** form and select this image.\n\nTo print the invoice go to the **Accounts receivable - Invoice journal**, select **Document - Original preview** and you should see our sample report:\n\n{% asset_img \"PrintedReport.png\" \"PrintedReport\" %}\n\n## The future of SSRS reporting\n\nThere may be a question of what is the future of SSRS reporting. Considering the latest news, I think that its popularity may grow. Microsoft recently released Power BI Paginated Reports that are completely based on SSRS \"rdl\" files. Technically a new Power BI Paginated Reports Builder is an old SSRS report builder with a new name(yes, another name change).\n\nCheck, for example, this recent course [Power BI Paginated Reports in a Day course](https://docs.microsoft.com/en-us/power-bi/learning-catalog/paginated-reports-online-course). Almost all its modules(except maybe 04) are relevant to D365FO development.\n\nAnd this Bear in the previous picture is not just a funny picture, it is an official mascot of Power BI [Paginated Reports](https://youtu.be/vu32LfckCt8?list=PL1N57mwBHtN1icIhpjQOaRL8r9G-wytpT&t=7). So with a new name and a new Bear, I hope the popularity of SSRS may grow.\n\n## SSRS reporting issues\n\nIf you watch this \"Power BI Paginated reports Day [course](https://docs.microsoft.com/en-us/power-bi/learning-catalog/paginated-reports-online-course)\" you may feel that SSRS is cool(presentation is really great). However, the last main update for Report Builder was 10 years ago and the current version has some issues. Just some of them:\n\n- \"rdl\" file is a very complex XML format. So in most cases, you will not be able to compare changes in the report - by using text compare you will see a huge number of differences in XML structure even for a small design change.\n- Page splitting is very basic. For example, if you have a data row that consists of multiple lines and you want to avoid page breaks inside this row, you may find that this is not supported and you need to develop your own page grouping solution.\n- You can't define a section that prints something on the footer of the last report page(and it is a quite popular requirement for reports - often it contains some bank payment information). There is a workaround for this if your report has 1 or 2 pages - you can put this information on page footer and hide the element using Globals!PageNumber and Globals!TotalPages variables, but if a report has 3 or more pages this will leave an empty space on these pages.\n- Report designer doesn't support formulas for defining Width property.\nSo there are a lot of things that can be improved, and I hope Microsoft will invest in it.\n\n## Summary\n\nReal-life invoice reports can be quite complex and require a lot of efforts to create them. However, as we see, creating a simple Sales Invoice design is not a complex task. You can use the project above as a starting point(another option to consider is to install modern design [templates](https://docs.microsoft.com/en-us/dynamics365/fin-ops-core/dev-itpro/analytics/install-modern-report-design-templates#apply-the-modern-designs)).\n\nIf you have some hints for SSRS report development, don't hesitate to post a comment. The project used in this post can be downloaded from my [GitHub](https://github.com/TrudAX/XppTools/tree/master/DEVTutorial/DEVTutorialReports)(you can download a model to a temporary folder and add elements from it to your project using \"Add - Existing item..\" command)","source":"_posts/xpp-extendsalesinvoicereport.md","raw":"---\ntitle: How to create a new design for a Sales Invoice report in D365FO\ncomments: true\ndate: 2025-07-09 20:14:45\ntags:\n - ssrs\n - sales invoice report\ncategories:\n - x++\ndescription: How to create a new design for a Sales Invoice report in D365FO\n---\n\n> Reprinted from: https://denistrunin.com/xpptools-createledgerjournal/\n\nCreating a new Sales Invoice report design using SSRS and X++ is quite a common task. In this post, I'll try to describe how you can do this in Dynamics 365 Finance and Operations.\n\n## Sales Invoice report development\n\nI will use \"DEVTutorial\" prefix for new elements\n\n## Data provided class\n\nLet's start with a data provider. We should create a new class and extend it from the standard **SalesInvoiceDP**. In this case, we can add additional fields that are relevant only for our report.\n\n```c#\n[SRSReportParameterAttribute(classStr(SalesInvoiceContract))]\nclass DEVTutorialSalesInvoiceDP  extends SalesInvoiceDP\n{\n    protected void populateSalesInvoiceTmp(CustInvoiceJour _custInvoiceJour,\n            CustInvoiceTrans _custInvoiceTrans,\n            TaxSpec _taxSpec,\n            CustPaymSchedLine _custPaymSchedLine,\n            CustTrans _prepaymentCustTrans,\n            TaxTrans _prepaymentTaxTrans)\n    {\n        super(_custInvoiceJour, _custInvoiceTrans, _taxSpec, _custPaymSchedLine, _prepaymentCustTrans, _prepaymentTaxTrans);\n        //populate additional fields in salesInvoiceTmp here\n        //salesInvoiceTmp.MyField = '';\n        //this method is called for main lines and also for all linked tables\n        //please note, that it will not be called if there are already some data exist in salesInvoiceTmp table for the selected Sales order, you need to delete existing records   \n    }\n\n    protected void populateSalesInvoiceHeaderFooterTmp(CustInvoiceJour _custInvoiceJour, CompanyInfo _companyInfo)\n    {\n        super(_custInvoiceJour, _companyInfo);\n        //populate additional fields in salesInvoiceTmp here\n        //salesInvoiceHeaderFooterTmp.MyField = '';\n    } \n}\n```\n\n## Report design\n\nThen add a new SSRS report to our project\n\n{% asset_img \"CreateNewReport.png\" \"CreateNewReport\" %}\n\nWe need to add Datasets for this report. In the standard system we have 4 sales invoice datasets, let's add them all.\n\n|Dataset name|Query|\n|-|-|\n|SalesInvoiceDS|SELECT * FROM DEVTutorialSalesInvoiceDP.SalesInvoiceTmp|\n|SalesInvoiceHeaderFooterDS|SELECT * FROM DEVTutorialSalesInvoiceDP.SalesInvoiceHeaderFooterTmp|\n|SalesInvoiceLocalizationDS|SELECT * FROM DEVTutorialSalesInvoiceDP.SalesInvoiceLocalizationTmp|\n|DocuBrandDetailsDS|SELECT * FROM DEVTutorialSalesInvoiceDP.SysDocuBrandDetailsRegular|\n\nAt the end you should have something like that:\n\n{% asset_img \"ReportDatasets.png\" \"ReportDatasets\" %}\n\n## Report Design\n\nThen let's add a new Precision Design(Report)\n\nModify its properties: Size to standard A4 210x297mm and all Margins to 0.\n\n{% asset_img \"ReportProperties.png\" \"ReportProperties\" %}\n\nAdd the following sections\n\n## Header section\n\nFor the header, let's add a logo from Document branding\n\n```vb\n=First(Fields!Image1.Value, \"DocuBrandDetailsDS\")\n```\n\nand some client information\n\n```vb\n=First(Fields!SalesId.Value, \"SalesInvoiceHeaderFooterDS\")   & vbcrlf &  \nFirst(Fields!InvoiceDate.Value, \"SalesInvoiceHeaderFooterDS\")  & vbcrlf &\nFirst(Fields!InvoicingAddress.Value, \"SalesInvoiceHeaderFooterDS\")\n```\n\n## Line section\n\nAdd a new Tablix control with **SalesInvoiceDS** dataset\n\n{% asset_img \"LineTablix.png\" \"LineTablix\" %}\n\nAdjust Row visibility to the following formula \"=IIF(Fields!ItemId.Value = \"\", true, false)\" as SalesInvoiceDS may contain data from linked tables(like payment schedule)\n\n{% asset_img \"RowVisibility.png\" \"RowVisibility\" %}\n\nLet's also add a totals section. The resulting design should look like this.\n\n{% asset_img \"ReportResulting.png\" \"ReportResulting\" %}\n\n## Connect a new report to Print management\n\nA sales invoice can be used in a Print management module. In order to connect our report to this module, we need to subscribe to two events(create 2 new classes):\n\nUpdate 25/11/2021. A more detailed description can be found in the following blog [How to Add New Report Format to Print Management](https://ax.docentric.com/how-to-add-new-report-format-to-print-management/)\n\n```c#\n[ExtensionOf(classstr(PrintMgmtReportFormatPopulator))]\nfinal class PrintMgmtReportFormatPopulatorDEVTutorial_Extension{   protected void addDocuments()\n    {\n        this.addStandard(PrintMgmtDocumentType::SalesOrderInvoice);\n        next addDocuments();\n    } }\n\nfinal static class PrintMgmtDocTypeDEVTutorial_EventHandler{     [SubscribesTo(classstr(PrintMgmtDocType), delegatestr(PrintMgmtDocType, getDefaultReportFormatDelegate))]\n    public static void getDefaultReportFormatDelegate(PrintMgmtDocumentType _docType, EventHandlerResult _result)\n    {   switch (_docType)\n        {\n            case PrintMgmtDocumentType::SalesOrderInvoice:\n                _result.result(ssrsReportStr(DEVTutorialSalesInvoice, Report));\n                break;\n        }  } }\n```\n\n## Test Sales invoice report\n\nThat is all. It is time to test our report.\n\nBuild and deploy the report. Then, before the test, you need to add it to the print management settings. In order to do this - run the following job\n\n```c#\nclass DEVTutorialPopulateReports\n{   public static void main(Args _args)\n    {\n        PrintMgmtReportFormatPopulator::construct().populate();\n    }}\n```\n\nNext step is to add a logo to our report. Go to the **Document images** form and upload the image. Then go to the **Branding details** form and select this image.\n\nTo print the invoice go to the **Accounts receivable - Invoice journal**, select **Document - Original preview** and you should see our sample report:\n\n{% asset_img \"PrintedReport.png\" \"PrintedReport\" %}\n\n## The future of SSRS reporting\n\nThere may be a question of what is the future of SSRS reporting. Considering the latest news, I think that its popularity may grow. Microsoft recently released Power BI Paginated Reports that are completely based on SSRS \"rdl\" files. Technically a new Power BI Paginated Reports Builder is an old SSRS report builder with a new name(yes, another name change).\n\nCheck, for example, this recent course [Power BI Paginated Reports in a Day course](https://docs.microsoft.com/en-us/power-bi/learning-catalog/paginated-reports-online-course). Almost all its modules(except maybe 04) are relevant to D365FO development.\n\nAnd this Bear in the previous picture is not just a funny picture, it is an official mascot of Power BI [Paginated Reports](https://youtu.be/vu32LfckCt8?list=PL1N57mwBHtN1icIhpjQOaRL8r9G-wytpT&t=7). So with a new name and a new Bear, I hope the popularity of SSRS may grow.\n\n## SSRS reporting issues\n\nIf you watch this \"Power BI Paginated reports Day [course](https://docs.microsoft.com/en-us/power-bi/learning-catalog/paginated-reports-online-course)\" you may feel that SSRS is cool(presentation is really great). However, the last main update for Report Builder was 10 years ago and the current version has some issues. Just some of them:\n\n- \"rdl\" file is a very complex XML format. So in most cases, you will not be able to compare changes in the report - by using text compare you will see a huge number of differences in XML structure even for a small design change.\n- Page splitting is very basic. For example, if you have a data row that consists of multiple lines and you want to avoid page breaks inside this row, you may find that this is not supported and you need to develop your own page grouping solution.\n- You can't define a section that prints something on the footer of the last report page(and it is a quite popular requirement for reports - often it contains some bank payment information). There is a workaround for this if your report has 1 or 2 pages - you can put this information on page footer and hide the element using Globals!PageNumber and Globals!TotalPages variables, but if a report has 3 or more pages this will leave an empty space on these pages.\n- Report designer doesn't support formulas for defining Width property.\nSo there are a lot of things that can be improved, and I hope Microsoft will invest in it.\n\n## Summary\n\nReal-life invoice reports can be quite complex and require a lot of efforts to create them. However, as we see, creating a simple Sales Invoice design is not a complex task. You can use the project above as a starting point(another option to consider is to install modern design [templates](https://docs.microsoft.com/en-us/dynamics365/fin-ops-core/dev-itpro/analytics/install-modern-report-design-templates#apply-the-modern-designs)).\n\nIf you have some hints for SSRS report development, don't hesitate to post a comment. The project used in this post can be downloaded from my [GitHub](https://github.com/TrudAX/XppTools/tree/master/DEVTutorial/DEVTutorialReports)(you can download a model to a temporary folder and add elements from it to your project using \"Add - Existing item..\" command)","slug":"xpp-extendsalesinvoicereport","published":1,"updated":"2025-07-09T12:27:53.608Z","layout":"post","photos":[],"_id":"cmcvxsshs000z3cugcsk3gy2j","content":"<blockquote>\n<p>Reprinted from: <a href=\"https://denistrunin.com/xpptools-createledgerjournal/\">https://denistrunin.com/xpptools-createledgerjournal/</a></p>\n</blockquote>\n<p>Creating a new Sales Invoice report design using SSRS and X++ is quite a common task. In this post, I’ll try to describe how you can do this in Dynamics 365 Finance and Operations.</p>\n<h2 id=\"Sales-Invoice-report-development\"><a href=\"#Sales-Invoice-report-development\" class=\"headerlink\" title=\"Sales Invoice report development\"></a>Sales Invoice report development</h2><p>I will use “DEVTutorial” prefix for new elements</p>\n<h2 id=\"Data-provided-class\"><a href=\"#Data-provided-class\" class=\"headerlink\" title=\"Data provided class\"></a>Data provided class</h2><p>Let’s start with a data provider. We should create a new class and extend it from the standard <strong>SalesInvoiceDP</strong>. In this case, we can add additional fields that are relevant only for our report.</p>\n<figure class=\"highlight c#\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[<span class=\"meta\">SRSReportParameterAttribute(classStr(SalesInvoiceContract))</span>]</span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title\">DEVTutorialSalesInvoiceDP</span>  <span class=\"title\">extends</span> <span class=\"title\">SalesInvoiceDP</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">populateSalesInvoiceTmp</span>(<span class=\"params\">CustInvoiceJour _custInvoiceJour,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">            CustInvoiceTrans _custInvoiceTrans,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">            TaxSpec _taxSpec,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">            CustPaymSchedLine _custPaymSchedLine,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">            CustTrans _prepaymentCustTrans,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">            TaxTrans _prepaymentTaxTrans</span>)</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        super(_custInvoiceJour, _custInvoiceTrans, _taxSpec, _custPaymSchedLine, _prepaymentCustTrans, _prepaymentTaxTrans);</span><br><span class=\"line\">        <span class=\"comment\">//populate additional fields in salesInvoiceTmp here</span></span><br><span class=\"line\">        <span class=\"comment\">//salesInvoiceTmp.MyField = &#x27;&#x27;;</span></span><br><span class=\"line\">        <span class=\"comment\">//this method is called for main lines and also for all linked tables</span></span><br><span class=\"line\">        <span class=\"comment\">//please note, that it will not be called if there are already some data exist in salesInvoiceTmp table for the selected Sales order, you need to delete existing records   </span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">populateSalesInvoiceHeaderFooterTmp</span>(<span class=\"params\">CustInvoiceJour _custInvoiceJour, CompanyInfo _companyInfo</span>)</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        super(_custInvoiceJour, _companyInfo);</span><br><span class=\"line\">        <span class=\"comment\">//populate additional fields in salesInvoiceTmp here</span></span><br><span class=\"line\">        <span class=\"comment\">//salesInvoiceHeaderFooterTmp.MyField = &#x27;&#x27;;</span></span><br><span class=\"line\">    &#125; </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Report-design\"><a href=\"#Report-design\" class=\"headerlink\" title=\"Report design\"></a>Report design</h2><p>Then add a new SSRS report to our project</p>\n<img src=\"/2025/07/09/xpp-extendsalesinvoicereport/CreateNewReport.png\" class=\"\" title=\"CreateNewReport\">\n\n<p>We need to add Datasets for this report. In the standard system we have 4 sales invoice datasets, let’s add them all.</p>\n<table>\n<thead>\n<tr>\n<th>Dataset name</th>\n<th>Query</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>SalesInvoiceDS</td>\n<td>SELECT * FROM DEVTutorialSalesInvoiceDP.SalesInvoiceTmp</td>\n</tr>\n<tr>\n<td>SalesInvoiceHeaderFooterDS</td>\n<td>SELECT * FROM DEVTutorialSalesInvoiceDP.SalesInvoiceHeaderFooterTmp</td>\n</tr>\n<tr>\n<td>SalesInvoiceLocalizationDS</td>\n<td>SELECT * FROM DEVTutorialSalesInvoiceDP.SalesInvoiceLocalizationTmp</td>\n</tr>\n<tr>\n<td>DocuBrandDetailsDS</td>\n<td>SELECT * FROM DEVTutorialSalesInvoiceDP.SysDocuBrandDetailsRegular</td>\n</tr>\n</tbody></table>\n<p>At the end you should have something like that:</p>\n<img src=\"/2025/07/09/xpp-extendsalesinvoicereport/ReportDatasets.png\" class=\"\" title=\"ReportDatasets\">\n\n<h2 id=\"Report-Design\"><a href=\"#Report-Design\" class=\"headerlink\" title=\"Report Design\"></a>Report Design</h2><p>Then let’s add a new Precision Design(Report)</p>\n<p>Modify its properties: Size to standard A4 210x297mm and all Margins to 0.</p>\n<img src=\"/2025/07/09/xpp-extendsalesinvoicereport/ReportProperties.png\" class=\"\" title=\"ReportProperties\">\n\n<p>Add the following sections</p>\n<h2 id=\"Header-section\"><a href=\"#Header-section\" class=\"headerlink\" title=\"Header section\"></a>Header section</h2><p>For the header, let’s add a logo from Document branding</p>\n<figure class=\"highlight vb\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">=First(Fields!Image1.Value, <span class=\"string\">&quot;DocuBrandDetailsDS&quot;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>and some client information</p>\n<figure class=\"highlight vb\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">=First(Fields!SalesId.Value, <span class=\"string\">&quot;SalesInvoiceHeaderFooterDS&quot;</span>)   &amp; vbcrlf &amp;  </span><br><span class=\"line\">First(Fields!InvoiceDate.Value, <span class=\"string\">&quot;SalesInvoiceHeaderFooterDS&quot;</span>)  &amp; vbcrlf &amp;</span><br><span class=\"line\">First(Fields!InvoicingAddress.Value, <span class=\"string\">&quot;SalesInvoiceHeaderFooterDS&quot;</span>)</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Line-section\"><a href=\"#Line-section\" class=\"headerlink\" title=\"Line section\"></a>Line section</h2><p>Add a new Tablix control with <strong>SalesInvoiceDS</strong> dataset</p>\n<img src=\"/2025/07/09/xpp-extendsalesinvoicereport/LineTablix.png\" class=\"\" title=\"LineTablix\">\n\n<p>Adjust Row visibility to the following formula “&#x3D;IIF(Fields!ItemId.Value &#x3D; “”, true, false)” as SalesInvoiceDS may contain data from linked tables(like payment schedule)</p>\n<img src=\"/2025/07/09/xpp-extendsalesinvoicereport/RowVisibility.png\" class=\"\" title=\"RowVisibility\">\n\n<p>Let’s also add a totals section. The resulting design should look like this.</p>\n<img src=\"/2025/07/09/xpp-extendsalesinvoicereport/ReportResulting.png\" class=\"\" title=\"ReportResulting\">\n\n<h2 id=\"Connect-a-new-report-to-Print-management\"><a href=\"#Connect-a-new-report-to-Print-management\" class=\"headerlink\" title=\"Connect a new report to Print management\"></a>Connect a new report to Print management</h2><p>A sales invoice can be used in a Print management module. In order to connect our report to this module, we need to subscribe to two events(create 2 new classes):</p>\n<p>Update 25&#x2F;11&#x2F;2021. A more detailed description can be found in the following blog <a href=\"https://ax.docentric.com/how-to-add-new-report-format-to-print-management/\">How to Add New Report Format to Print Management</a></p>\n<figure class=\"highlight c#\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[<span class=\"meta\">ExtensionOf(classstr(PrintMgmtReportFormatPopulator))</span>]</span><br><span class=\"line\">final <span class=\"keyword\">class</span> <span class=\"title\">PrintMgmtReportFormatPopulatorDEVTutorial_Extension</span>&#123;   <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">addDocuments</span>()</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.addStandard(PrintMgmtDocumentType::SalesOrderInvoice);</span><br><span class=\"line\">        <span class=\"function\">next <span class=\"title\">addDocuments</span>()</span>;</span><br><span class=\"line\">    &#125; &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">final <span class=\"keyword\">static</span> <span class=\"keyword\">class</span> <span class=\"title\">PrintMgmtDocTypeDEVTutorial_EventHandler</span>&#123;     [SubscribesTo(classstr(PrintMgmtDocType), delegatestr(PrintMgmtDocType, getDefaultReportFormatDelegate))]</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">getDefaultReportFormatDelegate</span>(<span class=\"params\">PrintMgmtDocumentType _docType, EventHandlerResult _result</span>)</span></span><br><span class=\"line\">    &#123;   <span class=\"keyword\">switch</span> (_docType)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> PrintMgmtDocumentType::SalesOrderInvoice:</span><br><span class=\"line\">                _result.result(ssrsReportStr(DEVTutorialSalesInvoice, Report));</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        &#125;  &#125; &#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Test-Sales-invoice-report\"><a href=\"#Test-Sales-invoice-report\" class=\"headerlink\" title=\"Test Sales invoice report\"></a>Test Sales invoice report</h2><p>That is all. It is time to test our report.</p>\n<p>Build and deploy the report. Then, before the test, you need to add it to the print management settings. In order to do this - run the following job</p>\n<figure class=\"highlight c#\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title\">DEVTutorialPopulateReports</span></span><br><span class=\"line\">&#123;   <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span>(<span class=\"params\">Args _args</span>)</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        PrintMgmtReportFormatPopulator::construct().populate();</span><br><span class=\"line\">    &#125;&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Next step is to add a logo to our report. Go to the <strong>Document images</strong> form and upload the image. Then go to the <strong>Branding details</strong> form and select this image.</p>\n<p>To print the invoice go to the <strong>Accounts receivable - Invoice journal</strong>, select <strong>Document - Original preview</strong> and you should see our sample report:</p>\n<img src=\"/2025/07/09/xpp-extendsalesinvoicereport/PrintedReport.png\" class=\"\" title=\"PrintedReport\">\n\n<h2 id=\"The-future-of-SSRS-reporting\"><a href=\"#The-future-of-SSRS-reporting\" class=\"headerlink\" title=\"The future of SSRS reporting\"></a>The future of SSRS reporting</h2><p>There may be a question of what is the future of SSRS reporting. Considering the latest news, I think that its popularity may grow. Microsoft recently released Power BI Paginated Reports that are completely based on SSRS “rdl” files. Technically a new Power BI Paginated Reports Builder is an old SSRS report builder with a new name(yes, another name change).</p>\n<p>Check, for example, this recent course <a href=\"https://docs.microsoft.com/en-us/power-bi/learning-catalog/paginated-reports-online-course\">Power BI Paginated Reports in a Day course</a>. Almost all its modules(except maybe 04) are relevant to D365FO development.</p>\n<p>And this Bear in the previous picture is not just a funny picture, it is an official mascot of Power BI <a href=\"https://youtu.be/vu32LfckCt8?list=PL1N57mwBHtN1icIhpjQOaRL8r9G-wytpT&t=7\">Paginated Reports</a>. So with a new name and a new Bear, I hope the popularity of SSRS may grow.</p>\n<h2 id=\"SSRS-reporting-issues\"><a href=\"#SSRS-reporting-issues\" class=\"headerlink\" title=\"SSRS reporting issues\"></a>SSRS reporting issues</h2><p>If you watch this “Power BI Paginated reports Day <a href=\"https://docs.microsoft.com/en-us/power-bi/learning-catalog/paginated-reports-online-course\">course</a>“ you may feel that SSRS is cool(presentation is really great). However, the last main update for Report Builder was 10 years ago and the current version has some issues. Just some of them:</p>\n<ul>\n<li>“rdl” file is a very complex XML format. So in most cases, you will not be able to compare changes in the report - by using text compare you will see a huge number of differences in XML structure even for a small design change.</li>\n<li>Page splitting is very basic. For example, if you have a data row that consists of multiple lines and you want to avoid page breaks inside this row, you may find that this is not supported and you need to develop your own page grouping solution.</li>\n<li>You can’t define a section that prints something on the footer of the last report page(and it is a quite popular requirement for reports - often it contains some bank payment information). There is a workaround for this if your report has 1 or 2 pages - you can put this information on page footer and hide the element using Globals!PageNumber and Globals!TotalPages variables, but if a report has 3 or more pages this will leave an empty space on these pages.</li>\n<li>Report designer doesn’t support formulas for defining Width property.<br>So there are a lot of things that can be improved, and I hope Microsoft will invest in it.</li>\n</ul>\n<h2 id=\"Summary\"><a href=\"#Summary\" class=\"headerlink\" title=\"Summary\"></a>Summary</h2><p>Real-life invoice reports can be quite complex and require a lot of efforts to create them. However, as we see, creating a simple Sales Invoice design is not a complex task. You can use the project above as a starting point(another option to consider is to install modern design <a href=\"https://docs.microsoft.com/en-us/dynamics365/fin-ops-core/dev-itpro/analytics/install-modern-report-design-templates#apply-the-modern-designs\">templates</a>).</p>\n<p>If you have some hints for SSRS report development, don’t hesitate to post a comment. The project used in this post can be downloaded from my <a href=\"https://github.com/TrudAX/XppTools/tree/master/DEVTutorial/DEVTutorialReports\">GitHub</a>(you can download a model to a temporary folder and add elements from it to your project using “Add - Existing item..” command)</p>\n","excerpt":"","more":"<blockquote>\n<p>Reprinted from: <a href=\"https://denistrunin.com/xpptools-createledgerjournal/\">https://denistrunin.com/xpptools-createledgerjournal/</a></p>\n</blockquote>\n<p>Creating a new Sales Invoice report design using SSRS and X++ is quite a common task. In this post, I’ll try to describe how you can do this in Dynamics 365 Finance and Operations.</p>\n<h2 id=\"Sales-Invoice-report-development\"><a href=\"#Sales-Invoice-report-development\" class=\"headerlink\" title=\"Sales Invoice report development\"></a>Sales Invoice report development</h2><p>I will use “DEVTutorial” prefix for new elements</p>\n<h2 id=\"Data-provided-class\"><a href=\"#Data-provided-class\" class=\"headerlink\" title=\"Data provided class\"></a>Data provided class</h2><p>Let’s start with a data provider. We should create a new class and extend it from the standard <strong>SalesInvoiceDP</strong>. In this case, we can add additional fields that are relevant only for our report.</p>\n<figure class=\"highlight c#\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[<span class=\"meta\">SRSReportParameterAttribute(classStr(SalesInvoiceContract))</span>]</span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title\">DEVTutorialSalesInvoiceDP</span>  <span class=\"title\">extends</span> <span class=\"title\">SalesInvoiceDP</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">populateSalesInvoiceTmp</span>(<span class=\"params\">CustInvoiceJour _custInvoiceJour,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">            CustInvoiceTrans _custInvoiceTrans,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">            TaxSpec _taxSpec,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">            CustPaymSchedLine _custPaymSchedLine,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">            CustTrans _prepaymentCustTrans,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">            TaxTrans _prepaymentTaxTrans</span>)</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        super(_custInvoiceJour, _custInvoiceTrans, _taxSpec, _custPaymSchedLine, _prepaymentCustTrans, _prepaymentTaxTrans);</span><br><span class=\"line\">        <span class=\"comment\">//populate additional fields in salesInvoiceTmp here</span></span><br><span class=\"line\">        <span class=\"comment\">//salesInvoiceTmp.MyField = &#x27;&#x27;;</span></span><br><span class=\"line\">        <span class=\"comment\">//this method is called for main lines and also for all linked tables</span></span><br><span class=\"line\">        <span class=\"comment\">//please note, that it will not be called if there are already some data exist in salesInvoiceTmp table for the selected Sales order, you need to delete existing records   </span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">populateSalesInvoiceHeaderFooterTmp</span>(<span class=\"params\">CustInvoiceJour _custInvoiceJour, CompanyInfo _companyInfo</span>)</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        super(_custInvoiceJour, _companyInfo);</span><br><span class=\"line\">        <span class=\"comment\">//populate additional fields in salesInvoiceTmp here</span></span><br><span class=\"line\">        <span class=\"comment\">//salesInvoiceHeaderFooterTmp.MyField = &#x27;&#x27;;</span></span><br><span class=\"line\">    &#125; </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Report-design\"><a href=\"#Report-design\" class=\"headerlink\" title=\"Report design\"></a>Report design</h2><p>Then add a new SSRS report to our project</p>\n<img src=\"/2025/07/09/xpp-extendsalesinvoicereport/CreateNewReport.png\" class=\"\" title=\"CreateNewReport\">\n\n<p>We need to add Datasets for this report. In the standard system we have 4 sales invoice datasets, let’s add them all.</p>\n<table>\n<thead>\n<tr>\n<th>Dataset name</th>\n<th>Query</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>SalesInvoiceDS</td>\n<td>SELECT * FROM DEVTutorialSalesInvoiceDP.SalesInvoiceTmp</td>\n</tr>\n<tr>\n<td>SalesInvoiceHeaderFooterDS</td>\n<td>SELECT * FROM DEVTutorialSalesInvoiceDP.SalesInvoiceHeaderFooterTmp</td>\n</tr>\n<tr>\n<td>SalesInvoiceLocalizationDS</td>\n<td>SELECT * FROM DEVTutorialSalesInvoiceDP.SalesInvoiceLocalizationTmp</td>\n</tr>\n<tr>\n<td>DocuBrandDetailsDS</td>\n<td>SELECT * FROM DEVTutorialSalesInvoiceDP.SysDocuBrandDetailsRegular</td>\n</tr>\n</tbody></table>\n<p>At the end you should have something like that:</p>\n<img src=\"/2025/07/09/xpp-extendsalesinvoicereport/ReportDatasets.png\" class=\"\" title=\"ReportDatasets\">\n\n<h2 id=\"Report-Design\"><a href=\"#Report-Design\" class=\"headerlink\" title=\"Report Design\"></a>Report Design</h2><p>Then let’s add a new Precision Design(Report)</p>\n<p>Modify its properties: Size to standard A4 210x297mm and all Margins to 0.</p>\n<img src=\"/2025/07/09/xpp-extendsalesinvoicereport/ReportProperties.png\" class=\"\" title=\"ReportProperties\">\n\n<p>Add the following sections</p>\n<h2 id=\"Header-section\"><a href=\"#Header-section\" class=\"headerlink\" title=\"Header section\"></a>Header section</h2><p>For the header, let’s add a logo from Document branding</p>\n<figure class=\"highlight vb\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">=First(Fields!Image1.Value, <span class=\"string\">&quot;DocuBrandDetailsDS&quot;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>and some client information</p>\n<figure class=\"highlight vb\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">=First(Fields!SalesId.Value, <span class=\"string\">&quot;SalesInvoiceHeaderFooterDS&quot;</span>)   &amp; vbcrlf &amp;  </span><br><span class=\"line\">First(Fields!InvoiceDate.Value, <span class=\"string\">&quot;SalesInvoiceHeaderFooterDS&quot;</span>)  &amp; vbcrlf &amp;</span><br><span class=\"line\">First(Fields!InvoicingAddress.Value, <span class=\"string\">&quot;SalesInvoiceHeaderFooterDS&quot;</span>)</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Line-section\"><a href=\"#Line-section\" class=\"headerlink\" title=\"Line section\"></a>Line section</h2><p>Add a new Tablix control with <strong>SalesInvoiceDS</strong> dataset</p>\n<img src=\"/2025/07/09/xpp-extendsalesinvoicereport/LineTablix.png\" class=\"\" title=\"LineTablix\">\n\n<p>Adjust Row visibility to the following formula “&#x3D;IIF(Fields!ItemId.Value &#x3D; “”, true, false)” as SalesInvoiceDS may contain data from linked tables(like payment schedule)</p>\n<img src=\"/2025/07/09/xpp-extendsalesinvoicereport/RowVisibility.png\" class=\"\" title=\"RowVisibility\">\n\n<p>Let’s also add a totals section. The resulting design should look like this.</p>\n<img src=\"/2025/07/09/xpp-extendsalesinvoicereport/ReportResulting.png\" class=\"\" title=\"ReportResulting\">\n\n<h2 id=\"Connect-a-new-report-to-Print-management\"><a href=\"#Connect-a-new-report-to-Print-management\" class=\"headerlink\" title=\"Connect a new report to Print management\"></a>Connect a new report to Print management</h2><p>A sales invoice can be used in a Print management module. In order to connect our report to this module, we need to subscribe to two events(create 2 new classes):</p>\n<p>Update 25&#x2F;11&#x2F;2021. A more detailed description can be found in the following blog <a href=\"https://ax.docentric.com/how-to-add-new-report-format-to-print-management/\">How to Add New Report Format to Print Management</a></p>\n<figure class=\"highlight c#\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[<span class=\"meta\">ExtensionOf(classstr(PrintMgmtReportFormatPopulator))</span>]</span><br><span class=\"line\">final <span class=\"keyword\">class</span> <span class=\"title\">PrintMgmtReportFormatPopulatorDEVTutorial_Extension</span>&#123;   <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">addDocuments</span>()</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.addStandard(PrintMgmtDocumentType::SalesOrderInvoice);</span><br><span class=\"line\">        <span class=\"function\">next <span class=\"title\">addDocuments</span>()</span>;</span><br><span class=\"line\">    &#125; &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">final <span class=\"keyword\">static</span> <span class=\"keyword\">class</span> <span class=\"title\">PrintMgmtDocTypeDEVTutorial_EventHandler</span>&#123;     [SubscribesTo(classstr(PrintMgmtDocType), delegatestr(PrintMgmtDocType, getDefaultReportFormatDelegate))]</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">getDefaultReportFormatDelegate</span>(<span class=\"params\">PrintMgmtDocumentType _docType, EventHandlerResult _result</span>)</span></span><br><span class=\"line\">    &#123;   <span class=\"keyword\">switch</span> (_docType)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> PrintMgmtDocumentType::SalesOrderInvoice:</span><br><span class=\"line\">                _result.result(ssrsReportStr(DEVTutorialSalesInvoice, Report));</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        &#125;  &#125; &#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Test-Sales-invoice-report\"><a href=\"#Test-Sales-invoice-report\" class=\"headerlink\" title=\"Test Sales invoice report\"></a>Test Sales invoice report</h2><p>That is all. It is time to test our report.</p>\n<p>Build and deploy the report. Then, before the test, you need to add it to the print management settings. In order to do this - run the following job</p>\n<figure class=\"highlight c#\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title\">DEVTutorialPopulateReports</span></span><br><span class=\"line\">&#123;   <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span>(<span class=\"params\">Args _args</span>)</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        PrintMgmtReportFormatPopulator::construct().populate();</span><br><span class=\"line\">    &#125;&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Next step is to add a logo to our report. Go to the <strong>Document images</strong> form and upload the image. Then go to the <strong>Branding details</strong> form and select this image.</p>\n<p>To print the invoice go to the <strong>Accounts receivable - Invoice journal</strong>, select <strong>Document - Original preview</strong> and you should see our sample report:</p>\n<img src=\"/2025/07/09/xpp-extendsalesinvoicereport/PrintedReport.png\" class=\"\" title=\"PrintedReport\">\n\n<h2 id=\"The-future-of-SSRS-reporting\"><a href=\"#The-future-of-SSRS-reporting\" class=\"headerlink\" title=\"The future of SSRS reporting\"></a>The future of SSRS reporting</h2><p>There may be a question of what is the future of SSRS reporting. Considering the latest news, I think that its popularity may grow. Microsoft recently released Power BI Paginated Reports that are completely based on SSRS “rdl” files. Technically a new Power BI Paginated Reports Builder is an old SSRS report builder with a new name(yes, another name change).</p>\n<p>Check, for example, this recent course <a href=\"https://docs.microsoft.com/en-us/power-bi/learning-catalog/paginated-reports-online-course\">Power BI Paginated Reports in a Day course</a>. Almost all its modules(except maybe 04) are relevant to D365FO development.</p>\n<p>And this Bear in the previous picture is not just a funny picture, it is an official mascot of Power BI <a href=\"https://youtu.be/vu32LfckCt8?list=PL1N57mwBHtN1icIhpjQOaRL8r9G-wytpT&t=7\">Paginated Reports</a>. So with a new name and a new Bear, I hope the popularity of SSRS may grow.</p>\n<h2 id=\"SSRS-reporting-issues\"><a href=\"#SSRS-reporting-issues\" class=\"headerlink\" title=\"SSRS reporting issues\"></a>SSRS reporting issues</h2><p>If you watch this “Power BI Paginated reports Day <a href=\"https://docs.microsoft.com/en-us/power-bi/learning-catalog/paginated-reports-online-course\">course</a>“ you may feel that SSRS is cool(presentation is really great). However, the last main update for Report Builder was 10 years ago and the current version has some issues. Just some of them:</p>\n<ul>\n<li>“rdl” file is a very complex XML format. So in most cases, you will not be able to compare changes in the report - by using text compare you will see a huge number of differences in XML structure even for a small design change.</li>\n<li>Page splitting is very basic. For example, if you have a data row that consists of multiple lines and you want to avoid page breaks inside this row, you may find that this is not supported and you need to develop your own page grouping solution.</li>\n<li>You can’t define a section that prints something on the footer of the last report page(and it is a quite popular requirement for reports - often it contains some bank payment information). There is a workaround for this if your report has 1 or 2 pages - you can put this information on page footer and hide the element using Globals!PageNumber and Globals!TotalPages variables, but if a report has 3 or more pages this will leave an empty space on these pages.</li>\n<li>Report designer doesn’t support formulas for defining Width property.<br>So there are a lot of things that can be improved, and I hope Microsoft will invest in it.</li>\n</ul>\n<h2 id=\"Summary\"><a href=\"#Summary\" class=\"headerlink\" title=\"Summary\"></a>Summary</h2><p>Real-life invoice reports can be quite complex and require a lot of efforts to create them. However, as we see, creating a simple Sales Invoice design is not a complex task. You can use the project above as a starting point(another option to consider is to install modern design <a href=\"https://docs.microsoft.com/en-us/dynamics365/fin-ops-core/dev-itpro/analytics/install-modern-report-design-templates#apply-the-modern-designs\">templates</a>).</p>\n<p>If you have some hints for SSRS report development, don’t hesitate to post a comment. The project used in this post can be downloaded from my <a href=\"https://github.com/TrudAX/XppTools/tree/master/DEVTutorial/DEVTutorialReports\">GitHub</a>(you can download a model to a temporary folder and add elements from it to your project using “Add - Existing item..” command)</p>\n"},{"title":"Get selected records in a grid on a form - X++","comments":1,"date":"2025-07-08T12:23:17.000Z","description":"Get selected records in a grid on a form - X++","_content":"\nIf you can get the form data source element, then you can get the selected records. Developers usually can get the args in the source code. That is a sally port for extracting the selected records.\n\n```c#\n\npublic static void main(Args _args)\n{\n    FormRun formRun = _args.caller();\n    FormDataSource formDS = formRun.dataSource();\n    SalesTable salesTable; // Use the SalesTable for testing.\n\n    while (salesTable = formDS.mark(1) ? formDS.cursor() : formDS.getFirst(1);\n            salesTable:\n            salesTable.getNext())\n    {}\n}\n\npublic void modified()\n{\n    SalesTable salesTable; // Use the SalesTable for testing.\n\n    while (salesTable = SalesTable_ds.mark(1) ? SalesTable_ds.cursor() : SalesTable_ds.getFirst(1);\n            salesTable:\n            salesTable.getNext())\n    {}\n}\n\n···","source":"_posts/xpp-getselectedrecords.md","raw":"---\ntitle: Get selected records in a grid on a form - X++\ncomments: true\ndate: 2025-07-08 20:23:17\ntags:\ncategories:\n - x++\ndescription: Get selected records in a grid on a form - X++\n---\n\nIf you can get the form data source element, then you can get the selected records. Developers usually can get the args in the source code. That is a sally port for extracting the selected records.\n\n```c#\n\npublic static void main(Args _args)\n{\n    FormRun formRun = _args.caller();\n    FormDataSource formDS = formRun.dataSource();\n    SalesTable salesTable; // Use the SalesTable for testing.\n\n    while (salesTable = formDS.mark(1) ? formDS.cursor() : formDS.getFirst(1);\n            salesTable:\n            salesTable.getNext())\n    {}\n}\n\npublic void modified()\n{\n    SalesTable salesTable; // Use the SalesTable for testing.\n\n    while (salesTable = SalesTable_ds.mark(1) ? SalesTable_ds.cursor() : SalesTable_ds.getFirst(1);\n            salesTable:\n            salesTable.getNext())\n    {}\n}\n\n···","slug":"xpp-getselectedrecords","published":1,"updated":"2025-07-08T12:31:07.995Z","layout":"post","photos":[],"_id":"cmcvxssht00133cugfnly3b9r","content":"<p>If you can get the form data source element, then you can get the selected records. Developers usually can get the args in the source code. That is a sally port for extracting the selected records.</p>\n<pre><code class=\"c#\">\npublic static void main(Args _args)\n&#123;\n    FormRun formRun = _args.caller();\n    FormDataSource formDS = formRun.dataSource();\n    SalesTable salesTable; // Use the SalesTable for testing.\n\n    while (salesTable = formDS.mark(1) ? formDS.cursor() : formDS.getFirst(1);\n            salesTable:\n            salesTable.getNext())\n    &#123;&#125;\n&#125;\n\npublic void modified()\n&#123;\n    SalesTable salesTable; // Use the SalesTable for testing.\n\n    while (salesTable = SalesTable_ds.mark(1) ? SalesTable_ds.cursor() : SalesTable_ds.getFirst(1);\n            salesTable:\n            salesTable.getNext())\n    &#123;&#125;\n&#125;\n\n···\n</code></pre>\n","excerpt":"","more":"<p>If you can get the form data source element, then you can get the selected records. Developers usually can get the args in the source code. That is a sally port for extracting the selected records.</p>\n<pre><code class=\"c#\">\npublic static void main(Args _args)\n&#123;\n    FormRun formRun = _args.caller();\n    FormDataSource formDS = formRun.dataSource();\n    SalesTable salesTable; // Use the SalesTable for testing.\n\n    while (salesTable = formDS.mark(1) ? formDS.cursor() : formDS.getFirst(1);\n            salesTable:\n            salesTable.getNext())\n    &#123;&#125;\n&#125;\n\npublic void modified()\n&#123;\n    SalesTable salesTable; // Use the SalesTable for testing.\n\n    while (salesTable = SalesTable_ds.mark(1) ? SalesTable_ds.cursor() : SalesTable_ds.getFirst(1);\n            salesTable:\n            salesTable.getNext())\n    &#123;&#125;\n&#125;\n\n···\n</code></pre>\n"},{"title":"Invoice Purchase Order Example","comments":1,"date":"2025-02-23T12:51:59.000Z","description":"Invoice Purchase Order Example","_content":"\n> 本文记录了 x++ 代码 invoice 采购订单的示例代码\n\n```c#\nHere is the C# code you provided with all comments removed:\n\n```csharp\npublic class GNCAutoInvoiceVendConsignedPOBatch extends RunBaseBatch implements BatchRetryable\n{\n    SysLookupMultiSelectValues  gInvoiceIds;\n    boolean                     gCreateParmTable;\n    PurchTable                  gPurchTable;\n    boolean                     gMultiPOs;\n    PurchId                     gPurchId;\n    RecordInsertList            gParmLineRecordInsertList, gParmSubLineRecordInsertList, gMarkupTrans;\n    systemSequence              gSystemSequence;\n    Num                         gInvoiceNumber;\n    TransDate                   gInvoiceDate        = DateTimeUtil::getSystemDate(DateTimeUtil::getUserPreferredTimeZone());\n    InvoiceDescriptionLarge     gDescription;\n    Map                         gTableRefIdMap      = new Map(Types::String, Types::String);\n    Map                         gItemMap            = new Map(Types::String, Types::Real);\n    DialogField     gDlgInvoiceIds;\n\n    #define.CurrentVersion(1)\n    #localmacro.CurrentList\n        gInvoiceIds\n    #endmacro\n\n    public boolean canGoBatch()\n    {\n        return true;\n    }\n\n    public boolean canGoBatchJournal()\n    {\n        return true;\n    }\n\n    public Object dialog()\n    {\n        DialogRunbase       dialog = super();\n    \n        gDlgInvoiceIds = dialog.addFieldValue(extendedTypeStr(SysLookupMultiSelectValues), gInvoiceIds, \"@SYS12128\");\n    \n        return dialog;\n    }\n\n    public void dialogPostRun(DialogRunbase _dialog)\n    {\n        super(_dialog);\n\n        Query                   query;\n        QueryBuildDataSource    qbds;\n\n        query   = new Query(queryStr(GNCAutoInvoiceVendConsignedLookupQuery));\n\n        SysLookupMultiSelectCtrl::constructWithQuery(\n                    _dialog.dialogForm().formRun(),\n                    gDlgInvoiceIds.control(),\n                    query,\n                    false,\n                    [tableNum(CustInvoiceJour), fieldNum(CustInvoiceJour, InvoiceId)]\n        );\n    }\n\n    public boolean getFromDialog()\n    {\n        gInvoiceIds = gDlgInvoiceIds.value();\n    \n        return super();\n    }\n\n    public container pack()\n    {\n        return [#CurrentVersion, #CurrentList];\n    }\n\n    static GNCAutoInvoiceVendConsignedPOBatch construct()\n    {\n        return new GNCAutoInvoiceVendConsignedPOBatch();\n    }\n\n    static ClassDescription description()\n    {\n        return \"@GNC:AutoInvoiceVendorConsignedPurchaseOrder\";\n    }\n\n    static void main(Args _args)\n    {\n        GNCAutoInvoiceVendConsignedPOBatch      batch;\n    \n        batch = GNCAutoInvoiceVendConsignedPOBatch::construct();\n    \n        if (batch.prompt())\n        {\n            batch.runOperation();\n        }\n    }\n\n    protected boolean canRunInNewSession()\n    {\n        return false;\n    }\n\n    [Hookable(false)]\n    public final boolean isRetryable()\n    {\n        return false;\n    }\n\n    public Qty getFinalInvoiceQty(ItemId _itemId, Qty _qty)\n    {\n        Qty retQty, storeQty;\n\n        GNCProcessedVendorConsignedInvAdjustments processedVendorConsignedInvAdjustments = GNCProcessedVendorConsignedInvAdjustments::find(_itemId, true);\n\n        if (processedVendorConsignedInvAdjustments.RecId)\n        {\n            ttsbegin;\n            storeQty = processedVendorConsignedInvAdjustments.Qty;\n            retQty = _qty - storeQty;\n            processedVendorConsignedInvAdjustments.Qty = retQty < 0 ? abs(retQty) : 0;\n            processedVendorConsignedInvAdjustments.update();\n            ttscommit;\n        }\n        else\n        {\n            retQty = _qty;\n        }\n\n        return retQty;\n    }\n\n    public void run()\n    {\n        #OCCRetryCount\n\n        setPrefix(\"@GNC:AutoInvoiceVendorConsignedPurchaseOrder\");\n        \n        query                       query_Item      = new Query(queryStr(GNCAutoInvoiceVendConsignedItemQuery));\n        QueryBuildDataSource        qbds;\n        SysLookupMultiSelectValues  qrvInvoiceIds   = strReplace(gInvoiceIds, ';', ',');\n        \n        if (qrvInvoiceIds)\n        {\n            qbds = query_Item.dataSourceTable(tableNum(CustInvoiceJour));\n            qbds.addRange(fieldNum(CustInvoiceJour, InvoiceId)).value(qrvInvoiceIds);\n        }\n\n        QueryRun                    queryRunItem    = new QueryRun(query_Item);\n        TransDateTime               earliestDateTime;\n\n        while (queryRunItem.next())\n        {\n            CustInvoiceTrans custInvoiceTrans_Item = queryRunItem.get(tableNum(CustInvoiceTrans));\n\n            Qty finalInvoiceQty = this.getfinalInvoiceQty(custInvoiceTrans_Item.ItemId, custInvoiceTrans_Item.Qty);\n            PurchLine   purchLine_earliest;\n            PurchTable  purchTable_earliest;\n            \n            select firstonly minof(CreatedDateTime) from purchTable_earliest\n                where purchTable_earliest.PurchaseType              == PurchaseType::Purch\n                exists join purchLine_earliest\n                    where purchLine_earliest.PurchId                == purchTable_earliest.PurchId\n                        && !purchLine_earliest.Blocked\n                        && !purchLine_earliest.IsDeleted\n                        && (purchLine_earliest.PurchStatus          == PurchStatus::Backorder\n                        || purchLine_earliest.PurchStatus           == PurchStatus::Received)\n                        && purchLine_earliest.ItemId                == custInvoiceTrans_Item.ItemId\n                        && purchLine_earliest.RemainPurchFinancial  > 0;\n\n            if (!earliestDateTime || earliestDateTime > purchTable_earliest.CreatedDateTime)\n            {\n                earliestDateTime = purchTable_earliest.CreatedDateTime;\n            }\n        }\n\n        if (!gItemMap.empty())\n        {\n            while select gPurchTable\n                where gPurchTable.PurchaseType      == PurchaseType::Purch\n                    && gPurchTable.CreatedDateTime  >= earliestDateTime\n                    && (gPurchTable.PurchStatus     == PurchStatus::Backorder\n                    || gPurchTable.PurchStatus      == PurchStatus::Received)\n            {\n                try\n                {\n                    this.processSinglePO();\n                }\n                catch (Exception::Deadlock)\n                {\n                    retry;\n                }\n                catch (Exception::UpdateConflict)\n                {\n                    if (appl.ttsLevel() == 0)\n                    {\n                        if (xSession::currentRetryCount() >= #RetryNum)\n                        {\n                            throw Exception::UpdateConflictNotRecovered;\n                        }\n                        else\n                        {\n                            retry;\n                        }\n                    }\n                    else\n                    {\n                        throw Exception::UpdateConflict;\n                    }\n                }\n                catch\n                {\n                    if (appl.ttsLevel() != 0)\n                    {\n                        ttsabort;\n                    }\n                    continue;\n                }\n            }\n\n            this.insertExceptions();\n        }\n\n\n        Query   query_jour = new Query();\n\n        qbds = query_jour.addDataSource(tableNum(CustInvoiceJour));\n        \n        if (qrvInvoiceIds)\n        {\n            qbds = query_jour.dataSourceTable(tableNum(CustInvoiceJour));\n            qbds.addRange(fieldNum(CustInvoiceJour, InvoiceId)).value(qrvInvoiceIds);\n        }\n\n        QueryRun    queryRunJour    = new QueryRun(query_jour);\n        \n        while (queryRunJour.next())\n        {\n            try\n            {\n                CustInvoiceJour custInvoiceJourUpd = queryRunJour.get(tableNum(CustInvoiceJour));\n\n                custInvoiceJourUpd.selectForUpdate(true);\n\n                ttsbegin;\n                custInvoiceJourUpd.GNCProcessedVendConsignedInvoice = true;\n                custInvoiceJourUpd.update();\n                ttscommit;\n            }\n            catch (Exception::Deadlock)\n            {\n                retry;\n            }\n            catch (Exception::UpdateConflict)\n            {\n                if (appl.ttsLevel() == 0)\n                {\n                    if (xSession::currentRetryCount() >= #RetryNum)\n                    {\n                        throw Exception::UpdateConflictNotRecovered;\n                    }\n                    else\n                    {\n                        retry;\n                    }\n                }\n                else\n                {\n                    throw Exception::UpdateConflict;\n                }\n            }\n            catch\n            {\n                if (appl.ttsLevel() != 0)\n                {\n                    ttsabort;\n                }\n                continue;\n            }\n        }\n    }\n\n    public void processSinglePO()\n    {\n        PurchLine                   purchLine, prevPurchLine;\n        VendPackingSlipTrans        vendPackingSlipTrans;\n        Map                         packingSlipTransMap = new Map(Types::Int64, Types::Real);\n        QueryRun                    queryRun;\n        CustInvoiceTrans            custInvoiceTrans;\n        Qty                         qtyToInvoice;\n            \n        gPurchId = gPurchTable.PurchId;\n\n        this.initParameters();\n        this.initRecordLists();\n\n        while select purchLine\n            where purchLine.PurchId                             == gPurchTable.PurchId\n                && !purchLine.Blocked\n                && !purchLine.IsDeleted\n                && (purchLine.PurchStatus                       == PurchStatus::Backorder\n                || purchLine.PurchStatus                        == PurchStatus::Received)\n                && purchLine.RemainPurchFinancial               > 0\n                join vendPackingSlipTrans\n                    where vendPackingSlipTrans.InventTransId    == purchLine.InventTransId\n        {\n            Qty         purchRemain = vendPackingSlipTrans.remainPurchFinancial();\n            Qty         curQty;\n            \n            if (!purchRemain)\n            {\n                continue;\n            }\n\n            if (!gItemMap.exists(purchLine.ItemId))\n            {\n                continue;\n            }\n\n            qtyToInvoice = gItemMap.lookup(purchLine.ItemId);\n\n            if (!qtyToInvoice)\n            {\n                continue;\n            }\n\n            if (qtyToInvoice > purchRemain)\n            {\n                curQty          = purchRemain;\n                qtyToInvoice    -= purchRemain;\n            }\n            else\n            {\n                curQty          = abs(qtyToInvoice);\n                qtyToInvoice    = 0;\n            }\n\n            if (purchLine.RecId != prevPurchLine.RecId)\n            {\n                if (packingSlipTransMap.elements() > 0)\n                {\n                    this.createParmLineAndSubLines(prevPurchLine, packingSlipTransMap.pack());\n                }\n                prevPurchLine       = purchLine.data();\n                packingSlipTransMap = new Map(Types::Int64, Types::Real);\n            }\n\n            packingSlipTransMap.insert(vendPackingSlipTrans.RecId, curQty);\n            gItemMap.insert(purchLine.ItemId, qtyToInvoice);\n        }\n\n        if (prevPurchLine.RecId && packingSlipTransMap.elements() > 0)\n        {\n            this.createParmLineAndSubLines(prevPurchLine, packingSlipTransMap.pack());\n        }\n\n        if (gCreateParmTable)\n        {\n            gInvoiceNumber = gPurchTable.PurchId;\n\n            VendInvoiceJour vendInvoiceJour;\n            Counter         i;\n\n            select firstonly RecId from vendInvoiceJour\n                where vendInvoiceJour.InvoiceId == gInvoiceNumber;\n\n            while (vendInvoiceJour.RecId)\n            {\n                i++;\n                vendInvoiceJour.clear();\n\n                gInvoiceNumber = strfmt('%1_%2', gPurchTable.PurchId, i);\n\n                select firstonly RecId from vendInvoiceJour\n                    where vendInvoiceJour.InvoiceId == gInvoiceNumber;\n            }\n\n            VendInvoiceInfoTable        vendInvoiceInfoTable;\n\n            ttsbegin;\n            vendInvoiceInfoTable = this.createParmTable();\n\n            this.insertRecordLists();\n            \n            PurchFormLetter_Invoice purchFormLetter = PurchFormLetter_Invoice::newFromSavedInvoice(vendInvoiceInfoTable);\n            purchFormLetter.purchTable(gPurchTable);\n            purchFormLetter.printFormLetter(false);\n            purchFormLetter.proforma(false);\n            purchFormLetter.parmId(vendInvoiceInfoTable.ParmId);\n            purchFormLetter.update(vendInvoiceInfoTable, vendInvoiceInfoTable.Num);\n\n            ttscommit;\n\n            select firstonly RecId from vendInvoiceJour\n                where vendInvoiceJour.InvoiceId == vendInvoiceInfoTable.Num;\n\n            if (vendInvoiceJour)\n            {\n                Info(strFmt(\"Vendor invoice journal %1 is posted.\", vendInvoiceInfoTable.Num));\n            }\n        }\n    }\n\n    public void insertExceptions()\n    {\n        MapEnumerator itemME = gItemMap.getEnumerator();\n\n        while (itemME.moveNext())\n        {\n            ItemId                      itemId  = itemME.currentKey();\n            Qty                         qtyExce = itemME.currentValue(); \n\n            if (!qtyExce)\n            {\n                continue;\n            }\n\n            query                       query   = new Query(queryStr(GNCAutoInvoiceVendConsignedQuery));\n            QueryBuildDataSource        qbds;\n            SysLookupMultiSelectValues  qrvInvoiceIds   = strReplace(gInvoiceIds, ';', ',');\n            QueryRun                    queryRun;\n            \n            qbds = query.dataSourceTable(tableNum(CustInvoiceTrans));\n            qbds.addRange(fieldNum(CustInvoiceTrans, ItemId)).value(itemId);\n\n            if (qrvInvoiceIds)\n            {\n                qbds = query.dataSourceTable(tableNum(CustInvoiceJour));\n                qbds.addRange(fieldNum(CustInvoiceJour, InvoiceId)).value(qrvInvoiceIds);\n            }\n\n            queryRun = new QueryRun(query);\n\n            while (queryRun.next())\n            {\n                CustInvoiceTrans    custInvoiceTrans = queryRun.get(tableNum(CustInvoiceTrans));\n                Qty                 qtyRemain, curQty;\n\n                qtyRemain = custInvoiceTrans.Qty;\n\n                if (qtyExce > qtyRemain)\n                {\n                    curQty      = qtyRemain;\n                    qtyExce     -= qtyRemain;\n                }\n                else\n                {\n                    curQty      = qtyExce;\n                    qtyExce     = 0;\n                }\n\n                GNCAutoInvoiceVendConsignedException::create(gInvoiceDate, \n                    custInvoiceTrans.SalesId, \n                    custInvoiceTrans.InvoiceDate, \n                    custInvoiceTrans.ItemId, \n                    custInvoiceTrans.Qty, \n                    curQty);\n\n                if (!qtyExce)\n                {\n                    break;\n                }\n            }\n        }\n    }\n\n    public void initParameters()\n    {\n        gSystemSequence     = new systemSequence();\n        gCreateParmTable    = false;\n    }\n\n    public TradeLineRefId getTableRefId()\n    {\n        if (!gTableRefIdMap.exists(gPurchId))\n        {\n            gTableRefIdMap.insert(gPurchId, formletterParmData::getNewTableRefId());\n        }\n\n        return gTableRefIdMap.lookup(gPurchId);\n    }\n\n    public void initRecordLists()\n    {\n        gParmLineRecordInsertList       = new RecordInsertList(tableNum(VendInvoiceInfoLine));\n        gParmSubLineRecordInsertList    = new RecordInsertList(tableNum(VendInvoiceInfoSubLine));\n        gMarkupTrans    = new RecordInsertList(tableNum(MarkupTrans));\n    }\n\n    public void insertParmLine(VendInvoiceInfoLine _vendInvoiceInfoLine, PurchLine _purchLine)\n    {\n        gSystemSequence.suspendRecIds(_vendInvoiceInfoLine.TableId);\n        _vendInvoiceInfoLine.RecId  = gSystemSequence.reserveValues(1, _vendInvoiceInfoLine.TableId);\n\n        gParmLineRecordInsertList.add(_vendInvoiceInfoLine);\n    }\n\n    public void createVendInvoiceMatchingLine(PurchLine _purchLine, VendDocumentLineMap _parmLine)\n    {\n        VendInvoiceMatchingLine vendInvoiceMatchingLine;\n\n        if (_parmLine.TableId && _parmLine.RecId && _purchLine)\n        {\n            vendInvoiceMatchingLine.clear();\n            vendInvoiceMatchingLine.initExpectedValues(_purchLine, _parmLine);\n            vendInvoiceMatchingLine.RefTableId = _parmLine.TableId;\n            vendInvoiceMatchingLine.RefRecId = _parmLine.RecId;\n            vendInvoiceMatchingLine.insert();\n        }\n    }\n\n    public void createMarkupTrans(PurchLine _purchLine, VendInvoiceInfoLine _vendInvoiceInfoLine)\n    {\n        MarkupTrans markupTrans, markupTransNew;\n\n        while select markupTrans\n            where markupTrans.TransTableId  == _purchLine.TableId\n                && markupTrans.TransRecId   == _purchLine.RecId\n                && markupTrans.Value        != 0\n        {\n            buf2Buf(markupTrans, markupTransNew);\n            markupTransNew.TransTableId       = _vendInvoiceInfoLine.TableId;\n            markupTransNew.TransRecId         = _vendInvoiceInfoLine.RecId;\n            gMarkupTrans.add(markupTransNew);\n        }\n    }\n\n    public void insertParmSubLine(VendInvoiceInfoSubLine _vendInvoiceInfoSubLine)\n    {\n        if (_vendInvoiceInfoSubLine.ReceiveNow == 0)\n        {\n            return;\n        }\n\n        gParmSubLineRecordInsertList.add(_vendInvoiceInfoSubLine);\n    }\n\n    public void insertRecordLists()\n    {\n        gParmLineRecordInsertList.insertDatabase();\n        gParmSubLineRecordInsertList.insertDatabase();\n        gMarkupTrans.insertDatabase();\n    }\n\n    public void createParmLineAndSubLines(PurchLine _purchLine, container _packedSubLinesMap)\n    {\n        MapEnumerator           me;\n        VendInvoiceInfoLine     vendInvoiceInfoLine;\n        Qty                     newPostingQty;\n        VendPackingSlipTrans    vendPackingSlipTrans;\n        Set                     subLineSet      = new Set(Types::Record);\n\n        me = Map::create(_packedSubLinesMap).getEnumerator();\n\n        while (me.moveNext())\n        {\n            RefRecId        vendPackingSlipTransRecId   = me.currentKey();\n            Qty             qty                         = me.currentValue();\n\n            vendPackingSlipTrans            = VendPackingSlipTrans::findRecId(vendPackingSlipTransRecId);\n\n            vendPackingSlipTrans.Qty        = qty;\n            vendPackingSlipTrans.InventQty  = qty;\n            newPostingQty                   += qty;\n\n            subLineSet.add(vendPackingSlipTrans);\n        }\n        \n        if (newPostingQty == 0)\n        {\n            return;\n        }\n\n        vendInvoiceInfoLine = this.createParmLine(_purchLine, newPostingQty);\n\n        this.createParmSubLines(vendInvoiceInfoLine, subLineSet);\n        \n        gCreateParmTable = true;\n    }\n\n    public VendInvoiceInfoLine createParmLine(PurchLine _purchLine, Qty _receiveNow)\n    {\n        VendInvoiceInfoLine vendInvoiceInfoLine;\n\n        vendInvoiceInfoLine.Ordering        = DocumentStatus::Invoice;\n        vendInvoiceInfoLine.TableRefId      = this.getTableRefId();\n        vendInvoiceInfoLine.DocumentOrigin  = DocumentOrigin::Manual;\n        vendInvoiceInfoLine.initFromPurchLine(_purchLine);\n        vendInvoiceInfoLine.defaultRow(_purchLine, null, _receiveNow, _receiveNow);\n\n        this.insertParmLine(vendInvoiceInfoLine, _purchLine);\n        \n        gCreateParmTable = true;\n\n        return vendInvoiceInfoLine;\n    }\n\n    public void createParmSubLines(VendInvoiceInfoLine _vendInvoiceInfoLine, Set _subLineSet)\n    {\n        VendPackingSlipTrans    vendPackingSlipTrans;\n        VendInvoiceInfoSubLine  vendInvoiceInfoSubLine;\n        SetEnumerator           se = _subLineSet.getEnumerator();\n\n        while (se.moveNext())\n        {\n            vendPackingSlipTrans = se.current();\n\n            vend\n\nInvoiceInfoSubLine.clear();\n            vendInvoiceInfoSubLine.initFromLine(_vendInvoiceInfoLine);\n            vendInvoiceInfoSubLine.initFromVendPackingSlipTrans(vendPackingSlipTrans);\n            this.insertParmSubLine(vendInvoiceInfoSubLine);\n        }\n\n        if (!_vendInvoiceInfoLine.vendInvoiceInfoSubTable())\n        {\n            VendInvoiceInfoSubTable::createFromVendInvoiceInfoLine(_vendInvoiceInfoLine, _vendInvoiceInfoLine.ParmId, gDescription, true);\n        }\n    }\n\n    public VendInvoiceInfoTable createParmTable()\n    {\n        VendInvoiceInfoTable        vendInvoiceInfoTable;\n\n        vendInvoiceInfoTable.clear();\n        vendInvoiceInfoTable.initValue();\n        vendInvoiceInfoTable.defaultRow(gPurchTable);\n        vendInvoiceInfoTable.initFromPurchTable(gPurchTable);\n        vendInvoiceInfoTable.DocumentOrigin         = DocumentOrigin::Manual;\n        vendInvoiceInfoTable.Num                    = gInvoiceNumber;\n        vendInvoiceInfoTable.VendInvoiceSaveStatus  = VendInvoiceSaveStatus::Pending;\n        vendInvoiceInfoTable.Description            = 'Retail POS Sale';\n        vendInvoiceInfoTable.DocumentDate           = gInvoiceDate;\n        vendInvoiceInfoTable.TransDate              = gInvoiceDate;\n        vendInvoiceInfoTable.LastMatchVariance      = LastMatchVarianceOptions::OK;\n        vendInvoiceInfoTable.ParmJobStatus          = ParmJobStatus::Waiting;\n        vendInvoiceInfoTable.Approved               = NoYes::Yes;\n        vendInvoiceInfoTable.Approver               = HcmWorker::userId2Worker(curUserId());\n        vendInvoiceInfoTable.TableRefId             = this.getTableRefId();\n        vendInvoiceInfoTable.Ordering               = DocumentStatus::Invoice;\n        vendInvoiceInfoTable.initInvoiceTotals();\n        vendInvoiceInfoTable.insert();\n        \n        return vendInvoiceInfoTable;\n    }\n\n    public void createParmSubTable(VendInvoiceInfoTable _vendInvoiceInfoTable)\n    {\n        VendInvoiceInfoSubTable::createFromVendInvoiceInfoTable(_vendInvoiceInfoTable, true);\n    }\n}\n```","source":"_posts/xpp-invoice-purchase-order.md","raw":"---\ntitle: Invoice Purchase Order Example\ncomments: true\ndate: 2025-02-23 20:51:59\ncategories:\n - x++\ndescription: Invoice Purchase Order Example\n---\n\n> 本文记录了 x++ 代码 invoice 采购订单的示例代码\n\n```c#\nHere is the C# code you provided with all comments removed:\n\n```csharp\npublic class GNCAutoInvoiceVendConsignedPOBatch extends RunBaseBatch implements BatchRetryable\n{\n    SysLookupMultiSelectValues  gInvoiceIds;\n    boolean                     gCreateParmTable;\n    PurchTable                  gPurchTable;\n    boolean                     gMultiPOs;\n    PurchId                     gPurchId;\n    RecordInsertList            gParmLineRecordInsertList, gParmSubLineRecordInsertList, gMarkupTrans;\n    systemSequence              gSystemSequence;\n    Num                         gInvoiceNumber;\n    TransDate                   gInvoiceDate        = DateTimeUtil::getSystemDate(DateTimeUtil::getUserPreferredTimeZone());\n    InvoiceDescriptionLarge     gDescription;\n    Map                         gTableRefIdMap      = new Map(Types::String, Types::String);\n    Map                         gItemMap            = new Map(Types::String, Types::Real);\n    DialogField     gDlgInvoiceIds;\n\n    #define.CurrentVersion(1)\n    #localmacro.CurrentList\n        gInvoiceIds\n    #endmacro\n\n    public boolean canGoBatch()\n    {\n        return true;\n    }\n\n    public boolean canGoBatchJournal()\n    {\n        return true;\n    }\n\n    public Object dialog()\n    {\n        DialogRunbase       dialog = super();\n    \n        gDlgInvoiceIds = dialog.addFieldValue(extendedTypeStr(SysLookupMultiSelectValues), gInvoiceIds, \"@SYS12128\");\n    \n        return dialog;\n    }\n\n    public void dialogPostRun(DialogRunbase _dialog)\n    {\n        super(_dialog);\n\n        Query                   query;\n        QueryBuildDataSource    qbds;\n\n        query   = new Query(queryStr(GNCAutoInvoiceVendConsignedLookupQuery));\n\n        SysLookupMultiSelectCtrl::constructWithQuery(\n                    _dialog.dialogForm().formRun(),\n                    gDlgInvoiceIds.control(),\n                    query,\n                    false,\n                    [tableNum(CustInvoiceJour), fieldNum(CustInvoiceJour, InvoiceId)]\n        );\n    }\n\n    public boolean getFromDialog()\n    {\n        gInvoiceIds = gDlgInvoiceIds.value();\n    \n        return super();\n    }\n\n    public container pack()\n    {\n        return [#CurrentVersion, #CurrentList];\n    }\n\n    static GNCAutoInvoiceVendConsignedPOBatch construct()\n    {\n        return new GNCAutoInvoiceVendConsignedPOBatch();\n    }\n\n    static ClassDescription description()\n    {\n        return \"@GNC:AutoInvoiceVendorConsignedPurchaseOrder\";\n    }\n\n    static void main(Args _args)\n    {\n        GNCAutoInvoiceVendConsignedPOBatch      batch;\n    \n        batch = GNCAutoInvoiceVendConsignedPOBatch::construct();\n    \n        if (batch.prompt())\n        {\n            batch.runOperation();\n        }\n    }\n\n    protected boolean canRunInNewSession()\n    {\n        return false;\n    }\n\n    [Hookable(false)]\n    public final boolean isRetryable()\n    {\n        return false;\n    }\n\n    public Qty getFinalInvoiceQty(ItemId _itemId, Qty _qty)\n    {\n        Qty retQty, storeQty;\n\n        GNCProcessedVendorConsignedInvAdjustments processedVendorConsignedInvAdjustments = GNCProcessedVendorConsignedInvAdjustments::find(_itemId, true);\n\n        if (processedVendorConsignedInvAdjustments.RecId)\n        {\n            ttsbegin;\n            storeQty = processedVendorConsignedInvAdjustments.Qty;\n            retQty = _qty - storeQty;\n            processedVendorConsignedInvAdjustments.Qty = retQty < 0 ? abs(retQty) : 0;\n            processedVendorConsignedInvAdjustments.update();\n            ttscommit;\n        }\n        else\n        {\n            retQty = _qty;\n        }\n\n        return retQty;\n    }\n\n    public void run()\n    {\n        #OCCRetryCount\n\n        setPrefix(\"@GNC:AutoInvoiceVendorConsignedPurchaseOrder\");\n        \n        query                       query_Item      = new Query(queryStr(GNCAutoInvoiceVendConsignedItemQuery));\n        QueryBuildDataSource        qbds;\n        SysLookupMultiSelectValues  qrvInvoiceIds   = strReplace(gInvoiceIds, ';', ',');\n        \n        if (qrvInvoiceIds)\n        {\n            qbds = query_Item.dataSourceTable(tableNum(CustInvoiceJour));\n            qbds.addRange(fieldNum(CustInvoiceJour, InvoiceId)).value(qrvInvoiceIds);\n        }\n\n        QueryRun                    queryRunItem    = new QueryRun(query_Item);\n        TransDateTime               earliestDateTime;\n\n        while (queryRunItem.next())\n        {\n            CustInvoiceTrans custInvoiceTrans_Item = queryRunItem.get(tableNum(CustInvoiceTrans));\n\n            Qty finalInvoiceQty = this.getfinalInvoiceQty(custInvoiceTrans_Item.ItemId, custInvoiceTrans_Item.Qty);\n            PurchLine   purchLine_earliest;\n            PurchTable  purchTable_earliest;\n            \n            select firstonly minof(CreatedDateTime) from purchTable_earliest\n                where purchTable_earliest.PurchaseType              == PurchaseType::Purch\n                exists join purchLine_earliest\n                    where purchLine_earliest.PurchId                == purchTable_earliest.PurchId\n                        && !purchLine_earliest.Blocked\n                        && !purchLine_earliest.IsDeleted\n                        && (purchLine_earliest.PurchStatus          == PurchStatus::Backorder\n                        || purchLine_earliest.PurchStatus           == PurchStatus::Received)\n                        && purchLine_earliest.ItemId                == custInvoiceTrans_Item.ItemId\n                        && purchLine_earliest.RemainPurchFinancial  > 0;\n\n            if (!earliestDateTime || earliestDateTime > purchTable_earliest.CreatedDateTime)\n            {\n                earliestDateTime = purchTable_earliest.CreatedDateTime;\n            }\n        }\n\n        if (!gItemMap.empty())\n        {\n            while select gPurchTable\n                where gPurchTable.PurchaseType      == PurchaseType::Purch\n                    && gPurchTable.CreatedDateTime  >= earliestDateTime\n                    && (gPurchTable.PurchStatus     == PurchStatus::Backorder\n                    || gPurchTable.PurchStatus      == PurchStatus::Received)\n            {\n                try\n                {\n                    this.processSinglePO();\n                }\n                catch (Exception::Deadlock)\n                {\n                    retry;\n                }\n                catch (Exception::UpdateConflict)\n                {\n                    if (appl.ttsLevel() == 0)\n                    {\n                        if (xSession::currentRetryCount() >= #RetryNum)\n                        {\n                            throw Exception::UpdateConflictNotRecovered;\n                        }\n                        else\n                        {\n                            retry;\n                        }\n                    }\n                    else\n                    {\n                        throw Exception::UpdateConflict;\n                    }\n                }\n                catch\n                {\n                    if (appl.ttsLevel() != 0)\n                    {\n                        ttsabort;\n                    }\n                    continue;\n                }\n            }\n\n            this.insertExceptions();\n        }\n\n\n        Query   query_jour = new Query();\n\n        qbds = query_jour.addDataSource(tableNum(CustInvoiceJour));\n        \n        if (qrvInvoiceIds)\n        {\n            qbds = query_jour.dataSourceTable(tableNum(CustInvoiceJour));\n            qbds.addRange(fieldNum(CustInvoiceJour, InvoiceId)).value(qrvInvoiceIds);\n        }\n\n        QueryRun    queryRunJour    = new QueryRun(query_jour);\n        \n        while (queryRunJour.next())\n        {\n            try\n            {\n                CustInvoiceJour custInvoiceJourUpd = queryRunJour.get(tableNum(CustInvoiceJour));\n\n                custInvoiceJourUpd.selectForUpdate(true);\n\n                ttsbegin;\n                custInvoiceJourUpd.GNCProcessedVendConsignedInvoice = true;\n                custInvoiceJourUpd.update();\n                ttscommit;\n            }\n            catch (Exception::Deadlock)\n            {\n                retry;\n            }\n            catch (Exception::UpdateConflict)\n            {\n                if (appl.ttsLevel() == 0)\n                {\n                    if (xSession::currentRetryCount() >= #RetryNum)\n                    {\n                        throw Exception::UpdateConflictNotRecovered;\n                    }\n                    else\n                    {\n                        retry;\n                    }\n                }\n                else\n                {\n                    throw Exception::UpdateConflict;\n                }\n            }\n            catch\n            {\n                if (appl.ttsLevel() != 0)\n                {\n                    ttsabort;\n                }\n                continue;\n            }\n        }\n    }\n\n    public void processSinglePO()\n    {\n        PurchLine                   purchLine, prevPurchLine;\n        VendPackingSlipTrans        vendPackingSlipTrans;\n        Map                         packingSlipTransMap = new Map(Types::Int64, Types::Real);\n        QueryRun                    queryRun;\n        CustInvoiceTrans            custInvoiceTrans;\n        Qty                         qtyToInvoice;\n            \n        gPurchId = gPurchTable.PurchId;\n\n        this.initParameters();\n        this.initRecordLists();\n\n        while select purchLine\n            where purchLine.PurchId                             == gPurchTable.PurchId\n                && !purchLine.Blocked\n                && !purchLine.IsDeleted\n                && (purchLine.PurchStatus                       == PurchStatus::Backorder\n                || purchLine.PurchStatus                        == PurchStatus::Received)\n                && purchLine.RemainPurchFinancial               > 0\n                join vendPackingSlipTrans\n                    where vendPackingSlipTrans.InventTransId    == purchLine.InventTransId\n        {\n            Qty         purchRemain = vendPackingSlipTrans.remainPurchFinancial();\n            Qty         curQty;\n            \n            if (!purchRemain)\n            {\n                continue;\n            }\n\n            if (!gItemMap.exists(purchLine.ItemId))\n            {\n                continue;\n            }\n\n            qtyToInvoice = gItemMap.lookup(purchLine.ItemId);\n\n            if (!qtyToInvoice)\n            {\n                continue;\n            }\n\n            if (qtyToInvoice > purchRemain)\n            {\n                curQty          = purchRemain;\n                qtyToInvoice    -= purchRemain;\n            }\n            else\n            {\n                curQty          = abs(qtyToInvoice);\n                qtyToInvoice    = 0;\n            }\n\n            if (purchLine.RecId != prevPurchLine.RecId)\n            {\n                if (packingSlipTransMap.elements() > 0)\n                {\n                    this.createParmLineAndSubLines(prevPurchLine, packingSlipTransMap.pack());\n                }\n                prevPurchLine       = purchLine.data();\n                packingSlipTransMap = new Map(Types::Int64, Types::Real);\n            }\n\n            packingSlipTransMap.insert(vendPackingSlipTrans.RecId, curQty);\n            gItemMap.insert(purchLine.ItemId, qtyToInvoice);\n        }\n\n        if (prevPurchLine.RecId && packingSlipTransMap.elements() > 0)\n        {\n            this.createParmLineAndSubLines(prevPurchLine, packingSlipTransMap.pack());\n        }\n\n        if (gCreateParmTable)\n        {\n            gInvoiceNumber = gPurchTable.PurchId;\n\n            VendInvoiceJour vendInvoiceJour;\n            Counter         i;\n\n            select firstonly RecId from vendInvoiceJour\n                where vendInvoiceJour.InvoiceId == gInvoiceNumber;\n\n            while (vendInvoiceJour.RecId)\n            {\n                i++;\n                vendInvoiceJour.clear();\n\n                gInvoiceNumber = strfmt('%1_%2', gPurchTable.PurchId, i);\n\n                select firstonly RecId from vendInvoiceJour\n                    where vendInvoiceJour.InvoiceId == gInvoiceNumber;\n            }\n\n            VendInvoiceInfoTable        vendInvoiceInfoTable;\n\n            ttsbegin;\n            vendInvoiceInfoTable = this.createParmTable();\n\n            this.insertRecordLists();\n            \n            PurchFormLetter_Invoice purchFormLetter = PurchFormLetter_Invoice::newFromSavedInvoice(vendInvoiceInfoTable);\n            purchFormLetter.purchTable(gPurchTable);\n            purchFormLetter.printFormLetter(false);\n            purchFormLetter.proforma(false);\n            purchFormLetter.parmId(vendInvoiceInfoTable.ParmId);\n            purchFormLetter.update(vendInvoiceInfoTable, vendInvoiceInfoTable.Num);\n\n            ttscommit;\n\n            select firstonly RecId from vendInvoiceJour\n                where vendInvoiceJour.InvoiceId == vendInvoiceInfoTable.Num;\n\n            if (vendInvoiceJour)\n            {\n                Info(strFmt(\"Vendor invoice journal %1 is posted.\", vendInvoiceInfoTable.Num));\n            }\n        }\n    }\n\n    public void insertExceptions()\n    {\n        MapEnumerator itemME = gItemMap.getEnumerator();\n\n        while (itemME.moveNext())\n        {\n            ItemId                      itemId  = itemME.currentKey();\n            Qty                         qtyExce = itemME.currentValue(); \n\n            if (!qtyExce)\n            {\n                continue;\n            }\n\n            query                       query   = new Query(queryStr(GNCAutoInvoiceVendConsignedQuery));\n            QueryBuildDataSource        qbds;\n            SysLookupMultiSelectValues  qrvInvoiceIds   = strReplace(gInvoiceIds, ';', ',');\n            QueryRun                    queryRun;\n            \n            qbds = query.dataSourceTable(tableNum(CustInvoiceTrans));\n            qbds.addRange(fieldNum(CustInvoiceTrans, ItemId)).value(itemId);\n\n            if (qrvInvoiceIds)\n            {\n                qbds = query.dataSourceTable(tableNum(CustInvoiceJour));\n                qbds.addRange(fieldNum(CustInvoiceJour, InvoiceId)).value(qrvInvoiceIds);\n            }\n\n            queryRun = new QueryRun(query);\n\n            while (queryRun.next())\n            {\n                CustInvoiceTrans    custInvoiceTrans = queryRun.get(tableNum(CustInvoiceTrans));\n                Qty                 qtyRemain, curQty;\n\n                qtyRemain = custInvoiceTrans.Qty;\n\n                if (qtyExce > qtyRemain)\n                {\n                    curQty      = qtyRemain;\n                    qtyExce     -= qtyRemain;\n                }\n                else\n                {\n                    curQty      = qtyExce;\n                    qtyExce     = 0;\n                }\n\n                GNCAutoInvoiceVendConsignedException::create(gInvoiceDate, \n                    custInvoiceTrans.SalesId, \n                    custInvoiceTrans.InvoiceDate, \n                    custInvoiceTrans.ItemId, \n                    custInvoiceTrans.Qty, \n                    curQty);\n\n                if (!qtyExce)\n                {\n                    break;\n                }\n            }\n        }\n    }\n\n    public void initParameters()\n    {\n        gSystemSequence     = new systemSequence();\n        gCreateParmTable    = false;\n    }\n\n    public TradeLineRefId getTableRefId()\n    {\n        if (!gTableRefIdMap.exists(gPurchId))\n        {\n            gTableRefIdMap.insert(gPurchId, formletterParmData::getNewTableRefId());\n        }\n\n        return gTableRefIdMap.lookup(gPurchId);\n    }\n\n    public void initRecordLists()\n    {\n        gParmLineRecordInsertList       = new RecordInsertList(tableNum(VendInvoiceInfoLine));\n        gParmSubLineRecordInsertList    = new RecordInsertList(tableNum(VendInvoiceInfoSubLine));\n        gMarkupTrans    = new RecordInsertList(tableNum(MarkupTrans));\n    }\n\n    public void insertParmLine(VendInvoiceInfoLine _vendInvoiceInfoLine, PurchLine _purchLine)\n    {\n        gSystemSequence.suspendRecIds(_vendInvoiceInfoLine.TableId);\n        _vendInvoiceInfoLine.RecId  = gSystemSequence.reserveValues(1, _vendInvoiceInfoLine.TableId);\n\n        gParmLineRecordInsertList.add(_vendInvoiceInfoLine);\n    }\n\n    public void createVendInvoiceMatchingLine(PurchLine _purchLine, VendDocumentLineMap _parmLine)\n    {\n        VendInvoiceMatchingLine vendInvoiceMatchingLine;\n\n        if (_parmLine.TableId && _parmLine.RecId && _purchLine)\n        {\n            vendInvoiceMatchingLine.clear();\n            vendInvoiceMatchingLine.initExpectedValues(_purchLine, _parmLine);\n            vendInvoiceMatchingLine.RefTableId = _parmLine.TableId;\n            vendInvoiceMatchingLine.RefRecId = _parmLine.RecId;\n            vendInvoiceMatchingLine.insert();\n        }\n    }\n\n    public void createMarkupTrans(PurchLine _purchLine, VendInvoiceInfoLine _vendInvoiceInfoLine)\n    {\n        MarkupTrans markupTrans, markupTransNew;\n\n        while select markupTrans\n            where markupTrans.TransTableId  == _purchLine.TableId\n                && markupTrans.TransRecId   == _purchLine.RecId\n                && markupTrans.Value        != 0\n        {\n            buf2Buf(markupTrans, markupTransNew);\n            markupTransNew.TransTableId       = _vendInvoiceInfoLine.TableId;\n            markupTransNew.TransRecId         = _vendInvoiceInfoLine.RecId;\n            gMarkupTrans.add(markupTransNew);\n        }\n    }\n\n    public void insertParmSubLine(VendInvoiceInfoSubLine _vendInvoiceInfoSubLine)\n    {\n        if (_vendInvoiceInfoSubLine.ReceiveNow == 0)\n        {\n            return;\n        }\n\n        gParmSubLineRecordInsertList.add(_vendInvoiceInfoSubLine);\n    }\n\n    public void insertRecordLists()\n    {\n        gParmLineRecordInsertList.insertDatabase();\n        gParmSubLineRecordInsertList.insertDatabase();\n        gMarkupTrans.insertDatabase();\n    }\n\n    public void createParmLineAndSubLines(PurchLine _purchLine, container _packedSubLinesMap)\n    {\n        MapEnumerator           me;\n        VendInvoiceInfoLine     vendInvoiceInfoLine;\n        Qty                     newPostingQty;\n        VendPackingSlipTrans    vendPackingSlipTrans;\n        Set                     subLineSet      = new Set(Types::Record);\n\n        me = Map::create(_packedSubLinesMap).getEnumerator();\n\n        while (me.moveNext())\n        {\n            RefRecId        vendPackingSlipTransRecId   = me.currentKey();\n            Qty             qty                         = me.currentValue();\n\n            vendPackingSlipTrans            = VendPackingSlipTrans::findRecId(vendPackingSlipTransRecId);\n\n            vendPackingSlipTrans.Qty        = qty;\n            vendPackingSlipTrans.InventQty  = qty;\n            newPostingQty                   += qty;\n\n            subLineSet.add(vendPackingSlipTrans);\n        }\n        \n        if (newPostingQty == 0)\n        {\n            return;\n        }\n\n        vendInvoiceInfoLine = this.createParmLine(_purchLine, newPostingQty);\n\n        this.createParmSubLines(vendInvoiceInfoLine, subLineSet);\n        \n        gCreateParmTable = true;\n    }\n\n    public VendInvoiceInfoLine createParmLine(PurchLine _purchLine, Qty _receiveNow)\n    {\n        VendInvoiceInfoLine vendInvoiceInfoLine;\n\n        vendInvoiceInfoLine.Ordering        = DocumentStatus::Invoice;\n        vendInvoiceInfoLine.TableRefId      = this.getTableRefId();\n        vendInvoiceInfoLine.DocumentOrigin  = DocumentOrigin::Manual;\n        vendInvoiceInfoLine.initFromPurchLine(_purchLine);\n        vendInvoiceInfoLine.defaultRow(_purchLine, null, _receiveNow, _receiveNow);\n\n        this.insertParmLine(vendInvoiceInfoLine, _purchLine);\n        \n        gCreateParmTable = true;\n\n        return vendInvoiceInfoLine;\n    }\n\n    public void createParmSubLines(VendInvoiceInfoLine _vendInvoiceInfoLine, Set _subLineSet)\n    {\n        VendPackingSlipTrans    vendPackingSlipTrans;\n        VendInvoiceInfoSubLine  vendInvoiceInfoSubLine;\n        SetEnumerator           se = _subLineSet.getEnumerator();\n\n        while (se.moveNext())\n        {\n            vendPackingSlipTrans = se.current();\n\n            vend\n\nInvoiceInfoSubLine.clear();\n            vendInvoiceInfoSubLine.initFromLine(_vendInvoiceInfoLine);\n            vendInvoiceInfoSubLine.initFromVendPackingSlipTrans(vendPackingSlipTrans);\n            this.insertParmSubLine(vendInvoiceInfoSubLine);\n        }\n\n        if (!_vendInvoiceInfoLine.vendInvoiceInfoSubTable())\n        {\n            VendInvoiceInfoSubTable::createFromVendInvoiceInfoLine(_vendInvoiceInfoLine, _vendInvoiceInfoLine.ParmId, gDescription, true);\n        }\n    }\n\n    public VendInvoiceInfoTable createParmTable()\n    {\n        VendInvoiceInfoTable        vendInvoiceInfoTable;\n\n        vendInvoiceInfoTable.clear();\n        vendInvoiceInfoTable.initValue();\n        vendInvoiceInfoTable.defaultRow(gPurchTable);\n        vendInvoiceInfoTable.initFromPurchTable(gPurchTable);\n        vendInvoiceInfoTable.DocumentOrigin         = DocumentOrigin::Manual;\n        vendInvoiceInfoTable.Num                    = gInvoiceNumber;\n        vendInvoiceInfoTable.VendInvoiceSaveStatus  = VendInvoiceSaveStatus::Pending;\n        vendInvoiceInfoTable.Description            = 'Retail POS Sale';\n        vendInvoiceInfoTable.DocumentDate           = gInvoiceDate;\n        vendInvoiceInfoTable.TransDate              = gInvoiceDate;\n        vendInvoiceInfoTable.LastMatchVariance      = LastMatchVarianceOptions::OK;\n        vendInvoiceInfoTable.ParmJobStatus          = ParmJobStatus::Waiting;\n        vendInvoiceInfoTable.Approved               = NoYes::Yes;\n        vendInvoiceInfoTable.Approver               = HcmWorker::userId2Worker(curUserId());\n        vendInvoiceInfoTable.TableRefId             = this.getTableRefId();\n        vendInvoiceInfoTable.Ordering               = DocumentStatus::Invoice;\n        vendInvoiceInfoTable.initInvoiceTotals();\n        vendInvoiceInfoTable.insert();\n        \n        return vendInvoiceInfoTable;\n    }\n\n    public void createParmSubTable(VendInvoiceInfoTable _vendInvoiceInfoTable)\n    {\n        VendInvoiceInfoSubTable::createFromVendInvoiceInfoTable(_vendInvoiceInfoTable, true);\n    }\n}\n```","slug":"xpp-invoice-purchase-order","published":1,"updated":"2025-07-08T12:05:00.541Z","layout":"post","photos":[],"_id":"cmcvxssht00153cug8a4g7fg7","content":"<blockquote>\n<p>本文记录了 x++ 代码 invoice 采购订单的示例代码</p>\n</blockquote>\n<figure class=\"highlight c#\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br><span class=\"line\">249</span><br><span class=\"line\">250</span><br><span class=\"line\">251</span><br><span class=\"line\">252</span><br><span class=\"line\">253</span><br><span class=\"line\">254</span><br><span class=\"line\">255</span><br><span class=\"line\">256</span><br><span class=\"line\">257</span><br><span class=\"line\">258</span><br><span class=\"line\">259</span><br><span class=\"line\">260</span><br><span class=\"line\">261</span><br><span class=\"line\">262</span><br><span class=\"line\">263</span><br><span class=\"line\">264</span><br><span class=\"line\">265</span><br><span class=\"line\">266</span><br><span class=\"line\">267</span><br><span class=\"line\">268</span><br><span class=\"line\">269</span><br><span class=\"line\">270</span><br><span class=\"line\">271</span><br><span class=\"line\">272</span><br><span class=\"line\">273</span><br><span class=\"line\">274</span><br><span class=\"line\">275</span><br><span class=\"line\">276</span><br><span class=\"line\">277</span><br><span class=\"line\">278</span><br><span class=\"line\">279</span><br><span class=\"line\">280</span><br><span class=\"line\">281</span><br><span class=\"line\">282</span><br><span class=\"line\">283</span><br><span class=\"line\">284</span><br><span class=\"line\">285</span><br><span class=\"line\">286</span><br><span class=\"line\">287</span><br><span class=\"line\">288</span><br><span class=\"line\">289</span><br><span class=\"line\">290</span><br><span class=\"line\">291</span><br><span class=\"line\">292</span><br><span class=\"line\">293</span><br><span class=\"line\">294</span><br><span class=\"line\">295</span><br><span class=\"line\">296</span><br><span class=\"line\">297</span><br><span class=\"line\">298</span><br><span class=\"line\">299</span><br><span class=\"line\">300</span><br><span class=\"line\">301</span><br><span class=\"line\">302</span><br><span class=\"line\">303</span><br><span class=\"line\">304</span><br><span class=\"line\">305</span><br><span class=\"line\">306</span><br><span class=\"line\">307</span><br><span class=\"line\">308</span><br><span class=\"line\">309</span><br><span class=\"line\">310</span><br><span class=\"line\">311</span><br><span class=\"line\">312</span><br><span class=\"line\">313</span><br><span class=\"line\">314</span><br><span class=\"line\">315</span><br><span class=\"line\">316</span><br><span class=\"line\">317</span><br><span class=\"line\">318</span><br><span class=\"line\">319</span><br><span class=\"line\">320</span><br><span class=\"line\">321</span><br><span class=\"line\">322</span><br><span class=\"line\">323</span><br><span class=\"line\">324</span><br><span class=\"line\">325</span><br><span class=\"line\">326</span><br><span class=\"line\">327</span><br><span class=\"line\">328</span><br><span class=\"line\">329</span><br><span class=\"line\">330</span><br><span class=\"line\">331</span><br><span class=\"line\">332</span><br><span class=\"line\">333</span><br><span class=\"line\">334</span><br><span class=\"line\">335</span><br><span class=\"line\">336</span><br><span class=\"line\">337</span><br><span class=\"line\">338</span><br><span class=\"line\">339</span><br><span class=\"line\">340</span><br><span class=\"line\">341</span><br><span class=\"line\">342</span><br><span class=\"line\">343</span><br><span class=\"line\">344</span><br><span class=\"line\">345</span><br><span class=\"line\">346</span><br><span class=\"line\">347</span><br><span class=\"line\">348</span><br><span class=\"line\">349</span><br><span class=\"line\">350</span><br><span class=\"line\">351</span><br><span class=\"line\">352</span><br><span class=\"line\">353</span><br><span class=\"line\">354</span><br><span class=\"line\">355</span><br><span class=\"line\">356</span><br><span class=\"line\">357</span><br><span class=\"line\">358</span><br><span class=\"line\">359</span><br><span class=\"line\">360</span><br><span class=\"line\">361</span><br><span class=\"line\">362</span><br><span class=\"line\">363</span><br><span class=\"line\">364</span><br><span class=\"line\">365</span><br><span class=\"line\">366</span><br><span class=\"line\">367</span><br><span class=\"line\">368</span><br><span class=\"line\">369</span><br><span class=\"line\">370</span><br><span class=\"line\">371</span><br><span class=\"line\">372</span><br><span class=\"line\">373</span><br><span class=\"line\">374</span><br><span class=\"line\">375</span><br><span class=\"line\">376</span><br><span class=\"line\">377</span><br><span class=\"line\">378</span><br><span class=\"line\">379</span><br><span class=\"line\">380</span><br><span class=\"line\">381</span><br><span class=\"line\">382</span><br><span class=\"line\">383</span><br><span class=\"line\">384</span><br><span class=\"line\">385</span><br><span class=\"line\">386</span><br><span class=\"line\">387</span><br><span class=\"line\">388</span><br><span class=\"line\">389</span><br><span class=\"line\">390</span><br><span class=\"line\">391</span><br><span class=\"line\">392</span><br><span class=\"line\">393</span><br><span class=\"line\">394</span><br><span class=\"line\">395</span><br><span class=\"line\">396</span><br><span class=\"line\">397</span><br><span class=\"line\">398</span><br><span class=\"line\">399</span><br><span class=\"line\">400</span><br><span class=\"line\">401</span><br><span class=\"line\">402</span><br><span class=\"line\">403</span><br><span class=\"line\">404</span><br><span class=\"line\">405</span><br><span class=\"line\">406</span><br><span class=\"line\">407</span><br><span class=\"line\">408</span><br><span class=\"line\">409</span><br><span class=\"line\">410</span><br><span class=\"line\">411</span><br><span class=\"line\">412</span><br><span class=\"line\">413</span><br><span class=\"line\">414</span><br><span class=\"line\">415</span><br><span class=\"line\">416</span><br><span class=\"line\">417</span><br><span class=\"line\">418</span><br><span class=\"line\">419</span><br><span class=\"line\">420</span><br><span class=\"line\">421</span><br><span class=\"line\">422</span><br><span class=\"line\">423</span><br><span class=\"line\">424</span><br><span class=\"line\">425</span><br><span class=\"line\">426</span><br><span class=\"line\">427</span><br><span class=\"line\">428</span><br><span class=\"line\">429</span><br><span class=\"line\">430</span><br><span class=\"line\">431</span><br><span class=\"line\">432</span><br><span class=\"line\">433</span><br><span class=\"line\">434</span><br><span class=\"line\">435</span><br><span class=\"line\">436</span><br><span class=\"line\">437</span><br><span class=\"line\">438</span><br><span class=\"line\">439</span><br><span class=\"line\">440</span><br><span class=\"line\">441</span><br><span class=\"line\">442</span><br><span class=\"line\">443</span><br><span class=\"line\">444</span><br><span class=\"line\">445</span><br><span class=\"line\">446</span><br><span class=\"line\">447</span><br><span class=\"line\">448</span><br><span class=\"line\">449</span><br><span class=\"line\">450</span><br><span class=\"line\">451</span><br><span class=\"line\">452</span><br><span class=\"line\">453</span><br><span class=\"line\">454</span><br><span class=\"line\">455</span><br><span class=\"line\">456</span><br><span class=\"line\">457</span><br><span class=\"line\">458</span><br><span class=\"line\">459</span><br><span class=\"line\">460</span><br><span class=\"line\">461</span><br><span class=\"line\">462</span><br><span class=\"line\">463</span><br><span class=\"line\">464</span><br><span class=\"line\">465</span><br><span class=\"line\">466</span><br><span class=\"line\">467</span><br><span class=\"line\">468</span><br><span class=\"line\">469</span><br><span class=\"line\">470</span><br><span class=\"line\">471</span><br><span class=\"line\">472</span><br><span class=\"line\">473</span><br><span class=\"line\">474</span><br><span class=\"line\">475</span><br><span class=\"line\">476</span><br><span class=\"line\">477</span><br><span class=\"line\">478</span><br><span class=\"line\">479</span><br><span class=\"line\">480</span><br><span class=\"line\">481</span><br><span class=\"line\">482</span><br><span class=\"line\">483</span><br><span class=\"line\">484</span><br><span class=\"line\">485</span><br><span class=\"line\">486</span><br><span class=\"line\">487</span><br><span class=\"line\">488</span><br><span class=\"line\">489</span><br><span class=\"line\">490</span><br><span class=\"line\">491</span><br><span class=\"line\">492</span><br><span class=\"line\">493</span><br><span class=\"line\">494</span><br><span class=\"line\">495</span><br><span class=\"line\">496</span><br><span class=\"line\">497</span><br><span class=\"line\">498</span><br><span class=\"line\">499</span><br><span class=\"line\">500</span><br><span class=\"line\">501</span><br><span class=\"line\">502</span><br><span class=\"line\">503</span><br><span class=\"line\">504</span><br><span class=\"line\">505</span><br><span class=\"line\">506</span><br><span class=\"line\">507</span><br><span class=\"line\">508</span><br><span class=\"line\">509</span><br><span class=\"line\">510</span><br><span class=\"line\">511</span><br><span class=\"line\">512</span><br><span class=\"line\">513</span><br><span class=\"line\">514</span><br><span class=\"line\">515</span><br><span class=\"line\">516</span><br><span class=\"line\">517</span><br><span class=\"line\">518</span><br><span class=\"line\">519</span><br><span class=\"line\">520</span><br><span class=\"line\">521</span><br><span class=\"line\">522</span><br><span class=\"line\">523</span><br><span class=\"line\">524</span><br><span class=\"line\">525</span><br><span class=\"line\">526</span><br><span class=\"line\">527</span><br><span class=\"line\">528</span><br><span class=\"line\">529</span><br><span class=\"line\">530</span><br><span class=\"line\">531</span><br><span class=\"line\">532</span><br><span class=\"line\">533</span><br><span class=\"line\">534</span><br><span class=\"line\">535</span><br><span class=\"line\">536</span><br><span class=\"line\">537</span><br><span class=\"line\">538</span><br><span class=\"line\">539</span><br><span class=\"line\">540</span><br><span class=\"line\">541</span><br><span class=\"line\">542</span><br><span class=\"line\">543</span><br><span class=\"line\">544</span><br><span class=\"line\">545</span><br><span class=\"line\">546</span><br><span class=\"line\">547</span><br><span class=\"line\">548</span><br><span class=\"line\">549</span><br><span class=\"line\">550</span><br><span class=\"line\">551</span><br><span class=\"line\">552</span><br><span class=\"line\">553</span><br><span class=\"line\">554</span><br><span class=\"line\">555</span><br><span class=\"line\">556</span><br><span class=\"line\">557</span><br><span class=\"line\">558</span><br><span class=\"line\">559</span><br><span class=\"line\">560</span><br><span class=\"line\">561</span><br><span class=\"line\">562</span><br><span class=\"line\">563</span><br><span class=\"line\">564</span><br><span class=\"line\">565</span><br><span class=\"line\">566</span><br><span class=\"line\">567</span><br><span class=\"line\">568</span><br><span class=\"line\">569</span><br><span class=\"line\">570</span><br><span class=\"line\">571</span><br><span class=\"line\">572</span><br><span class=\"line\">573</span><br><span class=\"line\">574</span><br><span class=\"line\">575</span><br><span class=\"line\">576</span><br><span class=\"line\">577</span><br><span class=\"line\">578</span><br><span class=\"line\">579</span><br><span class=\"line\">580</span><br><span class=\"line\">581</span><br><span class=\"line\">582</span><br><span class=\"line\">583</span><br><span class=\"line\">584</span><br><span class=\"line\">585</span><br><span class=\"line\">586</span><br><span class=\"line\">587</span><br><span class=\"line\">588</span><br><span class=\"line\">589</span><br><span class=\"line\">590</span><br><span class=\"line\">591</span><br><span class=\"line\">592</span><br><span class=\"line\">593</span><br><span class=\"line\">594</span><br><span class=\"line\">595</span><br><span class=\"line\">596</span><br><span class=\"line\">597</span><br><span class=\"line\">598</span><br><span class=\"line\">599</span><br><span class=\"line\">600</span><br><span class=\"line\">601</span><br><span class=\"line\">602</span><br><span class=\"line\">603</span><br><span class=\"line\">604</span><br><span class=\"line\">605</span><br><span class=\"line\">606</span><br><span class=\"line\">607</span><br><span class=\"line\">608</span><br><span class=\"line\">609</span><br><span class=\"line\">610</span><br><span class=\"line\">611</span><br><span class=\"line\">612</span><br><span class=\"line\">613</span><br><span class=\"line\">614</span><br><span class=\"line\">615</span><br><span class=\"line\">616</span><br><span class=\"line\">617</span><br><span class=\"line\">618</span><br><span class=\"line\">619</span><br><span class=\"line\">620</span><br><span class=\"line\">621</span><br><span class=\"line\">622</span><br><span class=\"line\">623</span><br><span class=\"line\">624</span><br><span class=\"line\">625</span><br><span class=\"line\">626</span><br><span class=\"line\">627</span><br><span class=\"line\">628</span><br><span class=\"line\">629</span><br><span class=\"line\">630</span><br><span class=\"line\">631</span><br><span class=\"line\">632</span><br><span class=\"line\">633</span><br><span class=\"line\">634</span><br><span class=\"line\">635</span><br><span class=\"line\">636</span><br><span class=\"line\">637</span><br><span class=\"line\">638</span><br><span class=\"line\">639</span><br><span class=\"line\">640</span><br><span class=\"line\">641</span><br><span class=\"line\">642</span><br><span class=\"line\">643</span><br><span class=\"line\">644</span><br><span class=\"line\">645</span><br><span class=\"line\">646</span><br><span class=\"line\">647</span><br><span class=\"line\">648</span><br><span class=\"line\">649</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Here <span class=\"keyword\">is</span> the C<span class=\"meta\"># code you provided with all comments removed:</span></span><br><span class=\"line\"></span><br><span class=\"line\">```csharp</span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title\">GNCAutoInvoiceVendConsignedPOBatch</span> <span class=\"title\">extends</span> <span class=\"title\">RunBaseBatch</span> <span class=\"title\">implements</span> <span class=\"title\">BatchRetryable</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    SysLookupMultiSelectValues  gInvoiceIds;</span><br><span class=\"line\">    boolean                     gCreateParmTable;</span><br><span class=\"line\">    PurchTable                  gPurchTable;</span><br><span class=\"line\">    boolean                     gMultiPOs;</span><br><span class=\"line\">    PurchId                     gPurchId;</span><br><span class=\"line\">    RecordInsertList            gParmLineRecordInsertList, gParmSubLineRecordInsertList, gMarkupTrans;</span><br><span class=\"line\">    systemSequence              gSystemSequence;</span><br><span class=\"line\">    Num                         gInvoiceNumber;</span><br><span class=\"line\">    TransDate                   gInvoiceDate        = DateTimeUtil::getSystemDate(DateTimeUtil::getUserPreferredTimeZone());</span><br><span class=\"line\">    InvoiceDescriptionLarge     gDescription;</span><br><span class=\"line\">    Map                         gTableRefIdMap      = <span class=\"keyword\">new</span> Map(Types::String, Types::String);</span><br><span class=\"line\">    Map                         gItemMap            = <span class=\"keyword\">new</span> Map(Types::String, Types::Real);</span><br><span class=\"line\">    DialogField     gDlgInvoiceIds;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">#<span class=\"keyword\">define</span>.CurrentVersion(1)</span></span><br><span class=\"line\">    <span class=\"meta\">#localmacro.CurrentList</span></span><br><span class=\"line\">        gInvoiceIds</span><br><span class=\"line\">    <span class=\"meta\">#endmacro</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> boolean <span class=\"title\">canGoBatch</span>()</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> boolean <span class=\"title\">canGoBatchJournal</span>()</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Object <span class=\"title\">dialog</span>()</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        DialogRunbase       dialog = super();</span><br><span class=\"line\">    </span><br><span class=\"line\">        gDlgInvoiceIds = dialog.addFieldValue(extendedTypeStr(SysLookupMultiSelectValues), gInvoiceIds, <span class=\"string\">&quot;@SYS12128&quot;</span>);</span><br><span class=\"line\">    </span><br><span class=\"line\">        <span class=\"keyword\">return</span> dialog;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">dialogPostRun</span>(<span class=\"params\">DialogRunbase _dialog</span>)</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        super(_dialog);</span><br><span class=\"line\"></span><br><span class=\"line\">        Query                   query;</span><br><span class=\"line\">        QueryBuildDataSource    qbds;</span><br><span class=\"line\"></span><br><span class=\"line\">        query   = <span class=\"keyword\">new</span> Query(queryStr(GNCAutoInvoiceVendConsignedLookupQuery));</span><br><span class=\"line\"></span><br><span class=\"line\">        SysLookupMultiSelectCtrl::constructWithQuery(</span><br><span class=\"line\">                    _dialog.dialogForm().formRun(),</span><br><span class=\"line\">                    gDlgInvoiceIds.control(),</span><br><span class=\"line\">                    query,</span><br><span class=\"line\">                    <span class=\"literal\">false</span>,</span><br><span class=\"line\">                    [<span class=\"meta\">tableNum(CustInvoiceJour), fieldNum(CustInvoiceJour, InvoiceId)</span>]</span><br><span class=\"line\">        );</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> boolean <span class=\"title\">getFromDialog</span>()</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        gInvoiceIds = gDlgInvoiceIds.<span class=\"keyword\">value</span>();</span><br><span class=\"line\">    </span><br><span class=\"line\">        <span class=\"keyword\">return</span> super();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> container <span class=\"title\">pack</span>()</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> [<span class=\"meta\">#CurrentVersion, #CurrentList];</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">static</span> GNCAutoInvoiceVendConsignedPOBatch <span class=\"title\">construct</span>()</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> GNCAutoInvoiceVendConsignedPOBatch();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">static</span> ClassDescription <span class=\"title\">description</span>()</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;@GNC:AutoInvoiceVendorConsignedPurchaseOrder&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span>(<span class=\"params\">Args _args</span>)</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        GNCAutoInvoiceVendConsignedPOBatch      batch;</span><br><span class=\"line\">    </span><br><span class=\"line\">        batch = GNCAutoInvoiceVendConsignedPOBatch::construct();</span><br><span class=\"line\">    </span><br><span class=\"line\">        <span class=\"keyword\">if</span> (batch.prompt())</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            batch.runOperation();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> boolean <span class=\"title\">canRunInNewSession</span>()</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    [<span class=\"meta\">Hookable(false)</span>]</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> final boolean <span class=\"title\">isRetryable</span>()</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Qty <span class=\"title\">getFinalInvoiceQty</span>(<span class=\"params\">ItemId _itemId, Qty _qty</span>)</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        Qty retQty, storeQty;</span><br><span class=\"line\"></span><br><span class=\"line\">        GNCProcessedVendorConsignedInvAdjustments processedVendorConsignedInvAdjustments = GNCProcessedVendorConsignedInvAdjustments::find(_itemId, <span class=\"literal\">true</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (processedVendorConsignedInvAdjustments.RecId)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            ttsbegin;</span><br><span class=\"line\">            storeQty = processedVendorConsignedInvAdjustments.Qty;</span><br><span class=\"line\">            retQty = _qty - storeQty;</span><br><span class=\"line\">            processedVendorConsignedInvAdjustments.Qty = retQty &lt; <span class=\"number\">0</span> ? abs(retQty) : <span class=\"number\">0</span>;</span><br><span class=\"line\">            processedVendorConsignedInvAdjustments.update();</span><br><span class=\"line\">            ttscommit;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">else</span></span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            retQty = _qty;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> retQty;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span>()</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"meta\">#OCCRetryCount</span></span><br><span class=\"line\"></span><br><span class=\"line\">        setPrefix(<span class=\"string\">&quot;@GNC:AutoInvoiceVendorConsignedPurchaseOrder&quot;</span>);</span><br><span class=\"line\">        </span><br><span class=\"line\">        query                       query_Item      = <span class=\"keyword\">new</span> Query(queryStr(GNCAutoInvoiceVendConsignedItemQuery));</span><br><span class=\"line\">        QueryBuildDataSource        qbds;</span><br><span class=\"line\">        SysLookupMultiSelectValues  qrvInvoiceIds   = strReplace(gInvoiceIds, <span class=\"string\">&#x27;;&#x27;</span>, <span class=\"string\">&#x27;,&#x27;</span>);</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">if</span> (qrvInvoiceIds)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            qbds = query_Item.dataSourceTable(tableNum(CustInvoiceJour));</span><br><span class=\"line\">            qbds.addRange(fieldNum(CustInvoiceJour, InvoiceId)).<span class=\"keyword\">value</span>(qrvInvoiceIds);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        QueryRun                    queryRunItem    = <span class=\"keyword\">new</span> QueryRun(query_Item);</span><br><span class=\"line\">        TransDateTime               earliestDateTime;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">while</span> (queryRunItem.next())</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            CustInvoiceTrans custInvoiceTrans_Item = queryRunItem.<span class=\"keyword\">get</span>(tableNum(CustInvoiceTrans));</span><br><span class=\"line\"></span><br><span class=\"line\">            Qty finalInvoiceQty = <span class=\"keyword\">this</span>.getfinalInvoiceQty(custInvoiceTrans_Item.ItemId, custInvoiceTrans_Item.Qty);</span><br><span class=\"line\">            PurchLine   purchLine_earliest;</span><br><span class=\"line\">            PurchTable  purchTable_earliest;</span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"function\"><span class=\"keyword\">select</span> firstonly <span class=\"title\">minof</span>(<span class=\"params\">CreatedDateTime</span>) <span class=\"keyword\">from</span> purchTable_earliest</span></span><br><span class=\"line\"><span class=\"function\">                <span class=\"keyword\">where</span> purchTable_earliest.PurchaseType</span>              == PurchaseType::Purch</span><br><span class=\"line\">                exists <span class=\"keyword\">join</span> purchLine_earliest</span><br><span class=\"line\">                    <span class=\"keyword\">where</span> purchLine_earliest.PurchId                == purchTable_earliest.PurchId</span><br><span class=\"line\">                        &amp;&amp; !purchLine_earliest.Blocked</span><br><span class=\"line\">                        &amp;&amp; !purchLine_earliest.IsDeleted</span><br><span class=\"line\">                        &amp;&amp; (purchLine_earliest.PurchStatus          == PurchStatus::Backorder</span><br><span class=\"line\">                        || purchLine_earliest.PurchStatus           == PurchStatus::Received)</span><br><span class=\"line\">                        &amp;&amp; purchLine_earliest.ItemId                == custInvoiceTrans_Item.ItemId</span><br><span class=\"line\">                        &amp;&amp; purchLine_earliest.RemainPurchFinancial  &gt; <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (!earliestDateTime || earliestDateTime &gt; purchTable_earliest.CreatedDateTime)</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                earliestDateTime = purchTable_earliest.CreatedDateTime;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!gItemMap.empty())</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">while</span> <span class=\"keyword\">select</span> gPurchTable</span><br><span class=\"line\">                <span class=\"keyword\">where</span> gPurchTable.PurchaseType      == PurchaseType::Purch</span><br><span class=\"line\">                    &amp;&amp; gPurchTable.CreatedDateTime  &gt;= earliestDateTime</span><br><span class=\"line\">                    &amp;&amp; (gPurchTable.PurchStatus     == PurchStatus::Backorder</span><br><span class=\"line\">                    || gPurchTable.PurchStatus      == PurchStatus::Received)</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"keyword\">try</span></span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">this</span>.processSinglePO();</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">catch</span> (Exception::Deadlock)</span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    retry;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">catch</span> (Exception::UpdateConflict)</span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (appl.ttsLevel() == <span class=\"number\">0</span>)</span><br><span class=\"line\">                    &#123;</span><br><span class=\"line\">                        <span class=\"keyword\">if</span> (xSession::currentRetryCount() &gt;= <span class=\"meta\">#RetryNum)</span></span><br><span class=\"line\">                        &#123;</span><br><span class=\"line\">                            <span class=\"keyword\">throw</span> Exception::UpdateConflictNotRecovered;</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                        <span class=\"keyword\">else</span></span><br><span class=\"line\">                        &#123;</span><br><span class=\"line\">                            retry;</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                    <span class=\"keyword\">else</span></span><br><span class=\"line\">                    &#123;</span><br><span class=\"line\">                        <span class=\"keyword\">throw</span> Exception::UpdateConflict;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">catch</span></span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (appl.ttsLevel() != <span class=\"number\">0</span>)</span><br><span class=\"line\">                    &#123;</span><br><span class=\"line\">                        ttsabort;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                    <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">this</span>.insertExceptions();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        Query   query_jour = <span class=\"keyword\">new</span> Query();</span><br><span class=\"line\"></span><br><span class=\"line\">        qbds = query_jour.addDataSource(tableNum(CustInvoiceJour));</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">if</span> (qrvInvoiceIds)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            qbds = query_jour.dataSourceTable(tableNum(CustInvoiceJour));</span><br><span class=\"line\">            qbds.addRange(fieldNum(CustInvoiceJour, InvoiceId)).<span class=\"keyword\">value</span>(qrvInvoiceIds);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        QueryRun    queryRunJour    = <span class=\"keyword\">new</span> QueryRun(query_jour);</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">while</span> (queryRunJour.next())</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">try</span></span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                CustInvoiceJour custInvoiceJourUpd = queryRunJour.<span class=\"keyword\">get</span>(tableNum(CustInvoiceJour));</span><br><span class=\"line\"></span><br><span class=\"line\">                custInvoiceJourUpd.selectForUpdate(<span class=\"literal\">true</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">                ttsbegin;</span><br><span class=\"line\">                custInvoiceJourUpd.GNCProcessedVendConsignedInvoice = <span class=\"literal\">true</span>;</span><br><span class=\"line\">                custInvoiceJourUpd.update();</span><br><span class=\"line\">                ttscommit;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">catch</span> (Exception::Deadlock)</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                retry;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">catch</span> (Exception::UpdateConflict)</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (appl.ttsLevel() == <span class=\"number\">0</span>)</span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (xSession::currentRetryCount() &gt;= <span class=\"meta\">#RetryNum)</span></span><br><span class=\"line\">                    &#123;</span><br><span class=\"line\">                        <span class=\"keyword\">throw</span> Exception::UpdateConflictNotRecovered;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                    <span class=\"keyword\">else</span></span><br><span class=\"line\">                    &#123;</span><br><span class=\"line\">                        retry;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">else</span></span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">throw</span> Exception::UpdateConflict;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">catch</span></span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (appl.ttsLevel() != <span class=\"number\">0</span>)</span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    ttsabort;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">processSinglePO</span>()</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        PurchLine                   purchLine, prevPurchLine;</span><br><span class=\"line\">        VendPackingSlipTrans        vendPackingSlipTrans;</span><br><span class=\"line\">        Map                         packingSlipTransMap = <span class=\"keyword\">new</span> Map(Types::Int64, Types::Real);</span><br><span class=\"line\">        QueryRun                    queryRun;</span><br><span class=\"line\">        CustInvoiceTrans            custInvoiceTrans;</span><br><span class=\"line\">        Qty                         qtyToInvoice;</span><br><span class=\"line\">            </span><br><span class=\"line\">        gPurchId = gPurchTable.PurchId;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">this</span>.initParameters();</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.initRecordLists();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">while</span> <span class=\"keyword\">select</span> purchLine</span><br><span class=\"line\">            <span class=\"keyword\">where</span> purchLine.PurchId                             == gPurchTable.PurchId</span><br><span class=\"line\">                &amp;&amp; !purchLine.Blocked</span><br><span class=\"line\">                &amp;&amp; !purchLine.IsDeleted</span><br><span class=\"line\">                &amp;&amp; (purchLine.PurchStatus                       == PurchStatus::Backorder</span><br><span class=\"line\">                || purchLine.PurchStatus                        == PurchStatus::Received)</span><br><span class=\"line\">                &amp;&amp; purchLine.RemainPurchFinancial               &gt; <span class=\"number\">0</span></span><br><span class=\"line\">                <span class=\"keyword\">join</span> vendPackingSlipTrans</span><br><span class=\"line\">                    <span class=\"keyword\">where</span> vendPackingSlipTrans.InventTransId    == purchLine.InventTransId</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            Qty         purchRemain = vendPackingSlipTrans.remainPurchFinancial();</span><br><span class=\"line\">            Qty         curQty;</span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"keyword\">if</span> (!purchRemain)</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (!gItemMap.exists(purchLine.ItemId))</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            qtyToInvoice = gItemMap.lookup(purchLine.ItemId);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (!qtyToInvoice)</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (qtyToInvoice &gt; purchRemain)</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                curQty          = purchRemain;</span><br><span class=\"line\">                qtyToInvoice    -= purchRemain;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">else</span></span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                curQty          = abs(qtyToInvoice);</span><br><span class=\"line\">                qtyToInvoice    = <span class=\"number\">0</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (purchLine.RecId != prevPurchLine.RecId)</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (packingSlipTransMap.elements() &gt; <span class=\"number\">0</span>)</span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">this</span>.createParmLineAndSubLines(prevPurchLine, packingSlipTransMap.pack());</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                prevPurchLine       = purchLine.data();</span><br><span class=\"line\">                packingSlipTransMap = <span class=\"keyword\">new</span> Map(Types::Int64, Types::Real);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            packingSlipTransMap.insert(vendPackingSlipTrans.RecId, curQty);</span><br><span class=\"line\">            gItemMap.insert(purchLine.ItemId, qtyToInvoice);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (prevPurchLine.RecId &amp;&amp; packingSlipTransMap.elements() &gt; <span class=\"number\">0</span>)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">this</span>.createParmLineAndSubLines(prevPurchLine, packingSlipTransMap.pack());</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (gCreateParmTable)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            gInvoiceNumber = gPurchTable.PurchId;</span><br><span class=\"line\"></span><br><span class=\"line\">            VendInvoiceJour vendInvoiceJour;</span><br><span class=\"line\">            Counter         i;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">select</span> firstonly RecId <span class=\"keyword\">from</span> vendInvoiceJour</span><br><span class=\"line\">                <span class=\"keyword\">where</span> vendInvoiceJour.InvoiceId == gInvoiceNumber;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">while</span> (vendInvoiceJour.RecId)</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                i++;</span><br><span class=\"line\">                vendInvoiceJour.clear();</span><br><span class=\"line\"></span><br><span class=\"line\">                gInvoiceNumber = strfmt(<span class=\"string\">&#x27;%1_%2&#x27;</span>, gPurchTable.PurchId, i);</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"keyword\">select</span> firstonly RecId <span class=\"keyword\">from</span> vendInvoiceJour</span><br><span class=\"line\">                    <span class=\"keyword\">where</span> vendInvoiceJour.InvoiceId == gInvoiceNumber;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            VendInvoiceInfoTable        vendInvoiceInfoTable;</span><br><span class=\"line\"></span><br><span class=\"line\">            ttsbegin;</span><br><span class=\"line\">            vendInvoiceInfoTable = <span class=\"keyword\">this</span>.createParmTable();</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">this</span>.insertRecordLists();</span><br><span class=\"line\">            </span><br><span class=\"line\">            PurchFormLetter_Invoice purchFormLetter = PurchFormLetter_Invoice::newFromSavedInvoice(vendInvoiceInfoTable);</span><br><span class=\"line\">            purchFormLetter.purchTable(gPurchTable);</span><br><span class=\"line\">            purchFormLetter.printFormLetter(<span class=\"literal\">false</span>);</span><br><span class=\"line\">            purchFormLetter.proforma(<span class=\"literal\">false</span>);</span><br><span class=\"line\">            purchFormLetter.parmId(vendInvoiceInfoTable.ParmId);</span><br><span class=\"line\">            purchFormLetter.update(vendInvoiceInfoTable, vendInvoiceInfoTable.Num);</span><br><span class=\"line\"></span><br><span class=\"line\">            ttscommit;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">select</span> firstonly RecId <span class=\"keyword\">from</span> vendInvoiceJour</span><br><span class=\"line\">                <span class=\"keyword\">where</span> vendInvoiceJour.InvoiceId == vendInvoiceInfoTable.Num;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (vendInvoiceJour)</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                Info(strFmt(<span class=\"string\">&quot;Vendor invoice journal %1 is posted.&quot;</span>, vendInvoiceInfoTable.Num));</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">insertExceptions</span>()</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        MapEnumerator itemME = gItemMap.getEnumerator();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">while</span> (itemME.moveNext())</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            ItemId                      itemId  = itemME.currentKey();</span><br><span class=\"line\">            Qty                         qtyExce = itemME.currentValue(); </span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (!qtyExce)</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            query                       query   = <span class=\"keyword\">new</span> Query(queryStr(GNCAutoInvoiceVendConsignedQuery));</span><br><span class=\"line\">            QueryBuildDataSource        qbds;</span><br><span class=\"line\">            SysLookupMultiSelectValues  qrvInvoiceIds   = strReplace(gInvoiceIds, <span class=\"string\">&#x27;;&#x27;</span>, <span class=\"string\">&#x27;,&#x27;</span>);</span><br><span class=\"line\">            QueryRun                    queryRun;</span><br><span class=\"line\">            </span><br><span class=\"line\">            qbds = query.dataSourceTable(tableNum(CustInvoiceTrans));</span><br><span class=\"line\">            qbds.addRange(fieldNum(CustInvoiceTrans, ItemId)).<span class=\"keyword\">value</span>(itemId);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (qrvInvoiceIds)</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                qbds = query.dataSourceTable(tableNum(CustInvoiceJour));</span><br><span class=\"line\">                qbds.addRange(fieldNum(CustInvoiceJour, InvoiceId)).<span class=\"keyword\">value</span>(qrvInvoiceIds);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            queryRun = <span class=\"keyword\">new</span> QueryRun(query);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">while</span> (queryRun.next())</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                CustInvoiceTrans    custInvoiceTrans = queryRun.<span class=\"keyword\">get</span>(tableNum(CustInvoiceTrans));</span><br><span class=\"line\">                Qty                 qtyRemain, curQty;</span><br><span class=\"line\"></span><br><span class=\"line\">                qtyRemain = custInvoiceTrans.Qty;</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"keyword\">if</span> (qtyExce &gt; qtyRemain)</span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    curQty      = qtyRemain;</span><br><span class=\"line\">                    qtyExce     -= qtyRemain;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">else</span></span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    curQty      = qtyExce;</span><br><span class=\"line\">                    qtyExce     = <span class=\"number\">0</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">                GNCAutoInvoiceVendConsignedException::create(gInvoiceDate, </span><br><span class=\"line\">                    custInvoiceTrans.SalesId, </span><br><span class=\"line\">                    custInvoiceTrans.InvoiceDate, </span><br><span class=\"line\">                    custInvoiceTrans.ItemId, </span><br><span class=\"line\">                    custInvoiceTrans.Qty, </span><br><span class=\"line\">                    curQty);</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"keyword\">if</span> (!qtyExce)</span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">initParameters</span>()</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        gSystemSequence     = <span class=\"keyword\">new</span> systemSequence();</span><br><span class=\"line\">        gCreateParmTable    = <span class=\"literal\">false</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> TradeLineRefId <span class=\"title\">getTableRefId</span>()</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!gTableRefIdMap.exists(gPurchId))</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            gTableRefIdMap.insert(gPurchId, formletterParmData::getNewTableRefId());</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> gTableRefIdMap.lookup(gPurchId);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">initRecordLists</span>()</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        gParmLineRecordInsertList       = <span class=\"keyword\">new</span> RecordInsertList(tableNum(VendInvoiceInfoLine));</span><br><span class=\"line\">        gParmSubLineRecordInsertList    = <span class=\"keyword\">new</span> RecordInsertList(tableNum(VendInvoiceInfoSubLine));</span><br><span class=\"line\">        gMarkupTrans    = <span class=\"keyword\">new</span> RecordInsertList(tableNum(MarkupTrans));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">insertParmLine</span>(<span class=\"params\">VendInvoiceInfoLine _vendInvoiceInfoLine, PurchLine _purchLine</span>)</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        gSystemSequence.suspendRecIds(_vendInvoiceInfoLine.TableId);</span><br><span class=\"line\">        _vendInvoiceInfoLine.RecId  = gSystemSequence.reserveValues(<span class=\"number\">1</span>, _vendInvoiceInfoLine.TableId);</span><br><span class=\"line\"></span><br><span class=\"line\">        gParmLineRecordInsertList.<span class=\"keyword\">add</span>(_vendInvoiceInfoLine);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">createVendInvoiceMatchingLine</span>(<span class=\"params\">PurchLine _purchLine, VendDocumentLineMap _parmLine</span>)</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        VendInvoiceMatchingLine vendInvoiceMatchingLine;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (_parmLine.TableId &amp;&amp; _parmLine.RecId &amp;&amp; _purchLine)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            vendInvoiceMatchingLine.clear();</span><br><span class=\"line\">            vendInvoiceMatchingLine.initExpectedValues(_purchLine, _parmLine);</span><br><span class=\"line\">            vendInvoiceMatchingLine.RefTableId = _parmLine.TableId;</span><br><span class=\"line\">            vendInvoiceMatchingLine.RefRecId = _parmLine.RecId;</span><br><span class=\"line\">            vendInvoiceMatchingLine.insert();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">createMarkupTrans</span>(<span class=\"params\">PurchLine _purchLine, VendInvoiceInfoLine _vendInvoiceInfoLine</span>)</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        MarkupTrans markupTrans, markupTransNew;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">while</span> <span class=\"keyword\">select</span> markupTrans</span><br><span class=\"line\">            <span class=\"keyword\">where</span> markupTrans.TransTableId  == _purchLine.TableId</span><br><span class=\"line\">                &amp;&amp; markupTrans.TransRecId   == _purchLine.RecId</span><br><span class=\"line\">                &amp;&amp; markupTrans.Value        != <span class=\"number\">0</span></span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            buf2Buf(markupTrans, markupTransNew);</span><br><span class=\"line\">            markupTransNew.TransTableId       = _vendInvoiceInfoLine.TableId;</span><br><span class=\"line\">            markupTransNew.TransRecId         = _vendInvoiceInfoLine.RecId;</span><br><span class=\"line\">            gMarkupTrans.<span class=\"keyword\">add</span>(markupTransNew);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">insertParmSubLine</span>(<span class=\"params\">VendInvoiceInfoSubLine _vendInvoiceInfoSubLine</span>)</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (_vendInvoiceInfoSubLine.ReceiveNow == <span class=\"number\">0</span>)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        gParmSubLineRecordInsertList.<span class=\"keyword\">add</span>(_vendInvoiceInfoSubLine);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">insertRecordLists</span>()</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        gParmLineRecordInsertList.insertDatabase();</span><br><span class=\"line\">        gParmSubLineRecordInsertList.insertDatabase();</span><br><span class=\"line\">        gMarkupTrans.insertDatabase();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">createParmLineAndSubLines</span>(<span class=\"params\">PurchLine _purchLine, container _packedSubLinesMap</span>)</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        MapEnumerator           me;</span><br><span class=\"line\">        VendInvoiceInfoLine     vendInvoiceInfoLine;</span><br><span class=\"line\">        Qty                     newPostingQty;</span><br><span class=\"line\">        VendPackingSlipTrans    vendPackingSlipTrans;</span><br><span class=\"line\">        Set                     subLineSet      = <span class=\"keyword\">new</span> Set(Types::Record);</span><br><span class=\"line\"></span><br><span class=\"line\">        me = Map::create(_packedSubLinesMap).getEnumerator();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">while</span> (me.moveNext())</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            RefRecId        vendPackingSlipTransRecId   = me.currentKey();</span><br><span class=\"line\">            Qty             qty                         = me.currentValue();</span><br><span class=\"line\"></span><br><span class=\"line\">            vendPackingSlipTrans            = VendPackingSlipTrans::findRecId(vendPackingSlipTransRecId);</span><br><span class=\"line\"></span><br><span class=\"line\">            vendPackingSlipTrans.Qty        = qty;</span><br><span class=\"line\">            vendPackingSlipTrans.InventQty  = qty;</span><br><span class=\"line\">            newPostingQty                   += qty;</span><br><span class=\"line\"></span><br><span class=\"line\">            subLineSet.<span class=\"keyword\">add</span>(vendPackingSlipTrans);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">if</span> (newPostingQty == <span class=\"number\">0</span>)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        vendInvoiceInfoLine = <span class=\"keyword\">this</span>.createParmLine(_purchLine, newPostingQty);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">this</span>.createParmSubLines(vendInvoiceInfoLine, subLineSet);</span><br><span class=\"line\">        </span><br><span class=\"line\">        gCreateParmTable = <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> VendInvoiceInfoLine <span class=\"title\">createParmLine</span>(<span class=\"params\">PurchLine _purchLine, Qty _receiveNow</span>)</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        VendInvoiceInfoLine vendInvoiceInfoLine;</span><br><span class=\"line\"></span><br><span class=\"line\">        vendInvoiceInfoLine.Ordering        = DocumentStatus::Invoice;</span><br><span class=\"line\">        vendInvoiceInfoLine.TableRefId      = <span class=\"keyword\">this</span>.getTableRefId();</span><br><span class=\"line\">        vendInvoiceInfoLine.DocumentOrigin  = DocumentOrigin::Manual;</span><br><span class=\"line\">        vendInvoiceInfoLine.initFromPurchLine(_purchLine);</span><br><span class=\"line\">        vendInvoiceInfoLine.defaultRow(_purchLine, <span class=\"literal\">null</span>, _receiveNow, _receiveNow);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">this</span>.insertParmLine(vendInvoiceInfoLine, _purchLine);</span><br><span class=\"line\">        </span><br><span class=\"line\">        gCreateParmTable = <span class=\"literal\">true</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> vendInvoiceInfoLine;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">createParmSubLines</span>(<span class=\"params\">VendInvoiceInfoLine _vendInvoiceInfoLine, Set _subLineSet</span>)</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        VendPackingSlipTrans    vendPackingSlipTrans;</span><br><span class=\"line\">        VendInvoiceInfoSubLine  vendInvoiceInfoSubLine;</span><br><span class=\"line\">        SetEnumerator           se = _subLineSet.getEnumerator();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">while</span> (se.moveNext())</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            vendPackingSlipTrans = se.current();</span><br><span class=\"line\"></span><br><span class=\"line\">            vend</span><br><span class=\"line\"></span><br><span class=\"line\">InvoiceInfoSubLine.clear();</span><br><span class=\"line\">            vendInvoiceInfoSubLine.initFromLine(_vendInvoiceInfoLine);</span><br><span class=\"line\">            vendInvoiceInfoSubLine.initFromVendPackingSlipTrans(vendPackingSlipTrans);</span><br><span class=\"line\">            <span class=\"keyword\">this</span>.insertParmSubLine(vendInvoiceInfoSubLine);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!_vendInvoiceInfoLine.vendInvoiceInfoSubTable())</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            VendInvoiceInfoSubTable::createFromVendInvoiceInfoLine(_vendInvoiceInfoLine, _vendInvoiceInfoLine.ParmId, gDescription, <span class=\"literal\">true</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> VendInvoiceInfoTable <span class=\"title\">createParmTable</span>()</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        VendInvoiceInfoTable        vendInvoiceInfoTable;</span><br><span class=\"line\"></span><br><span class=\"line\">        vendInvoiceInfoTable.clear();</span><br><span class=\"line\">        vendInvoiceInfoTable.initValue();</span><br><span class=\"line\">        vendInvoiceInfoTable.defaultRow(gPurchTable);</span><br><span class=\"line\">        vendInvoiceInfoTable.initFromPurchTable(gPurchTable);</span><br><span class=\"line\">        vendInvoiceInfoTable.DocumentOrigin         = DocumentOrigin::Manual;</span><br><span class=\"line\">        vendInvoiceInfoTable.Num                    = gInvoiceNumber;</span><br><span class=\"line\">        vendInvoiceInfoTable.VendInvoiceSaveStatus  = VendInvoiceSaveStatus::Pending;</span><br><span class=\"line\">        vendInvoiceInfoTable.Description            = <span class=\"string\">&#x27;Retail POS Sale&#x27;</span>;</span><br><span class=\"line\">        vendInvoiceInfoTable.DocumentDate           = gInvoiceDate;</span><br><span class=\"line\">        vendInvoiceInfoTable.TransDate              = gInvoiceDate;</span><br><span class=\"line\">        vendInvoiceInfoTable.LastMatchVariance      = LastMatchVarianceOptions::OK;</span><br><span class=\"line\">        vendInvoiceInfoTable.ParmJobStatus          = ParmJobStatus::Waiting;</span><br><span class=\"line\">        vendInvoiceInfoTable.Approved               = NoYes::Yes;</span><br><span class=\"line\">        vendInvoiceInfoTable.Approver               = HcmWorker::userId2Worker(curUserId());</span><br><span class=\"line\">        vendInvoiceInfoTable.TableRefId             = <span class=\"keyword\">this</span>.getTableRefId();</span><br><span class=\"line\">        vendInvoiceInfoTable.Ordering               = DocumentStatus::Invoice;</span><br><span class=\"line\">        vendInvoiceInfoTable.initInvoiceTotals();</span><br><span class=\"line\">        vendInvoiceInfoTable.insert();</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">return</span> vendInvoiceInfoTable;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">createParmSubTable</span>(<span class=\"params\">VendInvoiceInfoTable _vendInvoiceInfoTable</span>)</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        VendInvoiceInfoSubTable::createFromVendInvoiceInfoTable(_vendInvoiceInfoTable, <span class=\"literal\">true</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>","excerpt":"","more":"<blockquote>\n<p>本文记录了 x++ 代码 invoice 采购订单的示例代码</p>\n</blockquote>\n<figure class=\"highlight c#\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br><span class=\"line\">249</span><br><span class=\"line\">250</span><br><span class=\"line\">251</span><br><span class=\"line\">252</span><br><span class=\"line\">253</span><br><span class=\"line\">254</span><br><span class=\"line\">255</span><br><span class=\"line\">256</span><br><span class=\"line\">257</span><br><span class=\"line\">258</span><br><span class=\"line\">259</span><br><span class=\"line\">260</span><br><span class=\"line\">261</span><br><span class=\"line\">262</span><br><span class=\"line\">263</span><br><span class=\"line\">264</span><br><span class=\"line\">265</span><br><span class=\"line\">266</span><br><span class=\"line\">267</span><br><span class=\"line\">268</span><br><span class=\"line\">269</span><br><span class=\"line\">270</span><br><span class=\"line\">271</span><br><span class=\"line\">272</span><br><span class=\"line\">273</span><br><span class=\"line\">274</span><br><span class=\"line\">275</span><br><span class=\"line\">276</span><br><span class=\"line\">277</span><br><span class=\"line\">278</span><br><span class=\"line\">279</span><br><span class=\"line\">280</span><br><span class=\"line\">281</span><br><span class=\"line\">282</span><br><span class=\"line\">283</span><br><span class=\"line\">284</span><br><span class=\"line\">285</span><br><span class=\"line\">286</span><br><span class=\"line\">287</span><br><span class=\"line\">288</span><br><span class=\"line\">289</span><br><span class=\"line\">290</span><br><span class=\"line\">291</span><br><span class=\"line\">292</span><br><span class=\"line\">293</span><br><span class=\"line\">294</span><br><span class=\"line\">295</span><br><span class=\"line\">296</span><br><span class=\"line\">297</span><br><span class=\"line\">298</span><br><span class=\"line\">299</span><br><span class=\"line\">300</span><br><span class=\"line\">301</span><br><span class=\"line\">302</span><br><span class=\"line\">303</span><br><span class=\"line\">304</span><br><span class=\"line\">305</span><br><span class=\"line\">306</span><br><span class=\"line\">307</span><br><span class=\"line\">308</span><br><span class=\"line\">309</span><br><span class=\"line\">310</span><br><span class=\"line\">311</span><br><span class=\"line\">312</span><br><span class=\"line\">313</span><br><span class=\"line\">314</span><br><span class=\"line\">315</span><br><span class=\"line\">316</span><br><span class=\"line\">317</span><br><span class=\"line\">318</span><br><span class=\"line\">319</span><br><span class=\"line\">320</span><br><span class=\"line\">321</span><br><span class=\"line\">322</span><br><span class=\"line\">323</span><br><span class=\"line\">324</span><br><span class=\"line\">325</span><br><span class=\"line\">326</span><br><span class=\"line\">327</span><br><span class=\"line\">328</span><br><span class=\"line\">329</span><br><span class=\"line\">330</span><br><span class=\"line\">331</span><br><span class=\"line\">332</span><br><span class=\"line\">333</span><br><span class=\"line\">334</span><br><span class=\"line\">335</span><br><span class=\"line\">336</span><br><span class=\"line\">337</span><br><span class=\"line\">338</span><br><span class=\"line\">339</span><br><span class=\"line\">340</span><br><span class=\"line\">341</span><br><span class=\"line\">342</span><br><span class=\"line\">343</span><br><span class=\"line\">344</span><br><span class=\"line\">345</span><br><span class=\"line\">346</span><br><span class=\"line\">347</span><br><span class=\"line\">348</span><br><span class=\"line\">349</span><br><span class=\"line\">350</span><br><span class=\"line\">351</span><br><span class=\"line\">352</span><br><span class=\"line\">353</span><br><span class=\"line\">354</span><br><span class=\"line\">355</span><br><span class=\"line\">356</span><br><span class=\"line\">357</span><br><span class=\"line\">358</span><br><span class=\"line\">359</span><br><span class=\"line\">360</span><br><span class=\"line\">361</span><br><span class=\"line\">362</span><br><span class=\"line\">363</span><br><span class=\"line\">364</span><br><span class=\"line\">365</span><br><span class=\"line\">366</span><br><span class=\"line\">367</span><br><span class=\"line\">368</span><br><span class=\"line\">369</span><br><span class=\"line\">370</span><br><span class=\"line\">371</span><br><span class=\"line\">372</span><br><span class=\"line\">373</span><br><span class=\"line\">374</span><br><span class=\"line\">375</span><br><span class=\"line\">376</span><br><span class=\"line\">377</span><br><span class=\"line\">378</span><br><span class=\"line\">379</span><br><span class=\"line\">380</span><br><span class=\"line\">381</span><br><span class=\"line\">382</span><br><span class=\"line\">383</span><br><span class=\"line\">384</span><br><span class=\"line\">385</span><br><span class=\"line\">386</span><br><span class=\"line\">387</span><br><span class=\"line\">388</span><br><span class=\"line\">389</span><br><span class=\"line\">390</span><br><span class=\"line\">391</span><br><span class=\"line\">392</span><br><span class=\"line\">393</span><br><span class=\"line\">394</span><br><span class=\"line\">395</span><br><span class=\"line\">396</span><br><span class=\"line\">397</span><br><span class=\"line\">398</span><br><span class=\"line\">399</span><br><span class=\"line\">400</span><br><span class=\"line\">401</span><br><span class=\"line\">402</span><br><span class=\"line\">403</span><br><span class=\"line\">404</span><br><span class=\"line\">405</span><br><span class=\"line\">406</span><br><span class=\"line\">407</span><br><span class=\"line\">408</span><br><span class=\"line\">409</span><br><span class=\"line\">410</span><br><span class=\"line\">411</span><br><span class=\"line\">412</span><br><span class=\"line\">413</span><br><span class=\"line\">414</span><br><span class=\"line\">415</span><br><span class=\"line\">416</span><br><span class=\"line\">417</span><br><span class=\"line\">418</span><br><span class=\"line\">419</span><br><span class=\"line\">420</span><br><span class=\"line\">421</span><br><span class=\"line\">422</span><br><span class=\"line\">423</span><br><span class=\"line\">424</span><br><span class=\"line\">425</span><br><span class=\"line\">426</span><br><span class=\"line\">427</span><br><span class=\"line\">428</span><br><span class=\"line\">429</span><br><span class=\"line\">430</span><br><span class=\"line\">431</span><br><span class=\"line\">432</span><br><span class=\"line\">433</span><br><span class=\"line\">434</span><br><span class=\"line\">435</span><br><span class=\"line\">436</span><br><span class=\"line\">437</span><br><span class=\"line\">438</span><br><span class=\"line\">439</span><br><span class=\"line\">440</span><br><span class=\"line\">441</span><br><span class=\"line\">442</span><br><span class=\"line\">443</span><br><span class=\"line\">444</span><br><span class=\"line\">445</span><br><span class=\"line\">446</span><br><span class=\"line\">447</span><br><span class=\"line\">448</span><br><span class=\"line\">449</span><br><span class=\"line\">450</span><br><span class=\"line\">451</span><br><span class=\"line\">452</span><br><span class=\"line\">453</span><br><span class=\"line\">454</span><br><span class=\"line\">455</span><br><span class=\"line\">456</span><br><span class=\"line\">457</span><br><span class=\"line\">458</span><br><span class=\"line\">459</span><br><span class=\"line\">460</span><br><span class=\"line\">461</span><br><span class=\"line\">462</span><br><span class=\"line\">463</span><br><span class=\"line\">464</span><br><span class=\"line\">465</span><br><span class=\"line\">466</span><br><span class=\"line\">467</span><br><span class=\"line\">468</span><br><span class=\"line\">469</span><br><span class=\"line\">470</span><br><span class=\"line\">471</span><br><span class=\"line\">472</span><br><span class=\"line\">473</span><br><span class=\"line\">474</span><br><span class=\"line\">475</span><br><span class=\"line\">476</span><br><span class=\"line\">477</span><br><span class=\"line\">478</span><br><span class=\"line\">479</span><br><span class=\"line\">480</span><br><span class=\"line\">481</span><br><span class=\"line\">482</span><br><span class=\"line\">483</span><br><span class=\"line\">484</span><br><span class=\"line\">485</span><br><span class=\"line\">486</span><br><span class=\"line\">487</span><br><span class=\"line\">488</span><br><span class=\"line\">489</span><br><span class=\"line\">490</span><br><span class=\"line\">491</span><br><span class=\"line\">492</span><br><span class=\"line\">493</span><br><span class=\"line\">494</span><br><span class=\"line\">495</span><br><span class=\"line\">496</span><br><span class=\"line\">497</span><br><span class=\"line\">498</span><br><span class=\"line\">499</span><br><span class=\"line\">500</span><br><span class=\"line\">501</span><br><span class=\"line\">502</span><br><span class=\"line\">503</span><br><span class=\"line\">504</span><br><span class=\"line\">505</span><br><span class=\"line\">506</span><br><span class=\"line\">507</span><br><span class=\"line\">508</span><br><span class=\"line\">509</span><br><span class=\"line\">510</span><br><span class=\"line\">511</span><br><span class=\"line\">512</span><br><span class=\"line\">513</span><br><span class=\"line\">514</span><br><span class=\"line\">515</span><br><span class=\"line\">516</span><br><span class=\"line\">517</span><br><span class=\"line\">518</span><br><span class=\"line\">519</span><br><span class=\"line\">520</span><br><span class=\"line\">521</span><br><span class=\"line\">522</span><br><span class=\"line\">523</span><br><span class=\"line\">524</span><br><span class=\"line\">525</span><br><span class=\"line\">526</span><br><span class=\"line\">527</span><br><span class=\"line\">528</span><br><span class=\"line\">529</span><br><span class=\"line\">530</span><br><span class=\"line\">531</span><br><span class=\"line\">532</span><br><span class=\"line\">533</span><br><span class=\"line\">534</span><br><span class=\"line\">535</span><br><span class=\"line\">536</span><br><span class=\"line\">537</span><br><span class=\"line\">538</span><br><span class=\"line\">539</span><br><span class=\"line\">540</span><br><span class=\"line\">541</span><br><span class=\"line\">542</span><br><span class=\"line\">543</span><br><span class=\"line\">544</span><br><span class=\"line\">545</span><br><span class=\"line\">546</span><br><span class=\"line\">547</span><br><span class=\"line\">548</span><br><span class=\"line\">549</span><br><span class=\"line\">550</span><br><span class=\"line\">551</span><br><span class=\"line\">552</span><br><span class=\"line\">553</span><br><span class=\"line\">554</span><br><span class=\"line\">555</span><br><span class=\"line\">556</span><br><span class=\"line\">557</span><br><span class=\"line\">558</span><br><span class=\"line\">559</span><br><span class=\"line\">560</span><br><span class=\"line\">561</span><br><span class=\"line\">562</span><br><span class=\"line\">563</span><br><span class=\"line\">564</span><br><span class=\"line\">565</span><br><span class=\"line\">566</span><br><span class=\"line\">567</span><br><span class=\"line\">568</span><br><span class=\"line\">569</span><br><span class=\"line\">570</span><br><span class=\"line\">571</span><br><span class=\"line\">572</span><br><span class=\"line\">573</span><br><span class=\"line\">574</span><br><span class=\"line\">575</span><br><span class=\"line\">576</span><br><span class=\"line\">577</span><br><span class=\"line\">578</span><br><span class=\"line\">579</span><br><span class=\"line\">580</span><br><span class=\"line\">581</span><br><span class=\"line\">582</span><br><span class=\"line\">583</span><br><span class=\"line\">584</span><br><span class=\"line\">585</span><br><span class=\"line\">586</span><br><span class=\"line\">587</span><br><span class=\"line\">588</span><br><span class=\"line\">589</span><br><span class=\"line\">590</span><br><span class=\"line\">591</span><br><span class=\"line\">592</span><br><span class=\"line\">593</span><br><span class=\"line\">594</span><br><span class=\"line\">595</span><br><span class=\"line\">596</span><br><span class=\"line\">597</span><br><span class=\"line\">598</span><br><span class=\"line\">599</span><br><span class=\"line\">600</span><br><span class=\"line\">601</span><br><span class=\"line\">602</span><br><span class=\"line\">603</span><br><span class=\"line\">604</span><br><span class=\"line\">605</span><br><span class=\"line\">606</span><br><span class=\"line\">607</span><br><span class=\"line\">608</span><br><span class=\"line\">609</span><br><span class=\"line\">610</span><br><span class=\"line\">611</span><br><span class=\"line\">612</span><br><span class=\"line\">613</span><br><span class=\"line\">614</span><br><span class=\"line\">615</span><br><span class=\"line\">616</span><br><span class=\"line\">617</span><br><span class=\"line\">618</span><br><span class=\"line\">619</span><br><span class=\"line\">620</span><br><span class=\"line\">621</span><br><span class=\"line\">622</span><br><span class=\"line\">623</span><br><span class=\"line\">624</span><br><span class=\"line\">625</span><br><span class=\"line\">626</span><br><span class=\"line\">627</span><br><span class=\"line\">628</span><br><span class=\"line\">629</span><br><span class=\"line\">630</span><br><span class=\"line\">631</span><br><span class=\"line\">632</span><br><span class=\"line\">633</span><br><span class=\"line\">634</span><br><span class=\"line\">635</span><br><span class=\"line\">636</span><br><span class=\"line\">637</span><br><span class=\"line\">638</span><br><span class=\"line\">639</span><br><span class=\"line\">640</span><br><span class=\"line\">641</span><br><span class=\"line\">642</span><br><span class=\"line\">643</span><br><span class=\"line\">644</span><br><span class=\"line\">645</span><br><span class=\"line\">646</span><br><span class=\"line\">647</span><br><span class=\"line\">648</span><br><span class=\"line\">649</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Here <span class=\"keyword\">is</span> the C<span class=\"meta\"># code you provided with all comments removed:</span></span><br><span class=\"line\"></span><br><span class=\"line\">```csharp</span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title\">GNCAutoInvoiceVendConsignedPOBatch</span> <span class=\"title\">extends</span> <span class=\"title\">RunBaseBatch</span> <span class=\"title\">implements</span> <span class=\"title\">BatchRetryable</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    SysLookupMultiSelectValues  gInvoiceIds;</span><br><span class=\"line\">    boolean                     gCreateParmTable;</span><br><span class=\"line\">    PurchTable                  gPurchTable;</span><br><span class=\"line\">    boolean                     gMultiPOs;</span><br><span class=\"line\">    PurchId                     gPurchId;</span><br><span class=\"line\">    RecordInsertList            gParmLineRecordInsertList, gParmSubLineRecordInsertList, gMarkupTrans;</span><br><span class=\"line\">    systemSequence              gSystemSequence;</span><br><span class=\"line\">    Num                         gInvoiceNumber;</span><br><span class=\"line\">    TransDate                   gInvoiceDate        = DateTimeUtil::getSystemDate(DateTimeUtil::getUserPreferredTimeZone());</span><br><span class=\"line\">    InvoiceDescriptionLarge     gDescription;</span><br><span class=\"line\">    Map                         gTableRefIdMap      = <span class=\"keyword\">new</span> Map(Types::String, Types::String);</span><br><span class=\"line\">    Map                         gItemMap            = <span class=\"keyword\">new</span> Map(Types::String, Types::Real);</span><br><span class=\"line\">    DialogField     gDlgInvoiceIds;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">#<span class=\"keyword\">define</span>.CurrentVersion(1)</span></span><br><span class=\"line\">    <span class=\"meta\">#localmacro.CurrentList</span></span><br><span class=\"line\">        gInvoiceIds</span><br><span class=\"line\">    <span class=\"meta\">#endmacro</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> boolean <span class=\"title\">canGoBatch</span>()</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> boolean <span class=\"title\">canGoBatchJournal</span>()</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Object <span class=\"title\">dialog</span>()</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        DialogRunbase       dialog = super();</span><br><span class=\"line\">    </span><br><span class=\"line\">        gDlgInvoiceIds = dialog.addFieldValue(extendedTypeStr(SysLookupMultiSelectValues), gInvoiceIds, <span class=\"string\">&quot;@SYS12128&quot;</span>);</span><br><span class=\"line\">    </span><br><span class=\"line\">        <span class=\"keyword\">return</span> dialog;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">dialogPostRun</span>(<span class=\"params\">DialogRunbase _dialog</span>)</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        super(_dialog);</span><br><span class=\"line\"></span><br><span class=\"line\">        Query                   query;</span><br><span class=\"line\">        QueryBuildDataSource    qbds;</span><br><span class=\"line\"></span><br><span class=\"line\">        query   = <span class=\"keyword\">new</span> Query(queryStr(GNCAutoInvoiceVendConsignedLookupQuery));</span><br><span class=\"line\"></span><br><span class=\"line\">        SysLookupMultiSelectCtrl::constructWithQuery(</span><br><span class=\"line\">                    _dialog.dialogForm().formRun(),</span><br><span class=\"line\">                    gDlgInvoiceIds.control(),</span><br><span class=\"line\">                    query,</span><br><span class=\"line\">                    <span class=\"literal\">false</span>,</span><br><span class=\"line\">                    [<span class=\"meta\">tableNum(CustInvoiceJour), fieldNum(CustInvoiceJour, InvoiceId)</span>]</span><br><span class=\"line\">        );</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> boolean <span class=\"title\">getFromDialog</span>()</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        gInvoiceIds = gDlgInvoiceIds.<span class=\"keyword\">value</span>();</span><br><span class=\"line\">    </span><br><span class=\"line\">        <span class=\"keyword\">return</span> super();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> container <span class=\"title\">pack</span>()</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> [<span class=\"meta\">#CurrentVersion, #CurrentList];</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">static</span> GNCAutoInvoiceVendConsignedPOBatch <span class=\"title\">construct</span>()</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> GNCAutoInvoiceVendConsignedPOBatch();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">static</span> ClassDescription <span class=\"title\">description</span>()</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;@GNC:AutoInvoiceVendorConsignedPurchaseOrder&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span>(<span class=\"params\">Args _args</span>)</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        GNCAutoInvoiceVendConsignedPOBatch      batch;</span><br><span class=\"line\">    </span><br><span class=\"line\">        batch = GNCAutoInvoiceVendConsignedPOBatch::construct();</span><br><span class=\"line\">    </span><br><span class=\"line\">        <span class=\"keyword\">if</span> (batch.prompt())</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            batch.runOperation();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> boolean <span class=\"title\">canRunInNewSession</span>()</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    [<span class=\"meta\">Hookable(false)</span>]</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> final boolean <span class=\"title\">isRetryable</span>()</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Qty <span class=\"title\">getFinalInvoiceQty</span>(<span class=\"params\">ItemId _itemId, Qty _qty</span>)</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        Qty retQty, storeQty;</span><br><span class=\"line\"></span><br><span class=\"line\">        GNCProcessedVendorConsignedInvAdjustments processedVendorConsignedInvAdjustments = GNCProcessedVendorConsignedInvAdjustments::find(_itemId, <span class=\"literal\">true</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (processedVendorConsignedInvAdjustments.RecId)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            ttsbegin;</span><br><span class=\"line\">            storeQty = processedVendorConsignedInvAdjustments.Qty;</span><br><span class=\"line\">            retQty = _qty - storeQty;</span><br><span class=\"line\">            processedVendorConsignedInvAdjustments.Qty = retQty &lt; <span class=\"number\">0</span> ? abs(retQty) : <span class=\"number\">0</span>;</span><br><span class=\"line\">            processedVendorConsignedInvAdjustments.update();</span><br><span class=\"line\">            ttscommit;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">else</span></span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            retQty = _qty;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> retQty;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span>()</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"meta\">#OCCRetryCount</span></span><br><span class=\"line\"></span><br><span class=\"line\">        setPrefix(<span class=\"string\">&quot;@GNC:AutoInvoiceVendorConsignedPurchaseOrder&quot;</span>);</span><br><span class=\"line\">        </span><br><span class=\"line\">        query                       query_Item      = <span class=\"keyword\">new</span> Query(queryStr(GNCAutoInvoiceVendConsignedItemQuery));</span><br><span class=\"line\">        QueryBuildDataSource        qbds;</span><br><span class=\"line\">        SysLookupMultiSelectValues  qrvInvoiceIds   = strReplace(gInvoiceIds, <span class=\"string\">&#x27;;&#x27;</span>, <span class=\"string\">&#x27;,&#x27;</span>);</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">if</span> (qrvInvoiceIds)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            qbds = query_Item.dataSourceTable(tableNum(CustInvoiceJour));</span><br><span class=\"line\">            qbds.addRange(fieldNum(CustInvoiceJour, InvoiceId)).<span class=\"keyword\">value</span>(qrvInvoiceIds);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        QueryRun                    queryRunItem    = <span class=\"keyword\">new</span> QueryRun(query_Item);</span><br><span class=\"line\">        TransDateTime               earliestDateTime;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">while</span> (queryRunItem.next())</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            CustInvoiceTrans custInvoiceTrans_Item = queryRunItem.<span class=\"keyword\">get</span>(tableNum(CustInvoiceTrans));</span><br><span class=\"line\"></span><br><span class=\"line\">            Qty finalInvoiceQty = <span class=\"keyword\">this</span>.getfinalInvoiceQty(custInvoiceTrans_Item.ItemId, custInvoiceTrans_Item.Qty);</span><br><span class=\"line\">            PurchLine   purchLine_earliest;</span><br><span class=\"line\">            PurchTable  purchTable_earliest;</span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"function\"><span class=\"keyword\">select</span> firstonly <span class=\"title\">minof</span>(<span class=\"params\">CreatedDateTime</span>) <span class=\"keyword\">from</span> purchTable_earliest</span></span><br><span class=\"line\"><span class=\"function\">                <span class=\"keyword\">where</span> purchTable_earliest.PurchaseType</span>              == PurchaseType::Purch</span><br><span class=\"line\">                exists <span class=\"keyword\">join</span> purchLine_earliest</span><br><span class=\"line\">                    <span class=\"keyword\">where</span> purchLine_earliest.PurchId                == purchTable_earliest.PurchId</span><br><span class=\"line\">                        &amp;&amp; !purchLine_earliest.Blocked</span><br><span class=\"line\">                        &amp;&amp; !purchLine_earliest.IsDeleted</span><br><span class=\"line\">                        &amp;&amp; (purchLine_earliest.PurchStatus          == PurchStatus::Backorder</span><br><span class=\"line\">                        || purchLine_earliest.PurchStatus           == PurchStatus::Received)</span><br><span class=\"line\">                        &amp;&amp; purchLine_earliest.ItemId                == custInvoiceTrans_Item.ItemId</span><br><span class=\"line\">                        &amp;&amp; purchLine_earliest.RemainPurchFinancial  &gt; <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (!earliestDateTime || earliestDateTime &gt; purchTable_earliest.CreatedDateTime)</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                earliestDateTime = purchTable_earliest.CreatedDateTime;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!gItemMap.empty())</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">while</span> <span class=\"keyword\">select</span> gPurchTable</span><br><span class=\"line\">                <span class=\"keyword\">where</span> gPurchTable.PurchaseType      == PurchaseType::Purch</span><br><span class=\"line\">                    &amp;&amp; gPurchTable.CreatedDateTime  &gt;= earliestDateTime</span><br><span class=\"line\">                    &amp;&amp; (gPurchTable.PurchStatus     == PurchStatus::Backorder</span><br><span class=\"line\">                    || gPurchTable.PurchStatus      == PurchStatus::Received)</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"keyword\">try</span></span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">this</span>.processSinglePO();</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">catch</span> (Exception::Deadlock)</span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    retry;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">catch</span> (Exception::UpdateConflict)</span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (appl.ttsLevel() == <span class=\"number\">0</span>)</span><br><span class=\"line\">                    &#123;</span><br><span class=\"line\">                        <span class=\"keyword\">if</span> (xSession::currentRetryCount() &gt;= <span class=\"meta\">#RetryNum)</span></span><br><span class=\"line\">                        &#123;</span><br><span class=\"line\">                            <span class=\"keyword\">throw</span> Exception::UpdateConflictNotRecovered;</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                        <span class=\"keyword\">else</span></span><br><span class=\"line\">                        &#123;</span><br><span class=\"line\">                            retry;</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                    <span class=\"keyword\">else</span></span><br><span class=\"line\">                    &#123;</span><br><span class=\"line\">                        <span class=\"keyword\">throw</span> Exception::UpdateConflict;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">catch</span></span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (appl.ttsLevel() != <span class=\"number\">0</span>)</span><br><span class=\"line\">                    &#123;</span><br><span class=\"line\">                        ttsabort;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                    <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">this</span>.insertExceptions();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        Query   query_jour = <span class=\"keyword\">new</span> Query();</span><br><span class=\"line\"></span><br><span class=\"line\">        qbds = query_jour.addDataSource(tableNum(CustInvoiceJour));</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">if</span> (qrvInvoiceIds)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            qbds = query_jour.dataSourceTable(tableNum(CustInvoiceJour));</span><br><span class=\"line\">            qbds.addRange(fieldNum(CustInvoiceJour, InvoiceId)).<span class=\"keyword\">value</span>(qrvInvoiceIds);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        QueryRun    queryRunJour    = <span class=\"keyword\">new</span> QueryRun(query_jour);</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">while</span> (queryRunJour.next())</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">try</span></span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                CustInvoiceJour custInvoiceJourUpd = queryRunJour.<span class=\"keyword\">get</span>(tableNum(CustInvoiceJour));</span><br><span class=\"line\"></span><br><span class=\"line\">                custInvoiceJourUpd.selectForUpdate(<span class=\"literal\">true</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">                ttsbegin;</span><br><span class=\"line\">                custInvoiceJourUpd.GNCProcessedVendConsignedInvoice = <span class=\"literal\">true</span>;</span><br><span class=\"line\">                custInvoiceJourUpd.update();</span><br><span class=\"line\">                ttscommit;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">catch</span> (Exception::Deadlock)</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                retry;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">catch</span> (Exception::UpdateConflict)</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (appl.ttsLevel() == <span class=\"number\">0</span>)</span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (xSession::currentRetryCount() &gt;= <span class=\"meta\">#RetryNum)</span></span><br><span class=\"line\">                    &#123;</span><br><span class=\"line\">                        <span class=\"keyword\">throw</span> Exception::UpdateConflictNotRecovered;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                    <span class=\"keyword\">else</span></span><br><span class=\"line\">                    &#123;</span><br><span class=\"line\">                        retry;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">else</span></span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">throw</span> Exception::UpdateConflict;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">catch</span></span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (appl.ttsLevel() != <span class=\"number\">0</span>)</span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    ttsabort;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">processSinglePO</span>()</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        PurchLine                   purchLine, prevPurchLine;</span><br><span class=\"line\">        VendPackingSlipTrans        vendPackingSlipTrans;</span><br><span class=\"line\">        Map                         packingSlipTransMap = <span class=\"keyword\">new</span> Map(Types::Int64, Types::Real);</span><br><span class=\"line\">        QueryRun                    queryRun;</span><br><span class=\"line\">        CustInvoiceTrans            custInvoiceTrans;</span><br><span class=\"line\">        Qty                         qtyToInvoice;</span><br><span class=\"line\">            </span><br><span class=\"line\">        gPurchId = gPurchTable.PurchId;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">this</span>.initParameters();</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.initRecordLists();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">while</span> <span class=\"keyword\">select</span> purchLine</span><br><span class=\"line\">            <span class=\"keyword\">where</span> purchLine.PurchId                             == gPurchTable.PurchId</span><br><span class=\"line\">                &amp;&amp; !purchLine.Blocked</span><br><span class=\"line\">                &amp;&amp; !purchLine.IsDeleted</span><br><span class=\"line\">                &amp;&amp; (purchLine.PurchStatus                       == PurchStatus::Backorder</span><br><span class=\"line\">                || purchLine.PurchStatus                        == PurchStatus::Received)</span><br><span class=\"line\">                &amp;&amp; purchLine.RemainPurchFinancial               &gt; <span class=\"number\">0</span></span><br><span class=\"line\">                <span class=\"keyword\">join</span> vendPackingSlipTrans</span><br><span class=\"line\">                    <span class=\"keyword\">where</span> vendPackingSlipTrans.InventTransId    == purchLine.InventTransId</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            Qty         purchRemain = vendPackingSlipTrans.remainPurchFinancial();</span><br><span class=\"line\">            Qty         curQty;</span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"keyword\">if</span> (!purchRemain)</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (!gItemMap.exists(purchLine.ItemId))</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            qtyToInvoice = gItemMap.lookup(purchLine.ItemId);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (!qtyToInvoice)</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (qtyToInvoice &gt; purchRemain)</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                curQty          = purchRemain;</span><br><span class=\"line\">                qtyToInvoice    -= purchRemain;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">else</span></span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                curQty          = abs(qtyToInvoice);</span><br><span class=\"line\">                qtyToInvoice    = <span class=\"number\">0</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (purchLine.RecId != prevPurchLine.RecId)</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (packingSlipTransMap.elements() &gt; <span class=\"number\">0</span>)</span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">this</span>.createParmLineAndSubLines(prevPurchLine, packingSlipTransMap.pack());</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                prevPurchLine       = purchLine.data();</span><br><span class=\"line\">                packingSlipTransMap = <span class=\"keyword\">new</span> Map(Types::Int64, Types::Real);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            packingSlipTransMap.insert(vendPackingSlipTrans.RecId, curQty);</span><br><span class=\"line\">            gItemMap.insert(purchLine.ItemId, qtyToInvoice);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (prevPurchLine.RecId &amp;&amp; packingSlipTransMap.elements() &gt; <span class=\"number\">0</span>)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">this</span>.createParmLineAndSubLines(prevPurchLine, packingSlipTransMap.pack());</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (gCreateParmTable)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            gInvoiceNumber = gPurchTable.PurchId;</span><br><span class=\"line\"></span><br><span class=\"line\">            VendInvoiceJour vendInvoiceJour;</span><br><span class=\"line\">            Counter         i;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">select</span> firstonly RecId <span class=\"keyword\">from</span> vendInvoiceJour</span><br><span class=\"line\">                <span class=\"keyword\">where</span> vendInvoiceJour.InvoiceId == gInvoiceNumber;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">while</span> (vendInvoiceJour.RecId)</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                i++;</span><br><span class=\"line\">                vendInvoiceJour.clear();</span><br><span class=\"line\"></span><br><span class=\"line\">                gInvoiceNumber = strfmt(<span class=\"string\">&#x27;%1_%2&#x27;</span>, gPurchTable.PurchId, i);</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"keyword\">select</span> firstonly RecId <span class=\"keyword\">from</span> vendInvoiceJour</span><br><span class=\"line\">                    <span class=\"keyword\">where</span> vendInvoiceJour.InvoiceId == gInvoiceNumber;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            VendInvoiceInfoTable        vendInvoiceInfoTable;</span><br><span class=\"line\"></span><br><span class=\"line\">            ttsbegin;</span><br><span class=\"line\">            vendInvoiceInfoTable = <span class=\"keyword\">this</span>.createParmTable();</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">this</span>.insertRecordLists();</span><br><span class=\"line\">            </span><br><span class=\"line\">            PurchFormLetter_Invoice purchFormLetter = PurchFormLetter_Invoice::newFromSavedInvoice(vendInvoiceInfoTable);</span><br><span class=\"line\">            purchFormLetter.purchTable(gPurchTable);</span><br><span class=\"line\">            purchFormLetter.printFormLetter(<span class=\"literal\">false</span>);</span><br><span class=\"line\">            purchFormLetter.proforma(<span class=\"literal\">false</span>);</span><br><span class=\"line\">            purchFormLetter.parmId(vendInvoiceInfoTable.ParmId);</span><br><span class=\"line\">            purchFormLetter.update(vendInvoiceInfoTable, vendInvoiceInfoTable.Num);</span><br><span class=\"line\"></span><br><span class=\"line\">            ttscommit;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">select</span> firstonly RecId <span class=\"keyword\">from</span> vendInvoiceJour</span><br><span class=\"line\">                <span class=\"keyword\">where</span> vendInvoiceJour.InvoiceId == vendInvoiceInfoTable.Num;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (vendInvoiceJour)</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                Info(strFmt(<span class=\"string\">&quot;Vendor invoice journal %1 is posted.&quot;</span>, vendInvoiceInfoTable.Num));</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">insertExceptions</span>()</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        MapEnumerator itemME = gItemMap.getEnumerator();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">while</span> (itemME.moveNext())</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            ItemId                      itemId  = itemME.currentKey();</span><br><span class=\"line\">            Qty                         qtyExce = itemME.currentValue(); </span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (!qtyExce)</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            query                       query   = <span class=\"keyword\">new</span> Query(queryStr(GNCAutoInvoiceVendConsignedQuery));</span><br><span class=\"line\">            QueryBuildDataSource        qbds;</span><br><span class=\"line\">            SysLookupMultiSelectValues  qrvInvoiceIds   = strReplace(gInvoiceIds, <span class=\"string\">&#x27;;&#x27;</span>, <span class=\"string\">&#x27;,&#x27;</span>);</span><br><span class=\"line\">            QueryRun                    queryRun;</span><br><span class=\"line\">            </span><br><span class=\"line\">            qbds = query.dataSourceTable(tableNum(CustInvoiceTrans));</span><br><span class=\"line\">            qbds.addRange(fieldNum(CustInvoiceTrans, ItemId)).<span class=\"keyword\">value</span>(itemId);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (qrvInvoiceIds)</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                qbds = query.dataSourceTable(tableNum(CustInvoiceJour));</span><br><span class=\"line\">                qbds.addRange(fieldNum(CustInvoiceJour, InvoiceId)).<span class=\"keyword\">value</span>(qrvInvoiceIds);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            queryRun = <span class=\"keyword\">new</span> QueryRun(query);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">while</span> (queryRun.next())</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                CustInvoiceTrans    custInvoiceTrans = queryRun.<span class=\"keyword\">get</span>(tableNum(CustInvoiceTrans));</span><br><span class=\"line\">                Qty                 qtyRemain, curQty;</span><br><span class=\"line\"></span><br><span class=\"line\">                qtyRemain = custInvoiceTrans.Qty;</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"keyword\">if</span> (qtyExce &gt; qtyRemain)</span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    curQty      = qtyRemain;</span><br><span class=\"line\">                    qtyExce     -= qtyRemain;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">else</span></span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    curQty      = qtyExce;</span><br><span class=\"line\">                    qtyExce     = <span class=\"number\">0</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">                GNCAutoInvoiceVendConsignedException::create(gInvoiceDate, </span><br><span class=\"line\">                    custInvoiceTrans.SalesId, </span><br><span class=\"line\">                    custInvoiceTrans.InvoiceDate, </span><br><span class=\"line\">                    custInvoiceTrans.ItemId, </span><br><span class=\"line\">                    custInvoiceTrans.Qty, </span><br><span class=\"line\">                    curQty);</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"keyword\">if</span> (!qtyExce)</span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">initParameters</span>()</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        gSystemSequence     = <span class=\"keyword\">new</span> systemSequence();</span><br><span class=\"line\">        gCreateParmTable    = <span class=\"literal\">false</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> TradeLineRefId <span class=\"title\">getTableRefId</span>()</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!gTableRefIdMap.exists(gPurchId))</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            gTableRefIdMap.insert(gPurchId, formletterParmData::getNewTableRefId());</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> gTableRefIdMap.lookup(gPurchId);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">initRecordLists</span>()</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        gParmLineRecordInsertList       = <span class=\"keyword\">new</span> RecordInsertList(tableNum(VendInvoiceInfoLine));</span><br><span class=\"line\">        gParmSubLineRecordInsertList    = <span class=\"keyword\">new</span> RecordInsertList(tableNum(VendInvoiceInfoSubLine));</span><br><span class=\"line\">        gMarkupTrans    = <span class=\"keyword\">new</span> RecordInsertList(tableNum(MarkupTrans));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">insertParmLine</span>(<span class=\"params\">VendInvoiceInfoLine _vendInvoiceInfoLine, PurchLine _purchLine</span>)</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        gSystemSequence.suspendRecIds(_vendInvoiceInfoLine.TableId);</span><br><span class=\"line\">        _vendInvoiceInfoLine.RecId  = gSystemSequence.reserveValues(<span class=\"number\">1</span>, _vendInvoiceInfoLine.TableId);</span><br><span class=\"line\"></span><br><span class=\"line\">        gParmLineRecordInsertList.<span class=\"keyword\">add</span>(_vendInvoiceInfoLine);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">createVendInvoiceMatchingLine</span>(<span class=\"params\">PurchLine _purchLine, VendDocumentLineMap _parmLine</span>)</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        VendInvoiceMatchingLine vendInvoiceMatchingLine;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (_parmLine.TableId &amp;&amp; _parmLine.RecId &amp;&amp; _purchLine)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            vendInvoiceMatchingLine.clear();</span><br><span class=\"line\">            vendInvoiceMatchingLine.initExpectedValues(_purchLine, _parmLine);</span><br><span class=\"line\">            vendInvoiceMatchingLine.RefTableId = _parmLine.TableId;</span><br><span class=\"line\">            vendInvoiceMatchingLine.RefRecId = _parmLine.RecId;</span><br><span class=\"line\">            vendInvoiceMatchingLine.insert();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">createMarkupTrans</span>(<span class=\"params\">PurchLine _purchLine, VendInvoiceInfoLine _vendInvoiceInfoLine</span>)</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        MarkupTrans markupTrans, markupTransNew;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">while</span> <span class=\"keyword\">select</span> markupTrans</span><br><span class=\"line\">            <span class=\"keyword\">where</span> markupTrans.TransTableId  == _purchLine.TableId</span><br><span class=\"line\">                &amp;&amp; markupTrans.TransRecId   == _purchLine.RecId</span><br><span class=\"line\">                &amp;&amp; markupTrans.Value        != <span class=\"number\">0</span></span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            buf2Buf(markupTrans, markupTransNew);</span><br><span class=\"line\">            markupTransNew.TransTableId       = _vendInvoiceInfoLine.TableId;</span><br><span class=\"line\">            markupTransNew.TransRecId         = _vendInvoiceInfoLine.RecId;</span><br><span class=\"line\">            gMarkupTrans.<span class=\"keyword\">add</span>(markupTransNew);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">insertParmSubLine</span>(<span class=\"params\">VendInvoiceInfoSubLine _vendInvoiceInfoSubLine</span>)</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (_vendInvoiceInfoSubLine.ReceiveNow == <span class=\"number\">0</span>)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        gParmSubLineRecordInsertList.<span class=\"keyword\">add</span>(_vendInvoiceInfoSubLine);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">insertRecordLists</span>()</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        gParmLineRecordInsertList.insertDatabase();</span><br><span class=\"line\">        gParmSubLineRecordInsertList.insertDatabase();</span><br><span class=\"line\">        gMarkupTrans.insertDatabase();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">createParmLineAndSubLines</span>(<span class=\"params\">PurchLine _purchLine, container _packedSubLinesMap</span>)</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        MapEnumerator           me;</span><br><span class=\"line\">        VendInvoiceInfoLine     vendInvoiceInfoLine;</span><br><span class=\"line\">        Qty                     newPostingQty;</span><br><span class=\"line\">        VendPackingSlipTrans    vendPackingSlipTrans;</span><br><span class=\"line\">        Set                     subLineSet      = <span class=\"keyword\">new</span> Set(Types::Record);</span><br><span class=\"line\"></span><br><span class=\"line\">        me = Map::create(_packedSubLinesMap).getEnumerator();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">while</span> (me.moveNext())</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            RefRecId        vendPackingSlipTransRecId   = me.currentKey();</span><br><span class=\"line\">            Qty             qty                         = me.currentValue();</span><br><span class=\"line\"></span><br><span class=\"line\">            vendPackingSlipTrans            = VendPackingSlipTrans::findRecId(vendPackingSlipTransRecId);</span><br><span class=\"line\"></span><br><span class=\"line\">            vendPackingSlipTrans.Qty        = qty;</span><br><span class=\"line\">            vendPackingSlipTrans.InventQty  = qty;</span><br><span class=\"line\">            newPostingQty                   += qty;</span><br><span class=\"line\"></span><br><span class=\"line\">            subLineSet.<span class=\"keyword\">add</span>(vendPackingSlipTrans);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">if</span> (newPostingQty == <span class=\"number\">0</span>)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        vendInvoiceInfoLine = <span class=\"keyword\">this</span>.createParmLine(_purchLine, newPostingQty);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">this</span>.createParmSubLines(vendInvoiceInfoLine, subLineSet);</span><br><span class=\"line\">        </span><br><span class=\"line\">        gCreateParmTable = <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> VendInvoiceInfoLine <span class=\"title\">createParmLine</span>(<span class=\"params\">PurchLine _purchLine, Qty _receiveNow</span>)</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        VendInvoiceInfoLine vendInvoiceInfoLine;</span><br><span class=\"line\"></span><br><span class=\"line\">        vendInvoiceInfoLine.Ordering        = DocumentStatus::Invoice;</span><br><span class=\"line\">        vendInvoiceInfoLine.TableRefId      = <span class=\"keyword\">this</span>.getTableRefId();</span><br><span class=\"line\">        vendInvoiceInfoLine.DocumentOrigin  = DocumentOrigin::Manual;</span><br><span class=\"line\">        vendInvoiceInfoLine.initFromPurchLine(_purchLine);</span><br><span class=\"line\">        vendInvoiceInfoLine.defaultRow(_purchLine, <span class=\"literal\">null</span>, _receiveNow, _receiveNow);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">this</span>.insertParmLine(vendInvoiceInfoLine, _purchLine);</span><br><span class=\"line\">        </span><br><span class=\"line\">        gCreateParmTable = <span class=\"literal\">true</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> vendInvoiceInfoLine;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">createParmSubLines</span>(<span class=\"params\">VendInvoiceInfoLine _vendInvoiceInfoLine, Set _subLineSet</span>)</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        VendPackingSlipTrans    vendPackingSlipTrans;</span><br><span class=\"line\">        VendInvoiceInfoSubLine  vendInvoiceInfoSubLine;</span><br><span class=\"line\">        SetEnumerator           se = _subLineSet.getEnumerator();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">while</span> (se.moveNext())</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            vendPackingSlipTrans = se.current();</span><br><span class=\"line\"></span><br><span class=\"line\">            vend</span><br><span class=\"line\"></span><br><span class=\"line\">InvoiceInfoSubLine.clear();</span><br><span class=\"line\">            vendInvoiceInfoSubLine.initFromLine(_vendInvoiceInfoLine);</span><br><span class=\"line\">            vendInvoiceInfoSubLine.initFromVendPackingSlipTrans(vendPackingSlipTrans);</span><br><span class=\"line\">            <span class=\"keyword\">this</span>.insertParmSubLine(vendInvoiceInfoSubLine);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!_vendInvoiceInfoLine.vendInvoiceInfoSubTable())</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            VendInvoiceInfoSubTable::createFromVendInvoiceInfoLine(_vendInvoiceInfoLine, _vendInvoiceInfoLine.ParmId, gDescription, <span class=\"literal\">true</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> VendInvoiceInfoTable <span class=\"title\">createParmTable</span>()</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        VendInvoiceInfoTable        vendInvoiceInfoTable;</span><br><span class=\"line\"></span><br><span class=\"line\">        vendInvoiceInfoTable.clear();</span><br><span class=\"line\">        vendInvoiceInfoTable.initValue();</span><br><span class=\"line\">        vendInvoiceInfoTable.defaultRow(gPurchTable);</span><br><span class=\"line\">        vendInvoiceInfoTable.initFromPurchTable(gPurchTable);</span><br><span class=\"line\">        vendInvoiceInfoTable.DocumentOrigin         = DocumentOrigin::Manual;</span><br><span class=\"line\">        vendInvoiceInfoTable.Num                    = gInvoiceNumber;</span><br><span class=\"line\">        vendInvoiceInfoTable.VendInvoiceSaveStatus  = VendInvoiceSaveStatus::Pending;</span><br><span class=\"line\">        vendInvoiceInfoTable.Description            = <span class=\"string\">&#x27;Retail POS Sale&#x27;</span>;</span><br><span class=\"line\">        vendInvoiceInfoTable.DocumentDate           = gInvoiceDate;</span><br><span class=\"line\">        vendInvoiceInfoTable.TransDate              = gInvoiceDate;</span><br><span class=\"line\">        vendInvoiceInfoTable.LastMatchVariance      = LastMatchVarianceOptions::OK;</span><br><span class=\"line\">        vendInvoiceInfoTable.ParmJobStatus          = ParmJobStatus::Waiting;</span><br><span class=\"line\">        vendInvoiceInfoTable.Approved               = NoYes::Yes;</span><br><span class=\"line\">        vendInvoiceInfoTable.Approver               = HcmWorker::userId2Worker(curUserId());</span><br><span class=\"line\">        vendInvoiceInfoTable.TableRefId             = <span class=\"keyword\">this</span>.getTableRefId();</span><br><span class=\"line\">        vendInvoiceInfoTable.Ordering               = DocumentStatus::Invoice;</span><br><span class=\"line\">        vendInvoiceInfoTable.initInvoiceTotals();</span><br><span class=\"line\">        vendInvoiceInfoTable.insert();</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">return</span> vendInvoiceInfoTable;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">createParmSubTable</span>(<span class=\"params\">VendInvoiceInfoTable _vendInvoiceInfoTable</span>)</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        VendInvoiceInfoSubTable::createFromVendInvoiceInfoTable(_vendInvoiceInfoTable, <span class=\"literal\">true</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>"},{"title":"Merge the Ledger Account","comments":1,"date":"2024-12-23T07:56:06.000Z","description":"Merge the Ledger Account","_content":"\n\nThe example code as shown below:\n\n```c#\npublic static LedgerDimensionAccount generateDefaultDimension(container _conName, container _conValue)\n{\n    DimensionAttributeValueSetStorage   valueSetStorage = new DimensionAttributeValueSetStorage();\n    int                                 i;\n    DimensionAttribute                  dimensionAttribute;\n    DimensionAttributeValue             dimensionAttributeValue;\n    container                           conAttr  = _conName;\n    container                           conValue = _conValue;\n    str                                 dimValue;\n\n    for (i = 1; i <= conLen(conAttr); i++)\n    {\n        dimensionAttribute = dimensionAttribute::findByName(conPeek(conAttr,i));\n\n        if (dimensionAttribute.RecId == 0)\n        {\n            continue;\n        }\n\n        dimValue = conPeek(conValue,i);\n\n        if (dimValue != \"\")\n        {\n            // The last parameter is \"true\". A dimensionAttributeValue record will be created if not found.\n            dimensionAttributeValue = dimensionAttributeValue::findByDimensionAttributeAndValue(dimensionAttribute, dimValue, false, true);\n\n            // Add the dimensionAttibuteValue to the default dimension\n            valueSetStorage.addItem(dimensionAttributeValue);\n        }\n    }\n    return valueSetStorage.save();\n}\n\npublic static LedgerDimensionAccount replaceDefaultDimensionValues(\n    DimensionDefault    _invoiceDefaultDimension,\n    DimensionDefault    _purchDefaultDimension,\n    container           _conName)\n{\n    DimensionAttributeValueSetStorage invoiceValueSetStorage    = DimensionAttributeValueSetStorage::find(_invoiceDefaultDimension);\n    DimensionAttributeValueSetStorage purchValueSetStorage      = DimensionAttributeValueSetStorage::find(_purchDefaultDimension);\n\n    for (int i = 1; i <= conLen(_conName); i++)\n    {\n        var dimensionAttribute      = DimensionAttribute::findByName(conPeek(_conName, i));\n        var invoiceDimensionValue   = invoiceValueSetStorage.getDisplayValueByDimensionAttribute(dimensionAttribute.RecId);\n        var purchDimensionValue     = purchValueSetStorage.getDisplayValueByDimensionAttribute(dimensionAttribute.RecId);\n\n        if (purchDimensionValue && (purchDimensionValue != invoiceDimensionValue))\n        {\n            var newDimensionAttributeValue = DimensionAttributeValue::findByDimensionAttributeAndValue(dimensionAttribute, purchDimensionValue, false, true);\n\n            invoiceValueSetStorage.removeDimensionAttribute(dimensionAttribute.RecId);\n            invoiceValueSetStorage.addItem(newDimensionAttributeValue);\n        }\n    }    \n    return invoiceValueSetStorage.save();\n}\n```","source":"_posts/xpp-merge-ledger-account.md","raw":"---\ntitle: Merge the Ledger Account\ncategories:\n - x++\ncomments: true\ndate: 2024-12-23 15:56:06\ndescription: Merge the Ledger Account\n---\n\n\nThe example code as shown below:\n\n```c#\npublic static LedgerDimensionAccount generateDefaultDimension(container _conName, container _conValue)\n{\n    DimensionAttributeValueSetStorage   valueSetStorage = new DimensionAttributeValueSetStorage();\n    int                                 i;\n    DimensionAttribute                  dimensionAttribute;\n    DimensionAttributeValue             dimensionAttributeValue;\n    container                           conAttr  = _conName;\n    container                           conValue = _conValue;\n    str                                 dimValue;\n\n    for (i = 1; i <= conLen(conAttr); i++)\n    {\n        dimensionAttribute = dimensionAttribute::findByName(conPeek(conAttr,i));\n\n        if (dimensionAttribute.RecId == 0)\n        {\n            continue;\n        }\n\n        dimValue = conPeek(conValue,i);\n\n        if (dimValue != \"\")\n        {\n            // The last parameter is \"true\". A dimensionAttributeValue record will be created if not found.\n            dimensionAttributeValue = dimensionAttributeValue::findByDimensionAttributeAndValue(dimensionAttribute, dimValue, false, true);\n\n            // Add the dimensionAttibuteValue to the default dimension\n            valueSetStorage.addItem(dimensionAttributeValue);\n        }\n    }\n    return valueSetStorage.save();\n}\n\npublic static LedgerDimensionAccount replaceDefaultDimensionValues(\n    DimensionDefault    _invoiceDefaultDimension,\n    DimensionDefault    _purchDefaultDimension,\n    container           _conName)\n{\n    DimensionAttributeValueSetStorage invoiceValueSetStorage    = DimensionAttributeValueSetStorage::find(_invoiceDefaultDimension);\n    DimensionAttributeValueSetStorage purchValueSetStorage      = DimensionAttributeValueSetStorage::find(_purchDefaultDimension);\n\n    for (int i = 1; i <= conLen(_conName); i++)\n    {\n        var dimensionAttribute      = DimensionAttribute::findByName(conPeek(_conName, i));\n        var invoiceDimensionValue   = invoiceValueSetStorage.getDisplayValueByDimensionAttribute(dimensionAttribute.RecId);\n        var purchDimensionValue     = purchValueSetStorage.getDisplayValueByDimensionAttribute(dimensionAttribute.RecId);\n\n        if (purchDimensionValue && (purchDimensionValue != invoiceDimensionValue))\n        {\n            var newDimensionAttributeValue = DimensionAttributeValue::findByDimensionAttributeAndValue(dimensionAttribute, purchDimensionValue, false, true);\n\n            invoiceValueSetStorage.removeDimensionAttribute(dimensionAttribute.RecId);\n            invoiceValueSetStorage.addItem(newDimensionAttributeValue);\n        }\n    }    \n    return invoiceValueSetStorage.save();\n}\n```","slug":"xpp-merge-ledger-account","published":1,"updated":"2025-07-08T12:05:00.541Z","layout":"post","photos":[],"_id":"cmcvxssht00163cug11yn4g7w","content":"<p>The example code as shown below:</p>\n<figure class=\"highlight c#\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> LedgerDimensionAccount <span class=\"title\">generateDefaultDimension</span>(<span class=\"params\">container _conName, container _conValue</span>)</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    DimensionAttributeValueSetStorage   valueSetStorage = <span class=\"keyword\">new</span> DimensionAttributeValueSetStorage();</span><br><span class=\"line\">    <span class=\"built_in\">int</span>                                 i;</span><br><span class=\"line\">    DimensionAttribute                  dimensionAttribute;</span><br><span class=\"line\">    DimensionAttributeValue             dimensionAttributeValue;</span><br><span class=\"line\">    container                           conAttr  = _conName;</span><br><span class=\"line\">    container                           conValue = _conValue;</span><br><span class=\"line\">    str                                 dimValue;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (i = <span class=\"number\">1</span>; i &lt;= conLen(conAttr); i++)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        dimensionAttribute = dimensionAttribute::findByName(conPeek(conAttr,i));</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (dimensionAttribute.RecId == <span class=\"number\">0</span>)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        dimValue = conPeek(conValue,i);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (dimValue != <span class=\"string\">&quot;&quot;</span>)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"comment\">// The last parameter is &quot;true&quot;. A dimensionAttributeValue record will be created if not found.</span></span><br><span class=\"line\">            dimensionAttributeValue = dimensionAttributeValue::findByDimensionAttributeAndValue(dimensionAttribute, dimValue, <span class=\"literal\">false</span>, <span class=\"literal\">true</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// Add the dimensionAttibuteValue to the default dimension</span></span><br><span class=\"line\">            valueSetStorage.addItem(dimensionAttributeValue);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> valueSetStorage.save();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> LedgerDimensionAccount <span class=\"title\">replaceDefaultDimensionValues</span>(<span class=\"params\"></span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">    DimensionDefault    _invoiceDefaultDimension,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">    DimensionDefault    _purchDefaultDimension,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">    container           _conName</span>)</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    DimensionAttributeValueSetStorage invoiceValueSetStorage    = DimensionAttributeValueSetStorage::find(_invoiceDefaultDimension);</span><br><span class=\"line\">    DimensionAttributeValueSetStorage purchValueSetStorage      = DimensionAttributeValueSetStorage::find(_purchDefaultDimension);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"built_in\">int</span> i = <span class=\"number\">1</span>; i &lt;= conLen(_conName); i++)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> dimensionAttribute      = DimensionAttribute::findByName(conPeek(_conName, i));</span><br><span class=\"line\">        <span class=\"keyword\">var</span> invoiceDimensionValue   = invoiceValueSetStorage.getDisplayValueByDimensionAttribute(dimensionAttribute.RecId);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> purchDimensionValue     = purchValueSetStorage.getDisplayValueByDimensionAttribute(dimensionAttribute.RecId);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (purchDimensionValue &amp;&amp; (purchDimensionValue != invoiceDimensionValue))</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> newDimensionAttributeValue = DimensionAttributeValue::findByDimensionAttributeAndValue(dimensionAttribute, purchDimensionValue, <span class=\"literal\">false</span>, <span class=\"literal\">true</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">            invoiceValueSetStorage.removeDimensionAttribute(dimensionAttribute.RecId);</span><br><span class=\"line\">            invoiceValueSetStorage.addItem(newDimensionAttributeValue);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;    </span><br><span class=\"line\">    <span class=\"keyword\">return</span> invoiceValueSetStorage.save();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>","excerpt":"","more":"<p>The example code as shown below:</p>\n<figure class=\"highlight c#\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> LedgerDimensionAccount <span class=\"title\">generateDefaultDimension</span>(<span class=\"params\">container _conName, container _conValue</span>)</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    DimensionAttributeValueSetStorage   valueSetStorage = <span class=\"keyword\">new</span> DimensionAttributeValueSetStorage();</span><br><span class=\"line\">    <span class=\"built_in\">int</span>                                 i;</span><br><span class=\"line\">    DimensionAttribute                  dimensionAttribute;</span><br><span class=\"line\">    DimensionAttributeValue             dimensionAttributeValue;</span><br><span class=\"line\">    container                           conAttr  = _conName;</span><br><span class=\"line\">    container                           conValue = _conValue;</span><br><span class=\"line\">    str                                 dimValue;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (i = <span class=\"number\">1</span>; i &lt;= conLen(conAttr); i++)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        dimensionAttribute = dimensionAttribute::findByName(conPeek(conAttr,i));</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (dimensionAttribute.RecId == <span class=\"number\">0</span>)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        dimValue = conPeek(conValue,i);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (dimValue != <span class=\"string\">&quot;&quot;</span>)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"comment\">// The last parameter is &quot;true&quot;. A dimensionAttributeValue record will be created if not found.</span></span><br><span class=\"line\">            dimensionAttributeValue = dimensionAttributeValue::findByDimensionAttributeAndValue(dimensionAttribute, dimValue, <span class=\"literal\">false</span>, <span class=\"literal\">true</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// Add the dimensionAttibuteValue to the default dimension</span></span><br><span class=\"line\">            valueSetStorage.addItem(dimensionAttributeValue);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> valueSetStorage.save();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> LedgerDimensionAccount <span class=\"title\">replaceDefaultDimensionValues</span>(<span class=\"params\"></span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">    DimensionDefault    _invoiceDefaultDimension,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">    DimensionDefault    _purchDefaultDimension,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">    container           _conName</span>)</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    DimensionAttributeValueSetStorage invoiceValueSetStorage    = DimensionAttributeValueSetStorage::find(_invoiceDefaultDimension);</span><br><span class=\"line\">    DimensionAttributeValueSetStorage purchValueSetStorage      = DimensionAttributeValueSetStorage::find(_purchDefaultDimension);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"built_in\">int</span> i = <span class=\"number\">1</span>; i &lt;= conLen(_conName); i++)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> dimensionAttribute      = DimensionAttribute::findByName(conPeek(_conName, i));</span><br><span class=\"line\">        <span class=\"keyword\">var</span> invoiceDimensionValue   = invoiceValueSetStorage.getDisplayValueByDimensionAttribute(dimensionAttribute.RecId);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> purchDimensionValue     = purchValueSetStorage.getDisplayValueByDimensionAttribute(dimensionAttribute.RecId);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (purchDimensionValue &amp;&amp; (purchDimensionValue != invoiceDimensionValue))</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> newDimensionAttributeValue = DimensionAttributeValue::findByDimensionAttributeAndValue(dimensionAttribute, purchDimensionValue, <span class=\"literal\">false</span>, <span class=\"literal\">true</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">            invoiceValueSetStorage.removeDimensionAttribute(dimensionAttribute.RecId);</span><br><span class=\"line\">            invoiceValueSetStorage.addItem(newDimensionAttributeValue);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;    </span><br><span class=\"line\">    <span class=\"keyword\">return</span> invoiceValueSetStorage.save();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>"},{"title":"Open in Microsoft Office","comments":1,"date":"2025-01-18T14:15:28.000Z","description":"Open in Microsoft Office","_content":"\n## Operation Step\n\nThe first step is to implement the **OfficeIMenuCustomizer** and **OfficeIGenerateWorkbookCustomExporter**.\n\n{% asset_img \"xpp-open-in-office.png\" \"Class Header\" %}\n\nThe example code is as follows:\n\n{% asset_img \"xpp-open-in-office2.png\" \"Class Header\" %}\n\n{% asset_img \"xpp-open-in-office3.png\" \"Class Header\" %}\n\n## Filter Setting\n\nDo not use the Recid of the primary table as the filter condition. This will inevitably require the Recid of the primary table to be released, but this will cause an insertion problem for the data entity: since RecId is the primary key of the primary table, it will make an insertion error regardless of any field entered, and will not be able to skip validation.\n\nIn this case, you can only use other unique keys instead, but many unique indexes contain multiple fields, so you need to create a computed column in the data entity and then construct a computed column field from the multiple fields of the unique index.","source":"_posts/xpp-open-in-office.md","raw":"---\ntitle: Open in Microsoft Office\ncomments: true\ndate: 2025-01-18 22:15:28\ncategories:\n - x++\ndescription: Open in Microsoft Office\n---\n\n## Operation Step\n\nThe first step is to implement the **OfficeIMenuCustomizer** and **OfficeIGenerateWorkbookCustomExporter**.\n\n{% asset_img \"xpp-open-in-office.png\" \"Class Header\" %}\n\nThe example code is as follows:\n\n{% asset_img \"xpp-open-in-office2.png\" \"Class Header\" %}\n\n{% asset_img \"xpp-open-in-office3.png\" \"Class Header\" %}\n\n## Filter Setting\n\nDo not use the Recid of the primary table as the filter condition. This will inevitably require the Recid of the primary table to be released, but this will cause an insertion problem for the data entity: since RecId is the primary key of the primary table, it will make an insertion error regardless of any field entered, and will not be able to skip validation.\n\nIn this case, you can only use other unique keys instead, but many unique indexes contain multiple fields, so you need to create a computed column in the data entity and then construct a computed column field from the multiple fields of the unique index.","slug":"xpp-open-in-office","published":1,"updated":"2025-07-08T12:05:00.541Z","layout":"post","photos":[],"_id":"cmcvxsshx00233cughmsxhh74","content":"<h2 id=\"Operation-Step\"><a href=\"#Operation-Step\" class=\"headerlink\" title=\"Operation Step\"></a>Operation Step</h2><p>The first step is to implement the <strong>OfficeIMenuCustomizer</strong> and <strong>OfficeIGenerateWorkbookCustomExporter</strong>.</p>\n<img src=\"/2025/01/18/xpp-open-in-office/xpp-open-in-office.png\" class=\"\" title=\"Class Header\">\n\n<p>The example code is as follows:</p>\n<img src=\"/2025/01/18/xpp-open-in-office/xpp-open-in-office2.png\" class=\"\" title=\"Class Header\">\n\n<img src=\"/2025/01/18/xpp-open-in-office/xpp-open-in-office3.png\" class=\"\" title=\"Class Header\">\n\n<h2 id=\"Filter-Setting\"><a href=\"#Filter-Setting\" class=\"headerlink\" title=\"Filter Setting\"></a>Filter Setting</h2><p>Do not use the Recid of the primary table as the filter condition. This will inevitably require the Recid of the primary table to be released, but this will cause an insertion problem for the data entity: since RecId is the primary key of the primary table, it will make an insertion error regardless of any field entered, and will not be able to skip validation.</p>\n<p>In this case, you can only use other unique keys instead, but many unique indexes contain multiple fields, so you need to create a computed column in the data entity and then construct a computed column field from the multiple fields of the unique index.</p>\n","excerpt":"","more":"<h2 id=\"Operation-Step\"><a href=\"#Operation-Step\" class=\"headerlink\" title=\"Operation Step\"></a>Operation Step</h2><p>The first step is to implement the <strong>OfficeIMenuCustomizer</strong> and <strong>OfficeIGenerateWorkbookCustomExporter</strong>.</p>\n<img src=\"/2025/01/18/xpp-open-in-office/xpp-open-in-office.png\" class=\"\" title=\"Class Header\">\n\n<p>The example code is as follows:</p>\n<img src=\"/2025/01/18/xpp-open-in-office/xpp-open-in-office2.png\" class=\"\" title=\"Class Header\">\n\n<img src=\"/2025/01/18/xpp-open-in-office/xpp-open-in-office3.png\" class=\"\" title=\"Class Header\">\n\n<h2 id=\"Filter-Setting\"><a href=\"#Filter-Setting\" class=\"headerlink\" title=\"Filter Setting\"></a>Filter Setting</h2><p>Do not use the Recid of the primary table as the filter condition. This will inevitably require the Recid of the primary table to be released, but this will cause an insertion problem for the data entity: since RecId is the primary key of the primary table, it will make an insertion error regardless of any field entered, and will not be able to skip validation.</p>\n<p>In this case, you can only use other unique keys instead, but many unique indexes contain multiple fields, so you need to create a computed column in the data entity and then construct a computed column field from the multiple fields of the unique index.</p>\n"},{"title":"Query On-Hand inventory using specific inventory-dimensions","comments":1,"date":"2025-07-08T12:10:18.000Z","description":"Query On-Hand inventory using specific inventory-dimensions","_content":"\n## InventDimOnhand\n\nUsing the class InventDimOnhand, you can determine the on-hand inventory of articles and/or specific inventory-dimensions. The following job determines the inventory for a specific item and a specific inventlocation. This is grouped per color.\n\n```c#\nstatic void getInventOnhandExample(Args _args)\n{\n    ItemId itemId;\n    InventDimOnHand inventDimOnHand;\n    InventDimParm inventDimParmOnHandLevel;\n    InventDimOnHandIterator inventDimOnHandIterator;\n    InventDimOnHandMember inventDimOnHandMember;\n    InventDim inventDim;\n    InventDim inventDimCriteria;\n    InventDimParm inventDimParmCriteria;\n\n    // Item: Query specific item\n    itemId = \"DMO003\";\n    \n    // inventDimCriteria: Apply ranges\n    inventDimCriteria.wmsLocationId             = \"12-1\";\n    inventDimCriteria.InventBatchId             = \"DMOBatch001\";\n\n    // inventDimParmCriteria: should values from inventDimCriteria be used?\n    inventDimParmCriteria.ItemIdFlag            = false;\n    inventDimParmCriteria.InventSiteIdFlag      = false;\n    inventDimParmCriteria.InventLocationIdFlag  = false;\n    inventDimParmCriteria.wmsLocationIdFlag     = true;     // wmsLocationId from inventDimCriteria will be used\n    inventDimParmCriteria.wmsPalletIdFlag       = false;\n    inventDimParmCriteria.InventBatchIdFlag     = false;    // inventBatchId from inventDimCriteria will not be used\n    inventDimParmCriteria.InventSerialIdFlag    = false;\n    inventDimParmCriteria.ConfigIdFlag          = false;\n    inventDimParmCriteria.InventSizeIdFlag      = false;\n    inventDimParmCriteria.InventColorIdFlag     = false;\n    inventDimParmCriteria.InventStyleIdFlag     = false;\n\n    // inventDimParmOnHandLevel: Which dimensions should be used to group for?\n    // inventDimParmOnHandLevel necessary for inventDimOnHandLevel::DimParm\n    inventDimParmOnHandLevel.ItemIdFlag            = true;      // necessary\n    inventDimParmOnHandLevel.InventSiteIdFlag      = false;\n    inventDimParmOnHandLevel.InventLocationIdFlag  = false;\n    inventDimParmOnHandLevel.wmsLocationIdFlag     = false;\n    inventDimParmOnHandLevel.wmsPalletIdFlag       = false;\n    inventDimParmOnHandLevel.InventBatchIdFlag     = false;\n    inventDimParmOnHandLevel.InventSerialIdFlag    = false;\n    inventDimParmOnHandLevel.ConfigIdFlag          = false;\n    inventDimParmOnHandLevel.InventSizeIdFlag      = false;\n    inventDimParmOnHandLevel.InventColorIdFlag     = true;      // group by color\n    inventDimParmOnHandLevel.InventStyleIdFlag     = false;\n\n    inventDimOnHand = InventDimOnHand::newAvailPhysical(itemId,\n                                                        inventDimCriteria,\n                                                        inventDimParmCriteria,\n                                                        InventDimOnHandLevel::DimParm,\n                                                        inventDimParmOnHandLevel);\n\n    inventDimOnHandIterator = inventDimOnHand.onHandIterator();\n    while (inventDimOnHandIterator.more())\n    {\n        inventDimOnHandMember = inventDimOnHandIterator.value();\n\n        inventDim = InventDim::find(inventDimOnHandMember.parmInventDimId());\n\n        info(con2Str([  inventDimOnHandMember.parmItemId(),\n                        inventDim.InventSiteId,\n                        inventDim.InventLocationId,\n                        inventDim.wmsLocationId,\n                        inventDim.wmsPalletId,\n                        inventDim.InventBatchId,\n                        inventDim.InventSerialId,\n                        inventDim.ConfigId,\n                        inventDim.InventSizeId,\n                        inventDim.InventColorId,\n                        inventDim.InventStyleId,\n                        inventDimOnHandMember.parmInventQty()]));\n\n        inventDimOnHandIterator.next();\n    }\n}\n```\n\n## InventOnHand\n\nBelow function returns onhand qty of item. You can further filter on hand qty of the item for a location by passing invent location id as its optional parameter.\n\n```c#\ndisplay InventQtyOnHand qtyOnHand(InventLocationId _inventLocationId = '')\n{\n    InventOnHand inventQtyOnHand;\n\n    inventQtyOnHand = InventOnHand::newItemId(this.ItemId);\n\n    if (_inventLocationId)\n        inventQtyOnHand.parmInventLocationId(_inventLocationId);\n\n    return inventQtyOnHand.availPhysical();\n}\n```","source":"_posts/xpp-onhandinvent.md","raw":"---\ntitle: Query On-Hand inventory using specific inventory-dimensions\ncomments: true\ndate: 2025-07-08 20:10:18\ntags:\ncategories:\n - x++\ndescription: Query On-Hand inventory using specific inventory-dimensions\n---\n\n## InventDimOnhand\n\nUsing the class InventDimOnhand, you can determine the on-hand inventory of articles and/or specific inventory-dimensions. The following job determines the inventory for a specific item and a specific inventlocation. This is grouped per color.\n\n```c#\nstatic void getInventOnhandExample(Args _args)\n{\n    ItemId itemId;\n    InventDimOnHand inventDimOnHand;\n    InventDimParm inventDimParmOnHandLevel;\n    InventDimOnHandIterator inventDimOnHandIterator;\n    InventDimOnHandMember inventDimOnHandMember;\n    InventDim inventDim;\n    InventDim inventDimCriteria;\n    InventDimParm inventDimParmCriteria;\n\n    // Item: Query specific item\n    itemId = \"DMO003\";\n    \n    // inventDimCriteria: Apply ranges\n    inventDimCriteria.wmsLocationId             = \"12-1\";\n    inventDimCriteria.InventBatchId             = \"DMOBatch001\";\n\n    // inventDimParmCriteria: should values from inventDimCriteria be used?\n    inventDimParmCriteria.ItemIdFlag            = false;\n    inventDimParmCriteria.InventSiteIdFlag      = false;\n    inventDimParmCriteria.InventLocationIdFlag  = false;\n    inventDimParmCriteria.wmsLocationIdFlag     = true;     // wmsLocationId from inventDimCriteria will be used\n    inventDimParmCriteria.wmsPalletIdFlag       = false;\n    inventDimParmCriteria.InventBatchIdFlag     = false;    // inventBatchId from inventDimCriteria will not be used\n    inventDimParmCriteria.InventSerialIdFlag    = false;\n    inventDimParmCriteria.ConfigIdFlag          = false;\n    inventDimParmCriteria.InventSizeIdFlag      = false;\n    inventDimParmCriteria.InventColorIdFlag     = false;\n    inventDimParmCriteria.InventStyleIdFlag     = false;\n\n    // inventDimParmOnHandLevel: Which dimensions should be used to group for?\n    // inventDimParmOnHandLevel necessary for inventDimOnHandLevel::DimParm\n    inventDimParmOnHandLevel.ItemIdFlag            = true;      // necessary\n    inventDimParmOnHandLevel.InventSiteIdFlag      = false;\n    inventDimParmOnHandLevel.InventLocationIdFlag  = false;\n    inventDimParmOnHandLevel.wmsLocationIdFlag     = false;\n    inventDimParmOnHandLevel.wmsPalletIdFlag       = false;\n    inventDimParmOnHandLevel.InventBatchIdFlag     = false;\n    inventDimParmOnHandLevel.InventSerialIdFlag    = false;\n    inventDimParmOnHandLevel.ConfigIdFlag          = false;\n    inventDimParmOnHandLevel.InventSizeIdFlag      = false;\n    inventDimParmOnHandLevel.InventColorIdFlag     = true;      // group by color\n    inventDimParmOnHandLevel.InventStyleIdFlag     = false;\n\n    inventDimOnHand = InventDimOnHand::newAvailPhysical(itemId,\n                                                        inventDimCriteria,\n                                                        inventDimParmCriteria,\n                                                        InventDimOnHandLevel::DimParm,\n                                                        inventDimParmOnHandLevel);\n\n    inventDimOnHandIterator = inventDimOnHand.onHandIterator();\n    while (inventDimOnHandIterator.more())\n    {\n        inventDimOnHandMember = inventDimOnHandIterator.value();\n\n        inventDim = InventDim::find(inventDimOnHandMember.parmInventDimId());\n\n        info(con2Str([  inventDimOnHandMember.parmItemId(),\n                        inventDim.InventSiteId,\n                        inventDim.InventLocationId,\n                        inventDim.wmsLocationId,\n                        inventDim.wmsPalletId,\n                        inventDim.InventBatchId,\n                        inventDim.InventSerialId,\n                        inventDim.ConfigId,\n                        inventDim.InventSizeId,\n                        inventDim.InventColorId,\n                        inventDim.InventStyleId,\n                        inventDimOnHandMember.parmInventQty()]));\n\n        inventDimOnHandIterator.next();\n    }\n}\n```\n\n## InventOnHand\n\nBelow function returns onhand qty of item. You can further filter on hand qty of the item for a location by passing invent location id as its optional parameter.\n\n```c#\ndisplay InventQtyOnHand qtyOnHand(InventLocationId _inventLocationId = '')\n{\n    InventOnHand inventQtyOnHand;\n\n    inventQtyOnHand = InventOnHand::newItemId(this.ItemId);\n\n    if (_inventLocationId)\n        inventQtyOnHand.parmInventLocationId(_inventLocationId);\n\n    return inventQtyOnHand.availPhysical();\n}\n```","slug":"xpp-onhandinvent","published":1,"updated":"2025-07-08T12:15:58.457Z","layout":"post","photos":[],"_id":"cmcvxsshx00243cugbsk96k2h","content":"<h2 id=\"InventDimOnhand\"><a href=\"#InventDimOnhand\" class=\"headerlink\" title=\"InventDimOnhand\"></a>InventDimOnhand</h2><p>Using the class InventDimOnhand, you can determine the on-hand inventory of articles and&#x2F;or specific inventory-dimensions. The following job determines the inventory for a specific item and a specific inventlocation. This is grouped per color.</p>\n<figure class=\"highlight c#\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">getInventOnhandExample</span>(<span class=\"params\">Args _args</span>)</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    ItemId itemId;</span><br><span class=\"line\">    InventDimOnHand inventDimOnHand;</span><br><span class=\"line\">    InventDimParm inventDimParmOnHandLevel;</span><br><span class=\"line\">    InventDimOnHandIterator inventDimOnHandIterator;</span><br><span class=\"line\">    InventDimOnHandMember inventDimOnHandMember;</span><br><span class=\"line\">    InventDim inventDim;</span><br><span class=\"line\">    InventDim inventDimCriteria;</span><br><span class=\"line\">    InventDimParm inventDimParmCriteria;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Item: Query specific item</span></span><br><span class=\"line\">    itemId = <span class=\"string\">&quot;DMO003&quot;</span>;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">// inventDimCriteria: Apply ranges</span></span><br><span class=\"line\">    inventDimCriteria.wmsLocationId             = <span class=\"string\">&quot;12-1&quot;</span>;</span><br><span class=\"line\">    inventDimCriteria.InventBatchId             = <span class=\"string\">&quot;DMOBatch001&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// inventDimParmCriteria: should values from inventDimCriteria be used?</span></span><br><span class=\"line\">    inventDimParmCriteria.ItemIdFlag            = <span class=\"literal\">false</span>;</span><br><span class=\"line\">    inventDimParmCriteria.InventSiteIdFlag      = <span class=\"literal\">false</span>;</span><br><span class=\"line\">    inventDimParmCriteria.InventLocationIdFlag  = <span class=\"literal\">false</span>;</span><br><span class=\"line\">    inventDimParmCriteria.wmsLocationIdFlag     = <span class=\"literal\">true</span>;     <span class=\"comment\">// wmsLocationId from inventDimCriteria will be used</span></span><br><span class=\"line\">    inventDimParmCriteria.wmsPalletIdFlag       = <span class=\"literal\">false</span>;</span><br><span class=\"line\">    inventDimParmCriteria.InventBatchIdFlag     = <span class=\"literal\">false</span>;    <span class=\"comment\">// inventBatchId from inventDimCriteria will not be used</span></span><br><span class=\"line\">    inventDimParmCriteria.InventSerialIdFlag    = <span class=\"literal\">false</span>;</span><br><span class=\"line\">    inventDimParmCriteria.ConfigIdFlag          = <span class=\"literal\">false</span>;</span><br><span class=\"line\">    inventDimParmCriteria.InventSizeIdFlag      = <span class=\"literal\">false</span>;</span><br><span class=\"line\">    inventDimParmCriteria.InventColorIdFlag     = <span class=\"literal\">false</span>;</span><br><span class=\"line\">    inventDimParmCriteria.InventStyleIdFlag     = <span class=\"literal\">false</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// inventDimParmOnHandLevel: Which dimensions should be used to group for?</span></span><br><span class=\"line\">    <span class=\"comment\">// inventDimParmOnHandLevel necessary for inventDimOnHandLevel::DimParm</span></span><br><span class=\"line\">    inventDimParmOnHandLevel.ItemIdFlag            = <span class=\"literal\">true</span>;      <span class=\"comment\">// necessary</span></span><br><span class=\"line\">    inventDimParmOnHandLevel.InventSiteIdFlag      = <span class=\"literal\">false</span>;</span><br><span class=\"line\">    inventDimParmOnHandLevel.InventLocationIdFlag  = <span class=\"literal\">false</span>;</span><br><span class=\"line\">    inventDimParmOnHandLevel.wmsLocationIdFlag     = <span class=\"literal\">false</span>;</span><br><span class=\"line\">    inventDimParmOnHandLevel.wmsPalletIdFlag       = <span class=\"literal\">false</span>;</span><br><span class=\"line\">    inventDimParmOnHandLevel.InventBatchIdFlag     = <span class=\"literal\">false</span>;</span><br><span class=\"line\">    inventDimParmOnHandLevel.InventSerialIdFlag    = <span class=\"literal\">false</span>;</span><br><span class=\"line\">    inventDimParmOnHandLevel.ConfigIdFlag          = <span class=\"literal\">false</span>;</span><br><span class=\"line\">    inventDimParmOnHandLevel.InventSizeIdFlag      = <span class=\"literal\">false</span>;</span><br><span class=\"line\">    inventDimParmOnHandLevel.InventColorIdFlag     = <span class=\"literal\">true</span>;      <span class=\"comment\">// group by color</span></span><br><span class=\"line\">    inventDimParmOnHandLevel.InventStyleIdFlag     = <span class=\"literal\">false</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    inventDimOnHand = InventDimOnHand::newAvailPhysical(itemId,</span><br><span class=\"line\">                                                        inventDimCriteria,</span><br><span class=\"line\">                                                        inventDimParmCriteria,</span><br><span class=\"line\">                                                        InventDimOnHandLevel::DimParm,</span><br><span class=\"line\">                                                        inventDimParmOnHandLevel);</span><br><span class=\"line\"></span><br><span class=\"line\">    inventDimOnHandIterator = inventDimOnHand.onHandIterator();</span><br><span class=\"line\">    <span class=\"keyword\">while</span> (inventDimOnHandIterator.more())</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        inventDimOnHandMember = inventDimOnHandIterator.<span class=\"keyword\">value</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">        inventDim = InventDim::find(inventDimOnHandMember.parmInventDimId());</span><br><span class=\"line\"></span><br><span class=\"line\">        info(con2Str([  inventDimOnHandMember.parmItemId(),</span><br><span class=\"line\">                        inventDim.InventSiteId,</span><br><span class=\"line\">                        inventDim.InventLocationId,</span><br><span class=\"line\">                        inventDim.wmsLocationId,</span><br><span class=\"line\">                        inventDim.wmsPalletId,</span><br><span class=\"line\">                        inventDim.InventBatchId,</span><br><span class=\"line\">                        inventDim.InventSerialId,</span><br><span class=\"line\">                        inventDim.ConfigId,</span><br><span class=\"line\">                        inventDim.InventSizeId,</span><br><span class=\"line\">                        inventDim.InventColorId,</span><br><span class=\"line\">                        inventDim.InventStyleId,</span><br><span class=\"line\">                        inventDimOnHandMember.parmInventQty()]));</span><br><span class=\"line\"></span><br><span class=\"line\">        inventDimOnHandIterator.next();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"InventOnHand\"><a href=\"#InventOnHand\" class=\"headerlink\" title=\"InventOnHand\"></a>InventOnHand</h2><p>Below function returns onhand qty of item. You can further filter on hand qty of the item for a location by passing invent location id as its optional parameter.</p>\n<figure class=\"highlight c#\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\">display InventQtyOnHand <span class=\"title\">qtyOnHand</span>(<span class=\"params\">InventLocationId _inventLocationId = <span class=\"string\">&#x27;&#x27;</span></span>)</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    InventOnHand inventQtyOnHand;</span><br><span class=\"line\"></span><br><span class=\"line\">    inventQtyOnHand = InventOnHand::newItemId(<span class=\"keyword\">this</span>.ItemId);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (_inventLocationId)</span><br><span class=\"line\">        inventQtyOnHand.parmInventLocationId(_inventLocationId);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> inventQtyOnHand.availPhysical();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>","excerpt":"","more":"<h2 id=\"InventDimOnhand\"><a href=\"#InventDimOnhand\" class=\"headerlink\" title=\"InventDimOnhand\"></a>InventDimOnhand</h2><p>Using the class InventDimOnhand, you can determine the on-hand inventory of articles and&#x2F;or specific inventory-dimensions. The following job determines the inventory for a specific item and a specific inventlocation. This is grouped per color.</p>\n<figure class=\"highlight c#\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">getInventOnhandExample</span>(<span class=\"params\">Args _args</span>)</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    ItemId itemId;</span><br><span class=\"line\">    InventDimOnHand inventDimOnHand;</span><br><span class=\"line\">    InventDimParm inventDimParmOnHandLevel;</span><br><span class=\"line\">    InventDimOnHandIterator inventDimOnHandIterator;</span><br><span class=\"line\">    InventDimOnHandMember inventDimOnHandMember;</span><br><span class=\"line\">    InventDim inventDim;</span><br><span class=\"line\">    InventDim inventDimCriteria;</span><br><span class=\"line\">    InventDimParm inventDimParmCriteria;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Item: Query specific item</span></span><br><span class=\"line\">    itemId = <span class=\"string\">&quot;DMO003&quot;</span>;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">// inventDimCriteria: Apply ranges</span></span><br><span class=\"line\">    inventDimCriteria.wmsLocationId             = <span class=\"string\">&quot;12-1&quot;</span>;</span><br><span class=\"line\">    inventDimCriteria.InventBatchId             = <span class=\"string\">&quot;DMOBatch001&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// inventDimParmCriteria: should values from inventDimCriteria be used?</span></span><br><span class=\"line\">    inventDimParmCriteria.ItemIdFlag            = <span class=\"literal\">false</span>;</span><br><span class=\"line\">    inventDimParmCriteria.InventSiteIdFlag      = <span class=\"literal\">false</span>;</span><br><span class=\"line\">    inventDimParmCriteria.InventLocationIdFlag  = <span class=\"literal\">false</span>;</span><br><span class=\"line\">    inventDimParmCriteria.wmsLocationIdFlag     = <span class=\"literal\">true</span>;     <span class=\"comment\">// wmsLocationId from inventDimCriteria will be used</span></span><br><span class=\"line\">    inventDimParmCriteria.wmsPalletIdFlag       = <span class=\"literal\">false</span>;</span><br><span class=\"line\">    inventDimParmCriteria.InventBatchIdFlag     = <span class=\"literal\">false</span>;    <span class=\"comment\">// inventBatchId from inventDimCriteria will not be used</span></span><br><span class=\"line\">    inventDimParmCriteria.InventSerialIdFlag    = <span class=\"literal\">false</span>;</span><br><span class=\"line\">    inventDimParmCriteria.ConfigIdFlag          = <span class=\"literal\">false</span>;</span><br><span class=\"line\">    inventDimParmCriteria.InventSizeIdFlag      = <span class=\"literal\">false</span>;</span><br><span class=\"line\">    inventDimParmCriteria.InventColorIdFlag     = <span class=\"literal\">false</span>;</span><br><span class=\"line\">    inventDimParmCriteria.InventStyleIdFlag     = <span class=\"literal\">false</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// inventDimParmOnHandLevel: Which dimensions should be used to group for?</span></span><br><span class=\"line\">    <span class=\"comment\">// inventDimParmOnHandLevel necessary for inventDimOnHandLevel::DimParm</span></span><br><span class=\"line\">    inventDimParmOnHandLevel.ItemIdFlag            = <span class=\"literal\">true</span>;      <span class=\"comment\">// necessary</span></span><br><span class=\"line\">    inventDimParmOnHandLevel.InventSiteIdFlag      = <span class=\"literal\">false</span>;</span><br><span class=\"line\">    inventDimParmOnHandLevel.InventLocationIdFlag  = <span class=\"literal\">false</span>;</span><br><span class=\"line\">    inventDimParmOnHandLevel.wmsLocationIdFlag     = <span class=\"literal\">false</span>;</span><br><span class=\"line\">    inventDimParmOnHandLevel.wmsPalletIdFlag       = <span class=\"literal\">false</span>;</span><br><span class=\"line\">    inventDimParmOnHandLevel.InventBatchIdFlag     = <span class=\"literal\">false</span>;</span><br><span class=\"line\">    inventDimParmOnHandLevel.InventSerialIdFlag    = <span class=\"literal\">false</span>;</span><br><span class=\"line\">    inventDimParmOnHandLevel.ConfigIdFlag          = <span class=\"literal\">false</span>;</span><br><span class=\"line\">    inventDimParmOnHandLevel.InventSizeIdFlag      = <span class=\"literal\">false</span>;</span><br><span class=\"line\">    inventDimParmOnHandLevel.InventColorIdFlag     = <span class=\"literal\">true</span>;      <span class=\"comment\">// group by color</span></span><br><span class=\"line\">    inventDimParmOnHandLevel.InventStyleIdFlag     = <span class=\"literal\">false</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    inventDimOnHand = InventDimOnHand::newAvailPhysical(itemId,</span><br><span class=\"line\">                                                        inventDimCriteria,</span><br><span class=\"line\">                                                        inventDimParmCriteria,</span><br><span class=\"line\">                                                        InventDimOnHandLevel::DimParm,</span><br><span class=\"line\">                                                        inventDimParmOnHandLevel);</span><br><span class=\"line\"></span><br><span class=\"line\">    inventDimOnHandIterator = inventDimOnHand.onHandIterator();</span><br><span class=\"line\">    <span class=\"keyword\">while</span> (inventDimOnHandIterator.more())</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        inventDimOnHandMember = inventDimOnHandIterator.<span class=\"keyword\">value</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">        inventDim = InventDim::find(inventDimOnHandMember.parmInventDimId());</span><br><span class=\"line\"></span><br><span class=\"line\">        info(con2Str([  inventDimOnHandMember.parmItemId(),</span><br><span class=\"line\">                        inventDim.InventSiteId,</span><br><span class=\"line\">                        inventDim.InventLocationId,</span><br><span class=\"line\">                        inventDim.wmsLocationId,</span><br><span class=\"line\">                        inventDim.wmsPalletId,</span><br><span class=\"line\">                        inventDim.InventBatchId,</span><br><span class=\"line\">                        inventDim.InventSerialId,</span><br><span class=\"line\">                        inventDim.ConfigId,</span><br><span class=\"line\">                        inventDim.InventSizeId,</span><br><span class=\"line\">                        inventDim.InventColorId,</span><br><span class=\"line\">                        inventDim.InventStyleId,</span><br><span class=\"line\">                        inventDimOnHandMember.parmInventQty()]));</span><br><span class=\"line\"></span><br><span class=\"line\">        inventDimOnHandIterator.next();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"InventOnHand\"><a href=\"#InventOnHand\" class=\"headerlink\" title=\"InventOnHand\"></a>InventOnHand</h2><p>Below function returns onhand qty of item. You can further filter on hand qty of the item for a location by passing invent location id as its optional parameter.</p>\n<figure class=\"highlight c#\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\">display InventQtyOnHand <span class=\"title\">qtyOnHand</span>(<span class=\"params\">InventLocationId _inventLocationId = <span class=\"string\">&#x27;&#x27;</span></span>)</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    InventOnHand inventQtyOnHand;</span><br><span class=\"line\"></span><br><span class=\"line\">    inventQtyOnHand = InventOnHand::newItemId(<span class=\"keyword\">this</span>.ItemId);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (_inventLocationId)</span><br><span class=\"line\">        inventQtyOnHand.parmInventLocationId(_inventLocationId);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> inventQtyOnHand.availPhysical();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>"},{"title":"加密存储敏感信息","comments":1,"date":"2025-03-29T07:19:37.000Z","description":"在开发VSIX扩展时，安全存储API Key是关键需求。本案例通过`ProtectedData`加密与SecureString结合，实现密钥的加密存储与安全调用。用户输入API Key时，采用WPF PasswordBox控件接收SecureString，避免明文暴露。加密后数据以Base64存储于OptionPane全局配置，解密时仅当前用户可还原。通过作用域控制与内存清理机制，最大限度减少敏感数据驻留时间，确保AI集成安全可靠。文中提供完整代码示例，展示加密、解密逻辑及VS选项页集成方案，为VSIX开发提供实用安全实践指南。","_content":"\n> 本篇为大家介绍一个加密存储数据到 OptionPane 的案例。\n\n## 案例背景\n\nAI 应用开发需要调用大模型开放的接口，API Key 便是必不可少的（以下使用 deepseek-v3 示范）。\n\n> 关于如何获取且调用 deepseek 的 api key，可以访问官方文档 首次调用 [Deepseek API Docs](https://api-docs.deepseek.com/zh-cn/)，这里不再赘述。\n\n在集成 AI 到 VSIX 扩展应用过程中，如何存储且获取 API Key 是首先要考虑的，关键的需求如下：\n- API Key 不可明文存储；\n- API Key 不可明文展示；\n- 需要是一个全局变量，不可直接在源代码中声明使用；\n- 用户可以随时编辑。\n\n## 案例解析\n\n首先要解决的是：不可直接存储明文，这就需要在存储 **API key** 到 `OptionPane` 之前对用户输入的数据进行加密。\n\n```csharp\npublic static string EncrySecureString(SecureString secureString)\n{\n\tbyte[] encryptedData = ProtectedData.Protect(\n\t\tEncoding.UTF8.GetBytes(ToInsecureString(secureString)),\n\t\toptionEntropy: null,\n\t\tscope: DataProtectionScope.CurrentUser\n\t);\n}\n```\n\n而在调用 API 时则需要先获取存储在全局的加密数据，然后解密利用解密后的数据向 deepseek 大模型发送请求。\n\n```csharp\npublic static SecureString DecryptToSecureString(string encryptedBase64)\n{\n\tbyte[] encryptedBytes = Covert.FromBase64String(encryptedBase64);\n\tbyte[] decryptedBytes = ProtectedData.Unprotect(\n\t\tencryptedBytes,\n\t\toptionEntropy: null,\n\t\tscope: DataProtectionScope.CurrentUser\n\t);\n\treturn ToSecureString(Encoding.UTF8.GetString(decryptedBytes));\n}\n```\n\n其次不可直接将存储在全局的数据直接展示给用户，应当类似 Password 的风格，如下图：\n\n{% asset_img \"75c34455b6d94fd5a859979b5462f90d.png\" \"加密展示\" %}\n\nVSIX 提供了 OptionPane 接口用于存储全局的数据，用户可导航至 Tools > Option 找到 Visual Studio IDE 的所有全局配置标签页，如下图：\n\n{% asset_img \"c3f95d2ff64b427591d18ce311bcefea.png\" \"全局配置页\" %}\n\n**注**\n> 最后需要注意明文不可在代码内存中保留太长时间，这意味着在用户输入 API key 时，不可以直接使用 WPF.textbox 以普通字符串的形式接收用户输入的值，可以使用 SecureString 接收用户的输入值。\n> 在 C# 中，SecureString 是一种用于安全存储敏感数据（如密码、密钥等）的特殊字符串类型。其核心设计目标是通过加密和内存管理机制，降低敏感数据在内存中暴露的风险。\n> 而在请求发出后/时，应当立刻清理内存中的明敏感数据。这需要使用 byte[] 存储解密后的数据(在 C# 中普通字符串无法被安全地擦除)。最大的减少作用域，并且利用 Array.Clear() 清理 byte[] 数据。","source":"_posts/加密存储敏感信息.md","raw":"---\ntitle: 加密存储敏感信息\ncomments: true\ndate: 2025-03-29 15:19:37\ntags:\ncategories:\n - c#\ndescription: 在开发VSIX扩展时，安全存储API Key是关键需求。本案例通过`ProtectedData`加密与SecureString结合，实现密钥的加密存储与安全调用。用户输入API Key时，采用WPF PasswordBox控件接收SecureString，避免明文暴露。加密后数据以Base64存储于OptionPane全局配置，解密时仅当前用户可还原。通过作用域控制与内存清理机制，最大限度减少敏感数据驻留时间，确保AI集成安全可靠。文中提供完整代码示例，展示加密、解密逻辑及VS选项页集成方案，为VSIX开发提供实用安全实践指南。\n---\n\n> 本篇为大家介绍一个加密存储数据到 OptionPane 的案例。\n\n## 案例背景\n\nAI 应用开发需要调用大模型开放的接口，API Key 便是必不可少的（以下使用 deepseek-v3 示范）。\n\n> 关于如何获取且调用 deepseek 的 api key，可以访问官方文档 首次调用 [Deepseek API Docs](https://api-docs.deepseek.com/zh-cn/)，这里不再赘述。\n\n在集成 AI 到 VSIX 扩展应用过程中，如何存储且获取 API Key 是首先要考虑的，关键的需求如下：\n- API Key 不可明文存储；\n- API Key 不可明文展示；\n- 需要是一个全局变量，不可直接在源代码中声明使用；\n- 用户可以随时编辑。\n\n## 案例解析\n\n首先要解决的是：不可直接存储明文，这就需要在存储 **API key** 到 `OptionPane` 之前对用户输入的数据进行加密。\n\n```csharp\npublic static string EncrySecureString(SecureString secureString)\n{\n\tbyte[] encryptedData = ProtectedData.Protect(\n\t\tEncoding.UTF8.GetBytes(ToInsecureString(secureString)),\n\t\toptionEntropy: null,\n\t\tscope: DataProtectionScope.CurrentUser\n\t);\n}\n```\n\n而在调用 API 时则需要先获取存储在全局的加密数据，然后解密利用解密后的数据向 deepseek 大模型发送请求。\n\n```csharp\npublic static SecureString DecryptToSecureString(string encryptedBase64)\n{\n\tbyte[] encryptedBytes = Covert.FromBase64String(encryptedBase64);\n\tbyte[] decryptedBytes = ProtectedData.Unprotect(\n\t\tencryptedBytes,\n\t\toptionEntropy: null,\n\t\tscope: DataProtectionScope.CurrentUser\n\t);\n\treturn ToSecureString(Encoding.UTF8.GetString(decryptedBytes));\n}\n```\n\n其次不可直接将存储在全局的数据直接展示给用户，应当类似 Password 的风格，如下图：\n\n{% asset_img \"75c34455b6d94fd5a859979b5462f90d.png\" \"加密展示\" %}\n\nVSIX 提供了 OptionPane 接口用于存储全局的数据，用户可导航至 Tools > Option 找到 Visual Studio IDE 的所有全局配置标签页，如下图：\n\n{% asset_img \"c3f95d2ff64b427591d18ce311bcefea.png\" \"全局配置页\" %}\n\n**注**\n> 最后需要注意明文不可在代码内存中保留太长时间，这意味着在用户输入 API key 时，不可以直接使用 WPF.textbox 以普通字符串的形式接收用户输入的值，可以使用 SecureString 接收用户的输入值。\n> 在 C# 中，SecureString 是一种用于安全存储敏感数据（如密码、密钥等）的特殊字符串类型。其核心设计目标是通过加密和内存管理机制，降低敏感数据在内存中暴露的风险。\n> 而在请求发出后/时，应当立刻清理内存中的明敏感数据。这需要使用 byte[] 存储解密后的数据(在 C# 中普通字符串无法被安全地擦除)。最大的减少作用域，并且利用 Array.Clear() 清理 byte[] 数据。","slug":"加密存储敏感信息","published":1,"updated":"2025-07-08T12:05:00.542Z","layout":"post","photos":[],"_id":"cmcvxsshx00253cug6aacd1qn","content":"<blockquote>\n<p>本篇为大家介绍一个加密存储数据到 OptionPane 的案例。</p>\n</blockquote>\n<h2 id=\"案例背景\"><a href=\"#案例背景\" class=\"headerlink\" title=\"案例背景\"></a>案例背景</h2><p>AI 应用开发需要调用大模型开放的接口，API Key 便是必不可少的（以下使用 deepseek-v3 示范）。</p>\n<blockquote>\n<p>关于如何获取且调用 deepseek 的 api key，可以访问官方文档 首次调用 <a href=\"https://api-docs.deepseek.com/zh-cn/\">Deepseek API Docs</a>，这里不再赘述。</p>\n</blockquote>\n<p>在集成 AI 到 VSIX 扩展应用过程中，如何存储且获取 API Key 是首先要考虑的，关键的需求如下：</p>\n<ul>\n<li>API Key 不可明文存储；</li>\n<li>API Key 不可明文展示；</li>\n<li>需要是一个全局变量，不可直接在源代码中声明使用；</li>\n<li>用户可以随时编辑。</li>\n</ul>\n<h2 id=\"案例解析\"><a href=\"#案例解析\" class=\"headerlink\" title=\"案例解析\"></a>案例解析</h2><p>首先要解决的是：不可直接存储明文，这就需要在存储 <strong>API key</strong> 到 <code>OptionPane</code> 之前对用户输入的数据进行加密。</p>\n<figure class=\"highlight csharp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"built_in\">string</span> <span class=\"title\">EncrySecureString</span>(<span class=\"params\">SecureString secureString</span>)</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t<span class=\"built_in\">byte</span>[] encryptedData = ProtectedData.Protect(</span><br><span class=\"line\">\t\tEncoding.UTF8.GetBytes(ToInsecureString(secureString)),</span><br><span class=\"line\">\t\toptionEntropy: <span class=\"literal\">null</span>,</span><br><span class=\"line\">\t\tscope: DataProtectionScope.CurrentUser</span><br><span class=\"line\">\t);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>而在调用 API 时则需要先获取存储在全局的加密数据，然后解密利用解密后的数据向 deepseek 大模型发送请求。</p>\n<figure class=\"highlight csharp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> SecureString <span class=\"title\">DecryptToSecureString</span>(<span class=\"params\"><span class=\"built_in\">string</span> encryptedBase64</span>)</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t<span class=\"built_in\">byte</span>[] encryptedBytes = Covert.FromBase64String(encryptedBase64);</span><br><span class=\"line\">\t<span class=\"built_in\">byte</span>[] decryptedBytes = ProtectedData.Unprotect(</span><br><span class=\"line\">\t\tencryptedBytes,</span><br><span class=\"line\">\t\toptionEntropy: <span class=\"literal\">null</span>,</span><br><span class=\"line\">\t\tscope: DataProtectionScope.CurrentUser</span><br><span class=\"line\">\t);</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> ToSecureString(Encoding.UTF8.GetString(decryptedBytes));</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>其次不可直接将存储在全局的数据直接展示给用户，应当类似 Password 的风格，如下图：</p>\n<img src=\"/2025/03/29/%E5%8A%A0%E5%AF%86%E5%AD%98%E5%82%A8%E6%95%8F%E6%84%9F%E4%BF%A1%E6%81%AF/75c34455b6d94fd5a859979b5462f90d.png\" class=\"\" title=\"加密展示\">\n\n<p>VSIX 提供了 OptionPane 接口用于存储全局的数据，用户可导航至 Tools &gt; Option 找到 Visual Studio IDE 的所有全局配置标签页，如下图：</p>\n<img src=\"/2025/03/29/%E5%8A%A0%E5%AF%86%E5%AD%98%E5%82%A8%E6%95%8F%E6%84%9F%E4%BF%A1%E6%81%AF/c3f95d2ff64b427591d18ce311bcefea.png\" class=\"\" title=\"全局配置页\">\n\n<p><strong>注</strong></p>\n<blockquote>\n<p>最后需要注意明文不可在代码内存中保留太长时间，这意味着在用户输入 API key 时，不可以直接使用 WPF.textbox 以普通字符串的形式接收用户输入的值，可以使用 SecureString 接收用户的输入值。<br>在 C# 中，SecureString 是一种用于安全存储敏感数据（如密码、密钥等）的特殊字符串类型。其核心设计目标是通过加密和内存管理机制，降低敏感数据在内存中暴露的风险。<br>而在请求发出后&#x2F;时，应当立刻清理内存中的明敏感数据。这需要使用 byte[] 存储解密后的数据(在 C# 中普通字符串无法被安全地擦除)。最大的减少作用域，并且利用 Array.Clear() 清理 byte[] 数据。</p>\n</blockquote>\n","excerpt":"","more":"<blockquote>\n<p>本篇为大家介绍一个加密存储数据到 OptionPane 的案例。</p>\n</blockquote>\n<h2 id=\"案例背景\"><a href=\"#案例背景\" class=\"headerlink\" title=\"案例背景\"></a>案例背景</h2><p>AI 应用开发需要调用大模型开放的接口，API Key 便是必不可少的（以下使用 deepseek-v3 示范）。</p>\n<blockquote>\n<p>关于如何获取且调用 deepseek 的 api key，可以访问官方文档 首次调用 <a href=\"https://api-docs.deepseek.com/zh-cn/\">Deepseek API Docs</a>，这里不再赘述。</p>\n</blockquote>\n<p>在集成 AI 到 VSIX 扩展应用过程中，如何存储且获取 API Key 是首先要考虑的，关键的需求如下：</p>\n<ul>\n<li>API Key 不可明文存储；</li>\n<li>API Key 不可明文展示；</li>\n<li>需要是一个全局变量，不可直接在源代码中声明使用；</li>\n<li>用户可以随时编辑。</li>\n</ul>\n<h2 id=\"案例解析\"><a href=\"#案例解析\" class=\"headerlink\" title=\"案例解析\"></a>案例解析</h2><p>首先要解决的是：不可直接存储明文，这就需要在存储 <strong>API key</strong> 到 <code>OptionPane</code> 之前对用户输入的数据进行加密。</p>\n<figure class=\"highlight csharp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"built_in\">string</span> <span class=\"title\">EncrySecureString</span>(<span class=\"params\">SecureString secureString</span>)</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t<span class=\"built_in\">byte</span>[] encryptedData = ProtectedData.Protect(</span><br><span class=\"line\">\t\tEncoding.UTF8.GetBytes(ToInsecureString(secureString)),</span><br><span class=\"line\">\t\toptionEntropy: <span class=\"literal\">null</span>,</span><br><span class=\"line\">\t\tscope: DataProtectionScope.CurrentUser</span><br><span class=\"line\">\t);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>而在调用 API 时则需要先获取存储在全局的加密数据，然后解密利用解密后的数据向 deepseek 大模型发送请求。</p>\n<figure class=\"highlight csharp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> SecureString <span class=\"title\">DecryptToSecureString</span>(<span class=\"params\"><span class=\"built_in\">string</span> encryptedBase64</span>)</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t<span class=\"built_in\">byte</span>[] encryptedBytes = Covert.FromBase64String(encryptedBase64);</span><br><span class=\"line\">\t<span class=\"built_in\">byte</span>[] decryptedBytes = ProtectedData.Unprotect(</span><br><span class=\"line\">\t\tencryptedBytes,</span><br><span class=\"line\">\t\toptionEntropy: <span class=\"literal\">null</span>,</span><br><span class=\"line\">\t\tscope: DataProtectionScope.CurrentUser</span><br><span class=\"line\">\t);</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> ToSecureString(Encoding.UTF8.GetString(decryptedBytes));</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>其次不可直接将存储在全局的数据直接展示给用户，应当类似 Password 的风格，如下图：</p>\n<img src=\"/2025/03/29/%E5%8A%A0%E5%AF%86%E5%AD%98%E5%82%A8%E6%95%8F%E6%84%9F%E4%BF%A1%E6%81%AF/75c34455b6d94fd5a859979b5462f90d.png\" class=\"\" title=\"加密展示\">\n\n<p>VSIX 提供了 OptionPane 接口用于存储全局的数据，用户可导航至 Tools &gt; Option 找到 Visual Studio IDE 的所有全局配置标签页，如下图：</p>\n<img src=\"/2025/03/29/%E5%8A%A0%E5%AF%86%E5%AD%98%E5%82%A8%E6%95%8F%E6%84%9F%E4%BF%A1%E6%81%AF/c3f95d2ff64b427591d18ce311bcefea.png\" class=\"\" title=\"全局配置页\">\n\n<p><strong>注</strong></p>\n<blockquote>\n<p>最后需要注意明文不可在代码内存中保留太长时间，这意味着在用户输入 API key 时，不可以直接使用 WPF.textbox 以普通字符串的形式接收用户输入的值，可以使用 SecureString 接收用户的输入值。<br>在 C# 中，SecureString 是一种用于安全存储敏感数据（如密码、密钥等）的特殊字符串类型。其核心设计目标是通过加密和内存管理机制，降低敏感数据在内存中暴露的风险。<br>而在请求发出后&#x2F;时，应当立刻清理内存中的明敏感数据。这需要使用 byte[] 存储解密后的数据(在 C# 中普通字符串无法被安全地擦除)。最大的减少作用域，并且利用 Array.Clear() 清理 byte[] 数据。</p>\n</blockquote>\n"}],"PostAsset":[{"_id":"source/_posts/ai-900-exam-preparation-1/document-intelligence-studio.png","slug":"document-intelligence-studio.png","post":"cmcvxsshj00053cugbxsce93r","modified":0,"renderable":0},{"_id":"source/_posts/ai-900-exam-preparation-1/machine-learn.gif","slug":"machine-learn.gif","post":"cmcvxsshj00053cugbxsce93r","modified":0,"renderable":0},{"_id":"source/_posts/API/image1.png","slug":"image1.png","post":"cmcvxsshk00063cughrey9k0u","modified":0,"renderable":0},{"_id":"source/_posts/API/image2.png","slug":"image2.png","post":"cmcvxsshk00063cughrey9k0u","modified":0,"renderable":0},{"_id":"source/_posts/API/image3.png","slug":"image3.png","post":"cmcvxsshk00063cughrey9k0u","modified":0,"renderable":0},{"_id":"source/_posts/API/image4.png","slug":"image4.png","post":"cmcvxsshk00063cughrey9k0u","modified":0,"renderable":0},{"_id":"source/_posts/API/image5.png","slug":"image5.png","post":"cmcvxsshk00063cughrey9k0u","modified":0,"renderable":0},{"_id":"source/_posts/API/image6.png","slug":"image6.png","post":"cmcvxsshk00063cughrey9k0u","modified":0,"renderable":0},{"_id":"source/_posts/API/image7.png","slug":"image7.png","post":"cmcvxsshk00063cughrey9k0u","modified":0,"renderable":0},{"_id":"source/_posts/commerce-cache/commerce-cache-example.png","slug":"commerce-cache-example.png","post":"cmcvxsshm000a3cugf1gxfr0t","modified":0,"renderable":0},{"_id":"source/_posts/ai-900-exam-preparation-2/binary-confusion-matrix.png","slug":"binary-confusion-matrix.png","post":"cmcvxsshl00083cug7vb59e9x","modified":0,"renderable":0},{"_id":"source/_posts/ai-900-exam-preparation-2/classification-predictions.png","slug":"classification-predictions.png","post":"cmcvxsshl00083cug7vb59e9x","modified":0,"renderable":0},{"_id":"source/_posts/ai-900-exam-preparation-2/machine-learning-types.png","slug":"machine-learning-types.png","post":"cmcvxsshl00083cug7vb59e9x","modified":0,"renderable":0},{"_id":"source/_posts/ai-900-exam-preparation-2/machine-learning.png","slug":"machine-learning.png","post":"cmcvxsshl00083cug7vb59e9x","modified":0,"renderable":0},{"_id":"source/_posts/ai-900-exam-preparation-2/regression-line.png","slug":"regression-line.png","post":"cmcvxsshl00083cug7vb59e9x","modified":0,"renderable":0},{"_id":"source/_posts/ai-900-exam-preparation-2/roc-chart.png","slug":"roc-chart.png","post":"cmcvxsshl00083cug7vb59e9x","modified":0,"renderable":0},{"_id":"source/_posts/ai-900-exam-preparation-2/scatter-plot.png","slug":"scatter-plot.png","post":"cmcvxsshl00083cug7vb59e9x","modified":0,"renderable":0},{"_id":"source/_posts/ai-900-exam-preparation-2/sigmoid-plot.png","slug":"sigmoid-plot.png","post":"cmcvxsshl00083cug7vb59e9x","modified":0,"renderable":0},{"_id":"source/_posts/ai-900-exam-preparation-2/supervised-training.png","slug":"supervised-training.png","post":"cmcvxsshl00083cug7vb59e9x","modified":0,"renderable":0},{"_id":"source/_posts/ai-plateform-flask/image.png","slug":"image.png","post":"cmcvxsshm00093cug8y4a7fl9","modified":0,"renderable":0},{"_id":"source/_posts/d365-documentroutingconfiguration/image-25.png","slug":"image-25.png","post":"cmcvxsshn000d3cugcf64fa5c","modified":0,"renderable":0},{"_id":"source/_posts/d365-documentroutingconfiguration/image-26.png","slug":"image-26.png","post":"cmcvxsshn000d3cugcf64fa5c","modified":0,"renderable":0},{"_id":"source/_posts/d365-documentroutingconfiguration/image-27.png","slug":"image-27.png","post":"cmcvxsshn000d3cugcf64fa5c","modified":0,"renderable":0},{"_id":"source/_posts/d365-documentroutingconfiguration/image-28.png","slug":"image-28.png","post":"cmcvxsshn000d3cugcf64fa5c","modified":0,"renderable":0},{"_id":"source/_posts/d365-documentroutingconfiguration/image-29.png","slug":"image-29.png","post":"cmcvxsshn000d3cugcf64fa5c","modified":0,"renderable":0},{"_id":"source/_posts/d365-documentroutingconfiguration/image-30.png","slug":"image-30.png","post":"cmcvxsshn000d3cugcf64fa5c","modified":0,"renderable":0},{"_id":"source/_posts/d365-documentroutingconfiguration/image-31.png","slug":"image-31.png","post":"cmcvxsshn000d3cugcf64fa5c","modified":0,"renderable":0},{"_id":"source/_posts/d365-documentroutingconfiguration/image-32.png","slug":"image-32.png","post":"cmcvxsshn000d3cugcf64fa5c","modified":0,"renderable":0},{"_id":"source/_posts/d365-documentroutingconfiguration/image-33.png","slug":"image-33.png","post":"cmcvxsshn000d3cugcf64fa5c","modified":0,"renderable":0},{"_id":"source/_posts/d365-documentroutingconfiguration/image-34.png","slug":"image-34.png","post":"cmcvxsshn000d3cugcf64fa5c","modified":0,"renderable":0},{"_id":"source/_posts/d365-documentroutingconfiguration/image-35.png","slug":"image-35.png","post":"cmcvxsshn000d3cugcf64fa5c","modified":0,"renderable":0},{"_id":"source/_posts/d365-documentroutingconfiguration/image-36.png","slug":"image-36.png","post":"cmcvxsshn000d3cugcf64fa5c","modified":0,"renderable":0},{"_id":"source/_posts/d365-documentroutingconfiguration/image-37.png","slug":"image-37.png","post":"cmcvxsshn000d3cugcf64fa5c","modified":0,"renderable":0},{"_id":"source/_posts/d365-documentroutingconfiguration/image-38.png","slug":"image-38.png","post":"cmcvxsshn000d3cugcf64fa5c","modified":0,"renderable":0},{"_id":"source/_posts/d365-documentroutingconfiguration/image-39.png","slug":"image-39.png","post":"cmcvxsshn000d3cugcf64fa5c","modified":0,"renderable":0},{"_id":"source/_posts/d365-documentroutingconfiguration/image-40.png","slug":"image-40.png","post":"cmcvxsshn000d3cugcf64fa5c","modified":0,"renderable":0},{"_id":"source/_posts/d365-documentroutingconfiguration/image-41.png","slug":"image-41.png","post":"cmcvxsshn000d3cugcf64fa5c","modified":0,"renderable":0},{"_id":"source/_posts/d365-documentroutingconfiguration/image-42.png","slug":"image-42.png","post":"cmcvxsshn000d3cugcf64fa5c","modified":0,"renderable":0},{"_id":"source/_posts/d365-documentroutingconfiguration/image-43.png","slug":"image-43.png","post":"cmcvxsshn000d3cugcf64fa5c","modified":0,"renderable":0},{"_id":"source/_posts/d365-documentroutingconfiguration/image-45.png","slug":"image-45.png","post":"cmcvxsshn000d3cugcf64fa5c","modified":0,"renderable":0},{"_id":"source/_posts/d365-documentroutingconfiguration/image-46.png","slug":"image-46.png","post":"cmcvxsshn000d3cugcf64fa5c","modified":0,"renderable":0},{"_id":"source/_posts/d365-documentroutingconfiguration/image-47.png","slug":"image-47.png","post":"cmcvxsshn000d3cugcf64fa5c","modified":0,"renderable":0},{"_id":"source/_posts/d365-documentroutingconfiguration/image-48.png","slug":"image-48.png","post":"cmcvxsshn000d3cugcf64fa5c","modified":0,"renderable":0},{"_id":"source/_posts/d365-documentroutingconfiguration/image-49.png","slug":"image-49.png","post":"cmcvxsshn000d3cugcf64fa5c","modified":0,"renderable":0},{"_id":"source/_posts/mssql-clear-log/mssql-clear-log.png","slug":"mssql-clear-log.png","post":"cmcvxsshq000o3cug24x97s9i","modified":0,"renderable":0},{"_id":"source/_posts/xpp-createledgerjournals/CopyJournalDialog.png","slug":"CopyJournalDialog.png","post":"cmcvxsshq000p3cug0wg33dj8","modified":0,"renderable":0},{"_id":"source/_posts/xpp-api-list/xpp-api-list-recordinsertlist.png","slug":"xpp-api-list-recordinsertlist.png","post":"cmcvxsshr000s3cuga6psfnwb","modified":0,"renderable":0},{"_id":"source/_posts/xpp-debug-configuration/xpp-debug-configuration.png","slug":"xpp-debug-configuration.png","post":"cmcvxsshr000v3cug39drfyzv","modified":0,"renderable":0},{"_id":"source/_posts/xpp-extendsalesinvoicereport/CreateNewReport.png","slug":"CreateNewReport.png","post":"cmcvxsshs000z3cugcsk3gy2j","modified":0,"renderable":0},{"_id":"source/_posts/xpp-extendsalesinvoicereport/LineTablix.png","slug":"LineTablix.png","post":"cmcvxsshs000z3cugcsk3gy2j","modified":0,"renderable":0},{"_id":"source/_posts/xpp-extendsalesinvoicereport/PrintedReport.png","slug":"PrintedReport.png","post":"cmcvxsshs000z3cugcsk3gy2j","modified":0,"renderable":0},{"_id":"source/_posts/xpp-extendsalesinvoicereport/ReportDatasets.png","slug":"ReportDatasets.png","post":"cmcvxsshs000z3cugcsk3gy2j","modified":0,"renderable":0},{"_id":"source/_posts/xpp-extendsalesinvoicereport/ReportProperties.png","slug":"ReportProperties.png","post":"cmcvxsshs000z3cugcsk3gy2j","modified":0,"renderable":0},{"_id":"source/_posts/xpp-extendsalesinvoicereport/ReportResulting.png","slug":"ReportResulting.png","post":"cmcvxsshs000z3cugcsk3gy2j","modified":0,"renderable":0},{"_id":"source/_posts/xpp-extendsalesinvoicereport/RowVisibility.png","slug":"RowVisibility.png","post":"cmcvxsshs000z3cugcsk3gy2j","modified":0,"renderable":0},{"_id":"source/_posts/xpp-open-in-office/xpp-open-in-office.png","slug":"xpp-open-in-office.png","post":"cmcvxsshx00233cughmsxhh74","modified":0,"renderable":0},{"_id":"source/_posts/xpp-open-in-office/xpp-open-in-office2.png","slug":"xpp-open-in-office2.png","post":"cmcvxsshx00233cughmsxhh74","modified":0,"renderable":0},{"_id":"source/_posts/xpp-open-in-office/xpp-open-in-office3.png","slug":"xpp-open-in-office3.png","post":"cmcvxsshx00233cughmsxhh74","modified":0,"renderable":0},{"_id":"source/_posts/加密存储敏感信息/75c34455b6d94fd5a859979b5462f90d.png","slug":"75c34455b6d94fd5a859979b5462f90d.png","post":"cmcvxsshx00253cug6aacd1qn","modified":0,"renderable":0},{"_id":"source/_posts/加密存储敏感信息/c3f95d2ff64b427591d18ce311bcefea.png","slug":"c3f95d2ff64b427591d18ce311bcefea.png","post":"cmcvxsshx00253cug6aacd1qn","modified":0,"renderable":0}],"PostCategory":[{"post_id":"cmcvxsshj00053cugbxsce93r","category_id":"cmcvxsshk00073cug50bv3v2i","_id":"cmcvxssho000e3cug19gj9w7m"},{"post_id":"cmcvxsshk00063cughrey9k0u","category_id":"cmcvxsshm000b3cug1q9x32n1","_id":"cmcvxsshp000j3cug9qfaah4o"},{"post_id":"cmcvxsshl00083cug7vb59e9x","category_id":"cmcvxsshk00073cug50bv3v2i","_id":"cmcvxsshq000m3cug7skr0f8v"},{"post_id":"cmcvxsshp000k3cug11u9byh1","category_id":"cmcvxsshp000i3cuggwaj60wo","_id":"cmcvxsshr000q3cug3iwt7u4u"},{"post_id":"cmcvxsshm00093cug8y4a7fl9","category_id":"cmcvxsshp000i3cuggwaj60wo","_id":"cmcvxsshr000t3cugbhtvgf4g"},{"post_id":"cmcvxsshm000a3cugf1gxfr0t","category_id":"cmcvxsshq000n3cug9688dx5p","_id":"cmcvxsshs000x3cug5texea5g"},{"post_id":"cmcvxsshn000c3cughzgc21l2","category_id":"cmcvxsshq000n3cug9688dx5p","_id":"cmcvxssht00123cugcwefe1r6"},{"post_id":"cmcvxsshn000d3cugcf64fa5c","category_id":"cmcvxsshs000w3cug6f5id4z7","_id":"cmcvxsshu00193cug8xby97ns"},{"post_id":"cmcvxssho000g3cug53ueb5k7","category_id":"cmcvxsshs000w3cug6f5id4z7","_id":"cmcvxsshu001b3cug94hp6w7b"},{"post_id":"cmcvxsshp000h3cugg20170su","category_id":"cmcvxsshp000i3cuggwaj60wo","_id":"cmcvxsshu001d3cugeom1au32"},{"post_id":"cmcvxsshq000o3cug24x97s9i","category_id":"cmcvxsshu001a3cugam65gnse","_id":"cmcvxsshv001i3cug3sa79av5"},{"post_id":"cmcvxsshq000p3cug0wg33dj8","category_id":"cmcvxsshu001e3cugd4j69n9v","_id":"cmcvxsshv001o3cugdoumg8lx"},{"post_id":"cmcvxsshr000s3cuga6psfnwb","category_id":"cmcvxsshu001e3cugd4j69n9v","_id":"cmcvxsshv001r3cug3vdk7gfl"},{"post_id":"cmcvxsshr000v3cug39drfyzv","category_id":"cmcvxsshu001e3cugd4j69n9v","_id":"cmcvxsshv001u3cugb2at0lwz"},{"post_id":"cmcvxsshs000y3cug0vd4a3uk","category_id":"cmcvxsshu001e3cugd4j69n9v","_id":"cmcvxsshv001w3cug1hpm8t6f"},{"post_id":"cmcvxsshs000z3cugcsk3gy2j","category_id":"cmcvxsshu001e3cugd4j69n9v","_id":"cmcvxsshv001y3cugdtak1x92"},{"post_id":"cmcvxssht00133cugfnly3b9r","category_id":"cmcvxsshu001e3cugd4j69n9v","_id":"cmcvxsshv00203cug4c7zgtkj"},{"post_id":"cmcvxssht00153cug8a4g7fg7","category_id":"cmcvxsshu001e3cugd4j69n9v","_id":"cmcvxsshw00213cughcdmbn2w"},{"post_id":"cmcvxssht00163cug11yn4g7w","category_id":"cmcvxsshu001e3cugd4j69n9v","_id":"cmcvxsshw00223cug6ovrfcpl"},{"post_id":"cmcvxsshx00233cughmsxhh74","category_id":"cmcvxsshu001e3cugd4j69n9v","_id":"cmcvxsshy00263cug07lcfynl"},{"post_id":"cmcvxsshx00243cugbsk96k2h","category_id":"cmcvxsshu001e3cugd4j69n9v","_id":"cmcvxsshy00283cuge9p9hjg9"},{"post_id":"cmcvxsshx00253cug6aacd1qn","category_id":"cmcvxsshy00273cug7e7xg4sm","_id":"cmcvxsshy00293cugdvwnfhnd"}],"PostTag":[{"post_id":"cmcvxsshq000p3cug0wg33dj8","tag_id":"cmcvxsshr000u3cug7msjcixq","_id":"cmcvxssht00113cug2yqn574y"},{"post_id":"cmcvxsshs000y3cug0vd4a3uk","tag_id":"cmcvxssht00103cugfnwx0urc","_id":"cmcvxsshu001g3cug91w504xp"},{"post_id":"cmcvxsshs000y3cug0vd4a3uk","tag_id":"cmcvxsshu00173cugc2nz06ja","_id":"cmcvxsshv001h3cug2rrd2pld"},{"post_id":"cmcvxsshs000y3cug0vd4a3uk","tag_id":"cmcvxsshu001c3cuge0fbeopb","_id":"cmcvxsshv001l3cugfkbld789"},{"post_id":"cmcvxsshs000y3cug0vd4a3uk","tag_id":"cmcvxsshr000u3cug7msjcixq","_id":"cmcvxsshv001m3cug64bx5hac"},{"post_id":"cmcvxsshs000z3cugcsk3gy2j","tag_id":"cmcvxsshu001f3cug850z1rkk","_id":"cmcvxsshv001p3cugd1yvh392"},{"post_id":"cmcvxsshs000z3cugcsk3gy2j","tag_id":"cmcvxsshv001k3cugg0co6i96","_id":"cmcvxsshv001s3cugggtj98ec"}],"Tag":[{"name":"LedgerJournalTrans","_id":"cmcvxsshr000u3cug7msjcixq"},{"name":"CustTrans","_id":"cmcvxssht00103cugfnwx0urc"},{"name":"VendTrans","_id":"cmcvxsshu00173cugc2nz06ja"},{"name":"Reversal","_id":"cmcvxsshu001c3cuge0fbeopb"},{"name":"ssrs","_id":"cmcvxsshu001f3cug850z1rkk"},{"name":"sales invoice report","_id":"cmcvxsshv001k3cugg0co6i96"}]}}